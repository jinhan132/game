window.Modernizr=function(t,e,i){var n="2.6.2",s={},r=true,a=e.documentElement,o="modernizr",l=e.createElement(o),_=l.style,h=e.createElement("input"),f=":)",C={}.toString,m=" -webkit- -moz- -o- -ms- ".split(" "),u="Webkit Moz O ms",T=u.split(" "),S=u.toLowerCase().split(" "),c={svg:"http://www.w3.org/2000/svg"},g={},E={},d={},O=[],D=O.slice,A,G=function(t,i,n,s){var r,l,_,h,f=e.createElement("div"),C=e.body,m=C||e.createElement("body");if(parseInt(n,10)){while(n--){_=e.createElement("div");_.id=s?s[n]:o+(n+1);f.appendChild(_)}}r=["&#173;",'<style id="s',o,'">',t,"</style>"].join("");f.id=o;(C?f:m).innerHTML+=r;m.appendChild(f);if(!C){m.style.background="";m.style.overflow="hidden";h=a.style.overflow;a.style.overflow="hidden";a.appendChild(m)}l=i(f,t);if(!C){m.parentNode.removeChild(m);a.style.overflow=h}else{f.parentNode.removeChild(f)}return!!l},F=function(e){var i=t.matchMedia||t.msMatchMedia;if(i){return i(e).matches}var n;G("@media "+e+" { #"+o+" { position: absolute; } }",function(e){n=(t.getComputedStyle?getComputedStyle(e,null):e.currentStyle)["position"]=="absolute"});return n},R=function(){var t={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};function n(n,s){s=s||e.createElement(t[n]||"div");n="on"+n;var r=n in s;if(!r){if(!s.setAttribute){s=e.createElement("div")}if(s.setAttribute&&s.removeAttribute){s.setAttribute(n,"");r=b(s[n],"function");if(!b(s[n],"undefined")){s[n]=i}s.removeAttribute(n)}}s=null;return r}return n}(),p={}.hasOwnProperty,I;if(!b(p,"undefined")&&!b(p.call,"undefined")){I=function(t,e){return p.call(t,e)}}else{I=function(t,e){return e in t&&b(t.constructor.prototype[e],"undefined")}}if(!Function.prototype.bind){Function.prototype.bind=function t(e){var i=this;if(typeof i!="function"){throw new TypeError}var n=D.call(arguments,1),s=function(){if(this instanceof s){var t=function(){};t.prototype=i.prototype;var r=new t;var a=i.apply(r,n.concat(D.call(arguments)));if(Object(a)===a){return a}return r}else{return i.apply(e,n.concat(D.call(arguments)))}};return s}}function M(t){_.cssText=t}function v(t,e){return M(m.join(t+";")+(e||""))}function b(t,e){return typeof t===e}function N(t,e){return!!~(""+t).indexOf(e)}function x(t,e){for(var n in t){var s=t[n];if(!N(s,"-")&&_[s]!==i){return e=="pfx"?s:true}}return false}function y(t,e,n){for(var s in t){var r=e[t[s]];if(r!==i){if(n===false)return t[s];if(b(r,"function")){return r.bind(n||e)}return r}}return false}function B(t,e,i){var n=t.charAt(0).toUpperCase()+t.slice(1),s=(t+" "+T.join(n+" ")+n).split(" ");if(b(e,"string")||b(e,"undefined")){return x(s,e)}else{s=(t+" "+S.join(n+" ")+n).split(" ");return y(s,e,i)}}g["flexbox"]=function(){return B("flexWrap")};g["flexboxlegacy"]=function(){return B("boxDirection")};g["canvas"]=function(){var t=e.createElement("canvas");return!!(t.getContext&&t.getContext("2d"))};g["canvastext"]=function(){return!!(s["canvas"]&&b(e.createElement("canvas").getContext("2d").fillText,"function"))};g["webgl"]=function(){return!!t.WebGLRenderingContext};g["touch"]=function(){var i;if("ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch){i=true}else{G(["@media (",m.join("touch-enabled),("),o,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(t){i=t.offsetTop===9})}return i};g["geolocation"]=function(){return"geolocation"in navigator};g["postmessage"]=function(){return!!t.postMessage};g["websqldatabase"]=function(){return!!t.openDatabase};g["indexedDB"]=function(){return!!B("indexedDB",t)};g["hashchange"]=function(){return R("hashchange",t)&&(e.documentMode===i||e.documentMode>7)};g["history"]=function(){return!!(t.history&&history.pushState)};g["draganddrop"]=function(){var t=e.createElement("div");return"draggable"in t||"ondragstart"in t&&"ondrop"in t};g["websockets"]=function(){return"WebSocket"in t||"MozWebSocket"in t};g["rgba"]=function(){M("background-color:rgba(150,255,150,.5)");return N(_.backgroundColor,"rgba")};g["hsla"]=function(){M("background-color:hsla(120,40%,100%,.5)");return N(_.backgroundColor,"rgba")||N(_.backgroundColor,"hsla")};g["multiplebgs"]=function(){M("background:url(https://),url(https://),red url(https://)");return/(url\s*\(.*?){3}/.test(_.background)};g["backgroundsize"]=function(){return B("backgroundSize")};g["borderimage"]=function(){return B("borderImage")};g["borderradius"]=function(){return B("borderRadius")};g["boxshadow"]=function(){return B("boxShadow")};g["textshadow"]=function(){return e.createElement("div").style.textShadow===""};g["opacity"]=function(){v("opacity:.55");return/^0.55$/.test(_.opacity)};g["cssanimations"]=function(){return B("animationName")};g["csscolumns"]=function(){return B("columnCount")};g["cssgradients"]=function(){var t="background-image:",e="gradient(linear,left top,right bottom,from(#9f9),to(white));",i="linear-gradient(left top,#9f9, white);";M((t+"-webkit- ".split(" ").join(e+t)+m.join(i+t)).slice(0,-t.length));return N(_.backgroundImage,"gradient")};g["cssreflections"]=function(){return B("boxReflect")};g["csstransforms"]=function(){return!!B("transform")};g["csstransforms3d"]=function(){var t=!!B("perspective");if(t&&"webkitPerspective"in a.style){G("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(e,i){t=e.offsetLeft===9&&e.offsetHeight===3})}return t};g["csstransitions"]=function(){return B("transition")};g["fontface"]=function(){var t;G('@font-face {font-family:"font";src:url("https://")}',function(i,n){var s=e.getElementById("smodernizr"),r=s.sheet||s.styleSheet,a=r?r.cssRules&&r.cssRules[0]?r.cssRules[0].cssText:r.cssText||"":"";t=/src/i.test(a)&&a.indexOf(n.split(" ")[0])===0});return t};g["generatedcontent"]=function(){var t;G(["#",o,"{font:0/0 a}#",o,':after{content:"',f,'";visibility:hidden;font:3px/1 a}'].join(""),function(e){t=e.offsetHeight>=3});return t};g["video"]=function(){var t=e.createElement("video"),i=false;try{if(i=!!t.canPlayType){i=new Boolean(i);i.ogg=t.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,"");i.h264=t.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,"");i.webm=t.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}}catch(t){}return i};g["audio"]=function(){var t=e.createElement("audio"),i=false;try{if(i=!!t.canPlayType){i=new Boolean(i);i.ogg=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"");i.mp3=t.canPlayType("audio/mpeg;").replace(/^no$/,"");i.wav=t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"");i.m4a=(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,"")}}catch(t){}return i};g["localstorage"]=function(){try{localStorage.setItem(o,o);localStorage.removeItem(o);return true}catch(t){return false}};g["sessionstorage"]=function(){try{sessionStorage.setItem(o,o);sessionStorage.removeItem(o);return true}catch(t){return false}};g["webworkers"]=function(){return!!t.Worker};g["applicationcache"]=function(){return!!t.applicationCache};g["svg"]=function(){return!!e.createElementNS&&!!e.createElementNS(c.svg,"svg").createSVGRect};g["inlinesvg"]=function(){var t=e.createElement("div");t.innerHTML="<svg/>";return(t.firstChild&&t.firstChild.namespaceURI)==c.svg};g["smil"]=function(){return!!e.createElementNS&&/SVGAnimate/.test(C.call(e.createElementNS(c.svg,"animate")))};g["svgclippaths"]=function(){return!!e.createElementNS&&/SVGClipPath/.test(C.call(e.createElementNS(c.svg,"clipPath")))};function L(){s["input"]=function(i){for(var n=0,s=i.length;n<s;n++){d[i[n]]=!!(i[n]in h)}if(d.list){d.list=!!(e.createElement("datalist")&&t.HTMLDataListElement)}return d}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" "));s["inputtypes"]=function(t){for(var n=0,s,r,o,l=t.length;n<l;n++){h.setAttribute("type",r=t[n]);s=h.type!=="text";if(s){h.value=f;h.style.cssText="position:absolute;visibility:hidden;";if(/^range$/.test(r)&&h.style.WebkitAppearance!==i){a.appendChild(h);o=e.defaultView;s=o.getComputedStyle&&o.getComputedStyle(h,null).WebkitAppearance!=="textfield"&&h.offsetHeight!==0;a.removeChild(h)}else if(/^(search|tel)$/.test(r)){}else if(/^(url|email)$/.test(r)){s=h.checkValidity&&h.checkValidity()===false}else{s=h.value!=f}}E[t[n]]=!!s}return E}("search tel url email datetime date month week time datetime-local number range color".split(" "))}for(var P in g){if(I(g,P)){A=P.toLowerCase();s[A]=g[P]();O.push((s[A]?"":"no-")+A)}}s.input||L();s.addTest=function(t,e){if(typeof t=="object"){for(var n in t){if(I(t,n)){s.addTest(n,t[n])}}}else{t=t.toLowerCase();if(s[t]!==i){return s}e=typeof e=="function"?e():e;if(typeof r!=="undefined"&&r){a.className+=" "+(e?"":"no-")+t}s[t]=e}return s};M("");l=h=null;(function(t,e){var i=t.html5||{};var n=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i;var s=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i;var r;var a="_html5shiv";var o=0;var l={};var _;(function(){try{var t=e.createElement("a");t.innerHTML="<xyz></xyz>";r="hidden"in t;_=t.childNodes.length==1||function(){e.createElement("a");var t=e.createDocumentFragment();return typeof t.cloneNode=="undefined"||typeof t.createDocumentFragment=="undefined"||typeof t.createElement=="undefined"}()}catch(t){r=true;_=true}})();function h(t,e){var i=t.createElement("p"),n=t.getElementsByTagName("head")[0]||t.documentElement;i.innerHTML="x<style>"+e+"</style>";return n.insertBefore(i.lastChild,n.firstChild)}function f(){var t=c.elements;return typeof t=="string"?t.split(" "):t}function C(t){var e=l[t[a]];if(!e){e={};o++;t[a]=o;l[o]=e}return e}function m(t,i,r){if(!i){i=e}if(_){return i.createElement(t)}if(!r){r=C(i)}var a;if(r.cache[t]){a=r.cache[t].cloneNode()}else if(s.test(t)){a=(r.cache[t]=r.createElem(t)).cloneNode()}else{a=r.createElem(t)}return a.canHaveChildren&&!n.test(t)?r.frag.appendChild(a):a}function u(t,i){if(!t){t=e}if(_){return t.createDocumentFragment()}i=i||C(t);var n=i.frag.cloneNode(),s=0,r=f(),a=r.length;for(;s<a;s++){n.createElement(r[s])}return n}function T(t,e){if(!e.cache){e.cache={};e.createElem=t.createElement;e.createFrag=t.createDocumentFragment;e.frag=e.createFrag()}t.createElement=function(i){if(!c.shivMethods){return e.createElem(i)}return m(i,t,e)};t.createDocumentFragment=Function("h,f","return function(){"+"var n=f.cloneNode(),c=n.createElement;"+"h.shivMethods&&("+f().join().replace(/\w+/g,function(t){e.createElem(t);e.frag.createElement(t);return'c("'+t+'")'})+");return n}")(c,e.frag)}function S(t){if(!t){t=e}var i=C(t);if(c.shivCSS&&!r&&!i.hasCSS){i.hasCSS=!!h(t,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}"+"mark{background:#FF0;color:#000}")}if(!_){T(t,i)}return t}var c={elements:i.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:i.shivCSS!==false,supportsUnknownElements:_,shivMethods:i.shivMethods!==false,type:"default",shivDocument:S,createElement:m,createDocumentFragment:u};t.html5=c;S(e)})(this,e);s._version=n;s._prefixes=m;s._domPrefixes=S;s._cssomPrefixes=T;s.mq=F;s.hasEvent=R;s.testProp=function(t){return x([t])};s.testAllProps=B;s.testStyles=G;s.prefixed=function(t,e,i){if(!e){return B(t,"pfx")}else{return B(t,e,i)}};a.className=a.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(r?" js "+O.join(" "):"");return s}(this,this.document);"use strict";if(!Number.isInteger){Number.isInteger=function t(e){return typeof e==="number"&&isFinite(e)&&e>-9007199254740992&&e<9007199254740992&&Math.floor(e)===e}}function StringView(t,e,i,n){var s,r,a,o,l,_,h=isFinite(i)?i:0,f=15;if(e){this.encoding=e.toString()}t:switch(this.encoding){case"UTF-8":o=StringView.putUTF8CharCode;l=StringView.getUTF8CharLength;s=Uint8Array;break t;case"UTF-16":o=StringView.putUTF16CharCode;l=StringView.getUTF16CharLength;s=Uint16Array;break t;case"UTF-32":s=Uint32Array;f&=14;break t;default:s=Uint8Array;f&=14}t:switch(typeof t){case"string":f&=7;break t;case"object":e:switch(t.constructor){case StringView:f&=3;break t;case String:f&=7;break t;case ArrayBuffer:r=new s(t);_=this.encoding==="UTF-32"?t.byteLength>>>2:this.encoding==="UTF-16"?t.byteLength>>>1:t.byteLength;a=h===0&&(!isFinite(n)||n===_)?r:new s(t,h,!isFinite(n)?_-h:n);break t;case Uint32Array:case Uint16Array:case Uint8Array:s=t.constructor;_=t.length;r=t.byteOffset===0&&t.length===(s===Uint32Array?t.buffer.byteLength>>>2:s===Uint16Array?t.buffer.byteLength>>>1:t.buffer.byteLength)?t:new s(t.buffer);a=h===0&&(!isFinite(n)||n===_)?t:t.subarray(h,isFinite(n)?h+n:_);break t;default:r=new s(t);_=r.length;a=h===0&&(!isFinite(n)||n===_)?r:r.subarray(h,isFinite(n)?h+n:_)}break t;default:r=a=new s(Number(t)||0)}if(f<8){var C,m,u,T,S,c,g;if(f&4){C=t;m=_=C.length;f^=this.encoding==="UTF-32"?0:2;h=u=i?Math.max((m+i)%m,0):0;S=T=(Number.isInteger(n)?Math.min(Math.max(n,0)+h,m):m)-1}else{C=t.rawData;_=t.makeIndex();h=u=i?Math.max((_+i)%_,0):0;m=Number.isInteger(n)?Math.min(Math.max(n,0),_-u):_;S=T=m+u;if(t.encoding==="UTF-8"){c=StringView.getUTF8CharLength;g=StringView.loadUTF8CharCode}else if(t.encoding==="UTF-16"){c=StringView.getUTF16CharLength;g=StringView.loadUTF16CharCode}else{f&=1}}if(m===0||f<4&&C.encoding===this.encoding&&u===0&&m===_){f=7}t:switch(f){case 0:r=new s(m);for(var E=0;E<m;r[E]=C[h+E++]);break t;case 1:m=0;for(var d=h;d<S;d++){m+=l(C[d])}r=new s(m);for(var d=h,E=0;E<m;d++){E=o(r,C[d],E)}break t;case 2:h=0;var O;for(D=0;D<u;D++){O=g(C,h);h+=c(O)}r=new s(m);for(var d=h,E=0;E<m;d+=c(O),E++){O=g(C,d);r[E]=O}break t;case 3:m=0;var O;for(var D=0,d=0;D<T;d+=c(O)){O=g(C,d);if(D===u){h=d}if(++D>u){m+=l(O)}}r=new s(m);for(var d=h,E=0;E<m;d+=c(O)){O=g(C,d);E=o(r,O,E)}break t;case 4:r=new s(m);for(var A=0;A<m;A++){r[A]=C.charCodeAt(A)&255}break t;case 5:m=0;for(var G=0;G<_;G++){if(G===u){h=m}m+=l(C.charCodeAt(G));if(G===T){S=m}}r=new s(m);for(var E=0,D=0;E<m;D++){E=o(r,C.charCodeAt(D),E)}break t;case 6:r=new s(m);for(var A=0;A<m;A++){r[A]=C.charCodeAt(A)}break t;case 7:r=new s(m?C:0);break t}a=f>3&&(h>0||S<r.length-1)?r.subarray(h,S):r}this.buffer=r.buffer;this.bufferView=r;this.rawData=a;Object.freeze(this)}StringView.loadUTF8CharCode=function(t,e){var i=t.length,n=t[e];return n>251&&n<254&&e+5<i?(n-252)*1073741824+(t[e+1]-128<<24)+(t[e+2]-128<<18)+(t[e+3]-128<<12)+(t[e+4]-128<<6)+t[e+5]-128:n>247&&n<252&&e+4<i?(n-248<<24)+(t[e+1]-128<<18)+(t[e+2]-128<<12)+(t[e+3]-128<<6)+t[e+4]-128:n>239&&n<248&&e+3<i?(n-240<<18)+(t[e+1]-128<<12)+(t[e+2]-128<<6)+t[e+3]-128:n>223&&n<240&&e+2<i?(n-224<<12)+(t[e+1]-128<<6)+t[e+2]-128:n>191&&n<224&&e+1<i?(n-192<<6)+t[e+1]-128:n};StringView.putUTF8CharCode=function(t,e,i){var n=i;if(e<128){t[n++]=e}else if(e<2048){t[n++]=192+(e>>>6);t[n++]=128+(e&63)}else if(e<65536){t[n++]=224+(e>>>12);t[n++]=128+(e>>>6&63);t[n++]=128+(e&63)}else if(e<2097152){t[n++]=240+(e>>>18);t[n++]=128+(e>>>12&63);t[n++]=128+(e>>>6&63);t[n++]=128+(e&63)}else if(e<67108864){t[n++]=248+(e>>>24);t[n++]=128+(e>>>18&63);t[n++]=128+(e>>>12&63);t[n++]=128+(e>>>6&63);t[n++]=128+(e&63)}else{t[n++]=252+e/1073741824;t[n++]=128+(e>>>24&63);t[n++]=128+(e>>>18&63);t[n++]=128+(e>>>12&63);t[n++]=128+(e>>>6&63);t[n++]=128+(e&63)}return n};StringView.getUTF8CharLength=function(t){return t<128?1:t<2048?2:t<65536?3:t<2097152?4:t<67108864?5:6};StringView.loadUTF16CharCode=function(t,e){var i=t[e];return i>55231&&e+1<t.length?(i-55296<<10)+t[e+1]+9216:i};StringView.putUTF16CharCode=function(t,e,i){var n=i;if(e<65536){t[n++]=e}else{t[n++]=55232+(e>>>10);t[n++]=56320+(e&1023)}return n};StringView.getUTF16CharLength=function(t){return t<65536?1:2};StringView.b64ToUint6=function(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0};StringView.uint6ToB64=function(t){return t<26?t+65:t<52?t+71:t<62?t-4:t===62?43:t===63?47:65};StringView.bytesToBase64=function(t){var e="";var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var n=t;var s=n.byteLength;var r=s%3;var a=s-r;var o,l,_,h;var f;for(var C=0;C<a;C=C+3){f=n[C]<<16|n[C+1]<<8|n[C+2];o=(f&16515072)>>18;l=(f&258048)>>12;_=(f&4032)>>6;h=f&63;e+=i[o]+i[l]+i[_]+i[h]}if(r==1){f=n[a];o=(f&252)>>2;l=(f&3)<<4;e+=i[o]+i[l]+"=="}else if(r==2){f=n[a]<<8|n[a+1];o=(f&64512)>>10;l=(f&1008)>>4;_=(f&15)<<2;e+=i[o]+i[l]+i[_]+"="}return e};StringView.base64ToBytes=function(t,e){var i=t.replace(/[^A-Za-z0-9\+\/]/g,"");var n=i.length,s=e?Math.ceil((n*3+1>>>2)/e)*e:n*3+1>>>2,r=new Uint8Array(s);for(var a,o,l=0,_=0,h=0;h<n;h++){o=h&3;l|=StringView.b64ToUint6(i.charCodeAt(h))<<18-6*o;if(o===3||n-h===1){for(a=0;a<3&&_<s;a++,_++){r[_]=l>>>(16>>>a&24)&255}l=0}}return r};StringView.makeFromBase64=function(t,e,i,n){return new StringView(e==="UTF-16"||e==="UTF-32"?StringView.base64ToBytes(t,e==="UTF-16"?2:4).buffer:StringView.base64ToBytes(t),e,i,n)};StringView.prototype.encoding="UTF-8";StringView.prototype.makeIndex=function(t,e){var i=this.rawData,n,s=i.length,r=e||0,a=r,o=isNaN(t)?Infinity:t;if(t+1>i.length){throw new RangeError("StringView.prototype.makeIndex - The offset can't be major than the length of the array - 1.")}switch(this.encoding){case"UTF-8":var l;for(n=0;a<s&&n<o;n++){l=i[a];a+=l>251&&l<254&&a+5<s?6:l>247&&l<252&&a+4<s?5:l>239&&l<248&&a+3<s?4:l>223&&l<240&&a+2<s?3:l>191&&l<224&&a+1<s?2:1}break;case"UTF-16":for(n=r;a<s&&n<o;n++){a+=i[a]>55231&&a+1<i.length?2:1}break;default:a=n=isFinite(t)?t:s-1}if(t){return a}return n};StringView.prototype.toBase64=function(t){var e;if(t){if(this.bufferView.constructor===Uint8Array)e=this.bufferView;else e=new Uint8Array(this.buffer)}else{if(this.rawData.constructor===Uint8Array){e=this.rawData}else{e=new Uint8Array(this.buffer,this.rawData.byteOffset,this.rawData.length<<(this.rawData.constructor===Uint16Array?1:2))}}return StringView.bytesToBase64(e)};StringView.prototype.subview=function(t,e){var i,n,s,r=this.encoding==="UTF-8"||this.encoding==="UTF-16",a=t,o,l=this.rawData.length;if(l===0){return new StringView(this.buffer,this.encoding)}o=r?this.makeIndex():l;n=t?Math.max((o+t)%o,0):0;s=Number.isInteger(e)?Math.max(e,0)+n>o?o-n:e:o;if(n===0&&s===o){return this}if(r){a=this.makeIndex(n);i=this.makeIndex(s,a)-a}else{a=n;i=s-n}if(this.encoding==="UTF-16"){a<<=1}else if(this.encoding==="UTF-32"){a<<=2}return new StringView(this.buffer,this.encoding,a,i)};StringView.prototype.forEachChar=function(t,e,i,n){var s=this.rawData,r,a;if(this.encoding==="UTF-8"||this.encoding==="UTF-16"){var o,l;if(this.encoding==="UTF-8"){o=StringView.getUTF8CharLength;l=StringView.loadUTF8CharCode}else if(this.encoding==="UTF-16"){o=StringView.getUTF16CharLength;l=StringView.loadUTF16CharCode}a=isFinite(i)?this.makeIndex(i):0;r=isFinite(n)?this.makeIndex(n,a):s.length;for(var _,h=0;a<r;h++){_=l(s,a);t.call(e||null,_,h,a,s);a+=o(_)}}else{a=isFinite(i)?i:0;r=isFinite(n)?n+a:s.length;for(a;a<r;a++){t.call(e||null,s[a],a,a,s)}}};StringView.prototype.valueOf=StringView.prototype.toString=function(){if(this.encoding!=="UTF-8"&&this.encoding!=="UTF-16"){return String.fromCharCode.apply(null,this.rawData)}var t,e,i="";if(this.encoding==="UTF-8"){e=StringView.getUTF8CharLength;t=StringView.loadUTF8CharCode}else if(this.encoding==="UTF-16"){e=StringView.getUTF16CharLength;t=StringView.loadUTF16CharCode}for(var n,s=this.rawData.length,r=0;r<s;r+=e(n)){n=t(this.rawData,r);i+=String.fromCharCode(n)}return i};var vxSound=vxSound||{};vxSound.context=null;vxSound.Init=function(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext;vxSound.context=new AudioContext;console.log("Web Audio API(WAA) is supported in this browser. ")}catch(t){console.log("Web Audio API(WAA) is not supported in this browser. So, use the html5 Audio.")}};vxSound.IsPossible=function(){if(vxSound.context)return true;else return false};vxSound.SupportExt=function(){var t=document.createElement("audio");var e=!!(t.canPlayType&&t.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""));var i=!!(t.canPlayType&&t.canPlayType("audio/mpeg;").replace(/no/,""));if(i)strExt="mp3";else if(e)strExt="ogg";else strExt="";console.log("sound file ext is selected : "+strExt);return strExt};function CSound(t){var e=this;this.m_url=t;this.m_buffer=null;if(!vxSound.context.createGain)vxSound.context.createGain=vxSound.context.createGainNode;this.coreNode=vxSound.context.createGain();this.gainNode=vxSound.context.createGain();this.gainNode.connect(this.coreNode);this.Delete=function(){this.m_source.disconnect();this.m_source=null;this.gainNode.disconnect();this.gainNode=null;this.coreNode.disconnect();this.coreNode=null};this.start=function(){var t=this;var e=new XMLHttpRequest;e.open("GET",this.m_url,true);e.responseType="arraybuffer";e.onreadystatechange=function(){if(e.readyState===4&&e.status===200){}else if(e.readyState===4&&e.status===404){console.log("Page not found");t.onLoad(false)}};e.onload=function(){vxSound.context.decodeAudioData(e.response,function(e){t.m_buffer=e;t.onLoad(true)},t.onError)};e.progress=function(){t.onLoad(false)};e.error=function(){t.onLoad(false)};e.abort=function(){t.onLoad(false)};e.send()};this.onLoad=function(t){if(t)console.log("Sound load completed");else console.log("Sound load failed")};this.onError=function(t){console.log("decodeAudioData Error");this.onLoad(false)};this.play=function(t,e){t=typeof t!=="undefined"?t:false;e=typeof e!=="undefined"?e:0;this.m_source=vxSound.context.createBufferSource();this.m_source.buffer=this.m_buffer;this.m_source.connect(this.gainNode);this.coreNode.connect(vxSound.context.destination);if(t)this.m_source.loop=true;if(!this.m_source.start)this.m_source.start=this.m_source.noteOn;this.m_source.start(e)};this.pause=function(){this.m_source.disconnect()};this.resume=function(){this.m_source.connect(this.gainNode)};this.stop=function(){if(!this.m_source.stop)this.m_source.stop=this.m_source.noteOff;this.m_source.stop(0)};this.setVolume=function(t){t=typeof t!=="undefined"?t:0;if(t>=0&&t<=1)this.gainNode.gain.value=t}}(function(t){function e(t){var e=0;var n=0;t=t||{};this.settings=t;if(t.statusInterval==null){t.statusInterval=5e3}if(t.loggingDelay==null){t.loggingDelay=20*1e3}if(t.noProgressTimeout==null){t.noProgressTimeout=Infinity}var s=[],r=[],a,o=Date.now();var l={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4};var _=function(t){if(t==null){return[]}if(Array.isArray(t)){return t}return[t]};this.add=function(t){t.tags=new i(t.tags);if(t.priority==null){t.priority=Infinity}s.push({resource:t,status:l.QUEUED})};this.addProgressListener=function(t,e){r.push({callback:t,tags:new i(e)})};this.addCompletionListener=function(t,e){r.push({tags:new i(e),callback:function(e){if(e.completedCount===e.totalCount){t(e)}}})};var h=function(t){t=_(t);var e=function(e){var i=e.resource,n=Infinity;for(var s=0;s<i.tags.length;s++){for(var r=0;r<Math.min(t.length,n);r++){if(i.tags.all[s]===t[r]&&r<n){n=r;if(n===0){break}}if(n===0){break}}}return n};return function(t,i){var n=e(t),s=e(i);if(n<s){return-1}if(n>s){return 1}if(t.priority<i.priority){return-1}if(t.priority>i.priority){return 1}return 0}};this.start=function(t){a=Date.now();var e=h(t);s.sort(e);for(var i=0,n=s.length;i<n;i++){var r=s[i];r.status=l.WAITING}this.nextStep()};this.nextStep=function(){s[e].resource.start(this)};this.clear=function(){for(var t=0,e=s.length;t<e;t++){var i=s[t];i.resource.clear()}s.splice(0,e)};var f=function(){var e=false,i=Date.now()-o,n=i>=t.noProgressTimeout,r=i>=t.loggingDelay;for(var a=0,_=s.length;a<_;a++){var h=s[a];if(h.status!==l.WAITING){continue}if(h.resource.checkStatus){h.resource.checkStatus()}if(h.status===l.WAITING){if(n){h.resource.onTimeout()}else{e=true}}}if(r&&e){u()}if(e){setTimeout(f,t.statusInterval)}};this.isBusy=function(){for(var t=0,e=s.length;t<e;t++){if(s[t].status===l.QUEUED||s[t].status===l.WAITING){return true}}return false};var C=function(e,i){var n=null,a,_,h,f,C;for(a=0,_=s.length;a<_;a++){if(s[a].resource===e){n=s[a];break}}if(n==null||n.status!==l.WAITING){return}n.status=i;o=Date.now();h=e.tags.length;for(a=0,_=r.length;a<_;a++){f=r[a];if(f.tags.length===0){C=true}else{C=e.tags.intersects(f.tags)}if(C){m(n,f,t.owner)}}};this.onLoad=function(t){C(t,l.LOADED);if(t.audio){var i="";if(t.audio.src)i=t.audio.src;if(t.audio.m_url)i=t.audio.m_url}n++;if(s.length>n){if(s.length-1>e){e++;this.nextStep()}}else{n=0}};this.onError=function(t){C(t,l.ERROR)};this.onTimeout=function(t){C(t,l.TIMEOUT)};var m=function(t,e,i){var n=0,r=0,a,o,_,h;for(a=0,o=s.length;a<o;a++){_=s[a];h=false;if(e.tags.length===0){h=true}else{h=_.resource.tags.intersects(e.tags)}if(h){r++;if(_.status===l.LOADED||_.status===l.ERROR||_.status===l.TIMEOUT){n++}}}e.callback({resource:t.resource,loaded:t.status===l.LOADED,error:t.status===l.ERROR,timeout:t.status===l.TIMEOUT,completedCount:n,totalCount:r,eventOwner:i})};var u=this.log=function(t){if(!window.console){return}var e=Math.round((Date.now()-a)/1e3);window.console.log("PxLoader elapsed: "+e+" sec");for(var i=0,n=s.length;i<n;i++){var r=s[i];if(!t&&r.status!==l.WAITING){continue}var o="PxLoader: #"+i+" "+r.resource.getName();switch(r.status){case l.QUEUED:o+=" (Not Started)";break;case l.WAITING:o+=" (Waiting)";break;case l.LOADED:o+=" (Loaded)";break;case l.ERROR:o+=" (Error)";break;case l.TIMEOUT:o+=" (Timeout)";break}if(r.resource.tags.length>0){o+=" Tags: ["+r.resource.tags.all.join(",")+"]"}window.console.log(o)}}}function i(t){this.all=[];this.first=null;this.length=0;this.lookup={};if(t){if(Array.isArray(t)){this.all=t.slice(0)}else if(typeof t==="object"){for(var e in t){if(t.hasOwnProperty(e)){this.all.push(e)}}}else{this.all.push(t)}this.length=this.all.length;if(this.length>0){this.first=this.all[0]}for(var i=0;i<this.length;i++){this.lookup[this.all[i]]=true}}}i.prototype.intersects=function(t){if(this.length===0||t.length===0){return false}if(this.length===1&&t.length===1){return this.first===t.first}if(t.length<this.length){return t.intersects(this)}for(var e in this.lookup){if(t.lookup[e]){return true}}return false};if(typeof define==="function"&&define.amd){define("PxLoader",[],function(){return e})}t.PxLoader=e})(this);if(!Date.now){Date.now=function t(){return(new Date).getTime()}}if(!Array.isArray){Array.isArray=function(t){return Object.prototype.toString.call(t)==="[object Array]"}}function PxLoaderImage(t,e,i){var n=this,s=null;this.img=new Image;this.tags=e;this.priority=i;var r=function(){if(n.img.readyState==="complete"){l();s.onLoad(n)}};var a=function(){l();s.onLoad(n)};var o=function(){l();s.onError(n)};var l=function(){n.unbind("load",a);n.unbind("readystatechange",r);n.unbind("error",o)};this.start=function(e){s=e;n.bind("load",a);n.bind("readystatechange",r);n.bind("error",o);n.img.src=t};this.clear=function(){n=null;s=null;this.img=null;this.tags=null;this.priority=null};this.checkStatus=function(){if(n.img.complete){l();s.onLoad(n)}};this.onTimeout=function(){l();if(n.img.complete){s.onLoad(n)}else{s.onTimeout(n)}};this.getName=function(){return t};this.bind=function(t,e){if(n.img.addEventListener){n.img.addEventListener(t,e,false)}else if(n.img.attachEvent){n.img.attachEvent("on"+t,e)}};this.unbind=function(t,e){if(n.img.removeEventListener){n.img.removeEventListener(t,e,false)}else if(n.img.detachEvent){n.img.detachEvent("on"+t,e)}}}PxLoader.prototype.addImage=function(t,e,i){var n=new PxLoaderImage(t,e,i);this.add(n);return n.img};if(typeof define==="function"&&define.amd){define("PxLoaderImage",[],function(){return PxLoaderImage})}function PxLoaderSound(t,e,i,n){var s=this,r=null;this.tags=i;this.priority=n;this.id=t;this.url=e;this.audio=null;this.audioSupport=function(){var t=document.createElement("audio");var e=!!(t.canPlayType&&t.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""));if(e)return"ogg";var i=!!(t.canPlayType&&t.canPlayType("audio/mpeg;").replace(/no/,""));if(i)return"mp3";else return 0};this.support={};this.support.audio=s.audioSupport();this.start=function(t){r=t;var e=false;if(vxSound.IsPossible())e=true;if(!e){if(vxSound.IsPossible()){this.audio=new CSound(s.url);this.audio.start()}else{this.audio=new Audio;this.audio.src=s.url;this.audio.preload="auto";this.audio.volume=1}r.onLoad(s);return}else{if(vxSound.IsPossible()){this.audio=new CSound(s.url);this.audio.onLoad=function(){r.onLoad(s)};this.audio.start()}else{try{this.audio=new Audio;this.audio.src=s.url;this.audio.preload="auto";this.audio.volume=1;this.audio.onloadeddata=function(){r.onLoad(s)}}catch(t){r.onLoad(s)}}}};this.clear=function(){s=null;r=null;this.tags=null;this.sound=null;this.priority=null};this.checkStatus=function(){switch(s.sound["readyState"]){case 0:break;case 1:break;case 2:r.onError(s);break;case 3:r.onLoad(s);break}};this.onTimeout=function(){r.onTimeout(s)};this.getName=function(){return e}}PxLoader.prototype.addSound=function(t,e,i,n){var s=new PxLoaderSound(t,e,i,n);this.add(s);return s};if(typeof define==="function"&&define.amd){define("PxLoaderSound",[],function(){return PxLoaderSound})}function PxLoaderXML(t,e,i){var n=this,s=null;this.xhr=new XMLHttpRequest;this.tags=e;this.priority=i;var r=function(){if(n.xhr.readyState===4){l();if(n.xhr.status==0||n.xhr.status==200){s.onLoad(n)}else{s.onError(n)}}};var a=function(){l();s.onLoad(n)};var o=function(t){l();s.onError(n)};var l=function(){n.unbind("load",a);n.unbind("readystatechange",r);n.unbind("error",o)};this.start=function(e){s=e;n.bind("load",a);n.bind("readystatechange",r);n.bind("error",o);n.xhr.open("GET",t);n.xhr.send(null)};this.clear=function(){n=null;s=null;this.xhr=null;this.tags=null};this.checkStatus=function(){if(n.xhr.readyState!==4){return}l();s.onLoad(n)};this.onTimeout=function(){l();if(n.xhr.readyState!==4){s.onLoad(n)}else{s.onTimeout(n)}};this.getName=function(){return t};this.bind=function(t,e){if(n.xhr.addEventListener){n.xhr.addEventListener(t,e,false)}else if(n.xhr.attachEvent){n.xhr.attachEvent("on"+t,e)}};this.unbind=function(t,e){if(n.xhr.removeEventListener){n.xhr.removeEventListener(t,e,false)}else if(n.xhr.detachEvent){n.xhr.detachEvent("on"+t,e)}}}PxLoader.prototype.addXML=function(t,e,i){var n=new PxLoaderXML(t,e,i);this.add(n);return n.xhr};if(typeof define==="function"&&define.amd){define("PxLoaderXML",[],function(){return PxLoaderXML})}var vx=vx||{};(function(){var t=false,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;vx.Class=function(){};vx.Class.extend=function(i){var n=this.prototype;t=true;var s=new this;t=false;for(var r in i){s[r]=typeof i[r]=="function"&&typeof n[r]=="function"&&e.test(i[r])?function(t,e){return function(){var i=this._super;this._super=n[t];var s=e.apply(this,arguments);this._super=i;return s}}(r,i[r]):i[r]}function a(){if(!t&&this.init)this.init.apply(this,arguments)}a.prototype=s;a.prototype.constructor=a;a.extend=arguments.callee;return a}})();if(!Array.prototype.indexOf){Array.prototype.indexOf=function(t){var e=this.length>>>0;var i=Number(arguments[1])||0;i=i<0?Math.ceil(i):Math.floor(i);if(i<0)i+=e;for(;i<e;i++){if(i in this&&this[i]===t)return i}return-1}}if(!String.format){String.format=function(){for(var t=0,e=arguments;t<e.length-1;t++)e[0]=e[0].replace(RegExp("\\{"+t+"\\}","gm"),e[t+1]);return e[0]}}if(!String.prototype.format&&String.format){String.prototype.format=function(){var t=Array.prototype.slice.call(arguments).reverse();t.push(this);return String.format.apply(this,t.reverse())}}function ObArray(){Array.apply(this)}ObArray.prototype=new Array;ObArray.prototype.constructor=ObArray;ObArray.prototype.last=function(){return this[this.length-1]};ObArray.prototype.GetSize=function(){return this.length};ObArray.prototype.SetSize=function(t){this.length=t;for(var e=0;e<t;e++){if(this[e]==undefined)this[e]=null}};ObArray.prototype.SetSizeNum=function(t){this.length=t;for(var e=0;e<t;e++){if(this[e]==undefined)this[e]=0}};ObArray.prototype.RemoveAll=function(){var t=this.length;for(var e=0;e<t;e++){this[e]=null}this.splice(0,t)};ObArray.prototype.GetAt=function(t){if(t>=0&&t<this.length){return this[t]}return null};ObArray.prototype.SetAt=function(t,e){if(t>=0&&t<this.length){this[t]=e}};ObArray.prototype.Add=function(t){this.push(t)};ObArray.prototype.InsertAt=function(t,e){if(this.length==0){this.splice(0,0,e);return 0}else if(t>=0&&t<this.length){this.splice(t,0,e);return t}else{this.push(e);return this.length-1}};ObArray.prototype.RemoveAt=function(t){if(t>=0&&t<this.length){var e=this[t];this[t]=null;this.splice(t,1);return e}return null};ObArray.prototype.RemoveHead=function(){if(this.length>0)return this.shift();else return null};ObArray.prototype.RemoveTail=function(){if(this.length>0)return this.pop();else return null};ObArray.prototype.GetHead=function(){if(this.length>0)return this[0];else return null};ObArray.prototype.GetTail=function(){if(this.length>0)return this[this.length-1];else return null};ObArray.prototype.AddHead=function(t){this.splice(0,0,t)};ObArray.prototype.AddTail=function(t){this.push(t)};ObArray.prototype.AddHeads=function(t){if(t instanceof Array){var e=t.length;for(var i=e-1;i>=0;i--){this.InsertAt(0,t[i])}}};ObArray.prototype.AddTails=function(t){if(t instanceof Array){var e=t.length;for(var i=0;i<e;i++){this.push(t[i])}}};ObArray.prototype.FindObject=function(t,e){if(arguments.length!=2)e=0;return this.indexOf(t,e)};ObArray.prototype.RemoveObject=function(t,e){if(arguments.length!=2)e=0;var i=this.indexOf(t,e);if(i>=0&&i<this.length){this[i]=null;this.splice(i,1)}};ObArray.prototype.ReverseFind=function(t,e){if(e==undefined)e=this.length-1;return this.lastIndexOf(t,e)};ObArray.prototype.GetTailPosition=function(){if(this.length==0)return 0;else return this.length};Map=function(){this.map=new Object};Map.prototype={put:function(t,e){this.map[t]=e},get:function(t){return this.map[t]},containsKey:function(t){return t in this.map},containsValue:function(t){for(var e in this.map){if(this.map[e]==t)return true}return false},isEmpty:function(t){return this.size()==0},clear:function(){for(var t in this.map){delete this.map[t]}},remove:function(t){delete this.map[t]},keys:function(){var t=new Array;for(var e in this.map){t.push(e)}return t},values:function(){var t=new Array;for(var e in this.map){t.push(this.map[e])}return t},size:function(){var t=0;for(var e in this.map){t++}return t}};vx.trace=function(t){if(!vx.bDebug)return;try{var e=new Date;var i=String.format("[{0}:{1}:{2}:{3}] ",e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds());for(var n=0;n<arguments.length;n++){i+=arguments[n].toString();if(n!=arguments.length-1)i+=" "}if(vx.logchat){vx.logchat.AddStringEx(i+"\n",true,16777215,0)}console.log(i)}catch(t){return}};vx.rect=vx.Class.extend({init:function(t,e,i,n){if(arguments.length==0){t=0;e=0;i=0;n=0}this.left=t;this.top=e;this.right=i;this.bottom=n},valueOf:function(){return String.format("(left={0}, top={1}, right={2}, bottom={3}, ({4} x {5})) ",Math.round(this.left),Math.round(this.top),Math.round(this.right),Math.round(this.bottom),Math.round(this.Width()),Math.round(this.Height()))},toString:function(){return String.format("(left={0}, top={1}, right={2}, bottom={3}, ({4} x {5})) ",Math.round(this.left),Math.round(this.top),Math.round(this.right),Math.round(this.bottom),Math.round(this.Width()),Math.round(this.Height()))},Width:function(){return this.right-this.left},Height:function(){return this.bottom-this.top},Clone:function(){return new vx.rect(this.left,this.top,this.right,this.bottom)},Set:function(t){this.left=t.left;this.top=t.top;this.right=t.right;this.bottom=t.bottom},SetRect:function(t,e,i,n){this.left=t;this.top=e;this.right=i;this.bottom=n},Offset:function(t,e){this.left+=t;this.top+=e;this.right+=t;this.bottom+=e},Inflate:function(t,e,i,n){if(arguments.length==2){i=t;n=e}this.left-=t;this.top-=e;this.right+=i;this.bottom+=n},Deflate:function(t,e,i,n){if(arguments.length==2){i=t;n=e}this.left+=t;this.top+=e;this.right-=i;this.bottom-=n},Equal:function(t){if(this.left==t.left&&this.top==t.top&&this.right==t.right&&this.bottom==t.bottom)return true;else return false},EqualRect:function(t,e,i,n){if(this.left==t&&this.top==e&&this.right==i&&this.bottom==n)return true;else return false},Contain:function(t,e){if(this.left<=t&&this.right>=t&&this.top<=e&&this.bottom>=e)return true;else return false},Include:function(t){if(this.left>t.left)return false;if(this.top>t.top)return false;if(this.right<t.right)return false;if(this.bottom<t.bottom)return false;return true},Union:function(t){var e=this.Clone();if(this.left>t.left)e.left=t.left;if(this.top>t.top)e.top=t.top;if(this.right<t.right)e.right=t.right;if(this.bottom<t.bottom)e.bottom=t.bottom;return e},UnionRect:function(t){if(this.left>t.left)this.left=t.left;if(this.top>t.top)this.top=t.top;if(this.right<t.right)this.right=t.right;if(this.bottom<t.bottom)this.bottom=t.bottom},Intersection:function(t){var e=this.Clone();if(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom){e.left=0;e.top=0;e.right=0;e.bottom=0}else{if(this.left<t.left)e.left=t.left;if(this.top<t.top)e.top=t.top;if(this.right>t.right)e.right=t.right;if(this.bottom>t.bottom)e.bottom=t.bottom}return e},IntersectRect:function(t){if(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom){this.left=0;this.top=0;this.right=0;this.bottom=0;return false}else{if(this.left<t.left)this.left=t.left;if(this.top<t.top)this.top=t.top;if(this.right>t.right)this.right=t.right;if(this.bottom>t.bottom)this.bottom=t.bottom;return true}},Intersect:function(t){if(this.right<t.left||this.left>t.right||this.bottom<t.top||this.top>t.bottom)return false;return true},SetEmpty:function(){this.right=this.left;this.bottom=this.top},IsEmpty:function(){if(this.left>=this.right||this.top>=this.bottom)return true;else return false},Sum:function(){return(this.right-this.left)*(this.bottom-this.top)},CenterPoint:function(){return CUtil.CPoint((this.left+this.right)/2,(this.top+this.bottom)/2)},CenterPointRect:function(t,e){if(t==undefined)t=0;if(e==undefined)e=0;var i=new vx.rect(this.left,this.top,this.right,this.bottom);i.left=(i.left+i.right)/2-t/2;i.right=i.left+t;i.top=(i.top+i.bottom)/2-e/2;i.bottom=i.top+e;i.Int();return i},Int:function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom)},IntR:function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom)},IntB:function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom)},CIV:function(t){var e,i,n,s,r,a,o,l;e=this.left;i=this.top;n=this.right;s=this.bottom;r=t.left;a=t.top;o=t.right;l=t.bottom;if(n<r||e>o||s<a||i>l){return-1}else if(r<=e&&o>=n&&a<=i&&l>=s){return 0}else{if(e>r)t.left=e;if(i>a)t.top=i;if(n<o)t.right=n;if(s<l)t.bottom=s;return 1}},CAU:function(t){if(this.left>=this.right||this.top>=this.bottom){this.left=t.left;this.top=t.top;this.right=t.right;this.bottom=t.bottom;return false}var e,i,n,s,r,a,o,l,_,h;e=this.left;i=this.top;n=this.right;s=this.bottom;r=t.left;a=t.top;o=t.right;l=t.bottom;if(n<r||e>o||s<a||i>l)return true;_=(n-e)*(s-i);h=(o-r)*(l-a);if(_>=h){if(e<r&&n>o&&i<a&&s>l)return false;if(e>r)e=r;if(i>a)i=a;if(n<o)n=o;if(s<l)s=l;if((n-e)*(s-i)>_+h)return true;this.left=e;this.top=i;this.right=n;this.bottom=s}else{if(r<e&&o>n&&a<i&&l>s){this.left=r;this.top=a;this.right=o;this.bottom=l;return false}if(r>e)r=e;if(a>i)a=i;if(o<n)o=n;if(l<s)l=s;if((o-r)*(l-a)>_+h)return true;this.left=r;this.top=a;this.right=o;this.bottom=l}return false}});vx.point=vx.Class.extend({init:function(t,e){if(arguments.length==0){t=0;e=0}this.x=t;this.y=e},valueOf:function(){return String.format("(x={0}, y={1}) ",this.x,this.y)},toString:function(){return String.format("(x={0}, y={1}) ",this.x,this.y)},Clone:function(){return CUtil.CPoint(this.x,this.y)},Offset:function(t,e){this.x+=t;this.y+=e},Equal:function(t){if(this.x==t.x&&this.y==t.y)return true;else return false},CenterRect:function(t,e){return new vx.rect(this.x-t/2,this.y-e/2,this.x-t/2+t,this.y-e/2+e)},Int:function(){var t=this.x%1;var e=this.y%1;if(t!=0)this.x-=t;if(e!=0)this.y-=e},IntR:function(){var t=this.x%1;var e=this.y%1;if(t!=0){if(t>=.5)this.x+=1-t;else this.x-=t}if(e!=0){if(e>=.5)this.y+=1-e;else this.y-=e}}});vx.font=vx.Class.extend({init:function(t,e,i){if(i){this.value=String.format("bold {0}pt {1}",e,t)}else{this.value=String.format("{0}pt {1}",e,t)}this.bBold=i;this.fontName=t;this.fontSize=e;this.height=this.MeasureText("A",i,t,e)},Delete:function(){this.fontName=null;this.value=null},SetBold:function(t){this.bBold=t;this.Refresh()},SetSize:function(t){this.fontSize=t;this.Refresh()},SetName:function(t){this.fontName=t;this.Refresh()},Refresh:function(){if(this.bBold){this.value=String.format("bold {0}pt {1}",this.fontSize,this.fontName)}else{this.value=String.format("{0}pt {1}",this.fontSize,this.fontName)}},MeasureText:function(t,e,i,n){var s=document.createElement("DIV");s.innerHTML=t;s.style.position="absolute";s.style.top="-100px";s.style.left="-100px";s.style.fontFamily=i;s.style.fontWeight=e?"bold":"normal";s.style.fontSize=n+"pt";document.body.appendChild(s);var r=s.offsetHeight;document.body.removeChild(s);return r}});vx.timer_info=vx.Class.extend({init:function(t,e){this.nTimeSum=0;this.nTimeGap=e;this.nTimerID=t;this.nDeleteFlag=0}});vx.cmd_event=vx.Class.extend({init:function(){this.nType=0;this.nCmd=0;this.wparam=null;this.lparam=null;this.sender=null;this.receiver=null},Delete:function(){this.wparam=null;this.lparam=null;this.sender=null;this.receiver=null}});vx.reference=vx.Class.extend({init:function(t,e,i){if(t==undefined)t=null;if(e==undefined)e=0;if(i==undefined)i=0;this.m_strRef=t;this.m_nRef=e;this.m_dwRef=i},Delete:function(){this.m_strRef=null;this.m_nRef=0;this.m_dwRef=0}});vx.toolinfo2=vx.Class.extend({init:function(t,e){if(arguments.length<2)e=null;this.m_tagCont=new vx.tagcont;this.m_pObject=t;this.m_pTool=e;this.m_nDirect=CDefine.TTD_DOWNRIGHT;this.m_bUpdate=true},Delete:function(){if(this.m_tagCont){this.m_tagCont.Delete();this.m_tagCont=null}this.m_pObject=null;this.m_pTool=null},IsUpdate:function(){return this.m_bUpdate||!this.m_tagCont.IsCalulate()},GetPrivateToolTip:function(){return this.m_pTool},SetTagText:function(t,e){this.m_tagCont.SetTag(t,e);this.m_bUpdate=true},SetToolTipDirect:function(t){this.m_nDirect=t;this.m_bUpdate=true},GetSize:function(){return this.m_tagCont.GetSize()},DoUpdate:function(){this.m_bUpdate=false}});vx.box_param=vx.Class.extend({init:function(){this.sys_button_dx=25;this.sys_button_dy=24;this.sys_resize_border=8;this.sys_caption=30;this.out_lborder=CGlobal.DEFAULT_BOXBORDER;this.out_tborder=CGlobal.DEFAULT_BOXBORDER;this.out_rborder=CGlobal.DEFAULT_BOXBORDER;this.out_bborder=CGlobal.DEFAULT_BOXBORDER;this.minbox_dx=100;this.minbox_dy=80;this.maxbox_dx=800;this.maxbox_dy=600;this.default_btn_dx=120;this.default_btn_dy=36;this.title_xmargin=4;this.title_ymargin=1;this.sys_xmargin=0;this.sys_ymargin=1;this.hl_ymargin=0;this.hl_yoffset=0;this.message_xmargin=35;this.message_ymargin=15},Delete:function(){},Copy:function(){var t=new vx.box_param;t.sys_button_dx=this.sys_button_dx;t.sys_button_dy=this.sys_button_dy;t.sys_resize_border=this.sys_resize_border;t.sys_caption=this.sys_caption;t.out_lborder=this.out_lborder;t.out_tborder=this.out_tborder;t.out_rborder=this.out_rborder;t.out_bborder=this.out_bborder;t.minbox_dx=this.minbox_dx;t.minbox_dy=this.minbox_dy;t.maxbox_dx=this.maxbox_dx;t.maxbox_dy=this.maxbox_dy;t.default_btn_dx=this.default_btn_dx;t.default_btn_dy=this.default_btn_dy;t.title_xmargin=this.title_xmargin;t.title_ymargin=this.title_ymargin;t.sys_xmargin=this.sys_xmargin;t.sys_ymargin=this.sys_ymargin;t.hl_ymargin=this.hl_ymargin;t.hl_yoffset=this.hl_yoffset;t.message_xmargin=this.message_xmargin;t.message_ymargin=this.message_ymargin;return t}});vx.scrl_param=vx.Class.extend({init:function(){this.scrl_button_dx=24;this.scrl_button_dy=22;this.scrl_drag_min=10;this.scrl_space_gap=1;this.scrl_line_size=5;this.slider_dx=10;this.slider_dy=18},Delete:function(){}});vx.scrollinfo=vx.Class.extend({init:function(){this.cbSize=0;this.fMask=0;this.nMin=0;this.nMax=0;this.nPage=0;this.nPos=0;this.nTrackPos=0;this.nWheel=2},Delete:function(){},Clear:function(){this.cbSize=0;this.fMask=0;this.nMin=0;this.nMax=0;this.nPage=0;this.nPos=0;this.nTrackPos=0;this.nWheel=0}});vx.transform_prop=vx.Class.extend({init:function(){this.nStart=0;this.nEnd=0;this.nUnit=0;this.nCurrent=0;this.nTimeSum=0;this.nTimeGap=0;this.nTimeIndex=0;this.bEnable=false},Play:function(t){if(this.bEnable==0)return false;this.nTimeSum+=t;var e=Math.floor(this.nTimeSum/this.nTimeGap);if(this.nTimeIndex==e)return false;this.nTimeIndex=e;this.nCurrent=this.nStart+this.nTimeIndex*this.nUnit;if(this.nStart!=this.nEnd){if(this.nUnit>0){if(this.nCurrent>=this.nEnd){this.nCurrent=this.nEnd;this.bEnable=false}}else if(this.nUnit<0){if(this.nCurrent<=this.nEnd){this.nCurrent=this.nEnd;this.bEnable=false}}else{this.nCurrent=this.nEnd;this.bEnable=false}}return true}});vx.transform_info=vx.Class.extend({init:function(){this.rotate=null;this.alpha=null;this.xscale=null;this.yscale=null;this.horzturn=null;this.vertturn=null},Delete:function(){this.rotate=null;this.alpha=null;this.xscale=null;this.yscale=null;this.horzturn=null;this.vertturn=null}});vx.move_prop=vx.Class.extend({init:function(t){this.m_nTemp=0;this.m_pObject=t;this.m_rcTgt=new vx.rect(-1,-1,-1,-1);this.m_nCurPos=-1;this.m_ptParentBase=new vx.point(-1,-1);this.m_cntPoint=0;this.m_pPoint=null;this.m_nSleep=2;this.m_nTimeInc=0;this.m_uNotifyCmd=CDefine.CMD_VXOBJECT_MOVEEND;this.m_nMode=CDefine.MM_NORMAL;this.m_nGrid=4;this.m_nDiv=1;this.m_nArc=0;this.m_uMoveProp=CDefine.MOVEPROP_NOTIFYEND},Delete:function(){this.Clear();this.m_pObject=null;this.m_rcTgt=null;this.m_ptParentBase=null;this.m_pPoint=null},Clear:function(){this.ModifyProp(0,CDefine.MOVEPROP_RELATIVE);if(this.m_uMoveProp&CDefine.MOVEPROP_CONTINUEPROP){if(this.m_nTimeInc>this.m_cntPoint*this.m_nSleep)this.m_nTimeInc-=this.m_cntPoint*this.m_nSleep;else this.m_nTimeInc=0}else{this.m_nTimeInc=0}this.m_nCurPos=-1;this.m_cntPoint=0;if(this.m_pPoint)this.m_pPoint.RemoveAll()},ModifyProp:function(t,e){this.m_uMoveProp|=t;this.m_uMoveProp&=~e},SetBasicFacter:function(t,e,i,n,s){if(t>0)this.m_nSleep=t;if(e>=0)this.m_nMode=e;if(i>0)this.m_nGrid=i;if(n>0)this.m_nDiv=n;if(s<=1e3&&s>=-1e3)this.m_nArc=s},GetRatioFn:function(t,e,i,n,s){var r,a,o,l;o=l=0;if(t==1){while(1){a=i*(l+1)/n;o+=a;l++;if(o>=e)break}CUtil.SetSizePoint(s,l);for(r=0;r<l;r++)s[r]=i*(r+1)/n}else if(t==2){var _;while(1){a=i*(l+1)/n;o+=a;l++;if(o>e){_=o-e;break}}CUtil.SetSizePoint(s,l);for(r=0;r<l;r++){if(r==l-1)s[l-r-1]=i*(r+1)/n-_;else s[l-r-1]=i*(r+1)/n}}else if(t==3){var h=0;var f=e/2;while(1){a=i*(l-h*2+1)/n;if(a<=0)a=i;o+=a;l++;if(o>=f)h++;if(o>=e)break}o=0;h=0;for(r=0;r<l;r++){a=i*(r-h*2+1)/n;if(a<=0)a=i;o+=a;if(o>=f)h++;s[r]=a}}else{l=Math.floor(e/i);if(l*i<e)l++;for(r=0;r<l;r++)s[r]=i}return l},GetRatioFnEx:function(t,e,i,n,s){var r,a,o,l;o=l=0;if(t==1){while(1){a=i*(l+1)/n;o+=a;l++;if(o>=e)break}for(r=0;r<l;r++)s[r]=i*(r+1)/n}else if(t==2){var _;while(1){a=i*(l+1)/n;o+=a;l++;if(o>e){_=o-e;break}}for(r=0;r<l;r++){if(r==l-1)s[l-r-1]=i*(r+1)/n-_;else s[l-r-1]=i*(r+1)/n}}else if(t==3){var h=0;var f=e/2;while(1){a=i*(l-h*2+1)/n;if(a<=0)a=i;o+=a;l++;if(o>=f)h++;if(o>=e)break}o=0;h=0;for(r=0;r<l;r++){a=i*(r-h*2+1)/n;if(a<=0)a=i;o+=a;if(o>=f)h++;s[r]=a}}else{l=Math.floor(e/i);if(l*i<e)l++;for(r=0;r<l;r++)s[r]=i}return l},AppendPoint:function(t,e){var i=this.m_nMode%10;var n=Math.floor((this.m_nMode-i)/10);var s=0;if(n==0){if(this.m_uMoveProp&CDefine.MOVEPROP_CONTINUEPROP)return this.AppendPoint1Ex(t,e);else return this.AppendPoint1(t,e)}if(i==1){s=this.AppendPoint2(t,e)}else if(i==2){s=this.AppendPoint2(t,e)}else if(i==3){var r=new vx.point((t.x+e.x)/2,(t.y+e.y)/2);var a=this.m_nMode;this.m_nMode=n*10+1;s=this.AppendPoint2(t,r);this.m_nMode=n*10+2;s+=this.AppendPoint2(r,e);this.m_nMode=a}return s},AppendPoint1:function(t,e){var i,n,s,r;var a=e.x-t.x;var o=e.y-t.y;var l=Math.abs(a);var _=Math.abs(o);var h=0;if(a==0){i=false;n=_;s=0;if(o>0)r=1;else r=-1}else if(o==0){i=true;n=l;r=0;if(a>0)s=1;else s=-1}else{if(l>=_){i=true;n=l;h=_/l}else{i=false;n=_;h=l/_}if(a>0)s=1;else s=-1;if(o>0)r=1;else r=-1}var f=0;var C=new ObArray;f=this.GetRatioFn(this.m_nMode,n,this.m_nGrid,this.m_nDiv,C);var m=new ObArray;CUtil.SetSizePoint(m,this.m_cntPoint+f);if(this.m_pPoint&&this.m_cntPoint>0)CUtil.CopyPoint(m,0,this.m_pPoint);var u,T=0;var S=new vx.point(0,0);for(var c=this.m_cntPoint;c<this.m_cntPoint+f-1;c++){T+=C[c-this.m_cntPoint];if(i){S.x=t.x+T*s;S.y=t.y+T*r*h}else{S.x=t.x+T*s*h;S.y=t.y+T*r}u=m.GetAt(c);u.x=S.x;u.y=S.y}u=m.GetAt(c);u.x=e.x;u.y=e.y;this.m_cntPoint+=f;C.RemoveAll();C=null;if(this.m_pPoint){this.m_pPoint.RemoveAll();this.m_pPoint=null}this.m_pPoint=m;return f},AppendPoint1Ex:function(t,e){var i,n,s,r;var a=e.x-t.x;var o=e.y-t.y;var l=Math.abs(a);var _=Math.abs(o);var h=0;if(a==0){i=false;n=_;r=0;if(o>0)r=1;else r=-1}else if(o==0){i=true;n=l;s=0;if(a>0)s=1;else s=-1}else{n=Math.sqrt(l*l+_*_);if(l>=_){i=true;s=o/n;r=a/n}else{i=false;s=a/n;r=o/n}}var f=0;var C=new ObArray;f=this.GetRatioFn(this.m_nMode,n,this.m_nGrid,this.m_nDiv,C);var m=new ObArray;CUtil.SetSizePoint(m,this.m_cntPoint+f);if(this.m_pPoint&&this.m_cntPoint>0)CUtil.CopyPoint(m,0,this.m_pPoint);var u,T=0;var S=new vx.point(0,0);for(var c=this.m_cntPoint;c<this.m_cntPoint+f-1;c++){T=C[c-this.m_cntPoint];if(i){S.x=t.x+T*r;S.y=t.y+T*s}else{S.x=t.x+T*s;S.y=t.y+T*r}u=m.GetAt(c);u.x=S.x;u.y=S.y}u=m.GetAt(c);u.x=e.x;u.y=e.y;this.m_cntPoint+=f;C.RemoveAll();C=null;if(this.m_pPoint){this.m_pPoint.RemoveAll();this.m_pPoint=null}this.m_pPoint=m;return f},AppendPoint2:function(t,e){var i=0;var n=new vx.point(e.x-t.x,e.y-t.y);var s=Math.sqrt(n.x*n.x+n.y*n.y);var r=Math.floor(s);var a=this.m_nGrid;var o=this.m_nDiv;var l=this.m_nMode%10;var _=Math.floor((this.m_nMode-l)/10);if(a==0)a=1;if(o<=0)o=1;var h,f,C;var m=0;var u=0;C=Math.PI/2;if(n.x!=0&&n.y!=0){h=n.y/n.x;f=Math.atan(h);if(t.x>e.x)f+=CDefine.pi;m=Math.sin(f);u=Math.cos(f)}var T=a;var S=r/o;var c=S;var g=0;var E=0;while(g<r){g+=T;E++;if(g>c){c+=S;if(T>1)T--}}i=E+1;var d;var O=new ObArray;CUtil.SetSizePoint(O,this.m_cntPoint+i);var D=O[0];if(this.m_pPoint&&this.m_cntPoint>0)CUtil.CopyPoint(O,0,this.m_pPoint);T=a;S=r/o;c=S;g=0;E=0;var A;var G=new vx.point(0,0);var F=new vx.point(0,0);while(g<r){g+=T;E++;if(g>c){c+=S;if(T>1)T--}if(l==0){A=g}else{if(_==2){A=Math.sqrt(2*r*g-g*g)}else if(_==3){h=C*g/r;if(h>C)h=C;A=r*Math.sin(h)}else{A=r-(g-r)*(g-r)/r}if(l==1)A=r-A}if(n.x==0){G.x=0;if(n.y<0)G.y=-A;else G.y=A}else if(n.y==0){if(n.x<0)G.x=-A;else G.x=A;G.y=0}else{F.x=A;F.y=0;G.x=u*F.x-m*F.y;G.y=m*F.x+u*F.y}G.x+=t.x;G.y+=t.y;if(l==1){d=O.GetAt(this.m_cntPoint+i-E-1);d.x=G.x;d.y=G.y}else{d=O.GetAt(this.m_cntPoint+E-1);d.x=G.x;d.y=G.y}}d=O.GetAt(this.m_cntPoint+i-1);d.x=e.x;d.y=e.y;this.m_cntPoint+=i;if(this.m_pPoint){this.m_pPoint.RemoveAll();this.m_pPoint=null}this.m_pPoint=O;return i},MovingByRect:function(t,e,i,n,s,r){if(this.m_pObject==null)return false;this.Clear();this.m_rcTgt.Set(t);var a=this.m_pObject.GetObjectRect();if(this.m_pObject.m_parent){var o=this.m_pObject.m_parent.GetObjectRect();this.m_ptParentBase.x=o.left;this.m_ptParentBase.y=o.top}this.SetBasicFacter(e,i,n,s,r);var l=a.CenterPoint();var _=t.CenterPoint();if(a.Equal(t)){this.m_cntPoint=1;if(this.m_pPoint==null)this.m_pPoint=new ObArray;this.m_pPoint.RemoveAll();this.m_pPoint.Add(t.CenterPoint());this.m_pObject.SetTimer(CDefine.DEFTIMER_MOVE,0);return true}var h=this.m_cntPoint;var f=this.AppendPoint(l,_);if(this.m_nArc!=0){this.RepositionPoint(this.m_pPoint,h,f)}this.m_pObject.SetTimer(CDefine.DEFTIMER_MOVE,0);return true},MovingByRectP:function(t,e,i,n,s,r){if(this.m_pObject==null)return false;this.Clear();this.m_rcTgt.Set(t);this.m_ptParentBase.x=0;this.m_ptParentBase.y=0;this.ModifyProp(CDefine.MOVEPROP_RELATIVE,0);var a=this.m_pObject.GetObjectRectP();this.SetBasicFacter(e,i,n,s,r);var o=a.CenterPoint();var l=t.CenterPoint();if(a.Equal(t)){this.m_cntPoint=1;if(this.m_pPoint==null)this.m_pPoint=new ObArray;this.m_pPoint.RemoveAll();this.m_pPoint.Add(t.CenterPoint());this.m_pObject.SetTimer(CDefine.DEFTIMER_MOVE,0);return true}var _=this.m_cntPoint;var h=this.AppendPoint(o,l);if(this.m_nArc!=0){this.RepositionPoint(this.m_pPoint,_,h)}this.m_pObject.SetTimer(CDefine.DEFTIMER_MOVE,0);return true},MovingByPoint:function(t,e,i,n,s,r,a){if(this.m_pObject==null)return false;this.Clear();this.m_rcTgt=CUtil.CRect(e.x,e.y,e.x,e.y);if(this.m_pObject.m_parent){var o=this.m_pObject.m_parent.GetObjectRect();this.m_ptParentBase.x=o.left;this.m_ptParentBase.y=o.top}this.SetBasicFacter(i,n,s,r,a);var l=t.Clone();var _=e.Clone();if(l.x==_.x&&l.y==_.y){this.m_cntPoint=1;if(this.m_pPoint==null)this.m_pPoint=new ObArray;this.m_pPoint.RemoveAll();this.m_pPoint.Add(new vx.point(e.x,e.y));this.m_pObject.SetTimer(CDefine.DEFTIMER_MOVE,0);this.ModifyProp(CDefine.MOVEPROP_BYPOINT|CDefine.MOVEPROP_ONMOVECALL,0);return true}var h=this.m_cntPoint;var f=this.AppendPoint(l,_);if(this.m_nArc!=0){this.RepositionPoint(this.m_pPoint,h,f)}this.m_pObject.SetTimer(CDefine.DEFTIMER_MOVE,0);this.ModifyProp(CDefine.MOVEPROP_BYPOINT|CDefine.MOVEPROP_ONMOVECALL,0);return true},TimerRun:function(t,e,i){var n,s=0;if(this.m_nCurPos>=this.m_cntPoint-1||this.m_pPoint==null||this.m_pObject==null){this.Clear();if(this.m_uMoveProp&CDefine.MOVEPROP_CONTINUEPROP)return 0;else return CDefine.MOVERESULT_CLEAR}this.m_nTimeInc+=t;var r=Math.floor(this.m_nTimeInc/this.m_nSleep);if(r==this.m_nCurPos)return s;s|=CDefine.MOVERESULT_CHANGE;if(r>=this.m_cntPoint-1){s|=CDefine.MOVERESULT_MOVEEND;n=this.m_rcTgt.Clone();r=this.m_cntPoint-1}else{var a=this.m_pPoint[r];if(this.m_uMoveProp&CDefine.MOVEPROP_BYPOINT)n=CUtil.CRect(a.x,a.y,a.x,a.y);else n=this.m_pObject.GetPointRect(a)}n.IntR();this.m_nCurPos=r;this.ParentReposition(n);if(this.m_uMoveProp&CDefine.MOVEPROP_ONMOVECALL){s|=CDefine.MOVERESULT_CALLBACK;e.Set(n);i.x=r;i.y=this.m_cntPoint}else{if(this.m_uMoveProp&CDefine.MOVEPROP_RELATIVE)this.m_pObject.MoveObjectP(n);else this.m_pObject.MoveObject(n)}if(this.m_uMoveProp&CDefine.MOVEPROP_NOTIFYEND&&s&CDefine.MOVERESULT_MOVEEND){this.m_pObject.NotifyParent(this.m_uNotifyCmd,null,null)}return s},GetArcValue:function(t,e,i){if(t==0||e==0)return 0;var n=t/2;return-1*e*(i-n)*(i-n)/(n*n)+e},GetLength:function(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))},GetArcMax:function(t,e){this.m_nTemp=0;if(t.x==e.x||t.y==e.y)return 0;var i=Math.abs(t.x-e.x);var n=Math.abs(t.y-e.y);var s=new vx.point((t.x+e.x)/2,(t.y+e.y)/2);var r=(e.y-t.y)/(e.x-t.x);this.m_nTemp=Math.atan(r);var a,o;if(i>n){o=t.y;a=-1*(o-t.y)*r+s.x}else{a=t.x;o=-1*(a-t.x)/r+s.y}return this.GetLength(s,new vx.point(a,o))},RepositionPoint:function(t,e,i,n){if(arguments.length<4)n=-1;if(t==null||this.m_nArc==0)return 0;var s=t.GetAt(e);var r=t.GetAt(i-1);var a,o,l=0;if((this.m_uMoveProp&CDefine.MOVEPROP_FIXEDARC)==CDefine.MOVEPROP_FIXEDARC){o=this.m_nArc;l=o*Math.PI/180}else{o=this.GetArcMax(s,r);l=this.m_nTemp;o=o*this.m_nArc/100}if((this.m_uMoveProp&CDefine.MOVEPROP_NOUSEDIRECT)==CDefine.MOVEPROP_NOUSEDIRECT){if(s.x<r.x)o*=-1}var _=Math.sin(l);var h=Math.cos(l);var f,C;var m=this.GetLength(s,r);var u,T;for(var S=1;S<i-1;S++){if(S<n)continue;a=t.GetAt(S);f=this.GetLength(s,a);C=this.GetArcValue(m,o,f);u=_*C;T=h*C*-1;a.x+=u;a.y+=T}return o},ParentReposition:function(t){if(this.m_uMoveProp&CDefine.MOVEPROP_RELATIVE)return;if(this.m_pObject.m_parent){var e=this.m_pObject.m_parent.GetObjectRect();var i=e.left-this.m_ptParentBase.x;var n=e.top-this.m_ptParentBase.y;t.left+=i;t.top+n;t.right+=i;t.bottom+n}},Pumping:function(t,e,i,n,s,r,a,o){if(e<=0||i==0||n<=0)return false;if(i*2<n)return false;this.Clear();var l=t.Clone();this.m_rcTgt=t.Clone();this.m_nSleep=e;var _=l.CenterPoint();if(this.m_pObject.m_parent){var h=this.m_pObject.m_parent.GetObjectRect();this.m_ptParentBase.x=h.left;this.m_ptParentBase.y=h.top}var f;this.m_cntPoint=this.GetPumpingCnt(i,n,s,r,o);if(this.m_cntPoint<=1){this.m_cntPoint=0;return false}if(this.m_pPoint==null)this.m_pPoint=new ObArray;this.m_pPoint.RemoveAll();CUtil.SetSizePoint(this.m_pPoint,this.m_cntPoint);var C,m,u,T=0;var S=i;var c=n;var g,E,d=0;var O=1;var D=0;if(o>0&&o<i){C=Math.floor(S/c);if(C==0)return false;var A=o*2/C;m=Math.floor(S*2/C)-A;if(m>0){u=C*A;for(E=T;E<T+m-1;E++){f=this.GetArcValue(S*2,S,u);this.SetPumpPoint(this.m_pPoint.GetAt(E),_,f,D,O);u+=C;D+=C*a}this.SetPumpPoint(m_pPoint.GetAt(T+m-1),_,0,D);T+=m;if(this.m_uMoveProp&CDefine.MOVEPROP_TREMBLEPUMP){O*=-1}S=S*r;c=c*r;if(Math.floor(c)<=1)return false;d=1}}for(g=d;g<s;g++){C=S/c;if(C==0)break;m=Math.floor(S*2/C);if(m==0)break;u=C;for(E=T;E<T+m-1;E++){f=this.GetArcValue(S*2,S,Number(u));this.SetPumpPoint(this.m_pPoint.GetAt(E),_,Math.floor(f),D,O);u+=C;D+=Math.floor(C*a)}this.SetPumpPoint(this.m_pPoint.GetAt(T+m-1),_,0,D);T+=m;if(this.m_uMoveProp&CDefine.MOVEPROP_TREMBLEPUMP){O*=-1}S=S*r;c=c*r;if(Math.floor(c)<=1)break}this.SetPumpPoint(this.m_pPoint.GetAt(this.m_cntPoint-1),_,0,D);var G=this.m_pPoint.GetAt(this.m_cntPoint-1);this.m_rcTgt=CUtil.CenterRect(G.x,G.y,this.m_pObject.m_width,this.m_pObject.m_height);this.m_pObject.SetTimer(CDefine.DEFTIMER_MOVE,0);return true},SetPumpPoint:function(t,e,i,n,s){if(arguments.length<5)s=1;i=i*s;if(this.m_uMoveProp&(CDefine.MOVEPROP_RIGHTPUMP|CDefine.MOVEPROP_LEFTPUMP)){if(this.m_uMoveProp&CDefine.MOVEPROP_PUMPPUSHRIGHT)t.y=e.y+n;else if(this.m_uMoveProp&CDefine.MOVEPROP_PUMPPUSHLEFT)t.y=e.y-n;else t.y=e.y;if(this.m_uMoveProp&CDefine.MOVEPROP_RIGHTPUMP)t.x=e.x+i;else t.x=e.x-i}else{if(this.m_uMoveProp&CDefine.MOVEPROP_PUMPPUSHRIGHT)t.x=e.x+n;else if(this.m_uMoveProp&CDefine.MOVEPROP_PUMPPUSHLEFT)t.x=e.x-n;else t.x=e.x;if(this.m_uMoveProp&CDefine.MOVEPROP_BOTTOMPUMP)t.y=e.y+i;else t.y=e.y-i}},GetPumpingCnt:function(t,e,i,n,s){if(e==0)return 0;var r,a,o=0;var l=t;var _=e;var h=0;if(s>0&&s<t){r=Math.floor(l/_);if(r==0)return o;var f=Math.floor(s*2/r);a=Math.floor(l*2/r)-f;if(a>0){o+=a;l=l*n;_=_*n;if(Math.floor(_)<=1)return o;h=1}}for(var C=h;C<i;C++){r=Math.floor(l/_);if(r==0)break;a=Math.floor(l*2/r);if(a==0)break;o+=a;l=l*n;_=_*n;if(Math.floor(_)<=1)break}return o},PumpingPoint:function(t,e,i,n,s,r,a){if(s==0||this.m_pObject==null)return false;var o=e.x-t.x;var l=e.y-t.y;if(l<0)l=0;var _,h=l;if(n>0){h+=n;_=(l-n)/2;if(_<0)_=0}else{_=h/2}if(!this.Pumping(this.m_pObject.GetObjectRect(),i,h,h/s,r,a,0,_))return false;if(this.m_pPoint==null||this.m_cntPoint==0)return false;var f=o/this.m_cntPoint;var C=t.y-this.m_pPoint[0].y;if(_<0)C=0;for(var m=0;m<this.m_cntPoint-1;m++){this.m_pPoint[m].x+=Math.floor(f*m);this.m_pPoint[m].y+=C}this.m_pPoint[m].x+=o;this.m_pPoint[m].y+=C;var u=this.m_pPoint.GetAt(this.m_cntPoint-1);this.m_rcTgt=new vx.rect(u.x-this.m_pObject.m_width/2,u.y-this.m_pObject.m_height/2,this.m_pObject.m_width,this.m_pObject.m_height);return true}});vx.DIALOG_INFO=vx.Class.extend({init:function(t,e){this.dinfo_rect=e;this.dinfo_id=t;this.dinfo_title=null;this.dinfo_st=0;this.dinfo_stEx=0;this.dinfo_st2=0;this.dinfo_stEx2=0;this.dinfo_child=new ObArray},Delete:function(){this.dinfo_title=null;this.dinfo_rect=null;if(this.dinfo_child){var t;var e=this.dinfo_child.GetSize();for(var i=0;i<e;i++){t=this.dinfo_child.GetAt(i);if(t)t.Delete()}this.dinfo_child.RemoveAll();this.dinfo_child=null}},SetTitle:function(t){this.dinfo_title=t},SetStyle:function(t,e,i,n){this.dinfo_st=t;this.dinfo_stEx=e;this.dinfo_st2=i;this.dinfo_stEx2=n},AddItem:function(t,e,i,n,s,r,a,o,l){var _=new vx.DIALOG_ITEM(t,e,i,n,s,r,a,o,l);this.dinfo_child.Add(_)}});vx.DIALOG_ITEM=vx.Class.extend({init:function(t,e,i,n,s,r,a,o,l){this.ditem_type=t;this.ditem_title=e;this.ditem_rect=i;this.ditem_id=n;this.ditem_st=s;this.ditem_stEx=r;this.ditem_st2=a;this.ditem_stEx2=o;this.ditem_define=l},Delete:function(){this.ditem_title=null;this.ditem_rect=null}});vx.MENUITEM=vx.Class.extend({init:function(t,e,i,n){if(n==undefined)n=null;this.menu_status=t;this.menu_name=i;this.menu_id=e;this.menu_sub=null;this.menu_parent=n},Delete:function(){if(this.menu_sub){var t;var e=this.menu_sub.length;for(var i=0;i<e;i++){t=this.menu_sub.GetAt(i);if(t)t.Delete()}this.menu_sub.RemoveAll();this.menu_sub=null}this.menu_name=null;this.menu_parent=null},Copy:function(){var t;var e;var i=new vx.MENUITEM(this.menu_status,this.menu_id,this.menu_name);if(this.menu_sub){i.menu_sub=new ObArray;var n=this.menu_sub.length;for(var s=0;s<n;s++){t=this.menu_sub.GetAt(s);e=t.Copy();e.menu_parent=i;i.menu_sub.AddTail(e)}}return i},AppendMenu:function(t,e,i){if(this.menu_sub==null){this.menu_sub=new ObArray;this.menu_status|=CDefine.MF_POPUP}if(t&CDefine.MF_SEPARATOR)e=0;t&=CDefine.MF_STATUSMASK;var n=new vx.MENUITEM(t,e,i,this);this.menu_sub.AddTail(n);return n},AppendPopupMenu:function(t,e,i){if(this.menu_sub==null){this.menu_sub=new ObArray;this.menu_status|=CDefine.MF_POPUP;this.menu_id=-1;this.menu_name=i}this.menu_sub.AddTail(e);return e},InsertMenu:function(t,e,i,n){if(this.menu_sub&&t>=0&&t<this.menu_sub.length){if(this.menu_sub==null){this.menu_sub=new ObArray;this.menu_status|=CDefine.MF_POPUP}if(e&CDefine.MF_SEPARATOR)i=0;e&=CDefine.MF_STATUSMASK;var s=new vx.MENUITEM(e,i,n,this);this.menu_sub.InsertAt(t,s);return s}return this.AppendMenu(e,i,n)},InsertPopupMenu:function(t,e,i,n){if(this.menu_sub&&t>=0&&t<this.menu_sub.length){if(this.menu_sub==null){this.menu_sub=new ObArray;this.menu_status|=CDefine.MF_POPUP;this.menu_id=-1;this.menu_name=n}this.menu_sub.InsertAt(t,i);return i}return this.AppendPopupMenu(e,i,n)},GetSubMenu:function(t){if(t>=0&&t<this.menu_sub.length){var e=this.menu_sub.GetAt(t);if(e==null)return null;return e}return null},RemoveMenu:function(t,e){var i;if(this.menu_sub==null)return;if(e&CDefine.MF_BYCOMMAND){var n=this.menu_sub.length;for(var s=0;s<n;s++){i=this.menu_sub.GetAt(s);if(i.menu_id==t){this.menu_sub.RemoveAt(s);i.Delete();return}}}else{if(t>=0&&t<this.menu_sub.length){i=this.menu_sub.GetAt(t);this.menu_sub.RemoveAt(t);i.Delete()}}},EnableMenuItem:function(t,e){var i;if(this.menu_sub==null)return;if(e&CDefine.MF_BYCOMMAND){var n=this.menu_sub.length;for(var s=0;s<n;s++){i=this.menu_sub.GetAt(s);if(i.menu_id==t){i.menu_status=e&CDefine.MF_STATUSMASK;return}}}else{if(t>=0&&t<this.menu_sub.length){i=this.menu_sub.GetAt(t);if(e&CDefine.MF_SEPARATOR)i.menu_id=0;i.menu_status=e&CDefine.MF_STATUSMASK}}},ModifyMenu:function(t,e,i,n){var s;if(this.menu_sub==null)return;if(e&CDefine.MF_BYCOMMAND){var r=this.menu_sub.length;for(var a=0;a<r;a++){s=this.menu_sub.GetAt(a);if(s.menu_id==t){s.menu_id=i;s.menu_name=n;s.menu_status=e&CDefine.MF_STATUSMASK;return}}}else{if(t>=0&&t<this.menu_sub.length){s=this.menu_sub.GetAt(t);s.menu_id=i;s.menu_name=n;s.menu_status=e&CDefine.MF_STATUSMASK}}},CheckMenuItem:function(t,e){this.EnableMenuItem(t,e)},GetMenuItemCount:function(){if(this.menu_sub==null)return 0;else return this.menu_sub.length},GetMenuItemID:function(t){var e;if(t>=0&&t<this.menu_sub.length){e=this.menu_sub.GetAt(t);if(e)return e.menu_id}return 0},GetMenuState:function(t,e){var i;if(this.menu_sub==null)return 0;if(e&CDefine.MF_BYCOMMAND){var n=this.menu_sub.length;for(var s=0;s<n;s++){i=this.menu_sub.GetAt(s);if(i.menu_id==t){return i.menu_status}}}else{if(t>=0&&t<this.menu_sub.length){i=this.menu_sub.GetAt(t);return i.menu_status}}return 0},GetMenuString:function(t,e){var i;if(this.menu_sub==null)return null;if(e&CDefine.MF_BYCOMMAND){for(var n=0;n<this.menu_sub.length;n++){i=this.menu_sub.GetAt(n);if(i.menu_id==t){return i.menu_name}}}else{if(t>=0&&t<this.menu_sub.length){i=this.menu_sub.GetAt(t);return i.menu_name}}return null}});vx.changemenu=vx.Class.extend({init:function(t,e,i){this.m_menuName=null;this.m_nCmd=e;this.m_nValue=i;this.m_nID=t;this.m_nNewID=0;this.m_nFlag=0;this.m_subMenu=null},Delete:function(){this.m_menuName=null;if(this.m_subMenu){this.m_subMenu=null}},SetProperty:function(t,e,i){this.m_nNewID=t;this.m_nFlag=e;this.m_menuName=i}});vx.changemenu._IsMap=function(t){var e;var i=vx.Global.g_chmMap.length;for(var n=0;n<i;n++){e=vx.Global.g_chmMap.GetAt(n);if(e&&e.m_nID==t)return true}return false};vx.changemenu._AddMap=function(t){if(vx.changemenu._IsMap(t.m_nID))return false;vx.Global.g_chmMap.AddTail(t);return true};vx.changemenu.SetMenuProperty=function(t,e,i,n){vx.Global.g_dwMenuProperty=CUtil.MAKELONG(CUtil.MAKEWORD(t,e),CUtil.MAKEWORD(i,n))};vx.changemenu.IsMenuProperty=function(){if(vx.Global.g_dwMenuProperty==0)return false;else return true};vx.changemenu.DoMenuProperty=function(t){if(t&&vx.Global.g_dwMenuProperty!=0){t.SetMenuProperty(CUtil.LOBYTE(CUtil.LOWORD(vx.Global.g_dwMenuProperty)),CUtil.HIBYTE(CUtil.LOWORD(vx.Global.g_dwMenuProperty)),CUtil.LOBYTE(CUtil.HIWORD(vx.Global.g_dwMenuProperty)),CUtil.HIBYTE(CUtil.HIWORD(vx.Global.g_dwMenuProperty)));return true}else{return false}};vx.changemenu.ClearMenuProperty=function(){vx.Global.g_dwMenuProperty=0};vx.changemenu.GetMenuImageName=function(){return vx.Global.g_menuimagename};vx.changemenu.GetMenuIconName=function(){return vx.Global.g_menuiconname};vx.changemenu.SetMenuImageName=function(t){vx.Global.g_menuimagename=t};vx.changemenu.SetMenuIconName=function(t){vx.Global.g_menuiconname=t};vx.changemenu.CopyColor=function(t){if(!t||!vx.Global.g_pColorSet)return;for(var e=0;e<CDefine.MENUCOLOR_MAX;e++){t.SetAt(e,vx.Global.g_pColorSet.GetAt(e))}};vx.changemenu.Clear=function(){var t;var e;var i=vx.Global.g_chmList.length;for(t=0;t<i;t++){e=vx.Global.g_chmList.GetAt(t);if(e)e.Delete()}vx.Global.g_chmList.RemoveAll();i=vx.Global.g_inmList.length;for(t=0;t<i;t++){e=vx.Global.g_inmList.GetAt(t);if(e)e.Delete()}vx.Global.g_inmList.RemoveAll();i=vx.Global.g_addMenuList.length;for(t=0;t<i;t++){e=vx.Global.g_addMenuList.GetAt(t);if(e)e.Delete()}vx.Global.g_addMenuList.RemoveAll();vx.Global.g_chmMap.RemoveAll();if(vx.Global.g_pColorSet){vx.Global.g_pColorSet.RemoveAll();vx.Global.g_pColorSet=null}vx.Global.g_menuiconname=vx.Global.g_menuimagename=null};vx.changemenu.GetIconTextInfo=function(t){if(t==null||t.m_strRef==null)return-1;t.m_nRef=0;var e=t.m_strRef.lastIndexOf("|");if(e==-1)return-1;var i=t.m_strRef.length;var n=t.m_strRef.substr(e+1);t.m_strRef=t.m_strRef.substr(0,e);var s=CUtil.Replace(t.m_strRef,"&","");var r=t.m_strRef.length-s.length;switch(r){case 1:t.m_dwRef|=CDefine.TAGTYPE_BOLD;break;case 2:t.m_dwRef|=CDefine.TAGTYPE_BOLD|CDefine.TAGTYPE_LARGE;break;case 3:t.m_dwRef|=CDefine.TAGTYPE_BOLD|CDefine.TAGTYPE_EXTRA;break}t.m_strRef=s;var a=CUtil.Replace(n,"%","");var o=n.length-a.length;if(r>0)t.m_nRef=1;if(a=="")return-1;return Math.floor(a)};vx.changemenu.SetTextColor=function(t,e,i,n,s){vx.changemenu.AllocColorTable();if(t!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_TEXTNORMAL]=t;if(e!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_TEXTFOCUS]=e;if(i!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_TEXTDOWN]=i;if(n!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_TEXTGRAY]=n;if(s!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_TEXTBOUND]=s};vx.changemenu.SetBackColor=function(t,e,i,n){vx.changemenu.AllocColorTable();if(t!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_BACKNORMAL]=t;if(e!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_BACKFOCUS]=e;if(i!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_BACKDOWN]=i;if(n!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_BACKGRAY]=n};vx.changemenu.SetEdgeColor=function(t,e,i,n){vx.changemenu.AllocColorTable();if(t!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_EDGELEFTTOP]=t;if(e!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_EDGERIGHTBOTTOM]=e;if(i!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_EDGELEFTTOP2]=i;if(n!=4294967295)vx.Global.g_pColorSet[CDefine.MENUCOLOR_EDGERIGHTBOTTOM2]=n};vx.changemenu.SetMenuColor=function(t,e){if(t<0||t>CDefine.MENUCOLOR_MAX)return;vx.changemenu.AllocColorTable();vx.Global.g_pColorSet.SetAt(t,e)};vx.changemenu.AllocColorTable=function(){if(vx.Global.g_pColorSet==null){vx.Global.g_pColorSet=new ObArray;for(var t=0;t<CDefine.MENUCOLOR_MAX;t++){vx.Global.g_pColorSet.AddTail(4294967295)}}};vx.changemenu.IsChangeColor=function(){if(vx.Global.g_pColorSet)return true;else return false};vx.changemenu.InsertMenu=function(t,e,i,n){var s=new vx.changemenu(0,CDefine._CM_INSERT,t);if(e==0)i|=CDefine.MF_SEPARATOR;s.SetProperty(e,i,n);vx.Global.g_inmList.AddHead(s)};vx.changemenu.ModifyMenu=function(t,e,i,n){var s=new vx.changemenu(t,CDefine._CM_MODIFY,0);s.SetProperty(e,i,n);vx.changemenu._AddMap(s);vx.Global.g_chmList.AddHead(s)};vx.changemenu.RenameMenu=function(t,e,i){if(i==undefined)i=false;var n=new vx.changemenu(t,CDefine._CM_RENAME,Math.floor(i));n.m_menuName=e;vx.changemenu._AddMap(n);vx.Global.g_chmList.AddHead(n)};vx.changemenu.DeleteMenu=function(t,e){if(e==undefined)e=false;var i=new vx.changemenu(t,CDefine._CM_DELETE,Math.floor(e));if(!e){vx.changemenu._AddMap(i);vx.Global.g_chmList.AddHead(i)}else{vx.Global.g_inmList.AddHead(i)}};vx.changemenu.CheckMenu=function(t,e,i){if(i==undefined)i=false;var n=new vx.changemenu(t,CDefine._CM_CHECK,CUtil.MAKELONG(Math.floor(e),Math.floor(i)));vx.changemenu._AddMap(n);vx.Global.g_chmList.AddHead(n)};vx.changemenu.GrayMenu=function(t,e,i){if(i==undefined)i=false;var n=new vx.changemenu(t,CDefine._CM_GRAY,CUtil.MAKELONG(Math.floor(e),Math.floor(i)));vx.changemenu._AddMap(n);vx.Global.g_chmList.AddHead(n)};vx.changemenu.EnableMenu=function(t,e,i){if(i==undefined)i=false;var n=new vx.changemenu(t,CDefine._CM_ENABLE,CUtil.MAKELONG(Math.floor(e),Math.floor(i)));vx.changemenu._AddMap(n);vx.Global.g_chmList.AddHead(n)};vx.changemenu.InsertPopupMenuByRes=function(t,e,i,n,s){var r,a,o;if(e==0)return null;r=vx.Global.g_skin.LoadMenu(e);if(r==null)return null;a=r.GetSubMenu(i);if(a==null){return null}if(n>=0){o=a.GetSubMenu(n);if(o==null){o=a}}else{o=a}vx.changemenu.InsertPopupMenu(t,o.Copy(),s);return r};vx.changemenu.InsertPopupMenu=function(t,e,i){if(!e)return;var n=new vx.changemenu(0,CDefine._CM_INSERT,t);n.SetProperty(-1,CDefine.MF_POPUP,i);n.m_subMenu=e;vx.Global.g_inmList.AddHead(n);vx.Global.g_addMenuList.AddHead(e)};vx.changemenu.Refresh=function(t){if(!t)return;var e;var i,n,s;var r=vx.Global.g_inmList.length;for(n=r-1;n>=0;n--){e=vx.Global.g_inmList.GetAt(n);if(e.m_nCmd==CDefine._CM_INSERT){if(e.m_nFlag==CDefine.MF_POPUP){var a=e.m_subMenu;if(e.m_nValue==-1)t.AppendPopupMenu(CDefine.MF_POPUP,a,e.m_menuName);else t.InsertPopupMenu(e.m_nValue,CDefine.MF_BYPOSITION|CDefine.MF_POPUP,a,e.m_menuName)}else{if(e.m_nValue==-1)t.AppendMenu(e.m_nFlag,e.m_nNewID,e.m_menuName);else t.InsertMenu(e.m_nValue,CDefine.MF_BYPOSITION|e.m_nFlag,e.m_nNewID,e.m_menuName)}}else if(e.m_nCmd==CDefine._CM_DELETE){t.RemoveMenu(e.m_nID,CDefine.MF_BYPOSITION)}vx.Global.g_inmList.RemoveAt(n);e.Delete()}var o;var l=t.GetMenuItemCount();for(n=0;n<l;n++){i=t.GetMenuItemID(n);if(i==0||i==-1)continue;if(!vx.changemenu._IsMap(i))continue;var r=vx.Global.g_chmList.length;for(s=r-1;s>=0;s--){e=vx.Global.g_chmList.GetAt(s);switch(e.m_nCmd){case CDefine._CM_ENABLE:if(CUtil.LOWORD(e.m_nValue))o=CDefine.MF_ENABLED;else o=CDefine.MF_DISABLED;if(CUtil.HIWORD(e.m_nValue))o|=CDefine.MF_BYPOSITION;else o|=CDefine.MF_BYCOMMAND;t.EnableMenuItem(e.m_nID,o);if(CUtil.HIWORD(e.m_nValue)){vx.Global.g_chmList.RemoveAt(s);e.Delete();e=null}break;case CDefine._CM_GRAY:if(CUtil.LOWORD(e.m_nValue))o=CDefine.MF_GRAYED;else o=CDefine.MF_ENABLED;if(CUtil.HIWORD(e.m_nValue))o|=CDefine.MF_BYPOSITION;else o|=CDefine.MF_BYCOMMAND;t.EnableMenuItem(e.m_nID,o);if(CUtil.HIWORD(e.m_nValue)){vx.Global.g_chmList.RemoveAt(s);e.Delete();e=null}break;case CDefine._CM_CHECK:if(CUtil.LOWORD(e.m_nValue))o=CDefine.MF_CHECKED;else o=CDefine.MF_UNCHECKED;if(CUtil.HIWORD(e.m_nValue))o|=CDefine.MF_BYPOSITION;else o|=CDefine.MF_BYCOMMAND;t.CheckMenuItem(e.m_nID,o);if(CUtil.HIWORD(e.m_nValue)){vx.Global.g_chmList.RemoveAt(s);e.Delete();e=null}break;case CDefine._CM_DELETE:if(e.m_nValue!=0)t.RemoveMenu(e.m_nID,CDefine.MF_BYPOSITION);else t.RemoveMenu(e.m_nID,CDefine.MF_BYCOMMAND);break;case CDefine._CM_RENAME:if(e.m_nValue!=0)t.ModifyMenu(e.m_nID,CDefine.MF_BYPOSITION,0,e.m_menuName);else t.ModifyMenu(e.m_nID,CDefine.MF_BYCOMMAND,e.m_nID,e.m_menuName);if(e.m_nValue!=0){vx.Global.g_chmList.RemoveAt(s);e.Delete();e=null}break;case CDefine._CM_MODIFY:t.ModifyMenu(e.m_nID,CDefine.MF_BYCOMMAND|e.m_nFlag,e.m_nNewID,e.m_menuName);break}}}};vx.tag=vx.Class.extend({init:function(t){this.utype=0;this.color=0;this.vcolor=4294967295;this.rect=null;this.pList=null;this.pImage=null;this.content="";this.bmd=null;this.srect=null;if(arguments.length==0){this.rect=new vx.rect(0,0,0,0)}else{this._set(t)}},Delete:function(){this.rect=null;if(this.pList){var t;var e=this.pList.length;for(var i=0;i<e;i++){t=this.pList.GetAt(i);t.Delete()}this.pList.RemoveAll();this.pList=null}this.pImage=null;this.content="";if(this.bmd){this.bmd.Delete();this.bmd=null}this.srect=null},ClearBmd:function(){if(this.pList){var t;var e=this.pList.length;for(var i=0;i<e;i++){t=this.pList.GetAt(i);if(t.bmd){t.bmd.Delete();t.bmd=null}t.srect=null}}if(this.bmd){this.bmd.Delete();this.bmd=null}this.srect=null},SaveBmd:function(t){if(this.srect){t.Set(this.srect);return this.bmd}return null},RestoreBmd:function(t,e){if(t&&e){if(this.srect)srect.Set(t);else this.srect=new vx.rect(t.left,t.top,t.right,t.bottom);this.bmd=e}},_set:function(t){this.utype=t.utype;this.color=t.color;this.vcolor=t.vcolor;this.rect=t.rect.Clone();this.content=t.content;this.pImage=t.pImage;if(t.pList){var e;if(this.pList==null)this.pList=new ObArray;else this.pList.RemoveAll();var i=t.pList.length;for(var n=0;n<i;n++){e=t.pList.GetAt(n);this.pList.Add(e.CopyNew())}}else{if(this.pList)this.pList.RemoveAll();this.pList=null}},_append:function(t){var e;if(!this.pList)this.pList=new ObArray;this.pList.AddTail(t.CopyNew());if(t.pList){var i=t.pList.length;for(var n=0;n<i;n++){e=t.pList.GetAt(n);this.pList.Add(e.CopyNew())}}},_compare:function(t){if(t==null)return false;if(this.utype!=t.utype)return false;if(this.color!=t.color)return false;if(this.vcolor!=t.vcolor)return false;if(this.rect!=t.rect)return false;if(this.content!=t.content)return false;if(this.pImage!=t.pImage)return false;return true},IsText:function(){return this.utype&CDefine.TAGTYPE_TEXT&&!(this.utype&CDefine.TAGTYPE_NULL)},IsImage:function(){return this.utype&CDefine.TAGTYPE_IMAGE&&this.pImage},IsObject:function(){return this.utype&CDefine.TAGTYPE_OBJECT&&this.pImage},IsSetHeight:function(){return this.utype&CDefine.TAGTYPE_SETHEIGHT},SetRect:function(t,e,i,n){this.rect.left=t;this.rect.top=e;this.rect.right=t+i;this.rect.bottom=e+n},CopyRect:function(t){this.rect.left=t.left;this.rect.top=t.top;this.rect.right=t.right;this.rect.bottom=t.bottom},ModifyTagType:function(t,e){this.utype|=t;this.utype&=~e},Append:function(t){var e=0;var i;if(!this.pList)this.pList=new ObArray;this.pList.AddTail(t.CopyNew());if(t.IsObject())e++;if(t.pList){var n=t.pList.length;for(var s=0;s<n;s++){i=t.pList.GetAt(s);this.pList.Add(i.CopyNew());if(i.IsObject())e++}}return e},CopyNew:function(){var t=new vx.tag;t.utype=this.utype;t.color=this.color;t.vcolor=this.vcolor;t.rect=this.rect.Clone();t.content=this.content;t.pImage=this.pImage;t.pList=null;return t},Set:function(t){this.Delete();var e=0;if(t.IsObject())e++;this.utype=t.utype;this.color=t.color;this.vcolor=t.vcolor;if(this.rect)this.rect.Set(t.rect);else this.rect=t.rect.Clone();this.content=t.content;this.pImage=t.pImage;this.bmd=null;if(t.pList){var i;if(this.pList==null)this.pList=new ObArray;else this.pList.RemoveAll();var n=t.pList.length;for(var s=0;s<n;s++){i=t.pList.GetAt(s);if(i.IsObject())e++;this.pList.AddTail(i.CopyNew())}}return e},Put:function(t){if(t.utype&CDefine.TAGTYPE_NULL)return 0;if(this.utype!=0&&(this.utype&CDefine.TAGTYPE_MASK)!=(t.utype&CDefine.TAGTYPE_MASK))return 0;this.utype=t.utype;this.color=t.color;this.vcolor=t.vcolor;this.rect.Set(t.rect);this.content=t.content;this.pImage=t.pImage;this.bmd=null;if(t.IsObject())return 1;else return 0},PutFormat:function(t){this.Put(t);if(t.pList&&this.pList){if(this.pList.length!=t.pList.length)return;var e,i;var n=this.pList.length;for(var s=0;s<n;s++){e=this.pList.GetAt(s);i=t.pList.GetAt(s);if(e&&i)e.Put(i);else break}}},GetText:function(){var t="";if(this.utype&CDefine.TAGTYPE_TEXT){t=this.content}if(this.pList){var e;var i=this.pList.length;for(var n=0;n<i;n++){e=this.pList.GetAt(n);if(e.utype&CDefine.TAGTYPE_TEXT)t+=e.content;else if(e.utype&CDefine.TAGTYPE_RETURN)t+="\n";else if(e.utype&CDefine.TAGTYPE_WIDTH)t+=" "}}return t},GetTextColor:function(){if(this.utype&CDefine.TAGTYPE_TEXT&&!(this.utype&CDefine.TAGTYPE_NULL))return this.color;if(this.pList){var t;var e=this.pList.length;for(var i=0;i<e;i++){t=this.pList.GetAt(i);if(t.utype&CDefine.TAGTYPE_TEXT&&!(t.utype&CDefine.TAGTYPE_NULL))return this.color}}return 4294967295},ReplaceText:function(t){if(this.utype&CDefine.TAGTYPE_TEXT&&!(utype&CDefine.TAGTYPE_NULL)){if(this.bmd){this.bmd.Delete();this.bmd=null}this.content=t;this.rect.SetEmpty();return}if(this.pList){var e;var i=this.pList.length;for(var n=0;n<i;n++){e=this.pList.GetAt(n);if(e.utype&CDefine.TAGTYPE_TEXT&&!(e.utype&CDefine.TAGTYPE_NULL)){if(e.bmd){e.bmd.Delete();e.bmd=null}e.content=t;e.rect.SetEmpty();return}}}},GetTextType:function(){if(this.utype&CDefine.TAGTYPE_TEXT&&!(this.utype&CDefine.TAGTYPE_NULL)){return this.utype}if(this.pList){var t;var e=this.pList.length;for(var i=0;i<e;i++){t=this.pList.GetAt(i);if(t.utype&CDefine.TAGTYPE_TEXT&&!(t.utype&CDefine.TAGTYPE_NULL)){return t.utype}}}return CDefine.TAGTYPE_TEXT},ChangeTagColor:function(t,e){if(arguments.length<2)e=4294967295;if(this.utype&CDefine.TAGTYPE_TEXT){if(this.bmd){this.bmd.Delete();this.bmd=null}this.color=t;if(e!=4294967295)this.vcolor=e}if(this.pList){var i;var n=this.pList.length;for(var s=0;s<n;s++){i=this.pList.GetAt(s);if(i.utype&CDefine.TAGTYPE_TEXT){if(i.bmd){i.bmd.Delete();i.bmd=null}i.color=t;if(e!=4294967295)this.vcolor=e}}}},ChangeTextProp:function(t,e){if(this.utype&CDefine.TAGTYPE_TEXT&&!(this.utype&CDefine.TAGTYPE_NULL)){if(this.bmd){this.bmd.Delete();this.bmd=null}this.ModifyTagType(t,e);this.rect.SetEmpty()}if(this.pList){var i;var n=this.pList.length;for(var s=0;s<n;s++){i=this.pList.GetAt(s);if(i.utype&CDefine.TAGTYPE_TEXT&&!(i.utype&CDefine.TAGTYPE_NULL)){i.bmd=null;i.ModifyTagType(t,e);i.rect.SetEmpty()}}}},ChangeTagTextProp:function(t,e){if(arguments.length<2)e=4294967295;if(this.utype&CDefine.TAGTYPE_TEXT&&!(this.utype&CDefine.TAGTYPE_NULL)){if(this.bmd){this.bmd.Delete();this.bmd=null}this.rect.SetEmpty();if(e!=4294967295)this.color=e;this.utype=this.tagType|CDefine.TAGTYPE_TEXT}if(this.pList){var i;var n=this.pList.length;for(var s=0;s<n;s++){i=this.pList.GetAt(s);if(i.utype&CDefine.TAGTYPE_TEXT&&!(i.utype&CDefine.TAGTYPE_NULL)){if(i.bmd){i.bmd.Delete();i.bmd=null}i.rect.SetEmpty();if(e!=4294967295)i.color=e;i.utype=this.tagType|CDefine.TAGTYPE_TEXT}}}},Equal:function(t){if(this._compare(t)){if(this.pList==null&&t.pList==null)return true}else{return false}if(this.pList&&t.pList){var e;var i;if(this.pList.GetSize()!=t.pList.GetSize())return false;var n=this.pList.length;for(var s=0;s<n;s++){e=this.pList.GetAt(s);i=t.pList.GetAt(s);if(!e._compare(i))return false}return true}return false},Copy:function(){var t=new vx.tag(this);return t},IsNull:function(){if(this.rect.EqualRect(0,0,0,0)&&this.utype==CDefine.TAGTYPE_NULL)return true;else return false},IsEmpty:function(){if(this.rect.EqualRect(0,0,0,0)&&this.utype==0)return true;else return false}});vx.tag.TNULL=function(){var t=new vx.tag;t.rect.SetRect(0,0,0,0);t.utype=CDefine.TAGTYPE_NULL;return t};vx.tag.TAG=function(t,e){if(arguments.length<2)e=0;var i=new vx.tag;i.rect.SetRect(t.left,t.top,t.right,t.bottom);i.utype=e;return i};vx.tag.THEIGHT=function(t){var e=new vx.tag;e.rect.SetRect(0,0,0,t);e.utype=CDefine.TAGTYPE_SETHEIGHT;return e};vx.tag.TWIDTH=function(t){var e=new vx.tag;e.rect.SetRect(0,0,t,0);return e};vx.tag.TRETURN=function(t){var e=new vx.tag;e.rect.SetRect(0,0,0,t);e.utype=CDefine.TAGTYPE_SETHEIGHT|CDefine.TAGTYPE_RETURN;return e};vx.tag.Text=function(t,e,i,n){switch(arguments.length){case 4:break;case 3:n=4294967295;break;case 2:n=4294967295;i=0;break;case 1:n=4294967295;i=0;e=0;break;default:return null}var s=new vx.tag;s.utype=i|CDefine.TAGTYPE_TEXT;s.utype&=~(CDefine.TAGTYPE_IMAGE|CDefine.TAGTYPE_OBJECT);s.color=e;s.vcolor=n;s.content=t;s.pList=null;s.pImage=null;return s};vx.tag.Image=function(t,e,i){switch(arguments.length){case 3:break;case 2:i=0;break;default:return null}var n=new vx.tag;n.utype=i|CDefine.TAGTYPE_IMAGE;n.utype&=~(CDefine.TAGTYPE_TEXT|CDefine.TAGTYPE_OBJECT);n.color=CDefine.DEFAULT_MASK;n.vcolor=4294967295;n.content="";n.pList=null;n.pImage=t;n.rect.Set(e);return n};vx.tag.Obj=function(t,e,i){switch(arguments.length){case 3:break;case 2:i=0;break;default:return null}var n=new vx.tag;n.utype=i|CDefine.TAGTYPE_OBJECT;n.utype&=~(CDefine.TAGTYPE_TEXT|CDefine.TAGTYPE_IMAGE);n.color=0;n.vcolor=4294967295;n.content="";n.pList=null;n.pImage=t;n.rect.Set(e);return n};vx.tagfunc=vx.Class.extend({init:function(){this.m_nDefaultHeight=20;this.m_crBnd=new ObArray;this.m_pFont=new ObArray;this.m_crLT=0;this.m_crRB=0;this.m_hsum=0;this.m_objTag=0;this.m_crBnd.SetSize(CDefine.INDEX_MAXBOUND);this.m_crBnd.SetAt(CDefine.INDEX_BOUNDLT,CColor.GetColor(CColor.INDEX_CONTROLTEXT_BOUNDLT));this.m_crBnd.SetAt(CDefine.INDEX_BOUNDRB,CColor.GetColor(CColor.INDEX_CONTROLTEXT_BOUNDRB));this.m_crBnd.SetAt(CDefine.INDEX_BOUNDLT_SELECT,CColor.GetColor(CColor.INDEX_CONTROLTEXT_GRAYLT));this.m_crBnd.SetAt(CDefine.INDEX_BOUNDRB_SELECT,CColor.GetColor(CColor.INDEX_CONTROLTEXT_GRAYRB));this.m_pFont.SetSize(CDefine.INDEX_MAXFONT)},Delete:function(){if(this.m_pFont){this.m_pFont.RemoveAll();this.m_pFont=null}if(this.m_crBnd){this.m_crBnd.RemoveAll();this.m_crBnd=null}},SetTagMultiLineHeight:function(t){this.m_nDefaultHeight=t},SetTagFont:function(t,e){if(t==null)return;var i;if(e&CDefine.TAGTYPE_BOLD){if(e&CDefine.TAGSIZE_MASK){if(e&CDefine.TAGTYPE_EXTRA)i=CDefine.INDEX_FONTEXTRA_BOLD;else if(e&CDefine.TAGTYPE_LARGE)i=CDefine.INDEX_FONTLARGE_BOLD;else if(e&CDefine.TAGTYPE_SMALL)i=CDefine.INDEX_FONTSMALL_BOLD;else i=CDefine.INDEX_FONTNORMAL_BOLD}else{i=CDefine.INDEX_FONTNORMAL_BOLD}}else{if(e&CDefine.TAGSIZE_MASK){if(e&CDefine.TAGTYPE_EXTRA)i=CDefine.INDEX_FONTEXTRA;else if(e&CDefine.TAGTYPE_LARGE)i=CDefine.INDEX_FONTLARGE;else if(e&CDefine.TAGTYPE_SMALL)i=CDefine.INDEX_FONTSMALL;else i=CDefine.INDEX_FONTNORMAL}else{i=CDefine.INDEX_FONTNORMAL}}this.m_pFont.SetAt(i,t)},GetTagFont:function(t,e){if(arguments.length<2)e=false;var i;if(t&CDefine.TAGTYPE_SELECTBOLD&&e)t|=CDefine.TAGTYPE_BOLD;if(t&CDefine.TAGTYPE_BOLD){if(t&CDefine.TAGSIZE_MASK){if(t&CDefine.TAGTYPE_EXTRA)i=CDefine.INDEX_FONTEXTRA_BOLD;else if(t&CDefine.TAGTYPE_LARGE)i=CDefine.INDEX_FONTLARGE_BOLD;else if(t&CDefine.TAGTYPE_SMALL)i=CDefine.INDEX_FONTSMALL_BOLD;else i=CDefine.INDEX_FONTNORMAL_BOLD}else{i=CDefine.INDEX_FONTNORMAL_BOLD}}else{if(t&CDefine.TAGSIZE_MASK){if(t&CDefine.TAGTYPE_EXTRA)i=CDefine.INDEX_FONTEXTRA;else if(t&CDefine.TAGTYPE_LARGE)i=CDefine.INDEX_FONTLARGE;else if(t&CDefine.TAGTYPE_SMALL)i=CDefine.INDEX_FONTSMALL;else i=CDefine.INDEX_FONTNORMAL}else{i=CDefine.INDEX_FONTNORMAL}}var n=this.m_pFont.GetAt(i);if(n!=null)return n;else return vx.Global.g_pFont.GetAt(i)},SetBoundColor:function(t,e){if(t>=0&&t<CDefine.INDEX_MAXBOUND){this.m_crBnd.SetAt(t,e)}},GetBoundColor:function(t){if(t>=0&&t<CDefine.INDEX_MAXBOUND){return this.m_crBnd.GetAt(t)}return 0},GetBoundColors:function(t,e){if(t&CDefine.TAGTYPE_BNDINVERT&&e){this.m_crLT=this.m_crBnd.GetAt(CDefine.INDEX_BOUNDLT_SELECT);this.m_crRB=this.m_crBnd.GetAt(CDefine.INDEX_BOUNDRB_SELECT)}else{this.m_crLT=this.m_crBnd.GetAt(CDefine.INDEX_BOUNDLT);this.m_crRB=this.m_crBnd.GetAt(CDefine.INDEX_BOUNDRB)}},DrawTag:function(t,e,i,n,s,r,a){var o;var l,_,h=0;var f;var C,m,u;if(e.IsText()){o=this.GetTagFont(e.utype,a);if(e.content!=""&&e.content!=null&&o){if(a&&e.vcolor!=-1)C=e.vcolor;else C=e.color;if(e.rect.EqualRect(0,0,0,0)||e.utype&CDefine.TAGTYPE_SELECTBOLD)i.DrawTagText(e,e.rect,CDefine.DT_CALCRECT,o,C);f=s.Clone();h=e.rect.Width();_=s.Height();if(e.utype&CDefine.TAGTYPE_FULLMASK){if(e.utype&CDefine.TAGTYPE_FULLVCENTER){l=(n.top+n.bottom)/2;f.top=l-_/2;f.bottom=l-_/2+_}if(e.utype&CDefine.TAGTYPE_FULLLEFT){f.left=n.left;f.right=n.left+h}else if(e.utype&CDefine.TAGTYPE_FULLRIGHT){f.left=n.right-h;f.right=n.right}else if(e.utype&CDefine.TAGTYPE_FULLCENTER){l=(n.left+n.right)/2;f.left=l-h/2;f.right=l-h/2+h}h=0}else{s.left+=h;f.right=s.left}var T;if(r&(CDefine.DT_TOP|CDefine.DT_BOTTOM))T=r|CDefine.DT_SINGLELINE|CDefine.TAGFORMAT_MASK&e.utype;else T=r|CDefine.DT_SINGLELINE|CDefine.DT_VCENTER|CDefine.TAGFORMAT_MASK&e.utype;if(e.utype&CDefine.TAGBOUND_MASK){this.GetBoundColors(e.utype,a);m=this.m_crLT;u=this.m_crRB}else{m=4294967295;u=4294967295}i.DrawTagText(e,f,T,o,C,m)}}else if(e.IsImage()){if(!e.pImage)return h;var S=e.rect.Clone();f=s.Clone();h=e.rect.Width();_=e.rect.Height();if(e.utype&CDefine.TAGTYPE_FULLMASK){if(e.utype&CDefine.TAGTYPE_FULLVCENTER){l=(n.top+n.bottom)/2;f.top=l-_/2;f.bottom=l-_/2+_}if(e.utype&CDefine.TAGTYPE_FULLLEFT){f.left=n.left;f.right=n.left+h}else if(e.utype&CDefine.TAGTYPE_FULLRIGHT){f.left=n.right-h;f.right=n.right}else if(e.utype&CDefine.TAGTYPE_FULLCENTER){l=(n.left+n.right)/2;f.left=l-h/2;f.right=l-h/2+h}h=0}else{if(e.utype&CDefine.TAGTYPE_MULTILINEIMAGE)l=(n.top+n.bottom)/2;else l=(f.top+f.bottom)/2;s.left+=h;f.right=s.left;f.top=l-_/2;f.bottom=l-_/2+_}var c=e.pImage;c.DrawEx(i,f.left,f.top,S,0)}else if(e.IsObject()){f=s.Clone();h=e.rect.Width();_=e.rect.Height();if(e.utype&CDefine.TAGTYPE_FULLMASK){if(e.utype&CDefine.TAGTYPE_FULLVCENTER){l=(n.top+n.bottom)/2;f.top=l-_/2;f.bottom=l-_/2+_}if(e.utype&CDefine.TAGTYPE_FULLLEFT){f.left=n.left;f.right=n.left+h}else if(e.utype&CDefine.TAGTYPE_FULLRIGHT){f.left=n.right-h;f.right=n.right}else if(e.utype&CDefine.TAGTYPE_FULLCENTER){l=(n.left+n.right)/2;f.left=l-h/2;f.right=l-h/2+h}h=0}else{if(e.utype&CDefine.TAGTYPE_MULTILINEIMAGE)l=(n.top+n.bottom)/2;else l=(f.top+f.bottom)/2;s.left+=h;f.right=s.left;f.top=l-_/2;f.bottom=l-_/2+_}e.rect=f;if(t)t.AddTail(e)}else{h=e.rect.Width();s.left+=h}if(e.utype&CDefine.TAGTYPE_RETURN)h=-1;return h},Draw:function(t,e,i,n,s,r,a,o){if(e==null)return a;var l;var _;var h,f,C;var m;if(o==null)o=new ObArray;if(a==0){o.RemoveAll();a=this.CalcTag(e,i,r,o)}if(s&CDefine.DT_CENTER){h=(n.left+n.right)/2;m=CUtil.CRect(h-a/2,n.top,h-a/2+a,n.bottom)}else if(s&CDefine.DT_RIGHT){m=CUtil.CRect(n.right-a,n.top,n.right,n.bottom)}else{m=n.Clone()}h=f=C=0;var u,T,S=0;var c=false;if(o.GetSize()>1)c=true;var g=m.Clone();if(c){if(s&CDefine.DT_CENTER){T=o.GetAt(S);u=(g.left+g.right)/2;g.left=u-T/2;g.right=u-T/2+T}else if(s&CDefine.DT_RIGHT){T=o.GetAt(S);g.left=g.right-T}if(e.rect.Height()==0)g.bottom=g.top+this.m_nDefaultHeight;else g.bottom=g.top+e.rect.Height()}else{if(e.rect.Height()==0){g.top=Math.floor(g.top+g.bottom-this.m_nDefaultHeight)/2;g.bottom=g.top+this.m_nDefaultHeight}else{g.top=Math.floor(g.top+g.bottom-e.rect.Height())/2;g.bottom=g.top+e.rect.Height()}}f=g.Height();C+=f;h=this.DrawTag(t,e,i,n,g,s,r);if(h>0&&e.utype&CDefine.TAGTYPE_NOWIDTH)g.left-=h;if(!e.pList)return a;l=e.pList.length;for(var E=0;E<l;E++){_=e.pList.GetAt(E);if(h<0){g=m.Clone();g.top+=C;g.bottom=g.top+f;if(c){S++;if(s&CDefine.DT_CENTER){T=o.GetAt(S);u=(g.left+g.right)/2;g.left=u-T/2;g.right=u-T/2+T}else if(s&CDefine.DT_RIGHT){T=o.GetAt(S);g.left=g.right-T}}if(_.rect.Height()==0)g.bottom=g.top+this.m_nDefaultHeight;else g.bottom=g.top+_.rect.Height();f=g.Height();C+=f}else{if(_.IsSetHeight()){C-=g.Height();g.bottom=g.top+_.rect.Height();f=g.Height();C+=f}}h=this.DrawTag(t,_,i,n,g,s,r);if(h>0&&_.utype&CDefine.TAGTYPE_NOWIDTH)g.left-=h}return a},CalcTag:function(t,e,i,n){var s;var r=0;var a=0;var o=0;if(i&&t.vcolor!=-1)o=t.vcolor;else o=t.color;if(t.utype&CDefine.TAGTYPE_TEXT&&t.rect.EqualRect(0,0,0,0)){e.DrawTagText(t,t.rect,CDefine.DT_CALCRECT,this.GetTagFont(t.utype,i),o);if(t.utype&CDefine.TAGBOUND_MASK){t.rect.right+=4;t.rect.bottom+=4}}if(t.utype&CDefine.TAGTYPE_RETURN){a+=t.rect.Width();if(r<a)r=a;if(n)n.Add(a);a=0}else{if((t.utype&(CDefine.TAGTYPE_NOWIDTH|CDefine.TAGTYPE_FULLMASK))==0)a+=t.rect.Width()}if(!t.pList)return a>r?a:r;var l=t.pList.length;for(var _=0;_<l;_++){s=t.pList.GetAt(_);if(i&&s.vcolor!=-1)o=s.vcolor;else o=s.color;if(s.utype&CDefine.TAGTYPE_TEXT&&s.rect.EqualRect(0,0,0,0)){e.DrawTagText(s,s.rect,CDefine.DT_CALCRECT,this.GetTagFont(s.utype,i),o);if(t.utype&CDefine.TAGBOUND_MASK){t.rect.right+=4;t.rect.bottom+=4}}if(s.utype&CDefine.TAGTYPE_RETURN){a+=s.rect.Width();if(r<a)r=a;if(n)n.Add(a);a=0}else{if((s.utype&(CDefine.TAGTYPE_NOWIDTH|CDefine.TAGTYPE_FULLMASK))==0)a+=s.rect.Width()}}if(n)n.Add(a);return a>r?a:r},CalcTag2:function(t,e,i,n){if(t==null)return 0;var s;var r=0;var a=0;var o=0;var l=false;var _=0;this.m_hsum=0;this.m_objTag=0;if(i&&t.vcolor!=-1)_=t.vcolor;else _=t.color;if(t.utype&CDefine.TAGTYPE_TEXT&&t.rect.EqualRect(0,0,0,0)){e.DrawTagText(t,t.rect,CDefine.DT_CALCRECT,this.GetTagFont(t.utype,i),_);if(t.utype&CDefine.TAGBOUND_MASK){t.rect.right+=4;t.rect.bottom+=4}}else if(t.IsObject()){this.m_objTag++}if(t.utype&CDefine.TAGTYPE_RETURN){a+=t.rect.Width();if(r<a)r=a;if(n)n.Add(a);a=0;l=true}else{if((t.utype&(CDefine.TAGTYPE_NOWIDTH|CDefine.TAGTYPE_FULLMASK))==0)a+=t.rect.Width()}if(t.IsSetHeight()){o=t.rect.Height();this.m_hsum+=o}else if(t.IsImage()&&!(t.utype&(CDefine.TAGTYPE_MULTILINEIMAGE|CDefine.TAGTYPE_FULLMASK))){o=t.rect.Height();this.m_hsum+=o}else{o=this.m_nDefaultHeight;this.m_hsum+=this.m_nDefaultHeight}if(t.utype&CDefine.TAGTYPE_FIXEDHEIGHT)this.m_hsum=t.rect.Height();if(!t.pList)return a>r?a:r;var h=this.m_nDefaultHeight;var f=t.pList.length;for(var C=0;C<f;C++){s=t.pList.GetAt(C);if(l){if(s.IsSetHeight()){o=s.rect.Height();this.m_hsum+=o}else if(s.IsImage()&&!(s.utype&(CDefine.TAGTYPE_MULTILINEIMAGE|CDefine.TAGTYPE_FULLMASK))){o=s.rect.Height();this.m_hsum+=o}else{o=h;this.m_hsum+=h}l=false}else{if(s.IsSetHeight()){this.m_hsum-=o;o=s.rect.Height();this.m_hsum+=o}}if(s.utype&CDefine.TAGTYPE_TEXT&&s.rect.EqualRect(0,0,0,0)){if(i&&s.vcolor!=4294967295)_=s.vcolor;else _=s.color;e.DrawTagText(s,s.rect,CDefine.DT_CALCRECT,this.GetTagFont(s.utype,i),_);if(s.utype&CDefine.TAGBOUND_MASK){s.rect.right+=4;s.rect.bottom+=4}}else if(t.IsObject()){this.m_objTag++}if(s.utype&CDefine.TAGTYPE_FIXEDHEIGHT||!l){if(this.m_hsum<s.rect.Height())this.m_hsum=s.rect.Height()}else{this.m_hsum+=s.rect.Height()}if(s.utype&CDefine.TAGTYPE_RETURN){a+=s.rect.Width();if(r<a)r=a;if(n)n.Add(a);a=0;l=true;if(s.utype&CDefine.TAGTYPE_SETHEIGHT){h=s.rect.Height()}}else{if((t.utype&(CDefine.TAGTYPE_NOWIDTH|CDefine.TAGTYPE_FULLMASK))==0)a+=s.rect.Width()}}if(n)n.Add(a);return a>r?a:r}});vx.tagcont=vx.Class.extend({init:function(){this.m_uFmt=CDefine.DT_LEFT;this.m_bSelect=false;this.m_nCalc=0;this.m_nObjTagCnt=0;this.m_aryObjTag=new ObArray;this.m_aryLineW=new ObArray;this.m_szTag=new vx.point(0,0);this.m_tag=null;this.m_pTagFunc=vx.Global.g_tagFunc},Delete:function(){if(this.m_tag){this.m_tag.Delete();this.m_tag=null}this.m_szTag=null;this.m_pTagFunc=null;if(this.m_aryObjTag){this.m_aryObjTag.RemoveAll();this.m_aryObjTag=null}if(this.m_aryLineW){this.m_aryLineW.RemoveAll();this.m_aryLineW=null}},IsCalulate:function(){if(this.m_nCalc==0)return false;else return true},GetTag:function(){return this.m_tag},SetTag:function(t,e,i){switch(arguments.length){case 3:break;case 2:i=null;break;case 1:i=null;e=4294967295;break;default:return}this.m_tag=new vx.tag(t);if(e!=4294967295)this.m_uFmt=e;this.m_nCalc=0;if(this.m_aryLineW)this.m_aryLineW.RemoveAll();if(this.m_aryObjTag!=null)this.m_aryObjTag.RemoveAll();if(i==null)i=vx.Global.g_buffer;if(i&&this.m_pTagFunc){this.m_nCalc=this.m_pTagFunc.CalcTag2(this.m_tag,i,this.m_bSelect,this.m_aryLineW);this.m_szTag.x=this.m_nCalc;this.m_szTag.y=this.m_pTagFunc.m_hsum;this.m_nObjTagCnt=this.m_pTagFunc.m_objTag}},GetObjectTagCnt:function(){return this.m_nObjTagCnt},SetSelect:function(t){var e=this.m_bSelect;this.m_bSelect=t;if(e!=t)this.m_tag.ClearBmd();return e},GetSize:function(){if(this.m_nCalc==0&&this.m_pTagFunc){this.m_nCalc=this.m_pTagFunc.CalcTag2(this.m_tag,vx.Global.g_buffer,this.m_bSelect,this.m_aryLineW);this.m_szTag.x=this.m_nCalc;this.m_szTag.y=this.m_pTagFunc.m_hsum;this.m_nObjTagCnt=this.m_pTagFunc.m_objTag}return new vx.point(this.m_szTag.x,this.m_szTag.y)},SetTagFont:function(t,e){if(this.m_pTagFunc==vx.Global.g_tagFunc||this.m_pTagFunc==null){this.m_pTagFunc=new vx.tagfunc}this.m_pTagFunc.SetTagFont(t,e)},GetBoundColor:function(t){if(this.m_pTagFunc){return this.m_pTagFunc.GetBoundColor(t)}return 0},SetBoundColor:function(t,e){if(this.m_pTagFunc==vx.Global.g_tagFunc||this.m_pTagFunc==null){this.m_pTagFunc=new vx.tagfunc}this.m_pTagFunc.SetBoundColor(t,e)},SetTagMultiLineHeight:function(t){if(this.m_pTagFunc==vx.Global.g_tagFunc||this.m_pTagFunc==null){this.m_pTagFunc=new vx.tagfunc}this.m_pTagFunc.SetTagMultiLineHeight(t)},Draw:function(t,e){this.m_aryObjTag.RemoveAll();var i=e.Clone();var n=this.m_szTag.y;i.top=Math.floor((i.top+i.bottom-this.m_szTag.y)/2);i.bottom=i.top+this.m_szTag.y;this.m_nCalc=this.m_pTagFunc.Draw(this.m_aryObjTag,this.m_tag,t,i,this.m_uFmt,this.m_bSelect,this.m_nCalc,this.m_aryLineW)},ChangeTagColor:function(t,e,i,n){switch(arguments.length){case 4:break;case 3:n=false;break;case 2:n=false;i=4294967295;break;case 1:n=false;i=4294967295;e=4294967295;break;default:return}if(t!=4294967295)this.m_tag.ChangeTagColor(t);if(n){if(e!=4294967295)this.SetBoundColor(CDefine.INDEX_BOUNDLT_SELECT,e);if(i!=4294967295)this.SetBoundColor(CDefine.INDEX_BOUNDRB_SELECT,i)}else{if(e!=4294967295)this.SetBoundColor(CDefine.INDEX_BOUNDLT,e);if(i!=4294967295)this.SetBoundColor(CDefine.INDEX_BOUNDRB,i)}},ChangeTextTagType:function(t,e){this.m_nCalc=0;this.m_tag.ChangeTagTextProp(t,e)},ReplaceText:function(t){this.m_szTag.x=0;this.m_szTag.y=0;this.m_nCalc=0;this.m_nObjTagCnt=0;this.m_aryObjTag.RemoveAll();this.m_tag.ReplaceText(t);this.GetSize()}});vx.tagcont.GetTagSize=function(t){var e;e=vx.Global.g_tagFunc.CalcTag2(t,vx.Global.g_buffer,false,null);return new vx.point(e,vx.Global.g_tagFunc.m_hsum)};vx.tagcont.GetTagSizeInfo=function(t,e,i){var n;n=vx.Global.g_tagFunc.CalcTag2(t,vx.Global.g_buffer,false,i);e.x=n;e.y=vx.Global.g_tagFunc.m_hsum;return n};vx.tagcont.LevelColor=function(t,e){var i=CColor.GetRValue(t);var n=CColor.GetGValue(t);var s=CColor.GetBValue(t);i+=e*i/100;n+=e*n/100;s+=e*s/100;if(i>255)i=255;if(n>255)n=255;if(s>255)s=255;return CColor.RGB(i,n,s)};vx.tagcont.GetEnterTag=function(t,e,i,n,s,r){switch(arguments.length){case 6:break;case 5:r=0;break;case 4:r=0;s=20;break}if(t==null||t=="")return vx.tag.TNULL();t=CUtil.Replace(t,"\r\n","\n");t=CUtil.Replace(t,"\r","\n");var a,o;var l=false;var _=null;var h;while((a=t.search("\n"))!=-1){h=t.substring(0,a);t=t.substring(a+1);if(!l){l=true;if(h==""){_=vx.tag.TRETURN(s/3);_.Append(vx.tag.THEIGHT(s))}else{_=vx.tag.Text(h,e,i,n);_.Append(vx.tag.TRETURN(s))}}else{if(h==""){_.Append(vx.tag.TRETURN(s/3));_.Append(vx.tag.THEIGHT(s))}else{_.Append(vx.tag.Text(h,e,i,n));_.Append(vx.tag.TRETURN(s));if(r>0)_.Append(vx.tag.TWIDTH(r))}}}if(!l)_=vx.tag.Text(t,e,i,n);else{if(r>0)_.Append(vx.tag.TWIDTH(r));_.Append(vx.tag.Text(t,e,i,n))}return _};function CDefine(){}CDefine._CM_ENABLE=1;CDefine._CM_GRAY=2;CDefine._CM_CHECK=3;CDefine._CM_DELETE=4;CDefine._CM_RENAME=5;CDefine._CM_MODIFY=6;CDefine._CM_INSERT=7;CDefine.BUTTON_DEPTH=3;CDefine.SOUND_POOL_COUNT=5;CDefine.OPENSLID_GAP=200;CDefine.VXID_FOCUSMARK=4294967279;CDefine.VXID_NONE=4294967278;CDefine.VXID_HILIGHT=4294967277;CDefine.VXID_CLOSE=4294967264;CDefine.VXID_MAXIMIZE=4294967265;CDefine.VXID_MINIMIZE=4294967266;CDefine.VXID_BOXCLOSE=4294967267;CDefine.VXID_BOXOK=4294967268;CDefine.VXID_BOXCANCEL=4294967269;CDefine.VXID_BOXRETRY=4294967270;CDefine.VXID_HOLDER=4294967271;CDefine.VXID_LISTMORE=4294967272;CDefine.TIME_TIC=15;CDefine.DEFTIMER_HILIGHT0=983041;CDefine.DEFTIMER_HILIGHT=983042;CDefine.DEFTIMER_MOVE=655361;CDefine.DEFTIMER_EFFECTIN=655362;CDefine.DEFTIMER_EFFECTOUT=655363;CDefine.DEFTIMER_TRANSFORM=655364;CDefine.DEFTIMER_CLICK=65537;CDefine.DEFTIMER_BLINK=131073;CDefine.DEFTIMER_TAGANI=196609;CDefine.DEFTIMER_CARET=262145;CDefine.DEFTIMER_EDITTYPEW=327681;CDefine.DEFTIMER_EDITSCROLL=327682;CDefine.DEFTIMER_STATIC_ANIMATION=393217;CDefine.DEFTIMER_EFFECT_LIFE=458753;CDefine.DEFTIMER_EFFECT_FRAME=458754;CDefine.DEFTIMER_TICKER=524289;CDefine.DEFTIMER_OPENMENU=589825;CDefine.DEFTIMER_TOOLTIP=1048577;CDefine.DEFTIMER_PROGRESS=2097153;CDefine.DEFTIMER_PROGRESSMOVE=2097154;CDefine.DEFTIMER_SLIDER=3145729;CDefine.DEFTIMER_TALK=4194305;CDefine.DEFTIMER_TALKOPENSLID=4194306;CDefine.DEFTIMER_TAIVIEW=5242881;CDefine.DEFTIMER_PLAYCMD=6291457;CDefine.DEFTIMER_ANICURSOR=7340033;CDefine.DEFTIMER_GRAPENDING=8388609;CDefine.DEFTIMER_HOLD=9437185;CDefine.VXMASK_TABOPERATION=65535;CDefine.VXCODE_BOX=268435456;CDefine.VXCODE_SCROLLBOX=268500992;CDefine.VXCODE_EDITBOX=268500994;CDefine.VXCODE_LISTBOX=268500996;CDefine.VXCODE_SINGLELIST=285278212;CDefine.VXCODE_CLICK=536870912;CDefine.VXCODE_BUTTON=536870913;CDefine.VXCODE_GROUP=536936449;CDefine.VXCODE_STATIC=537001984;CDefine.VXCODE_COMBOBOX=8;CDefine.VXCODE_TAB=16;CDefine.VXCODE_SLIDER=32;CDefine.VXCODE_MENU=64;CDefine.VXCODE_SCROLLBAR=65536;CDefine.VXCODE_PROGRESS=262144;CDefine.VXCODE_TICKER=524288;CDefine.VXCODE_BANNER=1048576;CDefine.VXCODE_TOOLTIP=2097152;CDefine.VXCODE_AVATA=4194304;CDefine.VXCODE_BUILD=8388608;CDefine.VXCODE_UNDEFINE=4026531841;CDefine.CMD_VXSTAGE_MOVEEND=2852126721;CDefine.CMD_VXOBJECT_MOVEEND=268435457;CDefine.CMD_VXOBJECT_NOTIFYKEY=268435458;CDefine.CMD_VXOBJECT_POPUPESC=268435460;CDefine.CMD_VXBUTTON_CLICK=536870913;CDefine.CMD_VXMENUBAR_CLICK=805306369;CDefine.CMD_VXTAB_NOTIFYCHANGE=1073741825;CDefine.CMD_VXBANNER_CLICK=1342177281;CDefine.CMD_VXBANNER_NOTIFYEND=1342177282;CDefine.CMD_VXSTATIC_NOTIFY=1610612737;CDefine.CMD_VXDRAG_DRAGSTART=1879048193;CDefine.CMD_VXDRAG_DRAG=1879048194;CDefine.CMD_VXDRAG_DRAGEND=1879048195;CDefine.CMD_VXSCROLLBAR_HSCROLL=2147483649;CDefine.CMD_VXSCROLLBAR_VSCROLL=2147483650;CDefine.CMD_VXSCROLLBAR_CHANGESTATUS=2147483652;CDefine.CMD_VXLISTBOX_NOTIFYCHANGE=2415919105;CDefine.CMD_VXLISTBOX_NOTIFYDBLCLICK=2415919106;CDefine.CMD_VXLISTBOX_NOTIFYCLICK=2415919107;CDefine.CMD_VXLISTBOX_NOTIFYRCLICK=2415919108;CDefine.CMD_VXLISTBOX_HEADERCLICK=2415919109;CDefine.CMD_VXLISTBOX_HEADERRESIZE=2415919110;CDefine.CMD_VXLISTBOX_MORELIST=2415919111;CDefine.CMD_VXEDITBOX_NOTIFYLINK=2684354561;CDefine.CMD_VXEDITBOX_NOTIFYKEY=2684354562;CDefine.CMD_VXEDITBOX_TYPEWRITEEND=2684354563;CDefine.CMD_VXEDITBOX_ACCELERATOR=2684354564;CDefine.CMD_VXEDITBOX_SCROLLVIEWEEND=2684354565;CDefine.CMD_VXMESSAGEBOX_RESULT=2952790017;CDefine.CMD_VXCOMBOBOX_NOTIFYCHANGE=16777217;CDefine.CMD_VXCOMBOBOX_NOTIFYEDIT=16777218;CDefine.CMD_VXMENU_CLICK=33554433;CDefine.CMD_VXPROGRESS_TIMEOUT=50331649;CDefine.CMD_VXSLIDER_CHANGEPOSITION=67108865;CDefine.CMD_VXTAIVIEW_NOTIFY=83886081;CDefine.CMD_VXAVATA_NOTIFYCLICK=100663297;CDefine.CMD_VXAVATA_NOTIFYDBLCLK=100663298;CDefine.CMD_VXANIMATION_PLAYEND=117440513;CDefine.CMD_VXANIMATION_MOVEEND=117440514;CDefine.CMD_VXANIMATION_MYNOTIFY=117440515;CDefine.CMD_VXMODALBOX_END=134217729;CDefine.CMD_VXBUILD_LOOPEND=150994945;CDefine.CMD_VXPACKLOADER_COMPLETE=167772161;CDefine.CMD_VXPACKLOADER_PROGRESS=167772162;CDefine.CMD_VXPACKLOADER_ERROR=167772164;CDefine.CMD_VXHOLDER_NOTIFYEND=184549377;CDefine.CMD_VXHOLDER_NOTIFYEVENT=184549378;CDefine.CMD_TRANSFORM_END=201326593;CDefine.CMD_TRANSFORM_DONE=201326594;CDefine.MOVEPROP_ONMOVECALL=1;CDefine.MOVEPROP_NOTIFYEND=2;CDefine.MOVEPROP_NOUSEDIRECT=4;CDefine.MOVEPROP_FIXEDARC=8;CDefine.MOVEPROP_OFFSETVALUE=16;CDefine.MOVEPROP_CONTINUEPROP=32;CDefine.MOVEPROP_BYPOINT=64;CDefine.MOVEPROP_RELATIVE=128;CDefine.MOVEPROP_RAISING=65536;CDefine.MOVEPROP_FALLING=131072;CDefine.MOVEPROP_DELETE=262144;CDefine.MOVEPROP_PUMPPUSHLEFT=268435456;CDefine.MOVEPROP_PUMPPUSHRIGHT=536870912;CDefine.MOVEPROP_RIGHTPUMP=1073741824;CDefine.MOVEPROP_LEFTPUMP=2147483648;CDefine.MOVEPROP_BOTTOMPUMP=16777216;CDefine.MOVEPROP_TREMBLEPUMP=33554432;CDefine.MM_NORMAL=0;CDefine.MM_SLOWFAST=1;CDefine.MM_FASTSLOW=2;CDefine.MM_SLOWFASTSLOW=3;CDefine.MMP_NORMAL=10;CDefine.MMP_SLOWFAST=11;CDefine.MMP_FASTSLOW=12;CDefine.MMP_SLOWFASTSLOW=13;CDefine.MMC_NORMAL=20;CDefine.MMC_SLOWFAST=21;CDefine.MMC_FASTSLOW=22;CDefine.MMC_SLOWFASTSLOW=23;CDefine.MMS_NORMAL=30;CDefine.MMS_SLOWFAST=31;CDefine.MMS_FASTSLOW=32;CDefine.MMS_SLOWFASTSLOW=33;CDefine.MOVERESULT_CHANGE=1;CDefine.MOVERESULT_CALLBACK=2;CDefine.MOVERESULT_MOVEEND=4;CDefine.MOVERESULT_CLEAR=8;CDefine.pi=3.1415926535;CDefine.SMLIMIT_NORMAL=20;CDefine.SMLIMIT_BIG=28;CDefine.SMSIZE_SMALL=16;CDefine.SMSIZE_NORMAL=21;CDefine.SMSIZE_BIG=25;CDefine.SHAPE_NONE=0;CDefine.SHAPE_MINIMIZE=1;CDefine.SHAPE_MAXIMIZE=2;CDefine.SHAPE_RESTORE=3;CDefine.SHAPE_CLOSE=4;CDefine.SHAPE_UPARROW=5;CDefine.SHAPE_DOWNARROW=6;CDefine.SHAPE_LEFTARROW=7;CDefine.SHAPE_RIGHTARROW=8;CDefine.SHAPE_CHECK=9;CDefine.SHAPE_CHECKBOUND=10;CDefine.SHAPE_RADIO=11;CDefine.SHAPE_RADIOBOUND=12;CDefine.SHAPE_MULTI=13;CDefine.DEFAULT_MASK=16711935;CDefine.TAGTYPE_TEXT=268435456;CDefine.TAGTYPE_IMAGE=536870912;CDefine.TAGTYPE_OBJECT=1073741824;CDefine.TAGTYPE_MASK=1879048192;CDefine.TAGTYPE_NULL=512;CDefine.TAGTYPE_SETHEIGHT=16777216;CDefine.TAGTYPE_ANIMATION=33554432;CDefine.TAGTYPE_RETURN=67108864;CDefine.TAGTYPE_NOWIDTH=134217728;CDefine.TAGTYPE_BNDNORMAL=1048576;CDefine.TAGTYPE_BNDHALF=2097152;CDefine.TAGTYPE_BNDREVERSE=4194304;CDefine.TAGTYPE_BNDINVERT=8388608;CDefine.TAGBOUND_MASK=15728640;CDefine.TAGTYPE_SMALL=65536;CDefine.TAGTYPE_LARGE=131072;CDefine.TAGTYPE_EXTRA=262144;CDefine.TAGSIZE_MASK=458752;CDefine.TAGTYPE_BOLD=524288;CDefine.TAGTYPE_SELECTBOLD=4096;CDefine.TAGTYPE_FIXEDHEIGHT=8192;CDefine.TAGTYPE_ONCEANI=16384;CDefine.TAGTYPE_NOANINODRAW=32768;CDefine.TAGTYPE_MULTILINEIMAGE=256;CDefine.TAGTYPE_CENTER=1;CDefine.TAGTYPE_RIGHT=2;CDefine.TAGFORMAT_MASK=3;CDefine.TAGTYPE_FULLCENTER=16;CDefine.TAGTYPE_FULLLEFT=32;CDefine.TAGTYPE_FULLRIGHT=64;CDefine.TAGTYPE_FULLVCENTER=128;CDefine.TAGTYPE_FULLMASK=240;CDefine.DT_CENTER=1;CDefine.DT_RIGHT=2;CDefine.DT_LEFT=4;CDefine.DT_TOP=8;CDefine.DT_BOTTOM=16;CDefine.DT_VCENTER=32;CDefine.DT_SINGLELINE=64;CDefine.DT_CALCRECT=128;CDefine.INDEX_FONTSMALL=0;CDefine.INDEX_FONTNORMAL=1;CDefine.INDEX_FONTLARGE=2;CDefine.INDEX_FONTEXTRA=3;CDefine.INDEX_FONTSMALL_BOLD=4;CDefine.INDEX_FONTNORMAL_BOLD=5;CDefine.INDEX_FONTLARGE_BOLD=6;CDefine.INDEX_FONTEXTRA_BOLD=7;CDefine.INDEX_FONTCHAT=8;CDefine.INDEX_FONTCHAT_BOLD=9;CDefine.INDEX_MAXFONT=10;CDefine.INDEX_BOUNDLT=0;CDefine.INDEX_BOUNDRB=1;CDefine.INDEX_BOUNDLT_SELECT=2;CDefine.INDEX_BOUNDRB_SELECT=3;CDefine.INDEX_MAXBOUND=4;CDefine.BOXFLAG_LEFT=1;CDefine.BOXFLAG_TOP=2;CDefine.BOXFLAG_RIGHT=4;CDefine.BOXFLAG_BOTTOM=8;CDefine.BOXFLAG_LEFTTOP=16;CDefine.BOXFLAG_RIGHTTOP=32;CDefine.BOXFLAG_LEFTBOTTOM=64;CDefine.BOXFLAG_RIGHTBOTTOM=128;CDefine.BOXFLAG_INNER=256;CDefine.BOXFLAG_TRANS=512;CDefine.BOXFLAG_BUFFER=4096;CDefine.BOXFLAG_ALL=61439;CDefine.BOXFLAG_TOPONLY=50;CDefine.BOXFLAG_BOTTOMONLY=200;CDefine.PKFLAG_BMP=1;CDefine.PKFLAG_TGA=2;CDefine.PKFLAG_GIF=4;CDefine.PKFLAG_JPG=8;CDefine.PKFLAG_PNG=32;CDefine.PKFLAG_IMAGEMASK=47;CDefine.PKFLAG_ANI=16;CDefine.PKFLAG_TXT=256;CDefine.PKFLAG_WAV=4096;CDefine.PKFLAG_OGG=8192;CDefine.PKFLAG_TRANSFORM=268435456;CDefine.PKFLAG_SAVEDISK=536870912;CDefine.PKFLAG_IMAGENOTRANS=16777216;CDefine.PKFLAG_IMAGENOINNER=33554432;CDefine.PKFLAG_TILETRANSFER=67108864;CDefine.PKFLAG_HALFSHADOW=134217728;CDefine.NOTIFYKEY_RETURN=10;CDefine.NOTIFYKEY_ESC=11;CDefine.NOTIFYKEY_TAB=12;CDefine.NOTIFYKEY_BACKTAB=13;CDefine.NOTIFYKEY_CTRLTAB=14;CDefine.NOTIFYKEY_WHEEL=15;CDefine.NOTIFYKEY_ARROWDOWN=17;CDefine.NOTIFYKEY_ARROWUP=18;CDefine.NOTIFYKEY_ARROWLEFT=19;CDefine.NOTIFYKEY_ARROWRIGHT=20;CDefine.NOTIFYKEY_SETFOCUS=26;CDefine.NOTIFYKEY_CLEARFOCUS=27;CDefine.NOTIFYKEY_COPY=33;CDefine.NOTIFYKEY_CUT=34;CDefine.NOTIFYKEY_PASTE=35;CDefine.NOTIFYKEY_UNDO=36;CDefine.NOTIFYKEY_REDO=37;CDefine.NOTIFYKEY_SELECT=38;CDefine.NOTIFYKEY_UNSELECT=39;CDefine.SPI_SCRLBUTTONDX=0;CDefine.SPI_SCRLBUTTONDY=1;CDefine.SPI_SCRLDRAGMIN=2;CDefine.SPI_SCRLSPACEGAP=3;CDefine.SPI_SCRLLINESIZE=4;CDefine.BPI_SYSBUTTONDX=0;CDefine.BPI_SYSBUTTONDY=1;CDefine.BPI_SYSRESIZEBORDER=2;CDefine.BPI_SYSCAPTION=3;CDefine.BPI_OUTLBORDER=4;CDefine.BPI_OUTTBORDER=5;CDefine.BPI_OUTRBORDER=6;CDefine.BPI_OUTBBORDER=7;CDefine.BPI_MINBOXDX=8;CDefine.BPI_MINBOXDY=9;CDefine.BPI_MAXBOXDX=10;CDefine.BPI_MAXBOXDY=11;CDefine.BPI_DEFAULTBTNDX=12;CDefine.BPI_DEFAULTBTNDY=13;CDefine.BPI_TITLEXMARGIN=14;CDefine.BPI_TITLEYMARGIN=15;CDefine.BPI_SYSXMARGIN=16;CDefine.BPI_SYSYMARGIN=17;CDefine.BPI_HLYMARGIN=18;CDefine.BPI_HLYOFFSET=19;CDefine.BPI_MESSAGEXMARGIN=20;CDefine.BPI_MESSAGEYMARGIN=21;CDefine.RID_SCRL_LEFTARROW=257;CDefine.RID_SCRL_RIGHTARROW=258;CDefine.RID_SCRL_UPARROW=259;CDefine.RID_SCRL_DOWNARROW=260;CDefine.RID_SCRL_LEFTSPACE=513;CDefine.RID_SCRL_RIGHTSPACE=514;CDefine.RID_SCRL_UPSPACE=515;CDefine.RID_SCRL_DOWNSPACE=516;CDefine.RID_SCRL_DRAGHORZ=769;CDefine.RID_SCRL_DRAGVERT=770;CDefine.RID_SCROLLBAR_HORZ=4097;CDefine.RID_SCROLLBAR_VERT=4098;CDefine.RID_SCROLLDOCUMENT=4099;CDefine.RID_VXCOMBOBOX_EDIT=4026532017;CDefine.RID_VXCOMBOBOX_LIST=4026532018;CDefine.SIF_PAGE=1;CDefine.SIF_POS=2;CDefine.SIF_RANGE=4;CDefine.SIF_TRACKPOS=8;CDefine.SIF_WHEEL=16;CDefine.SIF_ALL=31;CDefine.HTBOTTOMRIGHT=1;CDefine.HTTOPRIGHT=2;CDefine.HTBOTTOMLEFT=3;CDefine.HTTOPLEFT=4;CDefine.HTBOTTOM=5;CDefine.HTRIGHT=6;CDefine.HTTOP=7;CDefine.HTLEFT=8;CDefine.HTCLIENT=9;CDefine.CURSOR_ARROW=0;CDefine.CURSOR_SIZENWSE=1;CDefine.CURSOR_SIZENESW=2;CDefine.CURSOR_SIZENS=3;CDefine.CURSOR_SIZEWE=4;CDefine.CURSOR_HAND=5;CDefine.CURSOR_USERDEFINE1=6;CDefine.CURSOR_USERDEFINE2=7;CDefine.CURSOR_USERDEFINE3=8;CDefine.CURSOR_USERDEFINE4=9;CDefine.CURSOR_MAXCOUNT=10;CDefine.SB_VERT=1;CDefine.SB_HORZ=2;CDefine.SB_BOTH=3;CDefine.HDCOLOR_NORMAL=0;CDefine.HDCOLOR_FOCUS=1;CDefine.HDCOLOR_DOWN=2;CDefine.HDCOLOR_GRAY=3;CDefine.HDCOLOR_EDGELT=4;CDefine.HDCOLOR_EDGERB=5;CDefine.MAX_HDCOLOR=6;CDefine.LH_CENTER=1;CDefine.LH_RIGHT=2;CDefine.LH_LEFT=4;CDefine.LH_HEADERLEFT=256;CDefine.LH_HEADERCENTER=512;CDefine.LH_HEADERRIGHT=1024;CDefine.LH_SORTDISABLE=4096;CDefine.LH_SORTBYTEXT=8192;CDefine.LH_SORTBYVALUE=16384;CDefine.LH_SORTBYLPARAM=32768;CDefine.LH_CHECKBOX=65536;CDefine.LH_PROGRESS=131072;CDefine.LH_ENTERBUTTON=262144;CDefine.LH_OBJECTMASK=983040;CDefine.HDMASK_TAG=1;CDefine.HDMASK_FORMAT=2;CDefine.HDMASK_WIDTH=4;CDefine.HDMASK_ALL=15;CDefine.LDCOLOR_BOUNDSELECT=0;CDefine.LDCOLOR_BOUND=1;CDefine.LDCOLOR_GRIDHILIGHT=2;CDefine.LDCOLOR_GRIDDARK=3;CDefine.LDCOLOR_FOCUS=4;CDefine.LDCOLOR_FOCUSHILIGHT=5;CDefine.LDCOLOR_FOCUSDARK=6;CDefine.LDCOLOR_SELECT=7;CDefine.LDCOLOR_SELECTHILIGHT=8;CDefine.LDCOLOR_SELECTDARK=9;CDefine.MAX_LDCOLOR=10;CDefine.LDSTYLE_FOCUSDRAW=1;CDefine.LDSTYLE_FOCUSUSEBACK=2;CDefine.LDSTYLE_FOCUSFLAT=4;CDefine.LDSTYLE_SELECTFLAT=8;CDefine.LDSTYLE_FOCUSIMAGE=16;CDefine.LDSTYLE_LINEUSEIMAGE=32;CDefine.LDSTYLE_GRIDRECT=64;CDefine.LDSTYLE_GRIDLINE=128;CDefine.LDSTYLE_GRIDVERT=256;CDefine.LDSTYLE_LINEFIT=512;CDefine.LDSTYLE_USEALPHAFOCUS=1024;CDefine.LINESTATUS_FOCUS=1;CDefine.LINESTATUS_SELECT=2;CDefine.PROGRESS_BACKCOLOR=0;CDefine.PROGRESS_FORECOLOR=1;CDefine.PROGRESS_FORECOLOR_GR=2;CDefine.PROGRESS_FORECOLOR_SHADOW=3;CDefine.PROGRESS_FORECOLOR_SHADOW_GR=4;CDefine.PROGRESS_TEXTCOLOR=5;CDefine.PROGRESS_TEXTBOUNDCOLOR=6;CDefine.PROGRESS_EDGE_LT=7;CDefine.PROGRESS_EDGE_RB=8;CDefine.PROGRESS_MAXCOLOR=9;CDefine.SIZE_SCROLLBTN=16;CDefine.KCHAR_TEXT=1;CDefine.KCHAR_IMAGE=2;CDefine.KCHAR_OBJECT=4;CDefine.KCHAR_UNDERSPACE=8;CDefine.KCHAR_BOLD=16;CDefine.KCHAR_UNDERLINE=32;CDefine.KCHAR_LINK=64;CDefine.KCHAR_FORMAT=128;CDefine.KCHAR_SELECT=256;CDefine.KCHAR_MARK=1024;CDefine.KCHAR_NOSHOW=2048;CDefine.KCHAR_SMALL=4096;CDefine.KCHAR_LARGE=8192;CDefine.KCHAR_EXTRA=16384;CDefine.KCHAR_SAVEMASK=127;CDefine.KCHAR_TEXTPROPMASK=112;CDefine.TTD_DOWNRIGHT=0;CDefine.TTD_UPPERRIGHT=1;CDefine.TTD_DOWNLEFT=2;CDefine.TTD_UPPERLEFT=3;CDefine.TTD_OBJECTUPPER=4;CDefine.TTD_OBJECTDOWN=5;CDefine.TTD_OBJECTLEFT=6;CDefine.TTD_OBJECTRIGHT=7;CDefine.TTD_OBJECTUPPERRIGHT=8;CDefine.TTD_OBJECTDOWNRIGHT=9;CDefine.TTD_OBJECTDOWNCENTER=10;CDefine.TTD_FIXEDPOSITION=11;CDefine.FLIP_VERT=1;CDefine.FLIP_HORZ=2;CDefine.MENUCOLOR_TEXTNORMAL=0;CDefine.MENUCOLOR_TEXTFOCUS=1;CDefine.MENUCOLOR_TEXTDOWN=2;CDefine.MENUCOLOR_TEXTGRAY=3;CDefine.MENUCOLOR_TEXTBOUND=4;CDefine.MENUCOLOR_BACKNORMAL=5;CDefine.MENUCOLOR_BACKFOCUS=6;CDefine.MENUCOLOR_BACKDOWN=7;CDefine.MENUCOLOR_INACTIVE=7;CDefine.MENUCOLOR_BACKGRAY=8;CDefine.MENUCOLOR_LEFTBAR=8;CDefine.MENUCOLOR_EDGELEFTTOP=9;CDefine.MENUCOLOR_EDGERIGHTBOTTOM=10;CDefine.MENUCOLOR_EDGELEFTTOP2=11;CDefine.MENUCOLOR_EDGERIGHTBOTTOM2=12;CDefine.MENUCOLOR_MAX=13;CDefine.MF_POPUP=1;CDefine.MF_SEPARATOR=2;CDefine.MF_BYPOSITION=4;CDefine.MF_BYCOMMAND=8;CDefine.MF_DISABLED=16;CDefine.MF_GRAYED=32;CDefine.MF_CHECKED=64;CDefine.MF_UNCHECKED=128;CDefine.MF_ENABLED=256;CDefine.MF_STATUSMASK=496;CDefine.IDNO=-2;CDefine.IDCANCEL=-1;CDefine.IDRETRY=0;CDefine.IDOK=1;CDefine.IDYES=2;CDefine.MB_OK=1;CDefine.MB_OKCANCEL=2;CDefine.MB_YESNO=4;CDefine.MB_YESNOCANCEL=8;CDefine.MB_INPUTEDIT=256;CDefine.MB_INPUTPASSWORD=512;CDefine.MASK_MESSAGEBOXINPUT=768;CDefine.MB_CHECKBOX=1024;CDefine.MB_PROGRESSTIMEOUT2=4096;CDefine.MB_PROGRESSTIMEOUT3=8192;CDefine.MB_PROGRESSTIMEOUT5=16384;CDefine.MB_PROGRESSTIMEOUT10=32768;CDefine.MB_PROGRESSTIMEOUT7=20480;CDefine.MB_PROGRESSTIMEOUT12=36864;CDefine.MB_PROGRESSTIMEOUT15=49152;CDefine.MASK_PROGRESSTIMEOUT=61440;CDefine.MB_NODRAG=65536;CDefine.MB_RIGHTFORMAT=131072;CDefine.MB_NOTITLESTAGE=262144;CDefine.MB_MODALESS=524288;CDefine.MB_USEMODALSTACK=1048576;CDefine.MB_CAPTIONHILIGHT=2097152;CDefine.MB_USEKEYEVENT=4194304;CDefine.MB_FITWIDTH=8388608;CDefine.MB_EFFECTRAISE=16777216;CDefine.MB_EFFECTFALL=33554432;CDefine.MB_EFFECTFADEIN=67108864;CDefine.MB_EFFECTFADEOUT=134217728;CDefine.MASK_EFFECT=251658240;CDefine.RETURN_TIMEOUT=1;CDefine.RETURN_CHECK=2;CDefine.TRANSFORM_ROTATE=1;CDefine.TRANSFORM_ALPHA=2;CDefine.TRANSFORM_XSCALE=3;CDefine.TRANSFORM_YSCALE=4;CDefine.TRANSFORM_HORZTURN=5;CDefine.TRANSFORM_VERTTURN=6;function CFlags(){}CFlags.STATUS_POPUP=1;CFlags.STATUS_SHOW=2;CFlags.STATUS_ENABLED=4;CFlags.MASK_STATUS=CFlags.STATUS_POPUP|CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED;CFlags.MASK_SHOWPROP=CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED;CFlags.STATUS_NOCLIP=8;CFlags.STATUS_NOBUFFER=64;CFlags.STATUS_TABSTOP=128;CFlags.STATUS_DRAWAFTER=256;CFlags.STATUS_INOBJECT=512;CFlags.STATUS_LIKEPOPUP=1024;CFlags.STATUS_USEBUFFER=2048;CFlags.STATUS_BOTTOM=4096;CFlags.STATUS_TOP=8192;CFlags.STATUS_TOPMOST=16384;CFlags.MASK_ZORDER=CFlags.STATUS_BOTTOM|CFlags.STATUS_TOP|CFlags.STATUS_TOPMOST;CFlags.MASK_CHANGE=CFlags.MASK_STATUS|CFlags.MASK_ZORDER;CFlags.MASK_NOCLIP=CFlags.STATUS_POPUP|CFlags.STATUS_NOCLIP;CFlags.MASK_POPUP=CFlags.STATUS_POPUP|CFlags.STATUS_LIKEPOPUP;CFlags.STATUS_TRANS=32768;CFlags.STATUS_ALPHA=65536;CFlags.STATUS_NOMOUSEMOVE=131072;CFlags.STATUS_NOFOCUS=262144;CFlags.STATUS_NOMESSAGE=524288;CFlags.STATUS_MODAL=1048576;CFlags.STATUS_SHADOW=2097152;CFlags.STATUS_BORDER=4194304;CFlags.STATUS_PARTALPHA=16777216;CFlags.STATUS_NOTRACK=33554432;CFlags.STATUS_NOTAGBUFFER=67108864;CFlags.STATUS_VERTSCRL=134217728;CFlags.STATUS_HORZSCRL=268435456;CFlags.STATUS_COMMONIMAGE0=536870912;CFlags.STATUS_COMMONIMAGE1=1073741824;CFlags.STATUS_COMMONIMAGE2=2147483648;CFlags.MASK_COMMONIMAGE=CFlags.STATUS_COMMONIMAGE0|CFlags.STATUS_COMMONIMAGE1|CFlags.STATUS_COMMONIMAGE2;CFlags.STATUS2_CHECK=1;CFlags.STATUS2_PRESS=2;CFlags.STATUS2_MOUSEOVER=4;CFlags.STATUS2_CAPTURE=8;CFlags.STATUS2_UPDATE=16;CFlags.STATUS2_UPDATEPARENT=32;CFlags.STATUS2_REDRAW=64;CFlags.STATUS2_DELETE=128;CFlags.STATUS2_TIMER=256;CFlags.STATUS2_LOCK=512;CFlags.STATUS2_UPDATEALL=1024;CFlags.STATUS2_NOCLEARFOCUSBYCHILD=2048;CFlags.STATUS2_MESSAGEPARENT=4096;CFlags.STATUS2_MESSAGECHILD=8192;CFlags.STATUS2_SELFNOTIFY=16384;CFlags.STATUS2_BLINK=32768;CFlags.STATUS2_PARENTDRAW=65536;CFlags.STATUS2_GROUP=131072;CFlags.STATUS2_BSTICKER=262144;CFlags.STATUS2_RSTICKER=524288;CFlags.STATUS2_EVENTSYNCLOCK=1048576;CFlags.STATUS2_DRAWFRAME=2097152;CFlags.STATUS2_INACTIVE=4194304;CFlags.STATUS2_SKIPCURSOR=8388608;CFlags.STATUS2_DOCUMENTONLY=16777216;CFlags.STATUS2_TOOLOVER=33554432;CFlags.STATUS2_DOMBUFFER=67108864;CFlags.STATUS2_FORCEDRAW=134217728;CFlags.STATUS2_NODRAW=268435456;CFlags.STATUS2_PREVDLBCLK=536870912;CFlags.STATUS2_CONTINUEPROP=1073741824;CFlags.STATUS2_TRANSFORM=2147483648;CFlags.STATUSEX2_FORCECLIP=1073741824;CFlags.STATUSEX2_WINDOWTOOLTIP=536870912;CFlags.STATUSEX2_EFFECTOUT_DESTROY=268435456;CFlags.STATUSEX2_EFFECTRAISE=16777216;CFlags.STATUSEX2_EFFECTFALL=33554432;CFlags.STATUSEX2_EFFECTFADEIN=67108864;CFlags.STATUSEX2_EFFECTFADEOUT=134217728;CFlags.MASK_SHOWINEFFECT=83886080;CFlags.MASK_SHOWOUTEFFECT=167772160;CFlags.MASK_SHOWEFFECT=251658240;CFlags.STATUSEX2_INCLUDESORT=1048576;CFlags.VXOBJECT2_EVENT_PASSPARENT=2097152;CFlags.VXOBJECT2_GROUP=4194304;CFlags.VXOBJECT2_DROPENABLED=8388608;CFlags.STATUSEX2_HORZGRIDBLT=65536;CFlags.STATUSEX2_VERTGRIDBLT=131072;CFlags.STATUSEX2_GRIDBLT_MASK=196608;CFlags.STATUSEX2_CHECKBUFFER=262144;CFlags.STATUSEX2_DRAWBACK=4096;CFlags.STAGEST_SHOW=1;CFlags.STAGEST_ENABLED=2;CFlags.STAGEST_SELECT=4;CFlags.STAGEST_SUBSTAGE=8;CFlags.STAGEST_MUSTGETKEY=16;CFlags.STAGEST_TIMER=32;CFlags.STAGEST_DROPENABLED=64;CFlags.STAGEST_DESTROY=128;CFlags.STAGEST_EDITMODE=256;CFlags.STAGEST_BACKSTAGE=512;CFlags.STAGEST_BS_CROSSTILE=1024;CFlags.STAGEST_BS_RECTTILE=2048;CFlags.STAGEST_BS_BACKGROUND=4096;CFlags.STAGEST_BS_HIDE=8192;CFlags.STAGEST_BS_SINGLE=16384;CFlags.STAGEST_FRONTSTAGE=32768;CFlags.STAGEST_MASK_CANUPDATE=CFlags.STAGEST_SELECT|CFlags.STAGEST_SUBSTAGE|CFlags.STAGEST_BACKSTAGE|CFlags.STAGEST_FRONTSTAGE;CFlags.STAGEST_NOCHANGERESOURCE=268435456;CFlags.STAGEST_NOTIFYWINDOW=536870912;CFlags.STAGEST_NOMULTIPLEPARAM=1073741824;CFlags.STAGEST2_SELFNOTIFY=1;CFlags.STAGEST2_CAPTUREMODE=2;CFlags.STAGEST2_REDRAW=4;CFlags.VXSP_WINDOWRESIZE=1;CFlags.VXSP_DOUBLEBUFFERING=2;CFlags.VXSP_NORMALPLATFORM=4;CFlags.VXSP_DXRUNLOOP=8;CFlags.VXSP_GETDRAW=16;CFlags.VXSP_OWNERDRAWFRAME=32;CFlags.VXSP_NODRAWBKGND=64;CFlags.VXSP_OBJECTDIALOG=128;CFlags.VXSP_CHILDTRANSDIALOG=256;CFlags.VXSP_NOPARTDRAW=512;CFlags.VXSP_APPLOOPVIA=1024;CFlags.VXSP_HIDDEN=2048;CFlags.VXSP_RESIZEDX=4096;CFlags.VXSP_DXTIMERLOOP=8192;CFlags.VXSP_INITFULLMODE=16384;CFlags.VXSP_FIXEDBUFFER=32768;CFlags.VXSP_MINIMIZEBOX=65536;CFlags.VXSP_MAXIMIZEBOX=131072;CFlags.VXSP_SYSMENU=262144;CFlags.VXSP_MODALDIALOG=524288;CFlags.VXSP_USEROUNDFRAME=1048576;CFlags.VXSP_USEAPPFOCUS=2097152;CFlags.VXSP_CLIENTDRAGRESIZE=4194304;CFlags.VXSP_SKINDIALOG=8388608;CFlags.VXSP_DEFAULTSTAGE=16777216;CFlags.VXSP_FULLBACKSCREEN=33554432;CFlags.VXSP_CLIENTCAPTION=67108864;CFlags.VXSP_DRAGRESIZE=134217728;CFlags.VXSP_LOCALRESOURCE=268435456;CFlags.VXSP_POPUP=536870912;CFlags.VXSP_CAPTION=1073741824;CFlags.VXSP_NONECLIENTSKIN=2147483648;CFlags.VXSP2_MAINSKIN=1;CFlags.VXSP2_TIMERLOOP=2;CFlags.VXSP2_ACTIVEAPP=4;CFlags.VXSP2_ACTIVE=8;CFlags.VXSP2_GAMEFULLSCREEN=16;CFlags.VXSP2_CAPTUREMODE=32;CFlags.VXSP2_UPDATEALL=64;CFlags.VXSP2_ICONICFULLMODE=128;CFlags.VXSP2_INITIALIZE=256;CFlags.VXSP2_CALCSCROLL=512;CFlags.VXSP2_RUNLOOPNOTIFY=1024;CFlags.VXSPEX_USESOCKET=1;CFlags.VXSPEX_NOINNERSOUND=2;CFlags.VXSPEX_NOBUTTONSOUND=4;CFlags.VXSPEX_USEGLOBALTAB=8;CFlags.VXSPEX_POPUPRAISE=16;CFlags.VXSPEX_POPUPFALL=32;CFlags.VXSPEX_NOSTAGECURSOR=64;CFlags.VXSPEX_USEWINDOWTOOLTIP=128;CFlags.SORTTYPE_NONE=0;CFlags.SORTTYPE_ZORDERONLY=CFlags.SORTTYPE_NONE;CFlags.SORTTYPE_BOTTOMONLY=1;CFlags.SORTTYPE_BOTTOMRIGHT=2;CFlags.SORTTYPE_ZORDERBOTTOMRIGHT=3;CFlags.ZVALUE_POPUP=1e6;CFlags.ZVALUE_TOPMOST=3e5;CFlags.ZVALUE_TOP=2e5;CFlags.ZVALUE_NORMAL=1e5;CFlags.ZVALUE_BOTTOM=0;CFlags.PVALUE_BASE=1e5;CFlags.VXCLICK_USEDBLCLK=268435456;CFlags.VXCLICK_DOWNEVENT=536870912;CFlags.VXCLICK_CAPTURE=1073741824;CFlags.VXCLICK_FACE2=16777216;CFlags.VXCLICK_TIMECLICK=33554432;CFlags.VXCLICK_OFFSETIMAGE=67108864;CFlags.VXCLICK_NOBORDER=1048576;CFlags.VXCLICK_FRAMETRANS=2097152;CFlags.VXCLICK_SINGLEIMAGE=4194304;CFlags.VXCLICK_NOMOUSELEAVE=8388608;CFlags.VXCLICK_FOCUS_BORDER=524288;CFlags.VXBUTTON_CHECK=1;CFlags.VXBUTTON_RADIO=2;CFlags.VXBUTTON_SETBLINK=4;CFlags.VXBUTTON_HASTAG=8;CFlags.VXBUTTON_USE2IMG=16;CFlags.VXBUTTON_USECHECK=128;CFlags.VXBUTTON_TEXTRESIZE=256;CFlags.VXBUTTON_TEXTWIDTH=512;CFlags.VXBUTTON_CHECKINVERT=1024;CFlags.VXBUTTON_MARGINHIT=2048;CFlags.VXBUTTON_TEXTONLY=4096;CFlags.VXBUTTON_TEXTCHECKUNDERLINE=8192;CFlags.VXBUTTON_TEXTUNDERLINE=16384;CFlags.VXBUTTON_FOCUSINVERT=32768;CFlags.VXBUTTON_GROUPBOX=65536;CFlags.VXBUTTON_GROUPBUTTON=131072;CFlags.VXBUTTON_CENTERRESIZE=262144;CFlags.VXBUTTON2_FULLBOX=524288;CFlags.VXBUTTON2_TABHIDE=1048576;CFlags.VXBUTTON2_SRCHORZ=2097152;CFlags.VXDRAG_NOTIFYPARENT=1;CFlags.VXDRAG_USERANGECLIP=2;CFlags.VXDRAG_DEFAULTRANGE=4;CFlags.VXDRAG_NOBORDER=8;CFlags.VXDRAG2_DROPNOTIFY=1;CFlags.VXDRAG2_DROPLIMITPARENT=2;CFlags.VXBOX_BORDERSUNKEN=8;CFlags.VXBOX_BORDERFLAT=16;CFlags.VXBOX_CAPTIONHILIGHT=32;CFlags.VXBOX_TRANSINNER=64;CFlags.VXBOX_NODRAG=128;CFlags.VXBOX_RESIZEBORDER=256;CFlags.VXBOX_CAPTION=512;CFlags.VXBOX_SYSCLOSE=1024;CFlags.VXBOX_NOFRAME=2048;CFlags.VXSCROLLBAR_HORZ=1;CFlags.VXSCROLLBAR_ALWAYSSHOW=2;CFlags.VXSCROLLBAR_ALWAYSHIDE=4;CFlags.VXSCROLLBAR_LOWER=8;CFlags.VXSCROLLBOX_ALWAYSHIDE_HSCROLL=4096;CFlags.VXSCROLLBOX_ALWAYSSHOW_VSCROLL=8192;CFlags.VXSCROLLBOX_ALWAYSSHOW_HSCROLL=16384;CFlags.VXSCROLLBOX_ALWAYSHIDE_VSCROLL=32768;CFlags.VXSCROLLBOX_LEFTSCROLL=65536;CFlags.VXSCROLLBOX_PREVENTCHILDSCROLL=131072;CFlags.VXHEADER_NOIMAGE=1;CFlags.VXHEADER_NOCLICK=2;CFlags.VXHEADER_RESIZEITEM=4;CFlags.VXHEADER_ENABLEFOCUS=8;CFlags.VXHEADER_ENTIREIMAGE=16;CFlags.VXLISTBOX_SHOWHEADER=1048576;CFlags.VXLISTBOX_INNERHEADER=2097152;CFlags.VXLISTBOX_READONLY=4194304;CFlags.VXLISTBOX_SELCHANGENOTIFY=8388608;CFlags.VXLISTBOX_CLICKNOTIFY=16777216;CFlags.VXLISTBOX_RCLICKNOTIFY=33554432;CFlags.VXLISTBOX_LIKECOMBO=67108864;CFlags.VXLISTBOX_ALWAYSSELECT=134217728;CFlags.VXLISTBOX_OWNERDRAWLINE=268435456;CFlags.VXLISTBOX_NOINPUTKEY=536870912;CFlags.VXLISTBOX_SELECT_OBJECTSHOW=1073741824;CFlags.VXPROGRESS_PATTERNIMAGE=1;CFlags.VXPROGRESS_REVERSE=4;CFlags.VXPROGRESS_VERTICAL=8;CFlags.VXPROGRESS_ROUNDEDGE=65536;CFlags.VXPROGRESS_NOBORDER=131072;CFlags.VXPROGRESS_SIMPLE=262144;CFlags.VXPROGRESS_SIMPLEGRADIENT=524288;CFlags.VXPROGRESS_ONPOSITION=1048576;CFlags.VXPROGRESS_ONRANGE=2097152;CFlags.VXPROGRESS_OUTERTEXT=4194304;CFlags.VXPROGRESS_ALPHABACKGROUND=8388608;CFlags.VXPROGRESS_NORESIZE=16777216;CFlags.VXPROGRESS_TEXTFULLBOUND=16;CFlags.VXPROGRESS_TEXTHALFBOUND=32;CFlags.VXPROGRESS_TEXTBOLD=64;CFlags.VXPROGRESS_SHOWPERCENT=128;CFlags.VXPROGRESS_TEXTLEFT=256;CFlags.VXPROGRESS_TEXTRIGHT=512;CFlags.VXPROGRESS_TEXTSPLIT=1024;CFlags.VXPROGRESS_TEXTBOTH=2048;CFlags.VXPROGRESS_ANIMATIONLOOP=4096;CFlags.VXPROGRESS_POSITIONMOVING=8192;CFlags.VXPROGRESS_USETIMEOUT=16384;CFlags.VXPROGRESS_SPLITANIMATIONALWAYS=32768;CFlags.VXPROGRESS_IMMEDIATELYMODE=268435456;CFlags.VXTAB_VERTICAL=1;CFlags.VXTAB_REVERSE=2;CFlags.VXTAB_DOWNEVENT=4;CFlags.VXTAB_LIKEBUTTON=8;CFlags.VXTAB_MARGINHIT=32;CFlags.VXTAB_CHECKINVERT=64;CFlags.VXTAB_SCROLLBUTTON=256;CFlags.VXTAB_RESIZABLE=512;CFlags.VXTAB_AUTOFIT=1024;CFlags.VXTAB_NOIMAGEFIT=2048;CFlags.VXTAB_USEIMAGEOFFSET=4096;CFlags.VXTAB_SIMPLE=8192;CFlags.VXTAB_RESIZEOWNER=16384;CFlags.VXTAB_SPLIT=32768;CFlags.VXSTATIC_ANIMATIONAUTOSTART=2;CFlags.VXSTATIC_TEXTRESIZE=4;CFlags.VXSTATIC_HASTAG=8;CFlags.VXSTATIC_ADJUSTFRAME=16;CFlags.VXSTATIC_CENTERRESIZE=32;CFlags.VXSTATIC_NORESIZE=64;CFlags.VXSTATIC_NOTIFYPARENT=128;CFlags.VXSTATIC_CENTERIMAGE=256;CFlags.VXSTATIC_TARGAALPHA=512;CFlags.VXSTATIC_SHAPE=1024;CFlags.VXSTATIC_NODRAW=2048;CFlags.VXSTATIC_REVERSEHORZ=4096;CFlags.VXSTATIC_REVERSEVERT=8192;CFlags.VXSTATIC_NOFRAMENODRAW=16384;CFlags.VXSTATIC_RECTAREA=32768;CFlags.VXSTATIC_LABELBKGND=65536;CFlags.VXSTATIC_GRADIENTBKGND_HORZ=131072;CFlags.VXSTATIC_GRADIENTBKGND_VERT=262144;CFlags.VXEDITBOX_READONLY=1048576;CFlags.VXEDITBOX_MULTILINE=2097152;CFlags.VXEDITBOX_USEEMOTICON=4194304;CFlags.VXEDITBOX_RETURNINPUT=8388608;CFlags.VXEDITBOX_WANTSPECIALKEY=16777216;CFlags.VXEDITBOX_NOWANTTAB=33554432;CFlags.VXEDITBOX_TYPEWRITE=67108864;CFlags.VXEDITBOX_PASSWORD=134217728;CFlags.VXEDITBOX2_CALCLINE=16;CFlags.VXEDITBOX2_LIMITLINE=32;CFlags.VXEDITBOX2_SCROLLLINE=64;CFlags.VXEDITBOX2_CALCCARET=128;CFlags.VXEDITBOX2_MASKCALC=240;CFlags.VXEDITBOX2_LOCKCALC=256;CFlags.VXEDITBOX2_SCROLLVIEW=512;CFlags.VXEDITBOX2_NUMBERONLY=1024;CFlags.VXCOMBOBOX_DROPLIST=1;CFlags.VXCOMBOBOX_NOBORDER=2;CFlags.VXCOMBOBOX_BOLDFONT=4;CFlags.VXCOMBOBOX_CENTERTEXT=8;CFlags.VXCOMBOBOX_IGNOREBORDERGAP=16;CFlags.VXCOMBOBOX_OPENSLID=32;CFlags.VXCOMBOBOX_POPUPSHADOW=64;CFlags.VXCOMBOBOX_SHOWTAGINVERT=128;CFlags.VXCOMBOBOX_DLGFRAME=256;CFlags.VXSLIDER_VERTICAL=1;CFlags.VXSLIDER_SCROLLBARTYPE=2;CFlags.VXSLIDER_SIMPLE=4;CFlags.VXSLIDER_SHAPEPEN=8;CFlags.VXSLIDER_SHAPETRIANGLE=16;CFlags.VXSLIDER_UPPERLINE=32;CFlags.VXSLIDER_NOAUTOTIMER=64;CFlags.VXSLIDER_FIXEDBACKIMAGE=128;CFlags.VXSLIDER_ENABLETOOLTIP=256;CFlags.VXSLIDER_ONLYDRAGENDNOTIFY=512;CFlags.VXSLIDER_NOBACKGROUND=1024;CFlags.VXSLIDER_SPLITAREA=2048;CFlags.VXSLIDER_HASSHADOW=4096;CFlags.VXSLIDER_ONLYFOREGROUND=8192;CFlags.VXSLIDER_ALPHABACKGROUND=16384;CFlags.VXTOOLTIP_ALPHA=1;CFlags.VXTOOLTIP_ALPHABRINGUP=2;CFlags.VXTOOLTIP_SHOWBYMOVE=4;CFlags.VXTOOLTIP_HASSHADOW=8;CFlags.VXTOOLTIP_DRAGTOOL=16;CFlags.VXTOOLTIP_FIXEDWIDTH=32;CFlags.VXTOOLTIP_FIXEDHEIGHT=64;CFlags.VXTOOLTIP_USEARROW=128;CFlags.VXTOOLTIP_NOCLOSE=256;CFlags.VXMENU_BORDERDOUBLE=8;CFlags.VXMENU_USESAHDOW=65536;CFlags.VXMENU_USEOBJECTRECT=131072;CFlags.VXMENU_WANTCLOSEEVENT=262144;CFlags.VXMENU_OPENSLID=524288;CFlags.VXMENU_SYNCNOTIFY=1048576;CFlags.VXTICKER_PAUSE=1;CFlags.VXMESSAGEBOX_PROGRESSTIMEOUT=262144;CFlags.VXMESSAGEBOX_RIGHTFORMAT=524288;CFlags.VXMESSAGEBOX_OK=1048576;CFlags.VXMESSAGEBOX_OKCANCEL=2097152;CFlags.VXMESSAGEBOX_YESNOCANCEL=4194304;CFlags.VXMESSAGEBOX_USEKEYEVENT=8388608;CFlags.VXMESSAGEBOX_FITWIDTH=16777216;CFlags.VXMENUBAR_VERTICAL=1;CFlags.VXBUILD_NORESIZE=1;CFlags.VXBUILD_NONOTIFYPARENT=2;CFlags.VXBUILD_NOTIFYEND_DELETE=4;CFlags.VXTOOLMENU_ISTOOL=268435456;CFlags.VXTOOLMENU_NOSCROLL=536870912;CFlags.VXTOOLMENU_FOCUSSELECT=1073741824;CFlags.VXTALKBALLOON_OPENSLID=268435456;CFlags.VXLAYER2_OPENEFFECT=1;CFlags.VXLAYER2_SLIDING=2;CFlags.VXLAYER2_DELETE=4;CFlags.VXLAYER2_NODEFAULT=8;function CKeys(){}CKeys.VK_SPACE=32;CKeys.VK_RETURN=10;CKeys.VK_ENTER=13;CKeys.VK_TAB=9;CKeys.VK_ESC=27;CKeys.VK_BACKSPACE=8;CKeys.VK_SHIFT=16;CKeys.VK_CONTROL=17;CKeys.VK_ALT=18;CKeys.VK_CAPSLOCK=20;CKeys.VK_NUMLOCK=144;CKeys.VK_LEFT=37;CKeys.VK_UP=38;CKeys.VK_RIGHT=39;CKeys.VK_DOWN=40;CKeys.VK_INSERT=45;CKeys.VK_DELETE=46;CKeys.VK_HOME=36;CKeys.VK_END=35;CKeys.VK_PAGEUP=33;CKeys.VK_PAGEDOWN=34;CKeys.VK_ESCAPE=27;CKeys.VK_0=48;CKeys.VK_1=49;CKeys.VK_2=50;CKeys.VK_3=51;CKeys.VK_4=52;CKeys.VK_5=53;CKeys.VK_6=54;CKeys.VK_7=55;CKeys.VK_8=56;CKeys.VK_9=57;CKeys.VK_A=65;CKeys.VK_B=66;CKeys.VK_C=67;CKeys.VK_D=68;CKeys.VK_E=69;CKeys.VK_F=70;CKeys.VK_G=71;CKeys.VK_H=72;CKeys.VK_I=73;CKeys.VK_J=74;CKeys.VK_K=75;CKeys.VK_L=76;CKeys.VK_M=77;CKeys.VK_N=78;CKeys.VK_O=79;CKeys.VK_P=80;CKeys.VK_Q=81;CKeys.VK_R=82;CKeys.VK_S=83;CKeys.VK_T=84;CKeys.VK_U=85;CKeys.VK_V=86;CKeys.VK_W=87;CKeys.VK_X=88;CKeys.VK_Y=89;CKeys.VK_Z=90;CKeys.VK_F1=112;CKeys.VK_F2=113;CKeys.VK_F3=114;CKeys.VK_F4=115;CKeys.VK_F5=116;CKeys.VK_F6=117;CKeys.VK_F7=118;CKeys.VK_F8=119;CKeys.VK_F9=120;CKeys.VK_F10=121;CKeys.VK_F11=122;CKeys.VK_F12=123;CKeys.MK_CONTROL=8;CKeys.MK_SHIFT=4;CKeys.MK_ALT=2;CKeys.MK_LBUTTON=1;CKeys.MK_GRAPEND=16;CKeys.MAX_KEYSTATUS=255;function CMessage(){}CMessage.WM_LBUTTONDOWN=513;CMessage.WM_MOUSEMOVE=512;CMessage.WM_LBUTTONUP=514;CMessage.WM_LBUTTONDBLCLK=515;CMessage.WM_RBUTTONDOWN=516;CMessage.WM_MOUSELEAVE=675;CMessage.WM_MOUSEWHEEL=522;CMessage.WM_KEYDOWN=256;CMessage.WM_KEYUP=257;CMessage.WM_CHAR=258;CMessage.WM_KILLFOCUS=8;CMessage.WM_CANCELMODE=10;CMessage.WM_GRAPMODESTART=240;CMessage.WM_GRAPMODE=241;CMessage.WM_GRAPMODEEND=242;CMessage.WM_PAGEVISIBLE=243;CMessage.WM_RESIZESTAGE=244;CGlobal=function(){this.g_nInObjCount=0;this.g_chmMap=new ObArray;this.g_chmList=new ObArray;this.g_inmList=new ObArray;this.g_addMenuList=new ObArray;this.g_pColorSet=null;this.g_menuiconname=null;this.g_menuimagename=null;this.g_dwMenuProperty=0;this.g_bUseModalBack=false;this.g_title_tagtype=CDefine.TAGTYPE_BOLD|CDefine.TAGTYPE_BNDNORMAL;this.g_pFont=new ObArray;this.g_fontName=null;this.g_fontNameChat=null;this.g_nOSLanguageCode=0;this.g_strOSLanguageMultiByte=null;this.g_nFontSmallSize=9;this.g_nFontNormalSize=10;this.g_nFontLargeSize=12;this.g_nFontExtraSize=14;this.g_tagFunc=null;this.g_skin=null;this.g_buffer=null;this.g_nPopupOrder=0;this.g_nPopupDirect=0;this.g_textTempBuf=null;this.g_strTitleIcon="icon_title.png";this.g_strMessageIcon="icon_message.png";this.g_strMenuIcon="icon_menu.png";this.g_strButtonIcon="icon_title.png";this.g_strShadowImage="commonshadow.png";this.g_strHilightImage="commonhilight.png";this.g_strButtonImage1="commonbutton0.png";this.g_strButtonImage2="commonbutton1.png";this.g_strButtonImage3="commonbutton2.png";this.g_strCheckImage1="commoncheck0.png";this.g_strCheckImage2="commoncheck1.png";this.g_strCheckImage3="commoncheck2.png";this.g_strRadioImage1="commonradio0.png";this.g_strRadioImage2="commonradio1.png";this.g_strRadioImage3="commonradio2.png";this.g_strBoxImage1="commonbox0.png";this.g_strBoxImage2="commonbox1.png";this.g_strBoxImage3="commonbox2.png";this.g_strSysImage1="commonsys0.png";this.g_strSysImage2="commonsys1.png";this.g_strSysImage3="commonsys2.png";this.g_strScrlVImage1="commonscrlv0.png";this.g_strScrlVImage2="commonscrlv1.png";this.g_strScrlVImage3="commonscrlv2.png";this.g_strScrlHImage1="commonscrlh0.png";this.g_strScrlHImage2="commonscrlh1.png";this.g_strScrlHImage3="commonscrlh2.png";this.g_rcSys1=null;this.g_rcSys2=null;this.g_rcSys3=null;this.g_uMenuTagType=0;this.g_uMessageTagType=0;this.g_uDefaultButtonTagType=CDefine.TAGTYPE_BOLD;this.g_uBoxTitleFormat=0;this.g_pTitleIcon=null;this.g_pMessageIcon=null;this.g_pMenuIcon=null;this.g_pButtonIcon=null;this.g_pShadowImage=null;this.g_pHilightImage=null;this.g_aryButtonImage=new ObArray;this.g_aryCheckImage=new ObArray;this.g_aryRadioImage=new ObArray;this.g_aryBoxImage=new ObArray;this.g_arySysImage=new ObArray;this.g_aryScrlVImage=new ObArray;this.g_aryScrlHImage=new ObArray;this.g_boxparam=new vx.box_param;this.g_scrlparam=new vx.scrl_param;this.g_popupFocus=null;this.g_referString=null;this.g_aryColor=new ObArray};CGlobal.DEFAULT_BOXBORDER=5;CGlobal.LTYPE_KOREAN=0;CGlobal.LTYPE_JAPANESE=1;CGlobal.LTYPE_CHINA=2;CGlobal.LTYPE_ENGLISH=3;CGlobal.LTYPE_TAIWAN=4;CGlobal.prototype.PrepareGlobal=function(t){this.g_skin=t;this.g_buffer=t.m_screen;this.g_pFont.SetSize(CDefine.INDEX_MAXFONT);this.g_tagFunc=new vx.tagfunc;var e;if(navigator.language==undefined){e=navigator.browserLanguage}else{e=navigator.language}if(e=="ko"){this.g_fontName="gulim";this.g_fontNameChat="gulim";this.g_nOSLanguageCode=CGlobal.LTYPE_KOREAN;this.g_strOSLanguageMultiByte="ks_c_5601-1987"}else if(e=="ja"){this.g_fontName="ms mincho";this.g_fontNameChat="ms mincho";this.g_nOSLanguageCode=CGlobal.LTYPE_JAPANESE;this.g_strOSLanguageMultiByte="shift_jis"}else if(e=="ch"){this.g_fontName="simsun";this.g_fontNameChat="simsun";this.g_nOSLanguageCode=CGlobal.LTYPE_CHINA;this.g_strOSLanguageMultiByte="gb2312"}else if(e=="ta"){this.g_fontName="simsun";this.g_fontNameChat="simsun";this.g_nOSLanguageCode=CGlobal.LTYPE_TAIWAN;this.g_strOSLanguageMultiByte="big5"}else{this.g_fontName="arial";this.g_fontNameChat="arial";this.g_nOSLanguageCode=CGlobal.LTYPE_ENGLISH;this.g_strOSLanguageMultiByte="us-ascii"}};CGlobal.prototype.CreateGlobal=function(){this.g_pFont.SetAt(CDefine.INDEX_FONTSMALL,new vx.font(this.g_fontName,this.g_nFontSmallSize,false));this.g_pFont.SetAt(CDefine.INDEX_FONTSMALL_BOLD,new vx.font(this.g_fontName,this.g_nFontSmallSize,true));this.g_pFont.SetAt(CDefine.INDEX_FONTNORMAL,new vx.font(this.g_fontName,this.g_nFontNormalSize,false));this.g_pFont.SetAt(CDefine.INDEX_FONTNORMAL_BOLD,new vx.font(this.g_fontName,this.g_nFontNormalSize,true));this.g_pFont.SetAt(CDefine.INDEX_FONTLARGE,new vx.font(this.g_fontName,this.g_nFontLargeSize,false));this.g_pFont.SetAt(CDefine.INDEX_FONTLARGE_BOLD,new vx.font(this.g_fontName,this.g_nFontLargeSize,true));this.g_pFont.SetAt(CDefine.INDEX_FONTEXTRA,new vx.font(this.g_fontName,this.g_nFontExtraSize,false));this.g_pFont.SetAt(CDefine.INDEX_FONTEXTRA_BOLD,new vx.font(this.g_fontName,this.g_nFontExtraSize,true));this.g_pFont.SetAt(CDefine.INDEX_FONTCHAT,new vx.font(this.g_fontNameChat,this.g_nFontNormalSize,false));this.g_pFont.SetAt(CDefine.INDEX_FONTCHAT_BOLD,new vx.font(this.g_fontNameChat,this.g_nFontNormalSize,true))};CGlobal.prototype.CreateLogBox=function(){if(vx.logchat==null){if(this.g_skin.m_titleStage){var t=new vx.logbox;var e=this.g_skin.GetViewRect();e.top=(e.top+e.bottom)/2;t.CreateP(this.g_skin.m_titleStage,e,CDefine.VXID_NONE,CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED|CFlags.STATUS_PARTALPHA|CFlags.STATUS_VERTSCRL,CFlags.VXBOX_CAPTION|CFlags.VXBOX_SYSCLOSE|CFlags.VXEDITBOX_READONLY|CFlags.VXEDITBOX_MULTILINE|CFlags.VXSCROLLBOX_ALWAYSHIDE_VSCROLL,null)}}};CGlobal.prototype.RefreshGlobalImage=function(){this.g_pTitleIcon=this.g_skin.FindImage(this.g_strTitleIcon);this.g_pMessageIcon=this.g_skin.FindImage(this.g_strMessageIcon);this.g_pMenuIcon=this.g_skin.FindImage(this.g_strMenuIcon);this.g_pButtonIcon=this.g_skin.FindImage(this.g_strButtonIcon);this.g_pShadowImage=this.g_skin.FindImage(this.g_strShadowImage);this.g_pHilightImage=this.g_skin.FindImage(this.g_strHilightImage);this.g_aryButtonImage.Add(this.g_skin.FindImage(this.g_strButtonImage1));this.g_aryButtonImage.Add(this.g_skin.FindImage(this.g_strButtonImage2));this.g_aryButtonImage.Add(this.g_skin.FindImage(this.g_strButtonImage3));this.g_aryCheckImage.Add(this.g_skin.FindImage(this.g_strCheckImage1));this.g_aryCheckImage.Add(this.g_skin.FindImage(this.g_strCheckImage2));this.g_aryCheckImage.Add(this.g_skin.FindImage(this.g_strCheckImage3));this.g_aryRadioImage.Add(this.g_skin.FindImage(this.g_strRadioImage1));this.g_aryRadioImage.Add(this.g_skin.FindImage(this.g_strRadioImage2));this.g_aryRadioImage.Add(this.g_skin.FindImage(this.g_strRadioImage3));this.g_aryBoxImage.Add(this.g_skin.FindImage(this.g_strBoxImage1));this.g_aryBoxImage.Add(this.g_skin.FindImage(this.g_strBoxImage2));this.g_aryBoxImage.Add(this.g_skin.FindImage(this.g_strBoxImage3));this.g_arySysImage.Add(this.g_skin.FindImage(this.g_strSysImage1));this.g_arySysImage.Add(this.g_skin.FindImage(this.g_strSysImage2));this.g_arySysImage.Add(this.g_skin.FindImage(this.g_strSysImage3));this.g_aryScrlVImage.Add(this.g_skin.FindImage(this.g_strScrlVImage1));this.g_aryScrlVImage.Add(this.g_skin.FindImage(this.g_strScrlVImage2));this.g_aryScrlVImage.Add(this.g_skin.FindImage(this.g_strScrlVImage3));this.g_aryScrlHImage.Add(this.g_skin.FindImage(this.g_strScrlHImage1));this.g_aryScrlHImage.Add(this.g_skin.FindImage(this.g_strScrlHImage2));this.g_aryScrlHImage.Add(this.g_skin.FindImage(this.g_strScrlHImage3))};CGlobal.prototype.VXS_GetTitleIcon=function(){return this.g_pTitleIcon};CGlobal.prototype.VXS_GetMessageIcon=function(){return this.g_pMessageIcon};CGlobal.prototype.VXS_GetMenuIcon=function(){return this.g_pMenuIcon};CGlobal.prototype.VXS_GetButtonIcon=function(){return this.g_pButtonIcon};CGlobal.prototype.VXS_GetShadowImage=function(){return this.g_pShadowImage};CGlobal.prototype.VXS_GetHilightImage=function(){return this.g_pHilightImage};CGlobal.prototype.VXS_GetButtonImage=function(t){return this.g_aryButtonImage.GetAt(t)};CGlobal.prototype.VXS_GetCheckImage=function(t){return this.g_aryCheckImage.GetAt(t)};CGlobal.prototype.VXS_GetRadioImage=function(t){return this.g_aryRadioImage.GetAt(t)};CGlobal.prototype.VXS_GetBoxImage=function(t){return this.g_aryBoxImage.GetAt(t)};CGlobal.prototype.VXS_GetSysImage=function(t){return this.g_arySysImage.GetAt(t)};CGlobal.prototype.VXS_GetScrlVImage=function(t){return this.g_aryScrlVImage.GetAt(t)};CGlobal.prototype.VXS_GetScrlHImage=function(t){return this.g_aryScrlHImage.GetAt(t)};CGlobal.prototype.VXS_GetSysImageRect=function(t){switch(t){case 0:return this.g_rcSys1;case 1:return this.g_rcSys2;case 2:return this.g_rcSys3;default:return null}};CGlobal.prototype.GetTagFont=function(t,e){if(arguments.length<2)bSelect=false;var i;if(t&CDefine.TAGTYPE_SELECTBOLD&&bSelect)t|=CDefine.TAGTYPE_BOLD;if(t&CDefine.TAGTYPE_BOLD){if(t&CDefine.TAGSIZE_MASK){if(t&CDefine.TAGTYPE_EXTRA)i=CDefine.INDEX_FONTEXTRA_BOLD;else if(t&CDefine.TAGTYPE_LARGE)i=CDefine.INDEX_FONTLARGE_BOLD;else if(t&CDefine.TAGTYPE_SMALL)i=CDefine.INDEX_FONTSMALL_BOLD;else i=CDefine.INDEX_FONTNORMAL_BOLD}else{i=CDefine.INDEX_FONTNORMAL_BOLD}}else{if(t&CDefine.TAGSIZE_MASK){if(t&CDefine.TAGTYPE_EXTRA)i=CDefine.INDEX_FONTEXTRA;else if(t&CDefine.TAGTYPE_LARGE)i=CDefine.INDEX_FONTLARGE;else if(t&CDefine.TAGTYPE_SMALL)i=CDefine.INDEX_FONTSMALL;else i=CDefine.INDEX_FONTNORMAL}else{i=CDefine.INDEX_FONTNORMAL}}return this.g_pFont.GetAt(i)};CGlobal.prototype.CreateTagFont=function(t,e){if(arguments.length<2)e=false;var i;var n;var s;if(e)i=vx.Global.g_fontNameChat;else i=vx.Global.g_fontName;if(t&CDefine.TAGSIZE_MASK){if(t&CDefine.TAGTYPE_EXTRA)n=this.g_nFontExtraSize;else if(t&CDefine.TAGTYPE_LARGE)n=this.g_nFontLargeSize;else if(t&CDefine.TAGTYPE_SMALL)n=this.g_nFontSmallSize;else n=this.g_nFontNormalSize}else{n=this.g_nFontNormalSize}if(t&CDefine.TAGTYPE_BOLD){s=new vx.font(i,n,true)}else{s=new vx.font(i,n,false)}return s};CGlobal.prototype.FindSeperatorNum=function(t){var e=-1;var i;var n;var s=t.lastIndexOf("|");if(s!=-1){i=t.length;n=t.substring(s+1);t=t.substring(0,s);if(n!=""){e=Math.floor(n)}}this.g_referString=t;return e};CGlobal.prototype.VXS_LoadResource=function(t){if(this.g_skin)this.g_skin.LoadResource(t)};CGlobal.prototype.GetTextTempBuffer=function(t,e){if(this.g_textTempBuf==null){this.g_textTempBuf=new vx.buffer(null,500,60)}var i=this.g_textTempBuf.m_context.canvas.width;var n=this.g_textTempBuf.m_context.canvas.height;if(i<t||n<e){this.g_textTempBuf.Delete();this.g_textTempBuf=null;this.g_textTempBuf=new vx.buffer(null,t,e)}this.g_textTempBuf.m_context.clearRect(0,0,t,e);return this.g_textTempBuf};function CColor(){}CColor.INDEX_BACKGROUND=0;CColor.INDEX_POPUPBKGND=1;CColor.INDEX_BORDER=2;CColor.INDEX_FRAME_LT=3;CColor.INDEX_FRAME_RB=4;CColor.INDEX_FRAME_LTDARK=5;CColor.INDEX_FRAME_RBDARK=6;CColor.INDEX_FRAMEFACE=7;CColor.INDEX_FRAMEFACE_GRAY=8;CColor.INDEX_CONTROL_LT=9;CColor.INDEX_CONTROL_RB=10;CColor.INDEX_CONTROL_LTDARK=11;CColor.INDEX_CONTROL_RBDARK=12;CColor.INDEX_CONTROLFACE=13;CColor.INDEX_CONTROLFACE_FOCUS=14;CColor.INDEX_CONTROLFACE_DOWN=15;CColor.INDEX_CONTROLFACE_GRAY=16;CColor.INDEX_CONTROLFACE_LIGHT=17;CColor.INDEX_CONTROLFACE_DARK=18;CColor.INDEX_CONTROLBORDER=19;CColor.INDEX_EDIT_BKGND=20;CColor.INDEX_EDIT_GRAY=21;CColor.INDEX_EDIT_BORDER=22;CColor.INDEX_EDIT_SELECT=23;CColor.INDEX_EDITTEXT=24;CColor.INDEX_EDITTEXT_SELECT=25;CColor.INDEX_CONTROLTEXT=26;CColor.INDEX_CONTROLTEXT_FOCUS=27;CColor.INDEX_CONTROLTEXT_DOWN=28;CColor.INDEX_CONTROLTEXT_GRAY=29;CColor.INDEX_CONTROLTEXT_BOUNDLT=30;CColor.INDEX_CONTROLTEXT_BOUNDRB=31;CColor.INDEX_CONTROLTEXT_GRAYLT=32;CColor.INDEX_CONTROLTEXT_GRAYRB=33;CColor.INDEX_FRAMETEXT=34;CColor.INDEX_FRAMETEXT_BOUNDLT=35;CColor.INDEX_FRAMETEXT_BOUNDRB=36;CColor.INDEX_MESSAGETEXT=37;CColor.INDEX_MESSAGETEXT_BOUND=38;CColor.INDEX_MESSAGEBTNTEXT=39;CColor.INDEX_MESSAGEBTNTEXT_BOUNDLT=40;CColor.INDEX_MESSAGEBTNTEXT_BOUNDRB=41;CColor.INDEX_CONTROLFACE2=42;CColor.INDEX_CONTROLFACE_FOCUS2=43;CColor.INDEX_CONTROLFACE_DOWN2=44;CColor.INDEX_CONTROLFACE_GRAY2=45;CColor.INDEX_CONTROL_LT2=46;CColor.INDEX_CONTROL_RB2=47;CColor.INDEX_CONTROL_LTDARK2=48;CColor.INDEX_CONTROL_RBDARK2=49;CColor.INDEX_TOOLTIP_TEXT=50;CColor.INDEX_TOOLTIP_BKGND=51;CColor.INDEX_TOOLTIP_BORDER=52;CColor.INDEX_CONTROLFACE_GR=53;CColor.INDEX_CONTROLFACE_FOCUS_GR=54;CColor.INDEX_CONTROLFACE_DOWN_GR=55;CColor.INDEX_CONTROLFACE_GRAY_GR=56;CColor.INDEX_CONTROLFACE2_GR=57;CColor.INDEX_CONTROLFACE_FOCUS2_GR=58;CColor.INDEX_CONTROLFACE_DOWN2_GR=59;CColor.INDEX_CONTROLFACE_GRAY2_GR=60;CColor.INDEX_CONTROLFACE_SHADOW=61;CColor.INDEX_CONTROLFACE_HIGH=62;CColor.INDEX_CONTROLFACE_SHADOW2=63;CColor.INDEX_CONTROLFACE_HIGH2=64;CColor.INDEX_FRAMEFACE_GR=65;CColor.INDEX_FRAMEFACE_GRAY_GR=66;CColor.INDEX_FRAMEFACE_SHADOW=67;CColor.INDEX_FRAMEFACE_SHADOW_GR=68;CColor.INDEX_PROGRESS=69;CColor.INDEX_PROGRESS_GR=70;CColor.INDEX_PROGRESS_SHADOW=71;CColor.INDEX_PROGRESS_SHADOW_GR=72;CColor.INDEX_DEFAULTSTAGE=73;CColor.INDEX_CONTROLBKGND=74;CColor.INDEX_CONTROLTEXT=75;CColor.INDEX_CONTROLTEXT_BKGND=76;CColor.INDEX_MAXCOLOR=77;CColor.InitColor=function(){vx.Global.g_aryColor.SetSize(CColor.INDEX_MAXCOLOR);vx.Global.g_aryColor[CColor.INDEX_BACKGROUND]=CColor.RGB(230,232,232);vx.Global.g_aryColor[CColor.INDEX_POPUPBKGND]=CColor.RGB(238,240,240);vx.Global.g_aryColor[CColor.INDEX_BORDER]=CColor.RGB(32,32,32);vx.Global.g_aryColor[CColor.INDEX_FRAME_LT]=CColor.RGB(17,154,255);vx.Global.g_aryColor[CColor.INDEX_FRAME_RB]=CColor.RGB(0,129,224);vx.Global.g_aryColor[CColor.INDEX_FRAME_LTDARK]=CColor.RGB(134,136,171);vx.Global.g_aryColor[CColor.INDEX_FRAME_RBDARK]=CColor.RGB(45,47,70);vx.Global.g_aryColor[CColor.INDEX_FRAMEFACE]=CColor.RGB(0,142,247);vx.Global.g_aryColor[CColor.INDEX_FRAMEFACE_GRAY]=CColor.RGB(112,120,148);vx.Global.g_aryColor[CColor.INDEX_FRAMEFACE_GR]=CColor.RGB(0,129,224);vx.Global.g_aryColor[CColor.INDEX_FRAMEFACE_GRAY_GR]=CColor.RGB(112,120,148);vx.Global.g_aryColor[CColor.INDEX_FRAMEFACE_SHADOW]=CColor.RGB(0,0,0);vx.Global.g_aryColor[CColor.INDEX_FRAMEFACE_SHADOW_GR]=CColor.RGB(0,0,255);vx.Global.g_aryColor[CColor.INDEX_CONTROL_LT]=CColor.RGB(34,158,255);vx.Global.g_aryColor[CColor.INDEX_CONTROL_RB]=CColor.RGB(0,123,214);vx.Global.g_aryColor[CColor.INDEX_CONTROL_LTDARK]=CColor.RGB(130,130,255);vx.Global.g_aryColor[CColor.INDEX_CONTROL_RBDARK]=CColor.RGB(64,64,64);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE]=CColor.RGB(0,142,247);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_FOCUS]=CColor.RGB(34,158,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_DOWN]=CColor.RGB(0,123,214);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_GRAY]=CColor.RGB(86,182,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_GR]=CColor.RGB(0,123,214);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_FOCUS_GR]=CColor.RGB(0,142,247);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_DOWN_GR]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_GRAY_GR]=CColor.RGB(216,216,216);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_SHADOW]=CColor.RGB(64,64,198);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_HIGH]=CColor.RGB(113,193,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_LIGHT]=CColor.RGB(159,214,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_DARK]=CColor.RGB(64,64,70);vx.Global.g_aryColor[CColor.INDEX_CONTROLBORDER]=CColor.RGB(64,64,70);vx.Global.g_aryColor[CColor.INDEX_EDIT_BKGND]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_EDIT_GRAY]=CColor.RGB(216,216,216);vx.Global.g_aryColor[CColor.INDEX_EDIT_BORDER]=CColor.RGB(70,68,45);vx.Global.g_aryColor[CColor.INDEX_EDIT_SELECT]=CColor.RGB(0,0,0);vx.Global.g_aryColor[CColor.INDEX_EDITTEXT]=CColor.RGB(0,0,0);vx.Global.g_aryColor[CColor.INDEX_EDITTEXT_SELECT]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT]=CColor.RGB(32,32,32);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT_FOCUS]=CColor.RGB(70,68,45);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT_DOWN]=CColor.RGB(0,0,0);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT_GRAY]=CColor.RGB(98,98,98);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT_BOUNDLT]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT_BOUNDRB]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT_GRAYLT]=CColor.RGB(128,128,128);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT_GRAYRB]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_FRAMETEXT]=CColor.RGB(236,236,236);vx.Global.g_aryColor[CColor.INDEX_FRAMETEXT_BOUNDLT]=CColor.RGB(24,24,24);vx.Global.g_aryColor[CColor.INDEX_FRAMETEXT_BOUNDRB]=CColor.RGB(24,24,24);vx.Global.g_aryColor[CColor.INDEX_MESSAGETEXT]=CColor.RGB(0,0,0);vx.Global.g_aryColor[CColor.INDEX_MESSAGETEXT_BOUND]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_MESSAGEBTNTEXT]=CColor.RGB(0,0,0);vx.Global.g_aryColor[CColor.INDEX_MESSAGEBTNTEXT_BOUNDLT]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_MESSAGEBTNTEXT_BOUNDRB]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE2]=CColor.RGB(236,68,42);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_FOCUS2]=CColor.RGB(245,93,70);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_DOWN2]=CColor.RGB(208,63,39);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_GRAY2]=CColor.RGB(218,155,143);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE2_GR]=CColor.RGB(208,63,39);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_FOCUS2_GR]=CColor.RGB(248,188,108);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_DOWN2_GR]=CColor.RGB(255,208,128);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_GRAY2_GR]=CColor.RGB(216,216,216);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_SHADOW2]=CColor.RGB(64,64,198);vx.Global.g_aryColor[CColor.INDEX_CONTROLFACE_HIGH2]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_CONTROL_LT2]=CColor.RGB(245,93,70);vx.Global.g_aryColor[CColor.INDEX_CONTROL_RB2]=CColor.RGB(208,63,39);vx.Global.g_aryColor[CColor.INDEX_CONTROL_LTDARK2]=CColor.RGB(130,130,130);vx.Global.g_aryColor[CColor.INDEX_CONTROL_RBDARK2]=CColor.RGB(64,64,64);vx.Global.g_aryColor[CColor.INDEX_TOOLTIP_TEXT]=CColor.RGB(70,68,45);vx.Global.g_aryColor[CColor.INDEX_TOOLTIP_BKGND]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_TOOLTIP_BORDER]=CColor.RGB(70,68,45);vx.Global.g_aryColor[CColor.INDEX_PROGRESS]=CColor.RGB(255,138,0);vx.Global.g_aryColor[CColor.INDEX_PROGRESS_GR]=CColor.RGB(255,138,0);vx.Global.g_aryColor[CColor.INDEX_PROGRESS_SHADOW]=CColor.RGB(202,108,0);vx.Global.g_aryColor[CColor.INDEX_PROGRESS_SHADOW_GR]=CColor.RGB(202,108,0);vx.Global.g_aryColor[CColor.INDEX_DEFAULTSTAGE]=CColor.RGB(229,226,200);vx.Global.g_aryColor[CColor.INDEX_CONTROLBKGND]=CColor.RGB(248,248,248);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT]=CColor.RGB(255,255,255);vx.Global.g_aryColor[CColor.INDEX_CONTROLTEXT_BKGND]=CColor.RGB(64,64,64)};CColor.RGB=function(t,e,i){t=(t&255)<<16;e=(e&255)<<8;i=i&255;return t|e|i};CColor.GetRValue=function(t){return(t&16711680)>>16};CColor.GetGValue=function(t){return(t&65280)>>8};CColor.GetBValue=function(t){return t&255};CColor.GetHalfton=function(t){var e=CColor.GetRValue(t);var i=CColor.GetGValue(t);var n=CColor.GetBValue(t);if(e+i+n<128*3){e=(e+255)%256;i=(i+255)%256;n=(n+255)%256}e=e/2;i=i/2;n=n/2;return CColor.RGB(e,i,n)};CColor.SetColor=function(t,e){if(t>=0&&t<CColor.INDEX_MAXCOLOR)vx.Global.g_aryColor.SetAt(t,e)};CColor.SetRGBColor=function(t,e,i,n){if(t>=0&&t<CColor.INDEX_MAXCOLOR)vx.Global.g_aryColor.SetAt(t,CColor.RGB(e,i,n))};CColor.GetColor=function(t){if(t>=0&&t<CColor.INDEX_MAXCOLOR)return vx.Global.g_aryColor.GetAt(t);else return 0};CColor.Value=function(t,e){if(arguments.length==1||e==1){return"rgb("+CColor.GetRValue(t)+","+CColor.GetGValue(t)+","+CColor.GetBValue(t)+")"}else{return"rgba("+CColor.GetRValue(t)+","+CColor.GetGValue(t)+","+CColor.GetBValue(t)+","+e+")"}};function CUtil(){}CUtil.SETHIWORD=function(t,e){e=(e&65535)<<16;t=t&65535;return t|e};CUtil.SETLOWORD=function(t,e){t=t&4294901760;return t|e};CUtil.MAKELONG=function(t,e){t=t&65535;e=(e&65535)<<16;return t|e};CUtil.MAKEWORD=function(t,e){t=t&255;e=(e&255)<<8;return t|e};CUtil.HIWORD=function(t){t=(t&4294901760)>>16;return t};CUtil.LOWORD=function(t){t=t&65535;return t};CUtil.iHIWORD=function(t){t=(t&4294901760)>>16;if(t<32767)return t;else return t-65535};CUtil.iLOWORD=function(t){t=t&65535;if(t<32767)return t;else return t-65535};CUtil.HIBYTE=function(t){t=(t&65280)>>8;return t};CUtil.LOBYTE=function(t){t=t&255;return t};CUtil.MAKEFRAME=function(t,e,i,n){t=t&255;e=(e&255)<<8;i=(i&255)<<16;n=(n&255)<<24;return t|e|i|n};CUtil.FRAME0=function(t){return t&255};CUtil.FRAME1=function(t){return(t&65280)>>8};CUtil.FRAME2=function(t){return(t&16711680)>>16};CUtil.FRAME3=function(t){return(t&4278190080)>>24};CUtil.iFRAME0=function(t){var e=t&255;if(e<128)return e;else return e-255};CUtil.iFRAME1=function(t){var e=(t&65280)>>8;if(e<128)return e;else return e-255};CUtil.iFRAME2=function(t){var e=(t&16711680)>>16;if(e<128)return e;else return e-255};CUtil.iFRAME3=function(t){var e=(t&4278190080)>>24;if(e<128)return e;else return e-255};CUtil.MAKEMARGIN=function(t,e,i,n){t=t&255;e=(e&255)<<8;i=(i&255)<<16;n=(n&255)<<24;return t|e|i|n};CUtil.MARGINLEFT=function(t){return t&255};CUtil.MARGINTOP=function(t){return(t&65280)>>8};CUtil.MARGINRIGHT=function(t){return(t&16711680)>>16};CUtil.MARGINBOTTOM=function(t){return(t&4278190080)>>24};CUtil.DecFrame=function(t,e,i,n,s){var r,a,o,l;r=(t&255)-e;a=((t&65280)>>8)-i;o=((t&16711680)>>16)-n;l=((t&4278190080)>>24)-s;if(r<0)r=0;if(a<0)a=0;if(o<0)o=0;if(l<0)l=0;r=r&255;a=(a&255)<<8;o=(o&255)<<16;l=(l&255)<<24;return r|a|o|l};CUtil.CRect=function(t,e,i,n){var s=new vx.rect(t,e,i,n);s.Int();return s};CUtil.CPoint=function(t,e){var i=new vx.point(t,e);i.Int();return i};CUtil.DeflateRect=function(t,e,i,n,s){t.left+=e;t.top+=i;t.right-=n;t.bottom-=s};CUtil.DeflateRect2=function(t,e,i){t.left+=e;t.top+=i;t.right-=e;t.bottom-=i};CUtil.InflateRect=function(t,e,i,n,s){t.left-=e;t.top-=i;t.right+=n;t.bottom+=s};CUtil.InflateRect2=function(t,e,i){t.left-=e;t.top-=i;t.right+=e;t.bottom+=i};CUtil.PtInRect=function(t,e,i){if(e>=t.left&&e<=t.right&&i>=t.top&&i<=t.bottom)return true;else return false};CUtil.EqualRect=function(t,e,i,n,s){if(t.left==e&&t.top==i&&t.right==n&&t.bottom==s)return true;else return false};CUtil.CopyRect=function(t){return new vx.rect(t.left,t.top,t.right,t.bottom)};CUtil.MakeRect=function(t,e,i,n){return new vx.rect(t,e,t+i,e+n)};CUtil.SetRect=function(t,e,i,n,s){t.left=e;t.top=i;t.right=e+n;t.bottom=i+s};CUtil.SetCRect=function(t,e,i,n,s){t.left=e;t.top=i;t.right=n;t.bottom=s};CUtil.IsRectEmpty=function(t){if(t.left>=t.right||t.top>=t.bottom)return true;return false};CUtil.EqualPoint=function(t,e,i){if(t.x==e&&t.y==i)return true;else return false};CUtil.CenterPoint=function(t){return new vx.point(t.left+t.Width()/2,t.top+t.Height()/2)};CUtil.CopyPoint=function(t){return new vx.point(t.x,t.y)};CUtil.MakePoint=function(t,e){return new vx.point(t,e)};CUtil.SetPoint=function(t,e,i){t.x=e;t.y=i};CUtil.CenterPointRect=function(t,e,i){return new vx.rect(t.x-e/2,t.y-i/2,t.x-e/2+e,t.y-i/2+i)};CUtil.CenterRect=function(t,e,i,n){return new vx.rect(t-i/2,e-n/2,t-i/2+i,e-n/2+n)};CUtil.Int=function(t){var e=t%1;if(e!=0)t-=e;return t};CUtil.IntR=function(t){var e=t%1;if(e!=0){if(e<.5)t-=e;else t+=1-e}return t};CUtil.IntB=function(t){var e=t%1;if(e!=0){t-=e;t++}return t};CUtil.Num2=function(t){t*=100;var e=t%1;if(e!=0){if(e<.5)t-=e;else t+=1-e}return t/100};CUtil.SortingObject_ByType=function(t,e,i){if(t==null||e==null)return;t.RemoveAll();var n,s,r,a,o=e.length;if(o==0)return;a=0;if(i==CFlags.SORTTYPE_ZORDERONLY||i==CFlags.SORTTYPE_ZORDERBOTTOMRIGHT){for(s=0;s<o;s++){n=e[s];if(n.m_uFlag2&CFlags.STATUS2_DELETE)continue;if(n.m_uFlag&CFlags.STATUS_TOPMOST)r=CFlags.ZVALUE_TOPMOST;else if(n.m_uFlag&CFlags.STATUS_TOP)r=CFlags.ZVALUE_TOP;else if(n.m_uFlag&CFlags.STATUS_BOTTOM)r=CFlags.ZVALUE_BOTTOM;else r=CFlags.ZVALUE_NORMAL;if(n.m_uFlag&CFlags.STATUS_POPUP)r+=CFlags.ZVALUE_POPUP;r+=n.m_nZOrder;n.m_nTmpZValue=r;if(i==CFlags.SORTTYPE_ZORDERBOTTOMRIGHT)n.m_nTmpPValue=(n.m_y+n.m_height)*CFlags.PVALUE_BASE+(n.m_x+n.m_width);else n.m_nTmpPValue=0;CUtil.SortACS(t,n,0,a);a++}}else if(i==CFlags.SORTTYPE_BOTTOMONLY||i==CFlags.SORTTYPE_BOTTOMRIGHT){for(s=0;s<o;s++){n=e[s];if(n.m_uFlag2&CFlags.STATUS2_DELETE)continue;if(n.m_uFlag&CFlags.STATUS_TOPMOST)r=CFlags.ZVALUE_TOPMOST;else if(n.m_uFlag&CFlags.STATUS_TOP)r=CFlags.ZVALUE_TOP;else if(n.m_uFlag&CFlags.STATUS_BOTTOM)r=CFlags.ZVALUE_BOTTOM;else r=CFlags.ZVALUE_NORMAL;if(n.m_uFlag&CFlags.STATUS_POPUP)r+=CFlags.ZVALUE_POPUP+n.m_nZOrder;else r+=n.m_y+n.m_height;n.m_nTmpZValue=r;if(i==CFlags.SORTTYPE_BOTTOMRIGHT)n.m_nTmpPValue=n.m_x+n.m_width;else n.m_nTmpPValue=0;CUtil.SortACS(t,n,0,a);a++}}};CUtil.SortACS=function(t,e,i,n){if(i>=n){t.InsertAt(n,e);return}var s;var r=e.m_nTmpZValue;var a=e.m_nTmpPValue;s=t.GetAt(n-1);if(s.m_nTmpZValue<r||s.m_nTmpZValue==r&&s.m_nTmpPValue<=a){t.InsertAt(n,e);return}s=t.GetAt(i);if(s.m_nTmpZValue>r){t.InsertAt(i,e);return}if(s.m_nTmpZValue==r){if(s.m_nTmpPValue==a){t.InsertAt(i+1,e);return}}else if(s.m_nTmpZValue>r){t.InsertAt(i,e);return}var o=(i+n)/2;o=Math.floor(o);s=t.GetAt(o);if(s.m_nTmpZValue==r){if(s.m_nTmpPValue==a){t.InsertAt(o+1,e)}else if(s.m_nTmpPValue<a){CUtil.SortACS(t,e,o,n)}else{CUtil.SortACS(t,e,i,o)}}else if(s.m_nTmpZValue<r){CUtil.SortACS(t,e,o,n)}else{CUtil.SortACS(t,e,i,o)}};CUtil.Replace=function(t,e,i){if(t==null||e==null)return t;var n=t.length;var s=e.length;var r;if(i=="")i=null;if(i==null)r=0;else r=i.length;var a=0;var o,l=null;var _=null;for(var h=0;h<n;h++){o=t.charAt(h);if(_==null)_=o;else _+=o;if(o==e.charAt(a)){a++;if(s==a)_=i;else continue}if(_!=null){if(l==null)l=_;else l+=_;_=null}a=0}return l};CUtil.Find=function(t,e,i){if(arguments.length<3)i=0;return t.indexOf(e,i)};CUtil.ReverseFind=function(t,e){return t.lastIndexOf(e)};CUtil.Left=function(t,e){return t.substr(0,e)};CUtil.Right=function(t,e){return t.substring(t.length-e)};CUtil.Mid=function(t,e,i){return t.substr(e,i)};CUtil.ParsingToken=function(t,e,i){var n,s=0;if(i==undefined)i=new Array;while(1){n=t.indexOf(e,s);if(n==-1)break;i.push(t.substr(s,n-s));s=n+1}return i};CUtil.FindLeft=function(t,e){var i=t.indexOf(e);if(i==-1)return t;return t.substr(0,i)};CUtil.FindRight=function(t,e){var i=t.indexOf(e);if(i==-1)return t;return t.substring(i+1,t.length)};CUtil.ReverseFindLeft=function(t,e){var i=t.lastIndexOf(e);if(i==-1)return t;return t.substr(0,i)};CUtil.ReverseFindRight=function(t,e){var i=t.lastIndexOf(e);if(i==-1)return t;return t.substring(i+1,t.length)};CUtil.TrimLeft=function(t){if(t==null||t=="")return t;var e=t.length;var i,n=null;for(var s=0;s<e;s++){i=t.charCodeAt(s);if(i==CKeys.VK_SPACE||i==CKeys.VK_TAB||i==CKeys.VK_ENTER||i==CKeys.VK_RETURN)continue;break}if(s==0)return t;else return CUtil.Right(t,e-s)};CUtil.TrimRight=function(t){if(t==null||t=="")return t;var e=t.length;var i,n=null;for(var s=e-1;s>=0;s--){i=t.charCodeAt(s);if(i==CKeys.VK_SPACE||i==CKeys.VK_TAB||i==CKeys.VK_ENTER||i==CKeys.VK_RETURN)continue;break}return CUtil.Left(t,s+1)};CUtil.Trim=function(t){return CUtil.TrimRight(CUtil.TrimLeft(t))};CUtil.TrimLeftSpace=function(t){if(t==null||t=="")return t;var e=t.length;var i,n=null;for(var s=0;s<e;s++){i=t.charCodeAt(s);if(i==CKeys.VK_SPACE||i==CKeys.VK_TAB)continue;break}if(s==0)return t;else return CUtil.Right(t,e-s)};CUtil.TrimRightSpace=function(t){if(t==null||t=="")return t;var e=t.length;var i,n=null;for(var s=e-1;s>=0;s--){i=t.charCodeAt(s);if(i==CKeys.VK_SPACE||i==CKeys.VK_TAB)continue;break}return CUtil.Left(t,s+1)};CUtil.TrimSpace=function(t){return CUtil.TrimRightSpace(CUtil.TrimLeftSpace(t))};CUtil.GetEnterText=function(t,e,i,n){if(vx.Global.g_buffer==null)return t;if(i==undefined)i=-1;if(n==undefined)n=e;var s=1;var r=0;var a,o="";var l=new vx.rect(0,0,0,20);if(i>0){vx.Global.g_buffer.DrawText(".",l,CDefine.DT_CALCRECT);n-=l.Width()*3;l.right=0}var _,h=t.length;for(_=0;_<h;_++){a=t.charAt(_);if(a=="\n"){s++;if(i>0&&s>i){break}r=0;o+=a;continue}else if(a=="\r"){continue}vx.Global.g_buffer.DrawText(a,l,CDefine.DT_CALCRECT);if(r+l.Width()>e){s++;if(i>0&&s>i){o+="...";break}r=l.Width();o+="\n"}else{r+=l.Width()}o+=a;l.right=0;if(i>0&&s==i)e=n}return o};CUtil.CopyPoint=function(t,e,i){if(t==null||i==null)return;var n=t.length;var s=i.length;if(e<0||e>=n)return;for(var r=e;r<e+s&&r<n;r++){t[r].x=i[r].x;t[r].y=i[r].y}};CUtil.SetSizePoint=function(t,e){t.length=e;for(var i=0;i<e;i++){if(t[i]==undefined)t[i]=new vx.point(0,0)}};CUtil.SetSizeRect=function(t,e){t.length=e;for(var i=0;i<e;i++){if(t[i]==undefined)t[i]=new vx.rect(0,0,0,0)}};CUtil.CenterPointRect=function(t,e,i){return new vx.rect(t.x-e/2,t.y-i/2,t.x-e/2+e,t.y-i/2+i)};CUtil.Max=function(t,e,i,n){var s=t;if(s<e)s=e;if(s<i)s=i;if(s<n)s=n;return s};CUtil.Min=function(t,e,i,n){var s=t;if(s>e)s=e;if(s>i)s=i;if(s>n)s=n;return s};CUtil.max=function(t,e){if(t>e)return t;else return e};CUtil.min=function(t,e){if(t<e)return t;else return e};CUtil.getTextContent=function(t){return t.textContent||t.text||t.innerText};CUtil.GetFileName=function(t){var e,i=CUtil.ReverseFind(t,"/");if(i==-1)e=t;else e=CUtil.Right(t,t.length-i-1);return e};CUtil.GetFileTitle=function(t){t=typeof t!=="undefined"?t:"";var e,i=CUtil.ReverseFind(t,".");if(i==-1)e=t;else e=CUtil.Left(t,i);return e};CUtil.GetFileExt=function(t){t=typeof t!=="undefined"?t:"";var e,i=CUtil.ReverseFind(t,".");if(i==-1)e=t;else e=CUtil.Mid(t,i+1,t.length);return e};CUtil.NormalizeRect=function(t){var e;if(t.left>t.right){e=t.left;t.left=t.right;t.right=e}if(t.top>t.bottom){e=t.top;t.top=t.bottom;t.bottom=e}};CUtil.NumToStr=function(t,e){var i=t.toString();var n="";for(var s=e-i.length-1;s>=0;s--)n+="0";return n+i};CUtil.CheckQuad90=function(t,e){var t=Math.floor(t%360/90);var e=Math.floor(e%360/90);var i,n;if(t==0||t==3)i=true;else i=false;if(e==0||e==3)n=true;else n=false;if(i!=n)return true;else return false};CUtil.NumStrToImageTag=function(t,e){var i=null;if(t){var n,s,r,a=t.length;for(s=0;s<a;s++){n=t.charAt(s);if(n=="+")r=10;else if(n=="-")r=11;else if(n=="9")r=9;else if(n=="8")r=8;else if(n=="7")r=7;else if(n=="6")r=6;else if(n=="5")r=5;else if(n=="4")r=4;else if(n=="3")r=3;else if(n=="2")r=2;else if(n=="1")r=1;else if(n=="0")r=0;else continue;if(i==null)i=vx.tag.Image(e,e.GetFrameRect(r));else i.Append(vx.tag.Image(e,e.GetFrameRect(r)))}}if(i==null)return vx.tag.TNULL();else return i};CUtil.GetMoneyString=function(t){var e=0;var i="";var n=t.toString();var s,r,a=n.length;for(r=a-1;r>=0;r--){s=n.charAt(r);if(e==3){s=s+",";e=0}i=s+i;e++}return i};CUtil.GetSoundExt=function(){var t="mp3";var e=document.createElement("audio");if(e.canPlayType){var i=!!(e.canPlayType&&e.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""));var n=!!(e.canPlayType&&e.canPlayType("audio/mpeg;").replace(/no/,""));var s=!!(e.canPlayType&&e.canPlayType('audio/wav; codecs="1"').replace(/no/,""));if(n)t="mp3";else if(i)t="ogg";else if(s)t="wav";vx.trace("CUtil....sound file ext is selected : "+t)}return t};CUtil.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e="";var i,n,s,r,a,o,l;var _=0;t=this._utf8_encode(t);while(_<t.length){i=t.charCodeAt(_++);n=t.charCodeAt(_++);s=t.charCodeAt(_++);r=i>>2;a=(i&3)<<4|n>>4;o=(n&15)<<2|s>>6;l=s&63;if(isNaN(n)){o=l=64}else if(isNaN(s)){l=64}e=e+this._keyStr.charAt(r)+this._keyStr.charAt(a)+this._keyStr.charAt(o)+this._keyStr.charAt(l)}return e},decode:function(t){var e="";var i,n,s;var r,a,o,l;var _=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(_<t.length){r=this._keyStr.indexOf(t.charAt(_++));a=this._keyStr.indexOf(t.charAt(_++));o=this._keyStr.indexOf(t.charAt(_++));l=this._keyStr.indexOf(t.charAt(_++));i=r<<2|a>>4;n=(a&15)<<4|o>>2;s=(o&3)<<6|l;e=e+String.fromCharCode(i);if(o!=64){e=e+String.fromCharCode(n)}if(l!=64){e=e+String.fromCharCode(s)}}e=this._utf8_decode(e);return e},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");var e="";for(var i=0;i<t.length;i++){var n=t.charCodeAt(i);if(n<128){e+=String.fromCharCode(n)}else if(n>127&&n<2048){e+=String.fromCharCode(n>>6|192);e+=String.fromCharCode(n&63|128)}else{e+=String.fromCharCode(n>>12|224);e+=String.fromCharCode(n>>6&63|128);e+=String.fromCharCode(n&63|128)}}return e},_utf8_decode:function(t){var e="";var i=0;var n=c1=c2=0;while(i<t.length){n=t.charCodeAt(i);if(n<128){e+=String.fromCharCode(n);i++}else if(n>191&&n<224){c2=t.charCodeAt(i+1);e+=String.fromCharCode((n&31)<<6|c2&63);i+=2}else{c2=t.charCodeAt(i+1);c3=t.charCodeAt(i+2);e+=String.fromCharCode((n&15)<<12|(c2&63)<<6|c3&63);i+=3}}return e}};CUtil.Convert=function(t){return{from:function(e){return{to:function(i){return parseInt(t,e).toString(i)}}}}};CUtil.Convert.Dec2Hex=function(t){var e=CUtil.Convert(t).from(10).to(16);return e};CUtil.Convert.Hex2Dec=function(t){var e=CUtil.Convert(t).from(16).to(10);return e};CUtil.ZeroFill=function(t,e){var n="";t=t.toString();if(t.length<e){for(i=0;i<e-t.length;i++)n+="0"}t=n+t;return t};CUtil.FindString=function(t,e){var i=new RegExp(e,"gi");var n=t.match(i);if(!n)return false;else return true};CUtil.StringToBuffer8=function(t){var e=new ArrayBuffer(t.length);var i=new Uint8Array(e);for(var n=0,s=t.length;n<s;n++)i[n]=t.charCodeAt(n);return e};CUtil.StringToBuffer16=function(t){var e=new ArrayBuffer(t.length*2);var i=new Uint16Array(e);for(var n=0,s=t.length;n<s;n++)i[n]=t.charCodeAt(n);return e};CUtil.Buffer2String=function(t){return String.fromCharCode.apply(null,new Uint16Array(t))};CUtil.String2HexString=function(t,e){e=typeof e!=="undefined"?e:1;var i=new ArrayBuffer(t.length*2);var n=new Uint16Array(i);for(var s=0,r=t.length;s<r;s++)n[s]=t.charCodeAt(s);var a="",o="",l="",_=0;for(var s=0;s<n.length;s++){_=n[s];strHex=CUtil.Convert.Dec2Hex(_);strHex=CUtil.ZeroFill(strHex,e*2);a+=strHex}return a};CUtil.HexString2BinaryString=function(t,e){e=typeof e!=="undefined"?e:1;var i="";var n="",s=0;for(var r=0;r<t.length;r=r+e*2){n=t.substring(r,r+e*2);s=CUtil.Convert.Hex2Dec(n);i+=String.fromCharCode(s)}return i};CUtil.BinaryString2HexString=function(t,e){e=typeof e!=="undefined"?e:1;var i=t.length*e;var n=new ArrayBuffer(i);var s;if(e==1)s=new Uint8Array(n);else if(e==2)s=new Uint16Array(n);for(var r=0;r<i;r++){s[r]=t.charCodeAt(r)}var a="",o="",l="",_=0;for(var r=0;r<s.length;r++){_=s[r];strHex=CUtil.Convert.Dec2Hex(_);strHex=CUtil.ZeroFill(strHex,e*2);a+=strHex}return a};CUtil.HexString2String=function(t,e){e=typeof e!=="undefined"?e:1;var i="";var n="",s=0;for(var r=0;r<t.length;r=r+e*2){n=t.substring(r,r+e*2);s=CUtil.Convert.Hex2Dec(n);i+=String.fromCharCode(s)}return i};CUtil.Dump=function(t){var e=new Uint8Array(t.m_arrayBuffer);var i=e.length;var n="";n+="----------------------------------------\n";for(var s=0;s<i;s++){if(s!=0&&s%8==0)n+="\n";n+=CUtil.ZeroFill(CUtil.Convert.Dec2Hex(e[s]),2)+" "}console.log(n)};CUtil.RSAEncrypt=function(t,e){var i="10001";var n=new RSAKey;var s=CUtil.BinaryString2HexString(t);n.setPublic(s,i);var r=n.encrypt(e);var a=CUtil.HexString2BinaryString(r);return a};CUtil.NTOHS=function(t){t=t&65535;var e=t&65280;e>>8;var i=t&255;i<<8;return e|i};CUtil.NTOHL=function(t){t=t&4294967295;var e=t&4278190080;var i=t&16711680;var n=t&65280;var s=t&255;e>>24;i>>8;n<<8;s<<24;return e|i|n|s};vx.buffer=vx.Class.extend({init:function(t,e,i){if(t==null){t=document.createElement("canvas")}else{e=t.width;i=t.height}this.m_canvas=t;this.m_context=t.getContext("2d");this.m_context.canvas.width=CUtil.IntB(e);this.m_context.canvas.height=CUtil.IntB(i);this.m_gradient=null;this.m_cx=0;this.m_cy=0;this.m_bUTB=false;this.m_bTransform=false},toString:function(){return"(vx.buffer)"},Delete:function(){this.m_canvas=null;this.m_context=null;this.m_gradient=null},SetSize:function(t,e){this.m_context.canvas.width=t;this.m_context.canvas.height=e},GetSize:function(){return new vx.point(this.m_context.canvas.width,this.m_context.canvas.height)},toRad:function(t){return t*Math.PI/180},Clip:function(t){this.m_context.save();if(t==null)return;this.m_context.beginPath();this.m_context.rect(t.left,t.top,t.right-t.left,t.bottom-t.top);this.m_context.clip();this.m_context.closePath()},ClipArray:function(t,e){this.m_context.save();if(e==0||t==null)return;var i;this.m_context.beginPath();for(var n=0;n<e;n++){i=t[n];this.m_context.rect(i.left,i.top,i.right-i.left,i.bottom-i.top)}this.m_context.clip();this.m_context.closePath()},Translate:function(t,e){this.m_context.save();this.m_context.translate(t,e)},TranslateClip:function(t,e,i){this.m_context.save();this.m_context.translate(t,e);if(i==null||this.m_bTransform)return;this.m_context.beginPath();this.m_context.rect(i.left,i.top,i.right-i.left,i.bottom-i.top);this.m_context.clip();this.m_context.closePath()},Transform:function(t,e,i,n,s){this.m_cx=t;this.m_cy=e;this.m_context.save();this.m_context.translate(t,e);if(i!=0)this.m_context.rotate(i*Math.PI/180);if(n!=1||s!=1)this.m_context.scale(n,s);this.m_bTransform=true},RestoreTransform:function(){this.m_cx=0;this.m_cy=0;this.m_bTransform=false;this.m_context.restore()},OffsetTransform:function(t){t.left-=this.m_cx;t.top-=this.m_cy;t.right-=this.m_cx;t.bottom-=this.m_cy},Restore:function(){this.m_context.restore()},Alpha:function(t){this.m_context.globalAlpha=t},RestoreAlpha:function(){this.m_context.globalAlpha=1},Blt:function(t,e,i){var n;if(t.m_context==undefined)n=t.m_image;else n=t.m_canvas;this.m_context.drawImage(n,e,i)},BltBlock:function(t,e,i,n,s,r,a){var o,l,_;if(t.m_context==undefined){_=t.m_image;o=t.m_image.width;l=t.m_image.height}else{_=t.m_canvas;o=t.m_context.canvas.width;l=t.m_context.canvas.height}if(n+r>o)r=o-n;if(s+a>l)a=l-s;if(n<0){r+=n;n=0}if(s<0){a+=s;s=0}if(r<=0||a<=0)return;this.m_context.drawImage(_,n,s,r,a,e,i,r,a)},HorzGridBlt:function(t,e,i,n,s,r,a,o){if(a==o){this.BltBlock(t,e,i,n,s,r,a)}var l,_,h;if(t.m_context==undefined){h=t.m_image;l=t.m_image.width;_=t.m_image.height}else{h=t.m_canvas;l=t.m_context.canvas.width;_=t.m_context.canvas.height}if(n+r>l)r=l-n;if(s+a>_)a=_-s;if(n<0){r+=n;n=0}if(s<0){a+=s;s=0}var f,C,m,u,T,S,c,g,E,d=false;c=2;if(o<0){o=-o;d=true}S=Math.floor(r/c);if(S==0)return;g=(_-o)/(_*S);if(!d){u=0;T=1;while(u<r){C=a*T;f=Math.floor(i+a/2-C/2);C=Math.floor(C);if(r-u>=c)m=c;else m=r-u;this.m_context.drawImage(h,n+u,s,m,a,e+u,f,m,C);u+=m;T-=g;if(T<=0)break}}else{u=r;T=1;while(u>0){C=a*T;f=Math.floor(i+a/2-C/2);C=Math.floor(C);if(u>=c)m=c;else m=u;u-=m;this.m_context.drawImage(h,n+u,s,m,a,e+u,f,m,C);T-=g;if(T<=0)break}}},VertGridBlt:function(t,e,i,n,s,r,a,o){if(r==o){this.BltBlock(t,e,i,n,s,r,a)}var l,_,h;if(t.m_context==undefined){h=t.m_image;l=t.m_image.width;_=t.m_image.height}else{h=t.m_canvas;l=t.m_context.canvas.width;_=t.m_context.canvas.height}if(n+r>l)r=l-n;if(s+a>_)a=_-s;if(n<0){r+=n;n=0}if(s<0){a+=s;s=0}var f,C,m,u,T,S,c,g,E,d=false;c=2;if(o<0){o=-o;d=true}S=Math.floor(a/c);if(S==0)return;g=(l-o)/(l*S);if(!d){u=0;T=1;while(u<a){C=r*T;f=Math.floor(e+r/2-C/2);C=Math.floor(C);if(a-u>=c)m=c;else m=a-u;this.m_context.drawImage(h,n,s+u,r,m,f,i+u,C,m);u+=m;T-=g;if(T<=0)break}}else{u=a;T=1;while(u>0){C=r*T;f=Math.floor(e+r/2-C/2);C=Math.floor(C);if(u>=c)m=c;else m=u;u-=m;this.m_context.drawImage(h,n,s+u,r,m,f,i+u,C,m);T-=g;if(T<=0)break}}},StretchBltBlock:function(t,e,i,n,s,r,a,o,l){if(n<=0||s<=0||o<=0||l<=0)return;var _;if(t.m_context==undefined)_=t.m_image;else _=t.m_canvas;this.m_context.drawImage(_,r,a,o,l,e,i,n,s)},VX_Fill:function(t){this.m_context.fillStyle=CColor.Value(t);this.m_context.fillRect(0,0,this.m_context.canvas.width,this.m_context.canvas.height)},VX_Clear:function(){this.m_context.clearRect(0,0,this.m_context.canvas.width,this.m_context.canvas.height)},DrawLine:function(t,e,i,n,s,r,a){switch(arguments.length){case 7:break;case 6:a=1;break;case 5:r=1;a=1;break;default:return}var o=.5;this.m_context.lineWidth=a;this.m_context.strokeStyle=CColor.Value(s,r);this.m_context.beginPath();this.m_context.moveTo(t+o,e+o);this.m_context.lineTo(i+o,n+o);this.m_context.stroke();this.m_context.closePath()},DrawRectangle:function(t,e,i,n,s){if(t.IsEmpty())return;var r=0;var a=t.Clone();switch(arguments.length){case 5:break;case 4:s=1;break;case 3:n=1;s=1;break;case 2:i=4294967295;n=1;s=1;break;default:return}this.m_context.lineWidth=1;if(e!=4294967295)this.m_context.fillStyle=CColor.Value(e,n);if(i!=4294967295){r=s/2;a.Deflate(r,r,r,r);this.m_context.lineWidth=s;this.m_context.strokeStyle=CColor.Value(i,n)}this.m_context.beginPath();this.m_context.moveTo(a.left,a.bottom);this.m_context.lineTo(a.left,a.top);this.m_context.lineTo(a.right,a.top);this.m_context.lineTo(a.right,a.bottom);this.m_context.lineTo(a.left-Math.floor(r),a.bottom);if(e!=4294967295)this.m_context.fill();if(i!=4294967295)this.m_context.stroke();this.m_context.closePath()},DrawRoundRect:function(t,e,i,n,s,r){if(t.IsEmpty())return;var a=t.Clone();switch(arguments.length){case 6:break;case 5:r=1;break;case 4:s=1;r=1;break;case 3:n=4294967295;s=1;r=1;break;default:return}if(e==0){this.DrawRectangle(t,i,n,s,r);return}if(n!=4294967295){var o=r/2;a.Deflate(o,o,o,o)}this.m_context.lineWidth=r;if(i!=4294967295){if(this.m_gradient)this.m_context.fillStyle=this.m_gradient;else this.m_context.fillStyle=CColor.Value(i,s)}if(n!=4294967295)this.m_context.strokeStyle=CColor.Value(n,s);this.m_context.beginPath();this.m_context.moveTo(a.left+e,a.top);this.m_context.lineTo(a.right-e,a.top);this.m_context.quadraticCurveTo(a.right,a.top,a.right,a.top+e);this.m_context.lineTo(a.right,a.bottom-e);this.m_context.quadraticCurveTo(a.right,a.bottom,a.right-e,a.bottom);this.m_context.lineTo(a.left+e,a.bottom);this.m_context.quadraticCurveTo(a.left,a.bottom,a.left,a.bottom-e);this.m_context.lineTo(a.left,a.top+e);this.m_context.quadraticCurveTo(a.left,a.top,a.left+e,a.top);if(i!=4294967295)this.m_context.fill();if(n!=4294967295)this.m_context.stroke();this.m_context.closePath()},DrawEllipse:function(t,e,i,n,s){if(t.IsEmpty())return;var r=t.Clone();switch(arguments.length){case 5:break;case 4:s=1;break;case 3:n=1;s=1;break;case 2:i=4294967295;n=1;s=1;break;default:return}if(e==4294967295&&i==4294967295)return;var a=s/2;r.Deflate(a,a,a,a);var o=r.CenterPoint();var l=r.Width()/2;var _=r.Height()/2;this.m_context.lineWidth=s;if(e!=4294967295)this.m_context.fillStyle=CColor.Value(e,n);if(i!=4294967295)this.m_context.strokeStyle=CColor.Value(i,n);this.m_context.beginPath();if(l==_){this.m_context.arc(o.x,o.y,l,0,Math.PI*2,false)}else{this.m_context.save();this.m_context.translate(o.x,o.y);this.m_context.scale(l,_);this.m_context.arc(0,0,1,0,Math.PI*2,false);this.m_context.restore()}if(e!=4294967295)this.m_context.fill();if(i!=4294967295)this.m_context.stroke();this.m_context.closePath()},DrawPolygon:function(t,e,i,n,s){switch(arguments.length){case 5:break;case 4:s=1;break;case 3:n=1;s=1;break;case 2:i=4294967295;n=1;s=1;break;default:return}var r,a,o=t.length;if(o==0)return;if(i!=4294967295)r=s/2;else r=0;this.m_context.lineWidth=s;if(this.m_gradient){this.m_context.fillStype=this.m_gradient}else{if(e!=4294967295)this.m_context.fillStyle=CColor.Value(e,n)}if(i!=4294967295)this.m_context.strokeStyle=CColor.Value(i,n);this.m_context.beginPath();this.m_context.moveTo(t[0].x+r,t[0].y+r);for(a=1;a<o;a++){this.m_context.lineTo(t[a].x+r,t[a].y+r)}this.m_context.lineTo(t[0].x+r,t[0].y+r);if(e!=4294967295||this.m_gradient)this.m_context.fill();if(i!=4294967295)this.m_context.stroke();this.m_context.closePath()},DrawPolyline:function(t,e,i,n){switch(arguments.length){case 4:break;case 3:n=1;break;case 2:i=1;n=1;break;default:return}var s,r,a=t.length;if(a==0||e==4294967295)return;s=n/2;this.m_context.lineWidth=n;this.m_context.strokeStyle=CColor.Value(e,i);this.m_context.beginPath();this.m_context.moveTo(t[0].x+s,t[0].y+s);for(r=1;r<a;r++){this.m_context.lineTo(t[r].x+s,t[r].y+s)}this.m_context.stroke();this.m_context.closePath()},DrawGradientPolygon:function(t,e,i,n,s,r,a,o,l){switch(arguments.length){case 9:break;case 8:l=1;break;case 7:l=1;o=1;break;case 6:l=1;o=1;a=1;break;case 5:l=1;o=1;a=1;r=4294967295;break;default:return}if(t==true)this.m_gradient=this.m_context.createLinearGradient(e.left,0,e.right,0);else this.m_gradient=this.m_context.createLinearGradient(0,e.top,0,e.bottom);this.m_gradient.addColorStop(0,CColor.Value(n,a));this.m_gradient.addColorStop(1,CColor.Value(s,o));this.DrawPolygon(i,n,r,a,l);this.m_gradient=null},Draw3dRect:function(t,e,i,n,s,r){if(t.IsEmpty())return;var a;var o;var l,_,h,f;var C=t.Clone();switch(arguments.length){case 6:break;case 5:r=0;break;case 4:r=0;s=1;break;case 3:r=0;s=1;n=1;break;case 2:r=0;s=1;n=1;i=e;break;default:return}a=s/2;this.m_context.lineWidth=s;if(n==1)this.m_context.strokeStyle=CColor.Value(e);else this.m_context.strokeStyle=CColor.Value(e,n);if(e==i){if(r==0){C.Deflate(a,a,a,a);this.m_context.beginPath();this.m_context.moveTo(C.left,C.bottom);this.m_context.lineTo(C.left,C.top);this.m_context.lineTo(C.right,C.top);this.m_context.lineTo(C.right,C.bottom);this.m_context.lineTo(C.left-Math.floor(a),C.bottom);this.m_context.stroke();this.m_context.closePath()}else{C.Deflate(0,0,s,s);l=CUtil.FRAME0(r);_=CUtil.FRAME1(r);h=CUtil.FRAME2(r);f=CUtil.FRAME3(r);o=new ObArray;o.Add(new vx.point(C.left,C.bottom-f));o.Add(new vx.point(C.left,C.top+l));o.Add(new vx.point(C.left+l,C.top));o.Add(new vx.point(C.right-_,C.top));o.Add(new vx.point(C.right,C.top+_));o.Add(new vx.point(C.right,C.bottom-h));o.Add(new vx.point(C.right-h,C.bottom));o.Add(new vx.point(C.left+f,C.bottom));this.DrawPolygon(o,4294967295,e,n,s);o.RemoveAll()}}else{if(r==0){C.Deflate(a,a,a,a);a=Math.floor(a);this.m_context.beginPath();this.m_context.moveTo(C.left,C.bottom);this.m_context.lineTo(C.left,C.top);this.m_context.lineTo(C.right+a,C.top);this.m_context.stroke();this.m_context.closePath();if(n==1)this.m_context.strokeStyle=CColor.Value(i);else this.m_context.strokeStyle=CColor.Value(i,n);this.m_context.beginPath();this.m_context.moveTo(C.right,C.top+a);this.m_context.lineTo(C.right,C.bottom);this.m_context.lineTo(C.left-a,C.bottom);this.m_context.stroke();this.m_context.closePath()}else{C.Deflate(0,0,s,s);l=CUtil.FRAME0(r);_=CUtil.FRAME1(r);h=CUtil.FRAME2(r);f=CUtil.FRAME3(r);o=new ObArray;o.RemoveAll();o.Add(new vx.point(C.left,C.bottom-f));o.Add(new vx.point(C.left,C.top+l));o.Add(new vx.point(C.left+l,C.top));o.Add(new vx.point(C.right-_,C.top));o.Add(new vx.point(C.right,C.top+_));this.DrawPolyline(o,e,n,s);if(i!=4294967295){o.RemoveAll();o.Add(new vx.point(C.right,C.top+_));o.Add(new vx.point(C.right,C.bottom-h));o.Add(new vx.point(C.right-h,C.bottom));o.Add(new vx.point(C.left+f,C.bottom));o.Add(new vx.point(C.left,C.bottom-f));this.DrawPolyline(o,i,n,s)}o.RemoveAll()}}},DrawFrameRect:function(t,e,i,n,s,r,a,o){if(e.IsEmpty())return;switch(arguments.length){case 8:break;case 7:o=0;break;case 6:o=0;a=1;break;case 5:o=0;a=1;r=1;break;case 4:o=0;a=1;r=1;s=4294967295;break;default:return}var l=e.Clone();var _=i.Clone();var h=0;if(s!=4294967295)h=a/2;this.m_context.lineWidth=a;this.m_context.strokeStyle=CColor.Value(s,r);this.m_context.fillStyle=CColor.Value(n,r);if(o==0){l.Deflate(h,h,h,h);_.Inflate(h,h,h,h);this.m_context.beginPath();if(t==0){this.m_context.moveTo(l.left,l.bottom);this.m_context.lineTo(l.left,l.top);this.m_context.lineTo(l.right,l.top);this.m_context.lineTo(l.right,l.bottom);this.m_context.lineTo(l.left,l.bottom);this.m_context.moveTo(_.left,_.bottom);this.m_context.lineTo(_.right,_.bottom);this.m_context.lineTo(_.right,_.top);this.m_context.lineTo(_.left,_.top);this.m_context.lineTo(_.left,_.bottom)}if(t==1){this.m_context.moveTo(l.left,l.bottom);this.m_context.lineTo(l.left,l.top);this.m_context.lineTo(l.right,l.top);this.m_context.lineTo(_.right,_.top);this.m_context.lineTo(_.left,_.top);this.m_context.lineTo(_.left,_.bottom);this.m_context.lineTo(l.left,l.bottom)}else if(t==2){this.m_context.moveTo(l.right,l.top);this.m_context.lineTo(l.right,l.bottom);this.m_context.lineTo(l.left,l.bottom);this.m_context.lineTo(_.left,_.bottom);this.m_context.lineTo(_.right,_.bottom);this.m_context.lineTo(_.right,_.top);this.m_context.lineTo(l.right,l.top)}if(n!=4294967295)this.m_context.fill();if(s!=4294967295)this.m_context.stroke();this.m_context.closePath()}else{var f,C,m,u,T,S,c,g;f=CUtil.FRAME0(o);C=CUtil.FRAME1(o);m=CUtil.FRAME2(o);u=CUtil.FRAME3(o);if(s!=4294967295){l.Deflate(0,0,a,a);_.Inflate(a,a,0,0)}T=f-(_.left-l.left)/2;S=C-(_.top-l.top)/2;c=m-(l.right-_.right)/2;g=u-(l.bottom-_.bottom)/2;if(T<1)T=1;else T=Math.floor(T);if(S<1)S=1;else S=Math.floor(S);if(c<1)c=1;else c=Math.floor(c);if(g<1)g=1;else g=Math.floor(g);this.m_context.beginPath();if(t==0){this.m_context.moveTo(h+l.left,h+l.bottom-u);this.m_context.lineTo(h+l.left,h+l.top+f);this.m_context.lineTo(h+l.left+f,h+l.top);this.m_context.lineTo(h+l.right-C,h+l.top);this.m_context.lineTo(h+l.right,h+l.top+C);this.m_context.lineTo(h+l.right,h+l.bottom-m);this.m_context.lineTo(h+l.right-m,h+l.bottom);this.m_context.lineTo(h+l.left+u,h+l.bottom);this.m_context.lineTo(h+l.left,h+l.bottom-u);this.m_context.moveTo(h+_.left+g,h+_.bottom);this.m_context.lineTo(h+_.right-c,h+_.bottom);this.m_context.lineTo(h+_.right,h+_.bottom-c);this.m_context.lineTo(h+_.right,h+_.top+S);this.m_context.lineTo(h+_.right-S,h+_.top);this.m_context.lineTo(h+_.left+T,h+_.top);this.m_context.lineTo(h+_.left,h+_.top+T);this.m_context.lineTo(h+_.left,h+_.bottom-g);this.m_context.lineTo(h+_.left+g,h+_.bottom)}else if(t==1){this.m_context.moveTo(h+l.left,h+l.bottom-u);this.m_context.lineTo(h+l.left,h+l.top+f);this.m_context.lineTo(h+l.left+f,h+l.top);this.m_context.lineTo(h+l.right-C,h+l.top);this.m_context.lineTo(h+_.right-S,h+_.top);this.m_context.lineTo(h+_.left+T,h+_.top);this.m_context.lineTo(h+_.left,h+_.top+T);this.m_context.lineTo(h+_.left,h+_.bottom-g);this.m_context.lineTo(h+l.left,h+l.bottom-u)}else if(t==2){this.m_context.moveTo(h+l.right,h+l.top+C);this.m_context.lineTo(h+l.right,h+l.bottom-m);this.m_context.lineTo(h+l.right-m,h+l.bottom);this.m_context.lineTo(h+l.left+u,h+l.bottom);this.m_context.lineTo(h+_.left+g,h+_.bottom);this.m_context.lineTo(h+_.right-c,h+_.bottom);this.m_context.lineTo(h+_.right,h+_.bottom-c);this.m_context.lineTo(h+_.right,h+_.top+S);this.m_context.lineTo(h+l.right,h+l.top+C)}if(n!=4294967295)this.m_context.fill();if(s!=4294967295)this.m_context.stroke();this.m_context.closePath()}},FillSolidRect:function(t,e,i,n,s,r,a){if(t.IsEmpty())return;var o=0;var l;var _,h,f,C;var m=t.Clone();switch(arguments.length){case 7:break;case 6:a=0;break;case 5:a=0;r=1;break;case 4:a=0;r=1;s=1;break;case 3:a=0;r=1;s=1;n=i;break;case 2:a=0;r=1;s=1;n=i=4294967295;break;default:return}if(this.m_gradient)this.m_context.fillStyle=this.m_gradient;else this.m_context.fillStyle=CColor.Value(e,s);if(i==n){if(a==0){if(i==4294967295){this.m_context.fillRect(m.left,m.top,m.Width(),m.Height())}else{o=r/2;this.m_context.lineWidth=r;this.m_context.strokeStyle=CColor.Value(i,s);m.Deflate(o,o,o,o);this.m_context.fillStyle=CColor.Value(e,s);this.m_context.beginPath();this.m_context.moveTo(m.left,m.bottom);this.m_context.lineTo(m.left,m.top);this.m_context.lineTo(m.right,m.top);this.m_context.lineTo(m.right,m.bottom);this.m_context.lineTo(m.left-Math.floor(o),m.bottom);this.m_context.fill();this.m_context.stroke();this.m_context.closePath()}}else{if(i!=4294967295)m.Deflate(0,0,r,r);_=CUtil.FRAME0(a);h=CUtil.FRAME1(a);f=CUtil.FRAME2(a);C=CUtil.FRAME3(a);l=new ObArray;l.Add(new vx.point(m.left,m.bottom-C));l.Add(new vx.point(m.left,m.top+_));l.Add(new vx.point(m.left+_,m.top));l.Add(new vx.point(m.right-h,m.top));l.Add(new vx.point(m.right,m.top+h));l.Add(new vx.point(m.right,m.bottom-f));l.Add(new vx.point(m.right-f,m.bottom));l.Add(new vx.point(m.left+C,m.bottom));this.DrawPolygon(l,e,i,s,r);l.RemoveAll()}}else{if(a==0){if(i==4294967295){this.m_context.fillRect(m.left,m.top,m.Width(),m.Height())}else{o=r/2;this.m_context.lineWidth=r;this.m_context.strokeStyle=CColor.Value(i,s);m.Deflate(o,o,o,o);o=Math.floor(o);this.m_context.fillRect(m.left,m.top,m.Width(),m.Height());this.m_context.beginPath();this.m_context.moveTo(m.left,m.bottom);this.m_context.lineTo(m.left,m.top);this.m_context.lineTo(m.right+o,m.top);this.m_context.stroke();this.m_context.closePath();if(s==1)this.m_context.strokeStyle=CColor.Value(n);else this.m_context.strokeStyle=CColor.Value(n,s);this.m_context.beginPath();this.m_context.moveTo(m.right,m.top+o);this.m_context.lineTo(m.right,m.bottom);this.m_context.lineTo(m.left-o,m.bottom);this.m_context.stroke();this.m_context.closePath()}}else{if(n!=4294967295)m.Deflate(0,0,r,r);_=CUtil.FRAME0(a);h=CUtil.FRAME1(a);f=CUtil.FRAME2(a);C=CUtil.FRAME3(a);l=new ObArray;l.Add(new vx.point(m.left,m.bottom-C));l.Add(new vx.point(m.left,m.top+_));l.Add(new vx.point(m.left+_,m.top));l.Add(new vx.point(m.right-h,m.top));l.Add(new vx.point(m.right,m.top+h));l.Add(new vx.point(m.right,m.bottom-f));l.Add(new vx.point(m.right-f,m.bottom));l.Add(new vx.point(m.left+C,m.bottom));this.DrawPolygon(l,e,4294967295,s,r);if(i!=4294967295){l.RemoveAll();l.Add(new vx.point(m.left,m.bottom-C));l.Add(new vx.point(m.left,m.top+_));l.Add(new vx.point(m.left+_,m.top));l.Add(new vx.point(m.right-h,m.top));l.Add(new vx.point(m.right,m.top+h));this.DrawPolyline(l,i,s,r)}if(n!=4294967295){l.RemoveAll();l.Add(new vx.point(m.right,m.top+h));l.Add(new vx.point(m.right,m.bottom-f));l.Add(new vx.point(m.right-f,m.bottom));l.Add(new vx.point(m.left+C,m.bottom));l.Add(new vx.point(m.left,m.bottom-C));this.DrawPolyline(l,n,s,r)}l.RemoveAll()}}},FillGradientRect:function(t,e,i,n,s,r,a,o,l,_){switch(arguments.length){case 10:break;case 9:_=0;break;case 8:_=0;l=1;break;case 7:_=0;l=1;o=4294967295;break;case 6:_=0;l=1;o=a=4294967295;break;case 5:_=0;l=1;o=a=4294967295;r=1;break;case 4:_=0;l=1;o=a=4294967295;r=1;s=1;break;case 3:this.FillSolidRect(e,i);return;default:return}if(t==true)this.m_gradient=this.m_context.createLinearGradient(e.left,0,e.right,0);else this.m_gradient=this.m_context.createLinearGradient(0,e.top,0,e.bottom);this.m_gradient.addColorStop(0,CColor.Value(i,s));this.m_gradient.addColorStop(1,CColor.Value(n,r));this.FillSolidRect(e,i,a,o,s,l,_);this.m_gradient=null},FillSolidRoundRect:function(t,e,i,n,s){switch(arguments.length){case 5:break;case 4:s=1;break;case 3:s=1;n=-1;break;case 2:s=1;n=-1;i=4294967295;break;default:return}if(n==0){this.FillSolidRect(t,e,i,s,1,1,0);return}else if(n==-1){if(t.Width()>t.Height())n=t.Height()/2;else n=t.Width()/2}this.DrawRoundRect(t,n,e,i,s,1)},FillGradientRoundRect:function(t,e,i,n,s,r,a,o){switch(arguments.length){case 8:break;case 7:o=-1;break;case 6:o=-1;a=4294967295;break;case 5:o=-1;a=4294967295;r=1;break;case 4:o=-1;a=4294967295;r=1;s=1;break;default:return}if(t==true)this.m_gradient=this.m_context.createLinearGradient(e.left,0,e.right,0);else this.m_gradient=this.m_context.createLinearGradient(0,e.top,0,e.bottom);this.m_gradient.addColorStop(0,CColor.Value(i,s));this.m_gradient.addColorStop(1,CColor.Value(n,r));this.FillSolidRoundRect(e,i,a,o,s);this.m_gradient=null},DrawText:function(t,e,i,n,s,r,a){if(t==null)return;switch(arguments.length){case 7:break;case 6:a=2;break;case 5:a=2;r=4294967295;break;case 4:a=2;r=4294967295;s=0;break;case 3:a=2;r=4294967295;s=0;n=vx.Global.GetTagFont(0);break;default:return}if(n==null)n=vx.Global.GetTagFont(0);this.m_context.font=n.value;if(i&CDefine.DT_CALCRECT){e.right=e.left+this.m_context.measureText(t,0,0).width;e.bottom=e.top+n.height;if(r!=4294967295){e.right+=a;e.bottom+=a}return}var o=e.CenterPoint();if(i&CDefine.DT_RIGHT){o.x=e.right;this.m_context.textAlign="end"}else if(i&CDefine.DT_CENTER){this.m_context.textAlign="center"}else{o.x=e.left;this.m_context.textAlign="start"}if(i&CDefine.DT_VCENTER){this.m_context.textBaseline="middle"}else if(i&CDefine.DT_BOTTOM){o.y=e.bottom;this.m_context.textBaseline="bottom"}else{o.y=e.top;this.m_context.textBaseline="top"}this.Clip(e);if(r!=4294967295&&a>0){this.m_context.lineWidth=a;this.m_context.strokeStyle=CColor.Value(r);this.m_context.strokeText(t,o.x,o.y)}this.m_context.fillStyle=CColor.Value(s);this.m_context.fillText(t,o.x,o.y+1);this.Restore()},DrawTextBound:function(t,e,i,n,s,r){if(t==null)return;if(r==4294967295)return;if(n==null)n=vx.Global.GetTagFont(0);this.m_context.font=n.value;var a,o,l,_;a=this.m_context.measureText(t,0,0).width;o=n.height;if(i&CDefine.DT_CALCRECT){e.right=e.left+a;e.bottom=e.top+o;return}l=a;_=o;var h=vx.Global.GetTextTempBuffer(a,o);h.m_context.font=n.value;h.m_context.textAlign="start";h.m_context.textBaseline="top";h.m_context.fillStyle=CColor.Value(r);h.m_context.fillText(t,0,0);if(i&CDefine.DT_RIGHT){x=e.right-l}else if(i&CDefine.DT_CENTER){x=(e.left+e.right)/2-l/2}else{x=e.left}if(i&CDefine.DT_VCENTER){y=(e.top+e.bottom)/2-_/2}else if(i&CDefine.DT_BOTTOM){y=e.bottom-_}else{y=e.top}x=Math.round(x);y=Math.round(y);this.Clip(e);this.BltBlock(h,x,y,0,0,a,o);this.BltBlock(h,x+1,y,0,0,a,o);this.BltBlock(h,x+2,y,0,0,a,o);this.BltBlock(h,x,y+1,0,0,a,o);this.BltBlock(h,x+2,y+1,0,0,a,o);this.BltBlock(h,x,y+2,0,0,a,o);this.BltBlock(h,x+1,y+2,0,0,a,o);this.BltBlock(h,x+2,y+2,0,0,a,o);this.m_context.font=n.value;this.m_context.textAlign="start";this.m_context.textBaseline="top";this.m_context.fillStyle=CColor.Value(s);this.m_context.fillText(t,x+1,y+1);this.Restore()},DrawTagText:function(t,e,i,n,s,r,a){if(t==null||t.content==null)return;switch(arguments.length){case 7:break;case 6:a=2;break;case 5:a=2;r=4294967295;break;case 4:a=2;r=4294967295;s=0;break;case 3:a=2;r=4294967295;s=0;n=vx.Global.GetTagFont(0);break;default:return}if(!this.m_bUTB||i&CDefine.DT_CALCRECT){if(r==4294967295)this.DrawText(t.content,e,i,n,s,r,a);else this.DrawTextBound(t.content,e,i,n,s,r);return}var o,l,_,h;if(t.bmd==null){this.DrawText(t.content,e,CDefine.DT_CALCRECT,n,s,r,a);t.bmd=vx.buffer(null,e.Width(),e.Height());t.srect=new vx.rect(0,0,e.Width(),e.Height());if(r==4294967295)t.bmd.DrawText(t.content,t.srect,CDefine.DT_LEFT,n,s,r,a);else t.bmd.DrawTextBound(t.content,t.srect,CDefine.DT_LEFT,n,s,r)}_=t.bmd.m_context.canvas.width;h=t.bmd.m_context.canvas.height;if(i&CDefine.DT_RIGHT){o=e.right-_}else if(i&CDefine.DT_CENTER){o=(e.left+e.right)/2-_/2}else{o=e.left}if(i&CDefine.DT_VCENTER){l=(e.top+e.bottom)/2-h/2}else if(i&CDefine.DT_BOTTOM){Y=e.bottom-h}else{l=e.top}o=Math.round(o);l=Math.round(l);this.Clip(e);this.BltBlock(t.bmd,o,l,0,0,_,h);this.Restore()},DrawButton:function(t,e,i,n,s,r,a,o,l){var _,h=t.Clone();if(l==undefined)l=CDefine.BUTTON_DEPTH;switch(e){case 0:case 1:this.FillSolidRect(h,i,a,a,1,1,o);h.Deflate(1,1,1,1);_=h.Clone();_.Deflate(l,l,l,l);this.DrawFrameRect(1,h,_,s,4294967295,1,1,o);this.DrawFrameRect(2,h,_,r,4294967295,1,1,o);break;default:this.FillSolidRect(h,i,a,a,1,1,o);break}},DrawPillar:function(t,e,i,n,s,r,a,o){var l=t.Clone();this.FillSolidRect(l,i,s,r,1,1,o);if(n!=4294967295){if(s!=4294967295)l.Deflate(1,1,1,1);if(e)l.left=l.left+l.Width()/2;else l.top=l.top+l.Height()/2;this.FillSolidRect(l,n,4294967295,4294967295,1,1,o)}},DrawShape:function(t,e,i,n){switch(e){case CDefine.SHAPE_UPARROW:case CDefine.SHAPE_DOWNARROW:case CDefine.SHAPE_LEFTARROW:case CDefine.SHAPE_RIGHTARROW:case CDefine.SHAPE_CHECK:case CDefine.SHAPE_RADIO:n=i;break}return this._DrawShape(t,e,i,n)},_DrawShape:function(t,e,i,n){var s=Math.min(t.Width(),t.Height());if(s<8)return 0;var r,a,o=0;var l=null;var _=null;var h=t.CenterPoint();var o=0;switch(e){case CDefine.SHAPE_UPARROW:{s=Math.round(s/4);r=Math.ceil(s/2);l=new ObArray;l.Add(new vx.point(h.x,h.y-r));l.Add(new vx.point(h.x-s,h.y+s-r));l.Add(new vx.point(h.x+s,h.y+s-r));this.DrawPolygon(l,n,i,1,1);l.RemoveAll()}break;case CDefine.SHAPE_DOWNARROW:{s=Math.round(s/4);r=Math.ceil(s/2);l=new ObArray;l.Add(new vx.point(h.x,h.y+r));l.Add(new vx.point(h.x-s,h.y-s+r));l.Add(new vx.point(h.x+s,h.y-s+r));this.DrawPolygon(l,n,i,1,1);l.RemoveAll()}break;case CDefine.SHAPE_LEFTARROW:{s=Math.round(s/4);r=Math.ceil(s/2);l=new ObArray;l.Add(new vx.point(h.x-r,h.y));l.Add(new vx.point(h.x+s-r,h.y-s));l.Add(new vx.point(h.x+s-r,h.y+s));this.DrawPolygon(l,n,i,1,1);l.RemoveAll()}break;case CDefine.SHAPE_RIGHTARROW:{s=Math.ceil(s/4);r=Math.ceil(s/2);l=new ObArray;l.Add(new vx.point(h.x+r,h.y));l.Add(new vx.point(h.x-s+r,h.y-s));l.Add(new vx.point(h.x-s+r,h.y+s));this.DrawPolygon(l,n,i,1,1);l.RemoveAll()}break;case CDefine.SHAPE_CHECK:{l=new ObArray;if(s<=18)s=s/6;else s=s/5;h.x-=CUtil.IntR(s+s/2);h.y-=CUtil.IntR(s/2);l.Add(new vx.point(h.x,h.y));l.Add(new vx.point(h.x+s,h.y+s));l.Add(new vx.point(h.x+s*3,h.y-s));l.Add(new vx.point(h.x+s*3,h.y));l.Add(new vx.point(h.x+s,h.y+s*2));l.Add(new vx.point(h.x,h.y+s));this.DrawPolygon(l,n,i,1,1);l.RemoveAll()}break;case CDefine.SHAPE_CHECKBOUND:{s=CUtil.IntR((s-2)/2);t=CUtil.CRect(h.x-s,h.y-s,h.x+s,h.y+s);this.FillSolidRect(t,n,i,i);o=t.Width()}break;case CDefine.SHAPE_RADIO:{if(s<=18)s=CUtil.IntR(s/6);else s=CUtil.IntR(s/5);t=CUtil.CRect(h.x-s,h.y-s,h.x+s,h.y+s);this.DrawEllipse(t,n,i,1,1);o=t.Width()}break;case CDefine.SHAPE_RADIOBOUND:{s=CUtil.IntR((s-2)/2);t=CUtil.CRect(h.x-s,h.y-s,h.x+s,h.y+s);this.DrawEllipse(t,n,i,1,1);o=t.Width()}break;case CDefine.SHAPE_MINIMIZE:{if(s>=16)a=CUtil.IntR(s/6);else a=2;s=CUtil.IntR(s/4);t=CUtil.CRect(h.x-s,h.y+s-a/2,h.x+s,h.y+s-a/2+a);this.FillSolidRect(t,i)}break;case CDefine.SHAPE_MAXIMIZE:{s=CUtil.IntR(s/4);t=CUtil.CRect(h.x-s,h.y-s,h.x+s,h.y+s);this.FillSolidRect(t,i);t.Deflate(1,1,1,1);t.top++;this.FillSolidRect(t,n)}break;case CDefine.SHAPE_CLOSE:{if(s>=16)a=CUtil.IntR(s/8);else a=1;if(n==4294967295)s=CUtil.IntR(s/4);else s=CUtil.IntR(s/5);this.DrawLine(h.x-s,h.y-s,h.x+s,h.y+s,i,1,a);this.DrawLine(h.x+s,h.y-s,h.x-s,h.y+s,i,1,a)}break;case CDefine.SHAPE_RESTORE:{if(s>=16)a=CUtil.IntR(s/10);else a=1;s=CUtil.IntR(s/5);t=CUtil.CRect(h.x-s,h.y-s,h.x+s,h.y+s);t.Offset(a,-a);this.FillSolidRect(t,i);t.Deflate(1,1);t.top++;this.FillSolidRect(t,n);t=CUtil.CRect(h.x-s,h.y-s,h.x+s,h.y+s);t.Offset(-a,a);this.FillSolidRect(t,i);t.Deflate(1,1);t.top++;this.FillSolidRect(t,n,n,n)}break;case CDefine.SHAPE_MULTI:{s=Math.floor(s/3.5);var f=Math.floor(s/5);if(f<1)f=1;t=CUtil.CRect(h.x-s,h.y-s,h.x-f,h.y-f);this.FillSolidRect(t,i);t.Offset(s+f,0);this.FillSolidRect(t,i);t.Offset(0,s+f);this.FillSolidRect(t,i);t.Offset(-(s+f),0);this.FillSolidRect(t,i);o=Math.floor(s*3.5)}break}return o}});vx.nTimerTic=15;vx.nMaxUpdateBuf=100;vx.nPopupOrder=0;vx.logchat=null;vx.map=new Object;vx.Global=null;vx.bPressLButton=false;vx.bTouch=false;vx.bOverTouch=false;vx.bDebug=true;vx.bRecord=false;vx.bPlayRecord=false;vx.bFirstSoundPlay=false;vx.bUseDomPopup=false;vx.bPreventEvent=false;vx.ptLast=new vx.point;vx.ptGrapValue=new vx.point;vx.ptGrapAcc=new vx.point;vx.nGrap=0;vx.nGrapTime=0;vx.nGrapGap=0;vx.touchObj=null;vx.nMinGrap=2;vx.nDblclk=500;vx.aryRecord=null;vx.nRecordMsg=0;vx.nRecordX=0;vx.nRecordY=0;vx.nRecordTime=0;vx.playTimer=null;vx.nPlayIndex=0;vx.nPlayTick=50;var ptTmp=new vx.point;document.addEventListener("mousedown",function(t){vx.bPressLButton=true},false);document.addEventListener("mouseup",function(t){vx.bPressLButton=false},false);vx.skin=vx.Class.extend({init:function(t){this.m_name=t;vx.map[t]=this;this.m_global=new CGlobal;this.SetGlobal();this.m_screen=new vx.buffer(document.getElementById(t),0,0);if(vx.bUseDomPopup)document.owner=this;else this.m_screen.m_canvas.owner=this;this.m_screen.m_canvas.setAttribute("tabindex","0");this.m_buffer=null;this.m_screen.VX_Fill(CColor.RGB(0,0,0));this.m_bActive=false;this.m_uFlag=0;this.m_uFlag2=0;this.m_uFlagEx=0;this.m_uFlagEx2=0;this.m_aryStage=new ObArray;this.m_aryStack=new ObArray;this.m_curStage=null;this.m_titleStage=null;this.m_focusObj=null;this.m_captureObj=null;this.m_nCurTimeTick=0;this.m_nTickDblClk=0;this.m_queue=new ObArray;this.m_resMgr=new vx.resourcemgr;this.m_aryUpdate=new ObArray;for(var e=0;e<vx.nMaxUpdateBuf;e++){this.m_aryUpdate.Add(new vx.rect(0,0,0,0))}this.m_nUpdate=0;this.m_bUpdateAll=true;this.m_nUpdateTimer=0;this.m_holder=null;vxSound.Init();this.m_sndMgr=new vx.soundmgr(this)},toString:function(){return"(vx.skin)"},Delete:function(){this.m_holder=null;var t;var e=this.m_aryStage.length;for(var i=0;i<e;i++){t=this.m_aryStage.GetAt(i);if(t==null)continue;t.Delete()}this.m_aryStage.RemoveAll();this.m_aryStage=null;this.m_curStage=null;this.m_titleStage=null;if(this.m_screen){this.m_screen.Delete();this.m_screen=null}if(this.m_buffer){this.m_buffer.Delete();this.m_buffer=null}if(this.m_queue){this.m_queue.RemoveAll();this.m_queue=null}if(this.m_resMgr){this.m_resMgr.Delete();this.m_resMgr=null}this.m_global=null},IsFlag:function(t){return(this.m_uFlag&t)==t},IsFlag2:function(t){return(this.m_uFlag2&t)==t},IsFlagEx:function(t){return(this.m_uFlagEx&t)==t},IsFlagEx2:function(t){return(this.m_uFlagEx2&t)==t},OrFlag:function(t){return this.m_uFlag&t},OrFlag2:function(t){return this.m_uFlag2&t},OrFlagEx:function(t){return this.m_uFlagEx&t},OrFlagEx2:function(t){return this.m_uFlagEx2&t},ModifyFlag:function(t,e){this.m_uFlag|=t;this.m_uFlag&=~e},ModifyFlag2:function(t,e){this.m_uFlag2|=t;this.m_uFlag2&=~e},ModifyFlagEx:function(t,e){this.m_uFlagEx|=t;this.m_uFlagEx&=~e},ModifyFlagEx2:function(t,e){this.m_uFlagEx2|=t;this.m_uFlagEx2&=~e},GetCurrentStage:function(){return this.m_curStage},GetTitleStage:function(){return this.m_titleStage},SetGlobal:function(){vx.Global=this.m_global},Activate:function(t){if(t==undefined)t=true;if(this.m_bActive==t)return;if(t)this.m_screen.m_canvas.focus();else this.m_screen.m_canvas.blur()},initialize:function(){vx.trace("Skin.Initialize");var t=this.m_name;var e=document.getElementById(t);if(this.IsFlag(CFlags.VXSP_WINDOWRESIZE)){window.addEventListener("resize",function(){var e=vx.map[t];if(e){e.SetGlobal();e.Resize(window.innerWidth,window.innerHeight);e.ResizeStage()}},false);this.Resize(window.innerWidth,window.innerHeight);this.ResizeStage()}if(this.IsFlag(CFlags.VXSP_DOUBLEBUFFERING)){this.m_buffer=new vx.buffer(null,this.m_screen.m_canvas.width,this.m_screen.m_canvas.height);vx.trace("double canvas buffering...")}else{vx.trace("single canvas buffering...")}this.m_nCurTimeTick=Date.now();vx.Global.PrepareGlobal(this);CColor.InitColor();this.OnInitialize()},Resize:function(t,e){this.m_screen.SetSize(t,e);var i=CUtil.CRect(0,0,t,e);var n=i.Clone();var s=i.CenterPoint();var r,a,o=this.m_aryStack.length;for(a=0;a<o;a++){r=this.m_aryStack[a];if(r){i.left=s.x-Math.floor(r.m_width/2);i.top=s.y-Math.floor(r.m_height/2);i.right=i.left+r.m_width;i.bottom=i.top+r.m_height;r.MoveObject(i);if(r.m_modalback!=undefined&&r.m_modalback){r.m_modalback.MoveObject(n)}}}},OnInitialize:function(){vx.trace("Skin.OnInitialize");vx.Global.CreateGlobal();var t;if(vx.bUseDomPopup)t=document;else t=this.m_screen.m_canvas;t.addEventListener("blur",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return;if(this.owner.m_bActive)this.owner.OnActive(false)},false);t.addEventListener("focus",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return;if(!this.owner.m_bActive)this.owner.OnActive(true)},false);t.addEventListener("keydown",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return;var e=0;if(t.shiftKey==1)e|=CKeys.MK_SHIFT;if(t.ctrlKey==1)e|=CKeys.MK_CONTROL;if(vx.bDebug&&t.keyCode==192&&t.ctrlKey==1){this.owner.DoRecord(!vx.bRecord)}this.owner.m_curStage.StageMessageDispatch(CMessage.WM_KEYDOWN,0,0,e,t.keyCode)},false);t.addEventListener("keypress",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return;var e=0;if(t.shiftKey==1)e|=CKeys.MK_SHIFT;if(t.ctrlKey==1)e|=CKeys.MK_CONTROL;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_CHAR,0,0,e,t.keyCode)},false);t.addEventListener("keyup",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return;var e=0;if(t.shiftKey==1)e|=CKeys.MK_SHIFT;if(t.ctrlKey==1)e|=CKeys.MK_CONTROL;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_KEYUP,0,0,e,t.charCode)},false);t.addEventListener("mousedown",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bOverTouch||vx.bPlayRecord)return;var e=0;if("which"in t)e=t.which==3;else if("button"in t)e=t.button==2;if(e)return;var i=CKeys.MK_LBUTTON;if(t.shiftKey==1)i|=CKeys.MK_SHIFT;if(t.ctrlKey==1)i|=CKeys.MK_CONTROL;vx.nGrap=1;vx.nGrapTime=Date.now();vx.nGrapGap=0;vx.ptGrapValue.x=0;vx.ptGrapValue.y=0;vx.ptGrapAcc.x=0;vx.ptGrapAcc.y=0;ptTmp.x=t.clientX;ptTmp.y=t.clientY;this.owner.WindowToView(ptTmp);this.owner.m_curStage.StageMessageDispatch(CMessage.WM_LBUTTONDOWN,ptTmp.x,ptTmp.y,i,0);vx.ptLast.x=ptTmp.x;vx.ptLast.y=ptTmp.y},false);t.addEventListener("mousemove",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bOverTouch||vx.bPlayRecord)return;var e,i;var n=0;if(t.shiftKey==1)n|=CKeys.MK_SHIFT;if(t.ctrlKey==1)n|=CKeys.MK_CONTROL;ptTmp.x=t.clientX;ptTmp.y=t.clientY;this.owner.WindowToView(ptTmp);if(vx.bPressLButton)n|=CKeys.MK_LBUTTON;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_MOUSEMOVE,ptTmp.x,ptTmp.y,n,0);if(vx.nGrap>0){e=ptTmp.x-vx.ptLast.x;i=ptTmp.y-vx.ptLast.y;if(e*e+i*i>4)vx.nGrap++;if(vx.nGrap==vx.nMinGrap){this.owner.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODESTART,ptTmp.x,ptTmp.y,n,0)}else if(vx.nGrap>vx.nMinGrap){if(e*vx.ptGrapValue.x>0){if(Math.abs(e)>Math.abs(vx.ptGrapValue.x)){vx.ptGrapAcc.x++}else{if(vx.ptGrapAcc.x>0)vx.ptGrapAcc.x--}}else{vx.ptGrapAcc.x=0}if(i*vx.ptGrapValue.y>0){if(Math.abs(i)>Math.abs(vx.ptGrapValue.y)){vx.ptGrapAcc.y++}else{if(vx.ptGrapAcc.y>0)vx.ptGrapAcc.y--}}else{vx.ptGrapAcc.y=0}vx.ptGrapValue.x=e;vx.ptGrapValue.y=i;var s=Date.now();vx.nGrapGap=s-vx.nGrapTime;vx.nGrapTime=s;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODE,ptTmp.x,ptTmp.y,n,0)}vx.ptLast.x=ptTmp.x;vx.ptLast.y=ptTmp.y}},false);t.addEventListener("mouseup",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bOverTouch||vx.bPlayRecord)return;var e=0;if(t.shiftKey==1)e|=CKeys.MK_SHIFT;if(t.ctrlKey==1)e|=CKeys.MK_CONTROL;ptTmp.x=t.clientX;ptTmp.y=t.clientY;this.owner.WindowToView(ptTmp);this.owner.m_curStage.StageMessageDispatch(CMessage.WM_LBUTTONUP,ptTmp.x,ptTmp.y,e,0);if(vx.nGrap>vx.nMinGrap){if(Math.abs(vx.ptGrapValue.y)>5)vx.ptGrapAcc.y++;if(Math.abs(vx.ptGrapValue.x)>5)vx.ptGrapAcc.x++;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODEEND,ptTmp.x,ptTmp.y,e,0)}vx.nGrap=0;vx.ptLast.x=vx.ptLast.y=-1},false);t.addEventListener("mouseout",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return;var e=0;if(t.shiftKey==1)e|=CKeys.MK_SHIFT;if(t.ctrlKey==1)e|=CKeys.MK_CONTROL;ptTmp.x=t.clientX;ptTmp.y=t.clientY;this.owner.WindowToView(ptTmp);this.owner.m_curStage.StageMessageDispatch(CMessage.WM_MOUSELEAVE,ptTmp.x,ptTmp.y,e,0);if(vx.nGrap>vx.nMinGrap){if(Math.abs(vx.ptGrapValue.y)>5)vx.ptGrapAcc.y++;if(Math.abs(vx.ptGrapValue.x)>5)vx.ptGrapAcc.x++;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODEEND,ptTmp.x,ptTmp.y,e,0)}vx.nGrap=0;vx.ptLast.x=vx.ptLast.y=-1},false);t.addEventListener("mousewheel",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return;var e=0;if(t.shiftKey==1)e|=CKeys.MK_SHIFT;if(t.ctrlKey==1)e|=CKeys.MK_CONTROL;var i=0;if(!t){t=window.event}if(t.wheelDelta){i=t.wheelDelta/120;if(window.opera){i=-i}}else if(t.detail){i=-t.detail/3}if(i){this.owner.m_curStage.StageMessageDispatch(CMessage.WM_MOUSEWHEEL,vx.ptLast.x,vx.ptLast.y,e,i)}},false);t.addEventListener("dblclick",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return;var e=0;if(t.shiftKey==1)e|=CKeys.MK_SHIFT;if(t.ctrlKey==1)e|=CKeys.MK_CONTROL;ptTmp.x=t.clientX;ptTmp.y=t.clientY;this.owner.WindowToView(ptTmp);this.owner.m_curStage.StageMessageDispatch(CMessage.WM_LBUTTONDBLCLK,ptTmp.x,ptTmp.y,e,0);vx.ptLast.x=ptTmp.x;vx.ptLast.y=ptTmp.y},false);t.addEventListener("touchstart",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();var e=navigator.userAgent.match(/iPhone|iPad|iPod/i);if(e&&vxSound.IsPossible()&&!vx.bFirstSoundPlay){var i=vxSound.context.createBuffer(1,1,22050);var n=vxSound.context.createBufferSource();n.buffer=i;n.connect(vxSound.context.destination);n.noteOn(0);setTimeout(function(){if(n.playbackState===n.PLAYING_STATE||n.playbackState===n.FINISHED_STATE)vx.bFirstSoundPlay=true},0)}vx.bTouch=vx.bOverTouch=true;if(vx.bPlayRecord){t.preventDefault();return}var s=CKeys.MK_LBUTTON;vx.nGrap=1;vx.nGrapTime=Date.now();vx.nGrapGap=0;vx.ptGrapValue.x=0;vx.ptGrapValue.y=0;vx.ptGrapAcc.x=0;vx.ptGrapAcc.y=0;ptTmp.x=t.touches[0].clientX;ptTmp.y=t.touches[0].clientY;this.owner.WindowToView(ptTmp);this.owner.m_curStage.StageMessageDispatch(CMessage.WM_LBUTTONDOWN,ptTmp.x,ptTmp.y,CKeys.MK_LBUTTON,0);vx.ptLast.x=ptTmp.x;vx.ptLast.y=ptTmp.y;t.preventDefault()},false);t.addEventListener("touchmove",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord){t.preventDefault();return}ptTmp.x=t.touches[0].clientX;ptTmp.y=t.touches[0].clientY;this.owner.WindowToView(ptTmp);this.owner.m_curStage.StageMessageDispatch(CMessage.WM_MOUSEMOVE,ptTmp.x,ptTmp.y,CKeys.MK_LBUTTON,0);var e,i;if(vx.nGrap>0){e=ptTmp.x-vx.ptLast.x;i=ptTmp.y-vx.ptLast.y;if(e*e+i*i>9)vx.nGrap++;if(vx.nGrap==vx.nMinGrap){this.owner.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODESTART,ptTmp.x,ptTmp.y,CKeys.MK_LBUTTON,0)}else if(vx.nGrap>vx.nMinGrap){e=ptTmp.x-vx.ptLast.x;i=ptTmp.y-vx.ptLast.y;if(e*vx.ptGrapValue.x>0){if(Math.abs(e)>Math.abs(vx.ptGrapValue.x)){vx.ptGrapAcc.x++}else{if(vx.ptGrapAcc.x>0)vx.ptGrapAcc.x--}}else{vx.ptGrapAcc.x=0}if(i*vx.ptGrapValue.y>0){if(Math.abs(i)>Math.abs(vx.ptGrapValue.y)){vx.ptGrapAcc.y++}else{if(vx.ptGrapAcc.y>0)vx.ptGrapAcc.y--}}else{vx.ptGrapAcc.y=0}vx.ptGrapValue.x=e;vx.ptGrapValue.y=i;var n=Date.now();vx.nGrapGap=n-vx.nGrapTime;vx.nGrapTime=n;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODE,ptTmp.x,ptTmp.y,CKeys.MK_LBUTTON,0)}}vx.ptLast.x=ptTmp.x;vx.ptLast.y=ptTmp.y;t.preventDefault()},false);t.addEventListener("touchend",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return true;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_LBUTTONUP,vx.ptLast.x,vx.ptLast.y,0,0);if(vx.nGrap>vx.nMinGrap){if(Math.abs(vx.ptGrapValue.y)>5)vx.ptGrapAcc.y++;if(Math.abs(vx.ptGrapValue.x)>5)vx.ptGrapAcc.x++;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODEEND,vx.ptLast.x,vx.ptLast.y,0,0)}vx.nGrap=0;this.owner.ProcessDoubleClick(vx.ptLast.x,vx.ptLast.y,0);vx.ptLast.x=vx.ptLast.y=-1;return true},false);t.addEventListener("touchleave",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return true;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_MOUSELEAVE,vx.ptLast.x,vx.ptLast.y,0,0);if(vx.nGrap>vx.nMinGrap){if(Math.abs(vx.ptGrapValue.y)>5)vx.ptGrapAcc.y++;if(Math.abs(vx.ptGrapValue.x)>5)vx.ptGrapAcc.x++;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODEEND,vx.ptLast.x,vx.ptLast.y,0,0)}vx.nGrap=0;vx.ptLast.x=vx.ptLast.y=-1;return true},false);t.addEventListener("touchcancel",function(t){if(!this.owner.m_curStage)return;this.owner.SetGlobal();if(vx.bPlayRecord)return true;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_CANCELMODE,vx.ptLast.x,vx.ptLast.y,0,0);if(vx.nGrap>vx.nMinGrap){if(Math.abs(vx.ptGrapValue.y)>5)vx.ptGrapAcc.y++;if(Math.abs(vx.ptGrapValue.x)>5)vx.ptGrapAcc.x++;this.owner.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODEEND,vx.ptLast.x,vx.ptLast.y,0,0)}vx.nGrap=0;vx.ptLast.x=vx.ptLast.y=-1;return true},false);var e=this;var i=this.getHiddenProp();var n=i.replace(/[H|h]idden/,"")+"visibilitychange";(function(t){document.addEventListener(n,function(e){var i=!e.currentTarget.hidden;t.m_sndMgr.OnPageVisible(i);t.m_curStage.StageMessageDispatch(CMessage.WM_PAGEVISIBLE,i,0,0,0)},false)})(e);(function(t){document.addEventListener("contextmenu",function(e){e.preventDefault();var i=CKeys.MK_RBUTTON;if(e.shiftKey==1)i|=CKeys.MK_SHIFT;if(e.ctrlKey==1)i|=CKeys.MK_CONTROL;ptTmp.x=e.clientX;ptTmp.y=e.clientY;t.WindowToView(ptTmp);t.m_curStage.StageMessageDispatch(CMessage.WM_RBUTTONDOWN,ptTmp.x,ptTmp.y,i,0)},false)})(e);var s=this;setInterval(function(){s.SetGlobal();s.OnEnterFrame()},vx.nTimerTic);if(this.m_titleStage==null)this.m_titleStage=new vx.stage;this.m_titleStage.Create(this,"TitleStage",CFlags.STAGEST_ENABLED|CFlags.STAGEST_SHOW|CFlags.STAGEST_SUBSTAGE,this.m_curStage);this.Activate()},getHiddenProp:function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++){if(t[e]+"Hidden"in document)return t[e]+"Hidden"}return null},ProcessDoubleClick:function(t,e,i){var n=false;if(this.m_nCurTimeTick-this.m_nTickDblClk<vx.nDblclk){this.m_curStage.StageMessageDispatch(CMessage.WM_LBUTTONDBLCLK,t,e,i,0);n=true}this.m_nTickDblClk=this.m_nCurTimeTick;return n},OnNotifyServer:function(t,e){},OnNotifyQueue:function(){var t;while(1){t=this.m_queue.RemoveHead();if(t){switch(t.nType){case 1:{var e=t.receiver;if(e)e.EventSync(t.nCmd,t.wparam,t.lparam,t.sender)}break;case 0:{var i=t.receiver;if(i)i.EventSync(t.nCmd,t.wparam,t.lparam,t.sender)}break;case 2:{OnNotifyServer(t.wparam,t.lparam)}break}t.Delete();t=null}else break}},OnEnterFrame:function(){this.OnNotifyQueue();this.OnDeleteStageCleanup();var t,e=this.m_screen;if(this.m_buffer)t=this.m_buffer;else t=e;var i=this.m_curStage;var n=this.m_nCurTimeTick;this.m_nCurTimeTick=Date.now();if(i){var s,r;var a=this.m_aryUpdate;var o,l,_=this.m_nUpdate;if(_>0||this.m_bUpdateAll)r=true;else r=false;if(r||this.m_nUpdateTimer>0){l=i.StagePrepare()}if(r){if(this.m_bUpdateAll){_=0}else{for(o=0;o<_;o++){i.StageToView(a[o])}t.ClipArray(a,_)}i.StageDraw(t);if(e!=t){if(this.m_bUpdateAll){e.Blt(t,0,0)}else{for(o=0;o<_;o++){s=a[o];e.BltBlock(t,s.left,s.top,s.left,s.top,s.Width(),s.Height())}t.Restore()}}else{if(!this.m_bUpdateAll)t.Restore()}}if(vx.nMaxUpdateBuf==0)this.m_bUpdateAll=true;else this.m_bUpdateAll=false;this.m_nUpdate=0;i.StageTimer(this.m_nCurTimeTick-n)}},OnActive:function(t){if(t){this.m_bActive=true}else{this.m_bActive=false;this.SetCaptureObject(null);this.m_curStage.StageMessageDispatch(CMessage.WM_CANCELMODE,0,0,0,0)}},SetFocusObject:function(t){vx.touchObj=t;if(t==this.m_focusObj)return;var e=this.m_focusObj;if(t){var i=t;if(t.IsFlag(CFlags.STATUS_NOFOCUS)||!t.IsFlag(CFlags.STATUS_ENABLED)){var n=t.m_parent;while(n){i=n;if(n.IsFlag(CFlags.STATUS_NOFOCUS)||!t.IsFlag(CFlags.STATUS_ENABLED)){n=n.m_parent}else break}t=n;if(i&&i.IsFlag(CFlags.STATUS_POPUP|CFlags.STATUS_NOFOCUS))return;if(!t)return}}this.m_focusObj=t;if(e&&e!=this.m_focusObj)e.FocusClear();if(this.m_focusObj){this.m_focusObj.Focus()}},GetFocusObject:function(){return this.m_focusObj},SetCaptureObject:function(t){if(t==null){this.ReleaseCaptureObject();return}this.m_captureObj=t;vx.touchObj=t;this.ModifyFlag2(CFlags.VXSP2_CAPTUREMODE,0);this.m_captureObj.ModifyFlag2(CFlags.STATUS2_CAPTURE,0)},GetCaptureObject:function(){return this.m_captureObj},ReleaseCaptureObject:function(){vx.touchObj=null;if(this.m_captureObj){this.ModifyFlag2(0,CFlags.VXSP2_CAPTUREMODE);var t=this.m_captureObj;this.m_captureObj=null;if(t){t.ModifyFlag2(0,CFlags.STATUS2_CAPTURE);t.OnReleaseCapture()}}},AddStage:function(t){this.m_aryStage.Add(t)},ResizeStage:function(){if(this.m_curStage)this.m_curStage.StageMessageDispatch(CMessage.WM_CANCELMODE,0,0,0,0);var t=this.GetViewRect();var e;for(var i=0;i<this.m_aryStage.length;i++){e=this.m_aryStage.GetAt(i);if(e)e.SetStageRect(t)}if(this.m_curStage)this.m_curStage.StageMessageDispatch(CMessage.WM_RESIZESTAGE,0,0,0,0)},DeleteStage:function(t){var e;for(var i=0;i<this.m_aryStage.length;i++){e=this.m_aryStage.GetAt(i);if(e==null)continue;if(e.m_name==t){e.Close();if(this.m_curStage==e)this.m_curStage=null;if(this.m_titleStage==e)this.m_titleStage=null;e=null;break}}},FindStage:function(t){var e;for(var i=0;i<this.m_aryStage.length;i++){e=this.m_aryStage.GetAt(i);if(e==null)continue;if(e.m_name==t)return e}return null},SelectStage:function(t){var e;for(var i=0;i<this.m_aryStage.length;i++){e=this.m_aryStage.GetAt(i);if(e==null)continue;if(e.m_name==t){if(e.OrFlag(CFlags.STAGEST_SUBSTAGE|CFlags.STAGEST_BACKSTAGE|CFlags.STAGEST_FRONTSTAGE))return false;if(this.m_curStage){this.m_curStage.ModifyFlag(0,CFlags.STAGEST_SELECT);e.AttachSubStage(this.m_curStage.DetachSubStage());this.m_curStage.OnSelect(false)}else{e.AttachSubStage(this.GetTitleStage())}this.m_curStage=e;this.m_curStage.ModifyFlag(CFlags.STAGEST_SELECT,0);if(this.m_titleStage){this.m_curStage.m_subStage=this.m_titleStage}this.m_curStage.OnSelect(true);this.m_curStage.Invalidate();return true}}return false},OnDeleteStageCleanup:function(){var t;for(var e=this.m_aryStage.length-1;e>=0;e--){t=this.m_aryStage.GetAt(e);if(t==null)continue;if(t.IsFlag(CFlags.STAGEST_DESTROY)){t.Delete();t=null;this.m_aryStage.RemoveAt(e)}}},GetViewRect:function(){var t=this.m_screen.GetSize();return new vx.rect(0,0,t.x,t.y)},GetViewSize:function(){return this.m_screen.GetSize()},WindowToView:function(t){var e=this.m_screen.m_canvas;var i=e.getBoundingClientRect();t.Offset(-i.left*(e.width/i.width),-i.top*(e.height/i.height))},ViewToWindow:function(t){var e=this.m_screen.m_canvas;var i=e.getBoundingClientRect();t.Offset(i.left*(e.width/i.width),i.top*(e.height/i.height))},AddUpdate:function(t){if(this.m_curStage==null)return;if(this.m_bUpdateAll)return;var e=this.m_curStage.m_rcStage.CIV(t);if(e==0){this.m_bUpdateAll=true;return}else if(e<0){return}var i=this.m_aryUpdate;var n,s=this.m_nUpdate;for(n=0;n<s;n++){if(!i[n].CAU(t))return}if(s+1<vx.nMaxUpdateBuf){i[s].Set(t);this.m_nUpdate++}else{this.m_bUpdateAll=true}},AddModalStack:function(t){var e=this.m_aryStack.GetTail();if(e)e.ChangeModalStack(t);this.m_aryStack.RemoveObject(t);t.ModifyFlag(CFlags.STATUS_MODAL,0);this.m_aryStack.AddTail(t)},RemoveModalStack:function(t){if(t==null)return;this.m_aryStack.RemoveObject(t);t.ModifyFlag(0,CFlags.STATUS_MODAL)},GetModalStack:function(){return this.m_aryStack.GetTail()},SetCursor:function(t){},InputQueue:function(t,e,i,n,s,r){var a=new vx.cmd_event;if(t)a.nType=1;else a.nType=0;a.nCmd=e;a.wparam=i;a.lparam=n;a.sender=s;a.receiver=r;this.m_queue.Add(a)},FindImage:function(t){if(this.m_resMgr){return this.m_resMgr.FindImage(t)}return null},FindXML:function(t){if(this.m_resMgr){return this.m_resMgr.FindXML(t)}return null},FindText:function(t){return this.m_resMgr.FindText(t)},FindSound:function(t){return this.m_resMgr.FindSound(t)},FindObject:function(t,e){if(arguments.length<2)e=false;if(this.m_titleStage){var i=this.m_titleStage.FindObject(t,e);if(i)return i}if(this.m_curStage){return this.m_curStage.FindObject(t,e)}return null},FindDropEnableObject:function(t,e){var i;if(this.m_curStage==null)return null;if(this.m_curStage.m_subStage)i=this.m_curStage.m_subStage.FindDropEnableObject(t,e);if(!i)i=this.m_curStage.FindDropEnableObject(t,e);return i},LoadResource:function(t){console.log("*******",t);var e=new vx.packloader(this,t);this.m_resMgr.AddPack(e)},OnDownloadResource:function(t,e){},OnDownloadProgress:function(t,e,i,n,s){},BuildResourceText:function(t){this.m_resMgr.BuildResourceText(t)},LoadMenu:function(t){if(this.m_resMgr==null)return null;return this.m_resMgr.LoadMenu(t)},NewMessageBox:function(t,e,i,n){var s=new vx.messagebox(t,e,i,n);return s},MessageBoxTag:function(t,e,i,n,s,r,a,o){var l;if(i==undefined)i=0;if(i&CDefine.MB_NOTITLESTAGE)l=this.m_curStage;else l=this.m_titleStage;if(l)return l.MessageBoxTag(t,e,i,n,s,r,a,o);else return null},MessageBox:function(t,e,i,n,s,r,a,o){var l;if(i==undefined)i=0;if(i&CDefine.MB_NOTITLESTAGE)l=this.m_curStage;else l=this.m_titleStage;if(l)return l.MessageBox(t,e,i,n,s,r,a,o);else return null},ShowHoldIndicator:function(t,e,i,n){if(t==undefined)t=0;if(e==undefined)e=0;var s=null;if(this.m_titleStage)s=this.m_titleStage;else s=this.GetCurrentStage();if(s==null)return;if(this.m_holder){this.m_holder.StopHolder();this.m_holder=null}var r=vx.Global.g_bUseModalBack;vx.Global.g_bUseModalBack=false;this.m_holder=new vx.holder;this.m_holder.StartHolder(s,t,e,i,n);vx.Global.g_bUseModalBack=r;return this.m_holder},StopHoldIndicator:function(){if(this.m_holder){this.m_holder.StopHolder();this.m_holder=null}},OnShowCursor:function(t,e){},DoRecord:function(t){var e,i;vx.bRecord=t;if(t){if(vx.aryRecord){i=vx.aryRecord.length;for(var e=0;e<i;e++){vx.aryRecord[e]=null}vx.aryRecord.splice(0,i)}else{vx.aryRecord=new Array}vx.nRecordTime=Date.now();vx.nRecordMsg=0}else{if(vx.aryRecord){var n,s="";i=vx.aryRecord.length;for(var e=0;e<i;e++){n=vx.aryRecord[e];s+=n.msg+","+n.x+","+n.y+","+n.flag+","+n.key+","+n.time+"|"}console.log(s.length,s)}}},LoadRecord:function(t){var e,i;if(vx.aryRecord){i=vx.aryRecord.length;for(e=0;e<i;e++){vx.aryRecord[e]=null}vx.aryRecord.splice(0,i)}else{vx.aryRecord=new Array}var n,s,r;var a,o=t.length;n={};r="";a=0;for(e=0;e<o;e++){s=t.charAt(e);if(s=="|"||s==","){switch(a){case 0:n.msg=Number(r);break;case 1:n.x=Number(r);break;case 2:n.y=Number(r);break;case 3:n.flag=Number(r);break;case 4:n.key=Number(r);break;case 5:n.time=Number(r);break;case 6:n.exp=r;break}r="";a++;if(s=="|"){vx.aryRecord.push(n);n={};a=0}}else{r+=s}}},PlayRecord:function(t){if(t){if(vx.aryRecord&&vx.aryRecord.length>0){var e=this;vx.nPlayIndex=0;vx.nRecordTime=vx.aryRecord[0].time;vx.playTimer=setInterval(function(){e.SetGlobal();e.OnRecordPlay()},vx.nPlayTick);vx.bPlayRecord=true;this.OnShowCursor(0,vx.aryRecord[0])}}else{if(vx.playTimer){clearInterval(vx.playTimer);vx.playTimer=null;vx.bPlayRecord=false;this.OnShowCursor(-1,null)}}},OnRecordPlay:function(){if(vx.nRecordTime>vx.nPlayTick){vx.nRecordTime-=vx.nPlayTick;return}vx.nPlayIndex++;if(vx.nPlayIndex>=vx.aryRecord.length-1){this.PlayRecord(false);return}var t=vx.aryRecord[vx.nPlayIndex];vx.nRecordTime=t.time;console.log(t.msg.toString(16),t.x,t.y,t.time,vx.nPlayIndex,vx.aryRecord.length);if(t.msg==CMessage.WM_LBUTTONDOWN){vx.nGrap=1;vx.nGrapTime=Date.now();vx.nGrapGap=0;vx.ptGrapValue.x=0;vx.ptGrapValue.y=0;vx.ptGrapAcc.x=0;vx.ptGrapAcc.y=0;this.m_curStage.StageMessageDispatch(t.msg,t.x,t.y,t.flag,t.key);vx.ptLast.x=t.x;vx.ptLast.y=t.y}else if(t.msg==CMessage.WM_MOUSEMOVE){this.m_curStage.StageMessageDispatch(t.msg,t.x,t.y,t.flag,0);if(vx.nGrap>0){dx=t.x-vx.ptLast.x;dy=t.y-vx.ptLast.y;if(dx*dx+dy*dy>4)vx.nGrap++;this.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODESTART,t.x,t.y,t.flag,0);if(dx*vx.ptGrapValue.x>0){if(Math.abs(dx)>Math.abs(vx.ptGrapValue.x)){vx.ptGrapAcc.x++}else{if(vx.ptGrapAcc.x>0)vx.ptGrapAcc.x--}}else{vx.ptGrapAcc.x=0}if(dy*vx.ptGrapValue.y>0){if(Math.abs(dy)>Math.abs(vx.ptGrapValue.y)){vx.ptGrapAcc.y++}else{if(vx.ptGrapAcc.y>0)vx.ptGrapAcc.y--}}else{vx.ptGrapAcc.y=0}vx.ptGrapValue.x=dx;vx.ptGrapValue.y=dy;var e=Date.now();vx.nGrapGap=e-vx.nGrapTime;vx.nGrapTime=e;this.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODE,t.x,t.y,t.flag,0);vx.ptLast.x=t.x;vx.ptLast.y=t.y}}else if(t.msg==CMessage.WM_LBUTTONUP||t.msg==CMessage.WM_MOUSELEAVE){this.m_curStage.StageMessageDispatch(t.msg,t.x,t.y,t.flag,0);if(Math.abs(vx.ptGrapValue.y)>5)vx.ptGrapAcc.y++;if(Math.abs(vx.ptGrapValue.x)>5)vx.ptGrapAcc.x++;this.m_curStage.StageMessageDispatch(CMessage.WM_GRAPMODEEND,t.x,t.y,t.flag,0);vx.nGrap=0;vx.ptLast.x=vx.ptLast.y=-1}else if(t.msg==CMessage.WM_LBUTTONDBLCLK){this.m_curStage.StageMessageDispatch(t.msg,t.x,t.y,t.flag,t.key);vx.ptLast.x=t.x;vx.ptLast.y=t.y}else{this.m_curStage.StageMessageDispatch(t.msg,t.x,t.y,t.flag,t.key)}this.OnShowCursor(1,t)},ConnectServer:function(t,e,i){if(i==undefined)i=this;var n=new vx.socket(i);n.Open(t,e);return n},OnConnect:function(t,e){console.log("vxConnect OK! - ["+e.currentTarget.url+"]")},OnClose:function(t,e){console.log("vxSocket Closed - ["+e.currentTarget.url+"]")},OnReceive:function(t,e){console.log("vxReceive Data! - ["+e.currentTarget.url+"]")},OnError:function(t,e){console.log("vxSocket Error - ["+e.currentTarget.url+"]")},PlayBGM:function(t,e,i,n){this.m_sndMgr.PlayBGM(t,e,i,n)},StopBGM:function(){this.m_sndMgr.StopBGM()},SetVolumeBGM:function(t){this.m_sndMgr.SetVolumeBGM(t)},PlaySound:function(t,e,i){this.m_sndMgr.PlaySound(t,e,i)},StopSound:function(){this.m_sndMgr.StopSound()},SetVolumeSound:function(t){this.m_sndMgr.SetVolumeSound(t)}});vx.resourcemgr=vx.Class.extend({init:function(){this.m_aryPack=new ObArray;this.m_mapText=new Map;this.m_menu=null;this.m_dialog=null},Delete:function(){var t,e,i=this.m_aryPack.length;for(e=0;e<i;e++){t=this.m_aryPack.GetAt(e);if(t)t.Delete()}this.m_aryPack.RemoveAll();this.m_aryPack=null;if(this.m_mapText){this.clear();m_mapText=null}var n,s,e,i;if(this.m_menu&&this.m_menu.m_list){n=this.m_menu.m_list;i=n.length;for(e=0;e<i;e++){s=n.GetAt(e);if(s)s.Delete()}n.RemoveAll();this.m_menu.m_list=null;this.m_menu=null}if(this.m_dialog&&this.m_dialog.m_list){n=this.m_dialog.m_list;i=n.length;for(e=0;e<i;e++){s=n.GetAt(e);if(s)s.Delete()}n.RemoveAll();this.m_dialog.m_list=null;this.m_dialog=null}},AddMenuList:function(t){this.m_menu=t},AddDialogList:function(t){this.m_dialog=t},LoadMenu:function(t){if(this.m_menu&&this.m_menu.m_list){var e=this.m_menu.m_list;var i,n,s=e.length;for(n=0;n<s;n++){i=e.GetAt(n);if(i&&i.menu_id==t)return i}}return null},LoadDialog:function(t){if(this.m_dialog&&this.m_dialog.m_list){var e=this.m_dialog.m_list;var i,n,s=e.length;for(n=0;n<s;n++){i=e.GetAt(n);if(i&&i.menu_id==t)return i}}return null},AddPack:function(t){this.m_aryPack.Add(t)},RemovePack:function(t){var e,i,n=this.m_aryPack.length;for(i=0;i<n;i++){e=this.m_aryPack.GetAt(i);if(e&&e.m_packName==t){e.Delete();this.m_aryPack.RemoveAt(i);return}}},FindImage:function(t){var e,i,n,s=this.m_aryPack.length;for(n=0;n<s;n++){i=this.m_aryPack.GetAt(n);if(!i)continue;e=i.m_mapImage.get(t);if(e)return e}return null},FindText:function(t){var e=this.m_mapText.get(t);if(e==undefined||e==null)return t;else return e},FindXML:function(t){var e,i,n,s=this.m_aryPack.length;for(n=0;n<s;n++){i=this.m_aryPack.GetAt(n);if(!i)continue;e=i.m_mapXML.get(t);if(e)return e.responseXML}return null},BuildResourceText:function(t){var e,i,n,s,r,a,o,l,_,h;h=this.FindXML(t);r=h.getElementsByTagName("xlang");n=r.length;for(e=0;e<n;e++){a=r[e];if(a.nodeType!=1)continue;s=a.childNodes.length;l=_=null;for(i=0;i<s;i++){o=a.childNodes[i];if(o.nodeType!=1)continue;if(o.nodeName=="xkey"){l=CUtil.getTextContent(o)}else if(o.nodeName=="xtext"){_=CUtil.getTextContent(o);if(l){this.m_mapText.put(l,_);break}}}}},FindSound:function(t){var e,i,n,s=this.m_aryPack.length;for(n=0;n<s;n++){i=this.m_aryPack.GetAt(n);if(!i)continue;e=i.m_mapSound.get(t);if(e)return e}return null},FindCurses:function(t){var e,i,n,s=this.m_aryPack.length;for(n=0;n<s;n++){i=this.m_aryPack.GetAt(n);if(!i)continue;e=i.m_textCurseMap;if(e&&e.GetSize()>0)return e}return null}});vx.packloader=vx.Class.extend({init:function(t,e){this.m_ownerSkin=t;this.m_packName=null;this.m_resName=null;this.m_preLoader=null;this.m_xhrConfig=null;this.m_mapImage=new Map;this.m_mapSound=new Map;this.m_mapVideo=new Map;this.m_mapXML=new Map;this.m_textCurseMap=new ObArray;var i=CUtil.GetFileName(e);var n=CUtil.ReverseFind(i,"?");if(n==-1)this.m_packName=i;else this.m_packName=CUtil.Left(i,n);var s={};s.owner=this;this.m_preLoader=new PxLoader(s);this.m_xhrConfig=this.m_preLoader.addXML(e);this.m_preLoader.addCompletionListener(function(e){t.SetGlobal();var i=e.eventOwner;var n=e.loaded;if(e.error||e.timeout)n=false;if(i.m_packName=="curses_kr.xml"||i.m_packName=="curses_jp.xml"||i.m_packName=="curses_ch.xml"||i.m_packName=="curses_tai.xml"||i.m_packName=="curses_en.xml"){i.OnDownloadCurses(n,e)}else i.OnDownloadConfig(n)});this.m_preLoader.start()},Delete:function(){this.m_ownerSkin=null;this.m_packName=null;this.m_mapImage.clear();this.m_mapImage=null;this.m_mapSound.clear();this.m_mapSound=null;this.m_mapVideo.clear();this.m_mapVideo=null;this.m_mapXML.clear();this.m_mapXML=null;if(this.m_preLoader){this.m_preLoader.clear();this.m_preLoader=null}if(this.m_resLoader){this.m_resLoader.clear();this.m_resLoader=null}this.m_xhrConfig=null},toString:function(){return"vx.packloader"},OnDownloadConfig:function(t){if(!t){this.m_ownerSkin.OnDownloadResource(this.m_packName,false);return}var e={};e.owner=this;this.m_resLoader=new PxLoader(e);var i,n;var s=this.m_xhrConfig.responseXML;var r,a,o,l,_,h,f,C,m;_=s.getElementsByTagName("ximage");o=_.length;for(r=0;r<o;r++){h=_[r];if(h.nodeType!=1)continue;l=h.childNodes.length;C=null;for(a=0;a<l;a++){f=h.childNodes[a];if(f.nodeType!=1)continue;if(f.nodeName=="xname"){m=CUtil.getTextContent(f);m=CUtil.GetFileName(m);m=RESOURCE_URL+m;C=new vx.image(this.m_resLoader.addImage(m));i=CUtil.GetFileName(m);n=CUtil.ReverseFind(i,"?");if(n!=-1)i=CUtil.Left(i,n);this.m_mapImage.put(i,C)}else if(f.nodeName=="xframe"){if(C)C.SetFrameString(CUtil.getTextContent(f))}else if(f.nodeName=="xresize"){if(C)C.SetResizeString(CUtil.getTextContent(f))}else if(f.nodeName=="xflag"){if(C)C.SetFlagString(CUtil.getTextContent(f))}}}_=s.getElementsByTagName("xsound");o=_.length;var u=CUtil.GetSoundExt();var T="";for(r=0;r<o;r++){h=_[r];if(h.nodeType!=1)continue;l=h.childNodes.length;for(a=0;a<l;a++){f=h.childNodes[a];if(f.nodeType!=1)continue;f=h.childNodes[a];if(f.nodeType!=1)continue;if(f.nodeName=="xname"){m=CUtil.getTextContent(f);m=CUtil.GetFileName(m);m=RESOURCE_URL+m;i=CUtil.GetFileName(m);n=CUtil.ReverseFind(i,"?");if(n!=-1)i=CUtil.Left(i,n);T=CUtil.GetFileTitle(i);m=CUtil.Replace(m,"mp3",u);this.m_mapSound.put(T,this.m_resLoader.addSound(T,m))}}}_=s.getElementsByTagName("xvideo");o=_.length;for(r=0;r<o;r++){h=_[r];if(h.nodeType!=1)continue;l=h.childNodes.length;for(a=0;a<l;a++){f=h.childNodes[a];if(f.nodeType!=1)continue;if(f.nodeName=="xname"){m=CUtil.getTextContent(f);m=CUtil.GetFileName(m);m=RESOURCE_URL+m;i=CUtil.GetFileName(m);n=CUtil.ReverseFind(i,"?");if(n!=-1)i=CUtil.Left(i,n);this.m_mapVideo.put(i,this.m_resLoader.addVideo(m))}}}_=s.getElementsByTagName("xtext");o=_.length;for(r=0;r<o;r++){h=_[r];if(h.nodeType!=1)continue;l=h.childNodes.length;for(a=0;a<l;a++){f=h.childNodes[a];if(f.nodeType!=1)continue;if(f.nodeName=="xname"){m=CUtil.getTextContent(f);m=CUtil.GetFileName(m);m=RESOURCE_URL+m;i=CUtil.GetFileName(m);n=CUtil.ReverseFind(i,"?");if(n!=-1)i=CUtil.Left(i,n);this.m_mapXML.put(i,this.m_resLoader.addXML(m))}}}var S=this.m_ownerSkin;this.m_resLoader.addProgressListener(function(t){S.SetGlobal();var e=t.eventOwner;e.OnDownloadProgress(t.resource.getName(),t.loaded,t.totalCount,t.completedCount)});this.m_resLoader.addCompletionListener(function(t){S.SetGlobal();var e=t.eventOwner;var i=t.loaded;if(t.error||t.timeout)i=false;e.OnDownloadResource(i)});this.m_resLoader.start()},OnDownloadCurses:function(t,e){if(!t){return}var i,n;var s=this.m_xhrConfig.responseXML;var r,a,o,l,_,h,f,C,m;_=s.getElementsByTagName("xtext");o=_.length;for(r=0;r<o;r++){h=_[r];if(h.nodeType!=1)continue;l=h.childNodes.length;for(a=0;a<l;a++){f=h.childNodes[a];if(f.nodeType!=3)continue;var u=CUtil.getTextContent(f);this.m_textCurseMap.push(u)}}this.m_ownerSkin.OnDownloadCurses()},OnDownloadResource:function(t){this.m_ownerSkin.OnDownloadResource(this.m_packName,t)},OnDownloadProgress:function(t,e,i,n){this.m_ownerSkin.OnDownloadProgress(this.m_packName,t,e,i,n)}});vx.stage=vx.Class.extend({init:function(t){this.m_name=null;this.m_skin=null;this.m_subStage=null;this.m_parentStage=null;this.m_backStage=null;this.m_rcStage=null;this.m_rcBoundary=null;this.m_uFlag=0;this.m_uFlag2=0;this.m_uFlagEx=0;this.m_uFlagEx2=0;this.m_aryChild=new ObArray;this.m_aryShow=new ObArray;this.m_aryTimer=null;this.m_nSortType=0;this.m_backScreen=null;this.m_pGlobalToolTip;this.m_bkgndImage=null;this.m_aryUpdate=null;this.m_nUpdate=0;this.m_bUpdateAll=true;this.m_backScreen=null;this.m_arySort=new ObArray;this.m_aryWorkTimer=new ObArray;this.m_bPageShow=1},toString:function(){return"(vx.stage)"},Delete:function(){var t,e;var i;if(this.m_aryChild){e=this.m_aryChild.length;for(t=0;t<e;t++){i=this.m_aryChild.GetAt(t);if(i==null)continue;i.Delete()}this.m_aryChild.RemoveAll();this.m_aryChild=null}if(this.m_aryShow){this.m_aryShow.RemoveAll();this.m_aryShow=null}if(this.m_aryTimer){this.m_aryTimer.RemoveAll();this.m_aryTimer=null}this.m_parentStage=null;this.m_subStage=null;this.m_rcStage=null;this.m_pGlobalToolTip=null;if(this.m_backScreen){this.m_backScreen.Delete();this.m_backScreen=null}if(this.m_arySort){this.m_arySort.RemoveAll();this.m_arySort=null}if(this.m_aryWorkTimer){this.m_aryWorkTimer.RemoveAll();this.m_aryWorkTimer=null}},IsFlag:function(t){return(this.m_uFlag&t)==t},IsFlag2:function(t){return(this.m_uFlag2&t)==t},IsFlagEx:function(t){return(this.m_uFlagEx&t)==t},IsFlagEx2:function(t){return(this.m_uFlagEx2&t)==t},OrFlag:function(t){return this.m_uFlag&t},OrFlag2:function(t){return this.m_uFlag2&t},OrFlagEx:function(t){return this.m_uFlagEx&t},OrFlagEx2:function(t){return this.m_uFlagEx2&t},ModifyFlag:function(t,e){this.m_uFlag|=t;this.m_uFlag&=~e},ModifyFlag2:function(t,e){this.m_uFlag2|=t;this.m_uFlag2&=~e},ModifyFlagEx:function(t,e){this.m_uFlagEx|=t;this.m_uFlagEx&=~e},ModifyFlagEx2:function(t,e){this.m_uFlagEx2|=t;this.m_uFlagEx2&=~e},EventSync:function(t,e,i,n){},GetStageRect:function(t){if(arguments.length==0)t=this.m_rcStage.Clone();else t.Set(this.m_rcStage);return t},GetMessageRect:function(t){if(arguments.length==0)t=this.m_rcStage.Clone();else t.Set(this.m_rcStage);t.top++;t.bottom--;return t},AddObject:function(t){if(t)this.m_aryChild.AddTail(t)},RemoveObject:function(t){if(t)this.m_aryChild.RemoveObject(t)},StageMessageDispatch:function(t,e,i,n,s){if(vx.bPreventEvent)return;if(vx.bRecord){var r=Date.now();if(t!=vx.nRecordMsg||r-vx.nRecordTime>=100&&(e!=vx.nRecordX||i!=vx.nRecordY)){switch(t){case CMessage.WM_KEYDOWN:case CMessage.WM_KEYUP:case CMessage.WM_CHAR:case CMessage.WM_MOUSEWHEEL:case CMessage.WM_GRAPMODESTART:case CMessage.WM_GRAPMODE:case CMessage.WM_GRAPMODEEND:break;default:{var a={};a.msg=t;a.x=e;a.y=i;a.flag=n;a.key=s;a.time=r-vx.nRecordTime;vx.aryRecord.push(a);vx.nRecordMsg=a.msg;vx.nRecordTime=r;vx.nRecordX=e;vx.nRecordY=i}break}}}var o=t;var l,_,h,f,C=0;if(this.m_subStage){C=this.m_subStage.StageMessageDispatch(t,e,i,n,s);if(C>0){if(this.IsFlag(CFlags.STAGEST_MUSTGETKEY)){switch(t){case CMessage.WM_KEYDOWN:case CMessage.WM_KEYUP:case CMessage.WM_CHAR:this.MessageDispatchStage(t,e,i,n,s);break}}return C}}if(!this.IsFlag(CFlags.STAGEST_ENABLED)||!this.IsFlag(CFlags.STAGEST_SHOW))return C;e+=this.m_rcStage.left;i+=this.m_rcStage.top;var m=this.m_aryShow;h=m.length;switch(t){case CMessage.WM_MOUSEMOVE:case CMessage.WM_LBUTTONDOWN:case CMessage.WM_LBUTTONDBLCLK:case CMessage.WM_LBUTTONUP:case CMessage.WM_MOUSELEAVE:case CMessage.WM_MOUSEWHEEL:case CMessage.WM_KEYDOWN:case CMessage.WM_KEYUP:case CMessage.WM_CHAR:case CMessage.WM_CANCELMODE:case CMessage.WM_PAGEVISIBLE:case CMessage.WM_RESIZESTAGE:case CMessage.WM_RBUTTONDOWN:{l=this.GetCaptureObject();if(l){if(l.m_parent){var u=new vx.point(e,i);l.m_parent.StageToClient(u);e=u.x;i=u.y}C+=l.MessageDispatch(t,e,i,n,s)}else{if(this.MessageDispatchModalAfter(t,e,i,n,s)>0){return 1}switch(t){case CMessage.WM_KEYDOWN:case CMessage.WM_KEYUP:case CMessage.WM_CHAR:case CMessage.WM_MOUSEWHEEL:{l=this.GetFocusObject();if(l)C+=l.MessageDispatch(t,e,i,n,s)}break;case CMessage.WM_MOUSEMOVE:case CMessage.WM_MOUSELEAVE:{for(f=h-1;f>=0;f--){l=m[f];_=l.MessageDispatch(t,e,i,n,s);if(_>0)t=CMessage.WM_MOUSELEAVE;C+=_}}break;default:{for(f=h-1;f>=0;f--){l=m[f];C+=l.MessageDispatch(t,e,i,n,s);if(C>0)break}}break}if(C==0){if(t==CMessage.WM_LBUTTONDOWN){if(!this.IsFlag(CFlags.STAGEST_SUBSTAGE))this.SetFocusObject(null)}else if(t==CMessage.WM_MOUSEMOVE){}this.MessageDispatchStage(t,e,i,n,s)}else{if(this.IsFlag(CFlags.STAGEST_MUSTGETKEY)){switch(t){case CMessage.WM_KEYDOWN:case CMessage.WM_KEYUP:case CMessage.WM_CHAR:this.MessageDispatchStage(t,e,i,n,s);break}}}}}break}if(vx.bTouch&&this.m_skin.m_captureObj==null&&(C>0||this.IsFlag(CFlags.STAGEST_SELECT))){switch(o){case CMessage.WM_GRAPMODE:case CMessage.WM_GRAPMODEEND:case CMessage.WM_GRAPMODESTART:if(this.MessageDispatchModalAfter(o,e,i,n,s)==0)this.MessageDispatchStage(o,e,i,n,s);if(this.m_skin.m_focusObj)this.m_skin.m_focusObj.MessageDispatch(o,e,i,n,s);break}}return C},StagePrepare:function(){if(this.m_subStage){this.m_subStage.StagePrepare()}if(this.m_backStage)this.m_backStage.StagePrepare();var t;if(this.m_backScreen)t=this.m_bUpdateAll;else t=this.m_skin.m_bUpdateAll;var e=new vx.rect(0,0,0,0);var i=this.m_rcStage.Clone();var n=this.m_aryWorkTimer;var s=this.m_arySort;var r=this.m_aryChild;var a,o,l=this.m_aryChild.length;var _=0;n.RemoveAll();s.RemoveAll();for(o=0;o<l;o++){a=r[o];if(a.IsFlag2(CFlags.STATUS2_DELETE)){r.RemoveAt(o);a.Delete();o--;l--;_++;continue}a.GetObjectRect(e);if(!e.Intersect(i)||!a.IsFlag(CFlags.STATUS_SHOW)){a.Prepare(null,n,t);continue}else{_+=a.Prepare(e,n,t)}if(t){a.ModifyFlag2(CFlags.STATUS2_UPDATE,0);_++}else{if(a.OrFlag2(CFlags.STATUS2_UPDATE|CFlags.STATUS2_REDRAW)){_++}else if(this.CheckUpdate(e)){a.ModifyFlag2(CFlags.STATUS2_UPDATE,0);_++}}s.push(a)}return _},StageDraw:function(t){if(!this.IsFlag(CFlags.STAGEST_SHOW))return;var e=this.m_aryShow;var i=this.m_arySort;var n,s,r,a,o;CUtil.SortingObject_ByType(e,i,this.m_nSortType);var l=t;if(this.m_backStage){l.VX_Clear();this.m_backStage.StageDraw(t)}if(this.m_backScreen){l=this.m_backScreen;if(!this.m_bUpdateAll){n=this.m_aryUpdate;o=this.m_nUpdate;if(o>0){for(a=0;a<o;a++){this.StageToView(n[a])}l.ClipArray(n,o)}}}l.Translate(-this.m_rcStage.left,-this.m_rcStage.top);this.OnDraw(l,this.m_rcStage);o=e.length;for(a=0;a<o;a++){r=e[a];if(!r.OrFlag2(CFlags.STATUS2_UPDATE|CFlags.STATUS2_REDRAW))continue;r.Draw(l)}l.Restore();if(t!=l){if(!this.m_bUpdateAll){for(a=0;a<o;a++){s=n[a];t.BltBlock(l,s.left,s.top,s.left,s.top,s.Width(),s.Height())}}else{t.Blt(l,0,0)}if(vx.nMaxUpdateBuf==0)this.m_bUpdateAll=true;else this.m_bUpdateAll=false;this.m_nUpdate=0}if(this.m_subStage)this.m_subStage.StageDraw(t)},StageTimer:function(t){if(this.m_subStage)this.m_subStage.StageTimer(t);if(this.m_backStage)this.m_backStage.StageTimer(t);var e=this.m_aryWorkTimer;var i,n,s=e.length;for(n=0;n<s;n++){i=e[n];i.Timer(t)}this.Timer(t)},Timer:function(t){if(!this.IsFlag(CFlags.STAGEST_TIMER))return;if(this.m_aryTimer){var e,i,n,s,r;s=this.m_aryTimer;n=s.length;for(i=0;i<n;i++){e=s[i];if(e.nDeleteFlag==1){s.RemoveAt(i);n--;i--;continue}e.nTimeSum+=t;if(e.nTimeGap==0){r=e.nTimeSum%1e3;this.OnTimer(e.nTimerID,gap,e.nTimeSum/1e3,r);e.nTimeSum=r}else if(e.nTimeSum>=e.nTimeGap){r=e.nTimeSum%e.nTimeGap;this.OnTimer(e.nTimerID,e.nTimeSum-r,(e.nTimeSum-r)/e.nTimeGap,r);e.nTimeSum=r}}if(s.length<=0)this.ModifyFlag(0,CFlags.STAGEST_TIMER)}},OnTimer:function(t,e,i,n){},SetTimer:function(t,e){var i,n,s,r;this.ModifyFlag(CFlags.STAGEST_TIMER,0);if(!this.m_aryTimer)this.m_aryTimer=new ObArray;r=this.m_aryTimer;s=this.m_aryTimer.length;for(n=0;n<s;n++){i=r[n];if(i.nTimerID==t){i.nTimeSum=0;i.nTimeGap=e;i.nDeleteFlag=0;return}}i=new vx.timer_info(t,e);this.m_aryTimer.AddTail(i)},KillTimer:function(t){if(this.m_aryTimer==null)return;var e,i,n,s;s=this.m_aryTimer;n=s.length;for(i=0;i<n;i++){e=s[i];if(e.nTimerID==t){e.nDeleteFlag=1;return}}},IsTimer:function(t){if(this.m_aryTimer==null)return false;var e,i,n,s;s=this.m_aryTimer;n=s.length;for(i=0;i<n;i++){e=s[i];if(e.nTimerID==t&&e.nDeleteFlag!=1){return true}}return false},OnDraw:function(t,e){if(this.IsFlag(CFlags.STAGEST_SUBSTAGE))return;this.DrawBackground(t,e)},DrawBackground:function(t,e){var i,n,s,r,a;var o=this.m_rcStage;if(this.m_bkgndImage){if(this.m_skin.m_bUpdateAll){t.BltBlock(this.m_bkgndImage,o.left,o.top,o.left,o.top,o.Width(),o.Height())}else{r=o.left;a=o.top;if(this.m_backScreen){i=this.m_aryUpdate;s=this.m_nUpdate}else{i=this.m_skin.m_aryUpdate;s=this.m_skin.m_nUpdate}for(n=0;n<s;n++){o=i[n];t.BltBlock(this.m_bkgndImage,o.left+r,o.top+a,o.left+r,o.top+a,o.Width(),o.Height())}}}else{var l=CColor.GetColor(CColor.INDEX_BACKGROUND);t.m_context.fillStyle=CColor.Value(l);if(this.m_skin.m_bUpdateAll){t.m_context.fillRect(e.left,e.top,e.Width(),e.Height())}else{r=o.left;a=o.top;if(this.m_backScreen){i=this.m_aryUpdate;s=this.m_nUpdate}else{i=this.m_skin.m_aryUpdate;s=this.m_skin.m_nUpdate}for(n=0;n<s;n++){o=i[n];t.m_context.fillRect(o.left+r,o.top+a,o.Width(),o.Height())}}}},Create:function(t,e,i,n){this.m_name=e;this.m_skin=t;this.m_parentStage=n;this.m_uFlag=i;this.m_rcStage=this.m_skin.GetViewRect();this.m_skin.AddStage(this);this.m_pGlobalToolTip=new vx.tooltip;this.m_pGlobalToolTip.Create(this,CUtil.CRect(0,0,0,0),CDefine.VXID_NONE,CFlags.STATUS_POPUP|CFlags.STATUS_TOPMOST,0,null);if(!this.OnCreate()){this.m_skin.DeleteStage(e);return false}if(this.IsFlag(CFlags.STAGEST_BACKSTAGE)){this.m_aryUpdate=new vx.ObArray;for(var s=0;s<vx.nMaxUpdateBuf;s++){this.m_aryUpdate.Add(new vx.rect(0,0,0,0))}var r=this.m_skin.m_screen.GetSize();this.m_backScreen=new vx.buffer(null,r.x,r.y)}if(!this.IsFlag(CFlags.STAGEST_SUBSTAGE))this.Invalidate();this.OnSize();return true},OnCreate:function(){return true},OnDestroy:function(){},Destroy:function(){this.OnDestroy();this.ModifyFlag(CFlags.STAGEST_DESTROY,CFlags.STAGEST_SHOW)},Close:function(){if(!this.OnClose())return;this.Destroy()},OnClose:function(){return true},OnSelect:function(t){var e,i;if(t){if(this.m_aryChild){i=this.m_aryChild.length;for(e=0;e<i;e++){obj=this.m_aryChild.GetAt(e);if(obj==null)continue;if(obj.m_uFlag&CFlags.STATUS_MODAL){if(this.m_skin.m_aryStack.FindObject(obj)==-1){this.m_skin.m_aryStack.AddTail(obj)}}}}}else{if(this.m_aryChild){var n=this.GetCaptureObject();var s=this.GetFocusObject();i=this.m_aryChild.length;for(e=0;e<i;e++){obj=this.m_aryChild.GetAt(e);if(obj==null)continue;if(obj.m_uFlag&CFlags.STATUS_MODAL)this.m_skin.m_aryStack.RemoveObject(obj);if(obj==n)this.SetCaptureObject(null);if(obj==s)this.SetFocusObject(null)}}}},AttachSubStage:function(t){if(this.IsFlag(CFlags.STAGEST_SUBSTAGE))return;if(t){this.m_subStage=t;t.m_parentStage=this}},DetachSubStage:function(){if(this.IsFlag(CFlags.STAGEST_SUBSTAGE))return null;var t=null;if(this.m_subStage){t=this.m_subStage;this.m_subStage.m_parentStage;this.m_subStage}return t},AttachBackStage:function(t){if(t){this.m_backStage=t;this.m_backStage.ModifyFlag(CFlags.STAGEST_BACKSTAGE,0)}},DetachBackStage:function(){var t=null;if(this.m_backStage){this.m_backStage.ModifyFlag(0,CFlags.STAGEST_BACKSTAGE);t=this.m_backStage;this.m_backStage}return t},AddUpdate:function(t){if(this.m_bUpdateAll||this.m_aryUpdate==null)return;var e=this.m_rcStage.CIV(t);if(e==0){this.m_bUpdateAll=true;return}else if(e<0){return}var i=this.m_aryUpdate;var n,s=this.m_nUpdate;for(n=0;n<s;n++){if(!i[n].CAU(t))return}if(s+1<vx.nMaxUpdateBuf){i[s].Set(t);this.m_nUpdate++}else{this.m_bUpdateAll=true}},InvalidateRect:function(t){if(this.m_skin.m_bUpdateAll){this.m_skin.m_nUpdate++;return}var e=this.m_skin.m_curStage;if(e){if(e==this){this.m_skin.AddUpdate(t)}else{if(this.m_backScreen)this.AddUpdate(t);this.StageToView(t);e.ViewToStage(t);this.m_skin.AddUpdate(t)}}},Invalidate:function(){this.m_skin.m_bUpdateAll=true;this.InvalidateRect(null)},GetGlobalToolTip:function(){return this.m_pGlobalToolTip},CloseToolTip:function(t,e){if(arguments.length<2)e=true;if(this.m_pGlobalToolTip==null)return;var i;if(t.m_toolInfo.m_pTool)i=t.m_toolInfo.m_pTool;else i=this.m_pGlobalToolTip;var n=i.GetToolInfo();if(i.GetToolInfo()!=t.m_toolInfo){if(e){t.ModifyFlag2(0,CFlags.STATUS2_TOOLOVER)}return}if(!e&&i.IsFlagEx(CFlags.VXTOOLTIP_DRAGTOOL))return;if(i.IsFlag(CFlags.STATUS_SHOW))i.CloseTool();if(e)t.ModifyFlag2(0,CFlags.STATUS2_TOOLOVER)},ShowToolTip:function(t,e,i,n){if(this.m_pGlobalToolTip==null)return;var s=t.GetObjectRect();var r=new vx.point(s.left+e,s.top+i);var a;if(t.m_toolInfo.m_pTool){if(this.m_pGlobalToolTip.IsFlag(CFlags.STATUS_SHOW)){this.m_pGlobalToolTip.ShowObject(false)}a=t.m_toolInfo.m_pTool}else{a=this.m_pGlobalToolTip}if(a.IsFlagEx(CFlags.VXTOOLTIP_DRAGTOOL)){a.SetShowTool(t.m_toolInfo,r)}else if(!t.IsFlag2(CFlags.STATUS2_TOOLOVER)&&n==0){a.SetShowTool(t.m_toolInfo,r)}else return;t.ModifyFlag2(CFlags.STATUS2_TOOLOVER,0)},CheckUpdate:function(t){var e,i,n;if(this.m_backScreen){n=this.m_aryUpdate;i=this.m_nUpdate}else{var s=this.m_skin.m_curStage;if(this!=s){this.StageToView(t);s.ViewToStage(t)}n=this.m_skin.m_aryUpdate;i=this.m_skin.m_nUpdate}for(e=0;e<i;e++){if(t.Intersect(n[e]))return true}return false},StageToView:function(t){t.Offset(-this.m_rcStage.left,-this.m_rcStage.top)},ViewToStage:function(t){t.Offset(this.m_rcStage.left,this.m_rcStage.top)},SetBackgroundImage:function(t){this.m_bkgndImage=t;this.Invalidate()},SetCaptureObject:function(t){if(this.m_skin)this.m_skin.SetCaptureObject(t)},GetCaptureObject:function(){if(this.m_skin)return this.m_skin.GetCaptureObject();else return null},ReleaseCaptureObject:function(){if(this.m_skin)this.m_skin.ReleaseCaptureObject()},SetFocusObject:function(t){if(this.m_skin)this.m_skin.SetFocusObject(t)},GetFocusObject:function(){if(this.m_skin)return this.m_skin.GetFocusObject();else return null},MessageDispatchStage:function(t,e,i,n,s){var r=0;switch(t){case CMessage.WM_LBUTTONDOWN:this.OnLButtonDown(e,i,n);r++;break;case CMessage.WM_LBUTTONDBLCLK:this.OnLButtonDblClk(e,i,n);r++;break;case CMessage.WM_MOUSEMOVE:this.OnSetCursor(CDefine.HTCLIENT,CMessage.WM_MOUSEMOVE);this.OnMouseMove(e,i,n);r++;break;case CMessage.WM_GRAPMODESTART:this.OnGrapModeStart(e,i,n);break;case CMessage.WM_GRAPMODE:this.OnGrapMode(e,i,n);break;case CMessage.WM_GRAPMODEEND:this.OnGrapModeEnd(e,i,n);break;case CMessage.WM_LBUTTONUP:this.OnLButtonUp(e,i,n);r++;break;case CMessage.WM_MOUSELEAVE:this.OnMouseLeave();r++;break;case CMessage.WM_MOUSEWHEEL:this.OnMouseWheel(e,i,n,s);r++;break;case CMessage.WM_KEYDOWN:this.OnKeyDown(n,s);r++;break;case CMessage.WM_CHAR:this.OnChar(n,s);r++;break;case CMessage.WM_KEYUP:this.OnKeyUp(n,s);r++;break;case CMessage.WM_PAGEVISIBLE:this.OnPageVisible(e);break;case CMessage.WM_RBUTTONDOWN:this.OnRButtonDown(e,i,n);break}return r},MessageDispatchModalAfter:function(t,e,i,n,s){var r=this.m_skin.GetModalStack();if(r==null)return 0;var a,o,l,_=0;var h,f=this.m_aryShow;l=f.length;var C=t;switch(t){case CMessage.WM_KEYDOWN:case CMessage.WM_KEYUP:case CMessage.WM_CHAR:case CMessage.WM_MOUSEWHEEL:{h=this.GetFocusObject();if(h)_+=h.MessageDispatch(t,e,i,n,s)}break;case CMessage.WM_MOUSEMOVE:case CMessage.WM_MOUSELEAVE:{for(a=l-1;a>=0;a--){h=f[a];o=h.MessageDispatch(t,e,i,n,s);if(o>0)t=CMessage.WM_MOUSEMOVE;if(h==r){_=1;break}}}break;default:{for(a=l-1;a>=0;a--){h=f[a];_+=h.MessageDispatch(t,e,i,n,s);if(_>0||h==r){if(_==0||t==CMessage.WM_KILLFOCUS)_=h.HitNoModalArea(t,e,i,n,s);break}}}break}if(vx.bTouch&&this.m_skin.m_captureObj==null&&(_>0||this.IsFlag(CFlags.STAGEST_SELECT))){switch(C){case CMessage.WM_GRAPMODE:case CMessage.WM_GRAPMODEEND:case CMessage.WM_GRAPMODESTART:r.MessageDispatch(t,e,i,n,s);if(this.m_skin.m_focusObj)this.m_skin.m_focusObj.MessageDispatch(t,e,i,n,s);break}}return _},OnSize:function(){},OnMove:function(t,e){},OnLButtonDown:function(t,e,i){},OnRButtonDown:function(t,e,i){},OnMouseMove:function(t,e,i){},OnGrapModeStart:function(t,e,i){},OnGrapMode:function(t,e,i){},OnGrapModeEnd:function(t,e,i){},OnLButtonUp:function(t,e,i){},OnLButtonDblClk:function(t,e,i){},OnMouseWheel:function(t,e,i,n){},OnMouseLeave:function(){},OnKeyDown:function(t,e){},OnChar:function(t,e){},OnKeyUp:function(t,e){},OnPageVisible:function(t){this.m_bPageShow=t},OnDropObject:function(t,e,i,n){},OnSetCursor:function(t,e){this.m_skin.SetCursor(CDefine.CURSOR_ARROW)},PostMessage:function(t,e,i,n){if(arguments.length==3)n=null;this.m_skin.InputQueue(true,t,e,i,n,this)},SendMessage:function(t,e,i,n){if(arguments.length==3)n=null;this.EventSync(t,e,i,n)},FindObject:function(t,e){if(arguments.length<2)e=false;var i,n,s,r;if(this.m_subStage&&e){i=this.m_subStage.FindObject(t,e);if(i)return i}n=this.m_aryChild;r=n.length;for(s=0;s<r;s++){i=n[s];if(i==null||!i.IsValid())continue;if(i.m_nID==t)return i}return null},FindDropEnableObject:function(t,e){if(!this.IsFlag(CFlags.STAGEST_ENABLED))return null;var i;var n=null;var s=this.m_aryShow.length;for(var r=0;r<s;r++){i=this.m_aryShow[r];n=i.FindDropObjectByPoint(t,e);if(n)break}return n},FindImage:function(t){return this.m_skin.FindImage(t)},FindText:function(t){return this.m_skin.FindText(t)},FindSound:function(t){return this.m_skin.FindSound(t)},SetStageBoundary:function(t){if(t==null){this.m_rcBoundary=null;return}this.m_rcBoundary=t.Clone()},GetStageBoundary:function(){if(this.m_rcBoundary)return this.m_rcBoundary.Clone();else return null},ApplyBoundary:function(){var t=this.m_rcStage;var e=this.m_rcBoundary;if(t==null||e==null)return;var i=t.Width();var n=t.Height();if(t.left<e.left){t.left=e.left;t.right=t.left+i}else if(t.right>e.right){t.right=e.right;t.left=t.right-i}if(t.top<e.top){t.top=e.top;t.bottom=t.top+n}else if(t.bottom>e.bottom){t.bottom=e.bottom;t.top=t.bottom-n}},MoveStage:function(t,e){if(this.m_rcStage==null)return;this.m_rcStage.Offset(t,e);if(this.m_rcBoundary&&!this.m_rcBoundary.IsEmpty())this.ApplyBoundary();if(this.m_backStage)this.m_backStage.MoveStage(t,e);if(this.m_frontStage)this.m_frontStage.MoveStage(t,e);this.OnMove(t,e);this.OnChangeViewport();this.Invalidate()},SetStageRect:function(t){if(this.m_rcStage)this.m_rcStage.Set(t);else this.m_rcStage=t.Clone();if(this.m_rcBoundary&&!this.m_rcBoundary.IsEmpty())this.ApplyBoundary();if(this.m_backStage)this.m_backStage.SetStageRect(t);if(this.m_frontStage)this.m_frontStage.SetStageRect(t);this.OnSize();this.OnChangeViewport();this.Invalidate()},ShowControl:function(t,e){var i=this.FindObject(t);if(i)i.ShowObject(e);return i},EnableControl:function(t,e){var i=this.FindObject(t);if(i)i.EnableObject(e);return i},MoveControl:function(t,e){var i=this.FindObject(t);if(i)i.MoveObject(e);return i},MoveControlP:function(t,e){var i=this.FindObject(t);if(i)i.MoveObjectP(e);return i},OffsetControl:function(t,e,i){var n=this.FindObject(t);if(n&&e!=0&&i!=0){var s=n.GetObjectRect();s.Offset(e,i);n.MoveObject(s)}return n},OnChangeViewport:function(){},MessageBoxTag:function(t,e,i,n,s,r,a,o){var l=this;if(this.m_subStage&&(i&CDefine.MB_NOTITLESTAGE)!=CDefine.MB_NOTITLESTAGE)l=this.m_subStage;var _=vx.Global.g_skin.NewMessageBox(i,s);if(n==null){n=vx.tag.Text(this.FindText("PROGRAM_KEY"),CColor.GetColor(CColor.INDEX_FRAMETEXT),vx.Global.g_title_tagtype)}if(s==0)s=CDefine.VXID_NONE;var h=CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED|CFlags.STATUS_POPUP|CFlags.STATUS_MODAL|CFlags.STATUS_COMMONIMAGE0;var f=CFlags.VXBOX_CAPTION|CFlags.VXBOX_SYSCLOSE;if(i&CDefine.MB_MODALESS)h&=~CFlags.STATUS_MODAL;if(i&CDefine.MB_CAPTIONHILIGHT)f|=CFlags.VXBOX_CAPTIONHILIGHT;if(i&CDefine.MB_RIGHTFORMAT)f|=CFlags.VXMESSAGEBOX_RIGHTFORMAT;if(i&CDefine.MB_USEKEYEVENT)f|=CFlags.VXMESSAGEBOX_USEKEYEVENT;if(i&CDefine.MB_FITWIDTH)f|=CFlags.VXMESSAGEBOX_FITWIDTH;if(i&CDefine.MASK_EFFECT){if(i&CDefine.MB_EFFECTRAISE)_.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTRAISE,0);if(i&CDefine.MB_EFFECTFALL)_.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTFALL,0);if(i&CDefine.MB_EFFECTFADEIN)_.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTFADEIN,0);if(i&CDefine.MB_EFFECTFADEOUT)_.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTFADEOUT,0)}if(n!=null)_.SetTitleTag(n);else _.SetTitle(FindText("PROGRAM_KEY"));_.SetMessageTag(e);_.SetButtonText(r,a,o);if(h&CFlags.STATUS_MODAL)_.DoModal(t,l,l.GetMessageRect(),s,h,f);else _.DoModaless(t,l,l.GetViewRect(),s,h,f);return _},MessageBox:function(t,e,i,n,s,r,a,o){var l=this;if(this.m_subStage&&(i&CDefine.MB_NOTITLESTAGE)!=CDefine.MB_NOTITLESTAGE)l=this.m_subStage;var _=vx.Global.g_skin.NewMessageBox(i);if(n==null){n=this.FindText("PROGRAM_KEY")}if(s==0)s=CDefine.VXID_NONE;var h=CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED|CFlags.STATUS_POPUP|CFlags.STATUS_MODAL|CFlags.STATUS_COMMONIMAGE0;var f=CFlags.VXBOX_CAPTION|CFlags.VXBOX_SYSCLOSE;if(i&CDefine.MB_MODALESS)h&=~CFlags.STATUS_MODAL;if(i&CDefine.MB_CAPTIONHILIGHT)f|=CFlags.VXBOX_CAPTIONHILIGHT;if(i&CDefine.MB_RIGHTFORMAT)f|=CFlags.VXMESSAGEBOX_RIGHTFORMAT;if(i&CDefine.MB_USEKEYEVENT)f|=CFlags.VXMESSAGEBOX_USEKEYEVENT;if(i&CDefine.MB_FITWIDTH)f|=CFlags.VXMESSAGEBOX_FITWIDTH;if(i&CDefine.MASK_EFFECT){if(i&CDefine.MB_EFFECTRAISE)_.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTRAISE,0);if(i&CDefine.MB_EFFECTFALL)_.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTFALL,0);if(i&CDefine.MB_EFFECTFADEIN)_.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTFADEIN,0);if(i&CDefine.MB_EFFECTFADEOUT)_.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTFADEOUT,0)}_.SetTitle(n);_.SetMessage(e);_.SetButtonText(r,a,o);if(h&CFlags.STATUS_MODAL)_.DoModal(t,l,l.GetMessageRect(),s,h,f);else _.DoModaless(t,l,l.GetStageRect(),s,h,f);return _},CreateModalBack:function(t){var e=new vx.modalback;e.Create(this,this.GetStageRect(),CDefine.VXID_NONE,CFlags.STATUS_SHOW|CFlags.STATUS_POPUP,0,null);t.m_modalback=e},PlayBGM:function(t,e,i,n){this.m_skin.PlayBGM(t,e,i,n)},StopBGM:function(){this.m_skin.StopBGM()},SetVolumeBGM:function(t){this.m_skin.SetVolumeBGM(t)},PlaySound:function(t,e,i){this.m_skin.PlaySound(t,e,i)},StopSound:function(){this.m_skin.StopSound()},SetVolumeSound:function(t){this.m_skin.SetVolumeSound(t)},IsPageShow:function(){return this.m_bPageShow}});vx.image=vx.Class.extend({init:function(t,e,i,n){if(e==undefined)e=CUtil.CRect(0,0,0,0);if(i==undefined)i=CUtil.CPoint(t.width,t.height);if(n==undefined)n=0;this.m_image=t;this.m_rcInner=e;this.m_szFrame=i;this.m_uFlag=n},IsFlag:function(t){return(this.m_uFlag&t)==t},ModifyFlag:function(t,e){this.m_uFlag|=t;this.m_uFlag&=~e},toString:function(){return"(vx.image)"},Delete:function(){this.m_image=null;this.m_rcInner=null;this.m_szFrame=null},SetFrameString:function(t){var e=CUtil.Find(t,",");if(e==-1)return;this.m_szFrame.x=Number(CUtil.Left(t,e));this.m_szFrame.y=Number(CUtil.Right(t,t.length-e-1))},SetResizeString:function(t){var e,i,n,s,r;r=CUtil.Find(t,",");if(r==-1)return;e=Number(CUtil.Left(t,r));t=CUtil.Right(t,t.length-r-1);r=CUtil.Find(t,",");if(r==-1)return;i=Number(CUtil.Left(t,r));t=CUtil.Right(t,t.length-r-1);r=CUtil.Find(t,",");if(r==-1)return;n=Number(CUtil.Left(t,r));s=Number(CUtil.Right(t,t.length-r-1));this.m_rcInner.SetRect(e,i,e+n,i+s)},SetFlagString:function(t){this.m_uFlag=Number(t)},GetImageSize:function(){return CUtil.CPoint(this.m_image.width,this.m_image.height)},GetFrameSize:function(){return this.m_szFrame.Clone()},GetImageRect:function(){return CUtil.CRect(0,0,this.m_image.width,this.m_image.height)},GetFrameRect:function(t){if(t==undefined)t=0;if(this.m_szFrame.x<=0||this.m_szFrame.y<=0)return this.GetImageRect();var e=0;var i=0;var n=(this.m_image.width-this.m_image.width%this.m_szFrame.x)/this.m_szFrame.x;if(n!=0){e=t%n;i=(t-e)/n}return CUtil.CRect(e*this.m_szFrame.x,i*this.m_szFrame.y,(e+1)*this.m_szFrame.x,(i+1)*this.m_szFrame.y)},GetFrameCount:function(){if(this.m_szFrame.x<=0||this.m_szFrame.y<=0)return 1;else return Math.floor(this.m_image.width/this.m_szFrame.x*(this.m_image.height/this.m_szFrame.y))},IsFrame:function(){if(this.m_szFrame.x<=0||this.m_szFrame.y<=0)return false;else return true},IsResize:function(){if(this.m_rcInner.left==0&&this.m_rcInner.top==0&&this.m_rcInner.right==0&&this.m_rcInner.bottom==0)return false;else return true},DrawEx:function(t,e,i,n,s){if(arguments.length<5)s=0;if(s&(CDefine.FLIP_HORZ|CDefine.FLIP_VERT)){var r,a,o,l;r=1;a=1;o=n.Width();l=n.Height();if(s&CDefine.FLIP_HORZ)r=-1;if(s&CDefine.FLIP_VERT)a=-1;t.Transform(e+o/2,i+l/2,0,r,a);t.BltBlock(this,-o/2,-l/2,n.left,n.top,n.Width(),n.Height());t.RestoreTransform()}else{t.BltBlock(this,e,i,n.left,n.top,n.Width(),n.Height())}},DrawStretch:function(t,e,i,n){if(arguments.length<4)n=0;var s,r,a=false;if(n&(CDefine.FLIP_HORZ|CDefine.FLIP_VERT)){if(n&CDefine.FLIP_HORZ)s=-1;if(n&CDefine.FLIP_VERT)r=-1;a=true;t.m_context.save();t.m_context.scale(s,r)}t.StretchBltBlock(this,e.left,e.top,e.Width(),e.Height(),i.left,i.top,i.Width(),i.Height());if(a){t.m_context.restore()}},DrawFrame:function(t,e,i,n,s){if(arguments.length<5)s=0;this.DrawEx(t,e,i,this.GetFrameRect(n),s)},DrawFull:function(t,e,i,n){if(arguments.length<3)n=0;this.DrawEx(t,e,i,this.GetImageRect(nFrame),n)},DrawBox:function(t,e,i){var n,s=this.GetFrameRect(i);if(this.m_rcInner.EqualRect(0,0,0,0)){this.DrawEx(t,e.left,e.top,s,0);return}var r=CDefine.BOXFLAG_ALL;if(this.IsFlag(CDefine.PKFLAG_IMAGENOINNER))r&=~CDefine.BOXFLAG_INNER;if(this.IsFlag(CDefine.PKFLAG_HALFSHADOW))r&=~(CDefine.BOXFLAG_LEFTTOP|CDefine.BOXFLAG_TOP|CDefine.BOXFLAG_LEFT);n=this.m_rcInner.Clone();n.Offset(s.left,s.top);this._DrawBox(t,e,n,s,r)},DrawPattern:function(t,e,i,n){var s=new vx.rect;var r,a,o,l,_,h,f,C;r=0;a=0;f=i.Width();C=i.Height();o=e.Width();l=e.Height();if(f<=0||C<=0)return;while(a<l){if(l-a>=C)h=C;else h=l-a;while(r<o){if(o-r>=f)_=f;else _=o-r;s.SetRect(i.left,i.top,i.left+_,i.top+h);this.DrawEx(t,e.left+r,e.top+a,s,n);r+=f}a+=C;r=0}},DrawPatternR:function(t,e,i,n){var s=new vx.rect;var r,a,o,l,_,h,f,C;r=0;a=0;f=i.Width();C=i.Height();o=e.Width();l=e.Height();if(f<=0||C<=0)return;while(a<l){if(l-a>=C)h=C;else h=l-a;while(r<o){if(o-r>=f)_=f;else _=o-r;s.SetRect(i.right-_,i.bottom-h,i.right,i.bottom);this.DrawEx(t,e.right-r-_,e.bottom-a-h,s,n);r+=f}a+=C;r=0}},_DrawBox:function(t,e,i,n,s){var r=0;var a,o;var l,_,h,f,C,m,u;C=e.Width();m=e.Height();if(i.left<=n.left){l=0;s&=~CDefine.BOXFLAG_LEFT}else l=i.left-n.left;if(i.top<=n.top){_=0;s&=~CDefine.BOXFLAG_TOP}else _=i.top-n.top;if(i.right>=n.right){h=0;s&=~CDefine.BOXFLAG_RIGHT}else h=n.right-i.right;if(i.bottom>=n.bottom){f=0;s&=~CDefine.BOXFLAG_BOTTOM}else f=n.bottom-i.bottom;if(_+f>e.Height()){u=_+f-e.Height();if(_>u/2&&f>u/2){if(u%2==0){f-=u/2;_-=u/2}else{f-=u/2+1;_-=u/2}}else if(_>u){_-=u}else if(f>u){f-=u}}if(l+h>e.Width()){u=l+h-e.Width();if(l>u/2&&h>u/2){if(u%2==0){l-=u/2;h-=u/2}else{l-=u/2+1;h-=u/2}}else if(l>u){l-=u}else if(h>u){h-=u}}l=Math.floor(l);_=Math.floor(_);h=Math.floor(h);f=Math.floor(f);if(s&CDefine.BOXFLAG_INNER){a=CUtil.CRect(e.left+l,e.top+_,e.right-h,e.bottom-f);o=CUtil.CRect(n.left+l,n.top+_,n.right-h,n.bottom-f);this.DrawPattern(t,a,o,r)}if(s&CDefine.BOXFLAG_LEFT){if(C<l+h){u=Math.floor(l*C/(l+h))+1;a=CUtil.CRect(e.left,e.top+_,e.left+u,e.bottom-f);o=CUtil.CRect(n.left,n.top+_,n.left+u,n.bottom-f)}else{a=CUtil.CRect(e.left,e.top+_,e.left+l,e.bottom-f);o=CUtil.CRect(n.left,n.top+_,n.left+l,n.bottom-f)}this.DrawPattern(t,a,o,r)}if(s&CDefine.BOXFLAG_TOP){if(m<_+f&&(s&CDefine.BOXFLAG_TOPONLY)!=CDefine.BOXFLAG_TOPONLY){u=Math.floor(_*m/(_+f));a=CUtil.CRect(e.left+l,e.top,e.right-h,e.top+u);o=CUtil.CRect(n.left+l,n.top,n.right-h,n.top+u)}else{a=CUtil.CRect(e.left+l,e.top,e.right-h,e.top+_);o=CUtil.CRect(n.left+l,n.top,n.right-h,n.top+_)}this.DrawPattern(t,a,o,r)}if(s&CDefine.BOXFLAG_RIGHT){if(C<l+h){u=Math.floor(h*C/(l+h));a=CUtil.CRect(e.right-u,e.top+_,e.right,e.bottom-f);o=CUtil.CRect(n.right-u,n.top+_,n.right,n.bottom-f)}else{a=CUtil.CRect(e.right-h,e.top+_,e.right,e.bottom-f);o=CUtil.CRect(n.right-h,n.top+_,n.right,n.bottom-f)}this.DrawPattern(t,a,o,r)}if(s&CDefine.BOXFLAG_BOTTOM){if(m<_+f&&(s&CDefine.BOXFLAG_BOTTOMONLY)!=CDefine.BOXFLAG_BOTTOMONLY){u=Math.floor(_*m/(_+f));a=CUtil.CRect(e.left+l,e.bottom-u,e.right-h,e.bottom);o=CUtil.CRect(n.left+l,n.bottom-u,n.right-h,n.bottom)}else{a=CUtil.CRect(e.left+l,e.bottom-f,e.right-h,e.bottom);o=CUtil.CRect(n.left+l,n.bottom-f,n.right-h,n.bottom)}this.DrawPattern(t,a,o,r)}if(s&CDefine.BOXFLAG_LEFTTOP){a=CUtil.CRect(e.left,e.top,e.left+l,e.top+_);o=CUtil.CRect(n.left,n.top,n.left+l,n.top+_);this.DrawEx(t,a.left,a.top,o,r)}if(s&CDefine.BOXFLAG_RIGHTTOP){a=CUtil.CRect(e.right-h,e.top,e.right,e.top+_);o=CUtil.CRect(n.right-h,n.top,n.right,n.top+_);this.DrawEx(t,a.left,a.top,o,r)}if(s&CDefine.BOXFLAG_RIGHTBOTTOM){a=CUtil.CRect(e.right-h,e.bottom-f,e.right,e.bottom);o=CUtil.CRect(n.right-h,n.bottom-f,n.right,n.bottom);this.DrawEx(t,a.left,a.top,o,r)}if(s&CDefine.BOXFLAG_LEFTBOTTOM){a=CUtil.CRect(e.left,e.bottom-f,e.left+l,e.bottom);o=CUtil.CRect(n.left,n.bottom-f,n.left+l,n.bottom);this.DrawEx(t,a.left,a.top,o,r)}},_DrawBoxClip:function(t,e,i,n,s,r){if(arguments.length<6)r=0;var a=0;var o,l,_,e,h;var f,C,m,u;if(i.left<n.left){f=0;r&=~CDefine.BOXFLAG_LEFT}else f=i.left-n.left;if(i.top<n.top){C=0;r&=~CDefine.BOXFLAG_TOP}else C=i.top-n.top;if(i.right>n.right){m=0;r&=~CDefine.BOXFLAG_RIGHT}else m=n.right-i.right;if(i.bottom>n.bottom){u=0;r&=~CDefine.BOXFLAG_BOTTOM}else u=n.bottom-i.bottom;if(r&CDefine.BOXFLAG_INNER){o=CUtil.CRect(e.left+f,e.top+C,e.right-m,e.bottom-u);if(!o.Intersect(s)){l=CUtil.CRect(n.left+f,n.top+C,n.right-m,n.bottom-u);this.DrawPattern(t,o,l,a)}}if(r&CDefine.BOXFLAG_LEFT){o=CUtil.CRect(e.left,e.top+C,e.left+f,e.bottom-u);if(!o.Intersect(s)){l=CUtil.CRect(n.left,n.top+C,n.left+f,n.bottom-u);this.DrawPattern(t,o,l,a)}else{_=o.Intersection(s);l=CUtil.CRect(n.left,n.top+C,n.left+f,n.bottom-u);h=CUtil.CRect(o.left,o.top,o.right,_.top);if(h.Height()>0)this.DrawPattern(t,h,l,a);h=CUtil.CRect(o.left,_.bottom,o.right,o.bottom);if(h.Height()>0)this.DrawPattern(t,h,l,a)}}if(r&CDefine.BOXFLAG_TOP){o=CUtil.CRect(e.left+f,e.top,e.right-m,e.top+C);if(!o.Intersect(s)){l=CUtil.CRect(n.left+f,n.top,n.right-m,n.top+C);this.DrawPattern(t,o,l,a)}else{_=o.Intersection(s);l=CUtil.CRect(n.left+f,n.top,n.right-m,n.top+C);h=CUtil.CRect(o.left,o.top,_.left,o.bottom);if(h.Width()>0)this.DrawPattern(t,h,l,a);h=CUtil.CRect(_.right,o.top,o.right,o.bottom);if(h.Width()>0)this.DrawPattern(t,h,l,a)}}if(r&CDefine.BOXFLAG_RIGHT){o=CUtil.CRect(e.right-m,e.top+C,e.right,e.bottom-u);if(!o.Intersect(s)){l=CUtil.CRect(n.right-m,n.top+C,n.right,n.bottom-u);this.DrawPattern(t,o,l,a)}else{_=o.Intersection(s);l=CUtil.CRect(n.right-m,n.top+C,n.right,n.bottom-u);h=CUtil.CRect(o.left,o.top,o.right,_.top);if(h.Height()>0)this.DrawPattern(t,h,l,a);h=CUtil.CRect(o.left,_.bottom,o.right,o.bottom);if(h.Height()>0)this.DrawPattern(t,h,l,a)}}if(r&CDefine.BOXFLAG_BOTTOM){o=CUtil.CRect(e.left+f,e.bottom-u,e.right-m,e.bottom);if(!o.Intersect(s)){l=CUtil.CRect(n.left+f,n.bottom-u,n.right-m,n.bottom);this.DrawPattern(t,o,l,a)}else{_=o.Intersection(s);l=CUtil.CRect(n.left+f,n.bottom-u,n.right-m,n.bottom);h=CUtil.CRect(o.left,o.top,_.left,o.bottom);if(h.Width()>0)this.DrawPattern(t,h,l,a);h=CUtil.CRect(_.right,o.top,o.right,o.bottom);if(h.Width()>0)this.DrawPattern(t,h,l,a)}}if(r&CDefine.BOXFLAG_LEFTTOP){o=CUtil.CRect(e.left,e.top,e.left+f,e.top+C);if(!o.Intersect(s)){l=CUtil.CRect(n.left,n.top,n.left+f,n.top+C);this.DrawEx(t,o.left,o.top,l,a)}}if(r&CDefine.BOXFLAG_RIGHTTOP){o=CUtil.CRect(e.right-m,e.top,e.right,e.top+C);if(!o.Intersect(s)){l=CUtil.CRect(n.right-m,n.top,n.right,n.top+C);this.DrawEx(t,o.left,o.top,l,a)}}if(r&CDefine.BOXFLAG_RIGHTBOTTOM){o=CUtil.CRect(e.right-m,e.bottom-u,e.right,e.bottom);if(!o.Intersect(s)){l=CUtil.CRect(n.right-m,n.bottom-u,n.right,n.bottom);this.DrawEx(t,o.left,o.top,l,a)}}if(r&CDefine.BOXFLAG_LEFTBOTTOM){o=CUtil.CRect(e.left,e.bottom-u,e.left+f,e.bottom);if(!o.Intersect(s)){l=CUtil.CRect(n.left,n.bottom-u,n.left+f,n.bottom);this.DrawEx(t,o.left,o.top,l,a)}}},DrawBoxClip:function(t,e,i,n){var s;var r=this.GetFrameRect(i);if(CUtil.EqualRect(this.m_rcInner,0,0,0,0)){this.DrawEx(t,e.left,e.top,r,0);return}var a=CDefine.BOXFLAG_ALL;if(this.IsFlag(CDefine.PKFLAG_IMAGENOINNER))a&=~CDefine.BOXFLAG_INNER;if(this.IsFlag(CDefine.PKFLAG_HALFSHADOW))a&=~(CDefine.BOXFLAG_LEFTTOP|CDefine.BOXFLAG_TOP|CDefine.BOXFLAG_LEFT);s=this.m_rcInner.Clone();s.Offset(r.left,r.top);this._DrawBoxClip(t,e,s,r,n,a)}});vx.object=vx.Class.extend({init:function(){this.m_stage=null;this.m_parent=null;this.m_x=0;this.m_y=0;this.m_width=0;this.m_height=0;this.m_nAlpha=1;this.m_nAngle=0;this.m_nScaleX=1;this.m_nScaleY=1;this.m_nTmAlpha=0;this.m_nTmAlphaLimit=0;this.m_uFlag=0;this.m_uFlag2=0;this.m_uFlagEx=0;this.m_uFlagEx2=0;this.m_aryChild=null;this.m_aryShow=null;this.m_aryTimer=null;this.m_nSdOff_l=0;this.m_nSdOff_t=0;this.m_nSdOff_r=0;this.m_nSdOff_b=0;this.m_nNcBnd_l=0;this.m_nNcBnd_t=0;this.m_nNcBnd_r=0;this.m_nNcBnd_b=0;this.m_bUseNcBnd=false;this.m_nBorderGap=0;this.m_dwRndVal=0;this.m_dwRbStk=0;this.m_nZOrder=0;this.m_nSortType=0;this.m_nID=0;this.m_nTypeCode=0;this.m_nTmDelay=0;this.m_nMoveWait=0;this.m_moveProp=null;this.m_toolInfo=null;this.m_aryColor=null;this.m_buffer=null;this.m_nInObj=0;this.m_nTmpZValue=0;this.m_nTmpPValue=0;this.m_arySort=null;this.m_transform=null;this.m_wParam=null;this.m_lParam=null;this.m_ptC=null;this.m_bPageShow=1},toString:function(){return"(vx.object)"},SetWParam:function(t){this.m_wParam=t},SetLParam:function(t){this.m_lParam=t},IsFlag:function(t){return(this.m_uFlag&t)==t},IsFlag2:function(t){return(this.m_uFlag2&t)==t},IsFlagEx:function(t){return(this.m_uFlagEx&t)==t},IsFlagEx2:function(t){return(this.m_uFlagEx2&t)==t},OrFlag:function(t){return this.m_uFlag&t},OrFlag2:function(t){return this.m_uFlag2&t},OrFlagEx:function(t){return this.m_uFlagEx&t},OrFlagEx2:function(t){return this.m_uFlagEx2&t},ModifyFlag:function(t,e){this.m_uFlag|=t;this.m_uFlag&=~e;if(e&CFlags.MASK_SHOWPROP)this.ClearShowProp()},ModifyFlag2:function(t,e){this.m_uFlag2|=t;this.m_uFlag2&=~e;if(t&CFlags.STATUS2_DELETE)this.ClearShowProp()},ModifyFlagEx:function(t,e){this.m_uFlagEx|=t;this.m_uFlagEx&=~e},ModifyFlagEx2:function(t,e){this.m_uFlagEx2|=t;this.m_uFlagEx2&=~e},GetSkin:function(){if(this.m_stage)return this.m_stage.m_skin;else return null},GetStage:function(){return this.m_stage},AddObject:function(t){if(t){if(this.m_aryChild==null){this.m_aryChild=new ObArray;this.m_aryShow=new ObArray;this.m_arySort=new ObArray}this.m_aryChild.AddTail(t);if(t.IsFlag(CFlags.STATUS_INOBJECT))this.m_nInObj++}},RemoveObject:function(t){if(t&&this.m_aryChild){if(t.IsFlag(CFlags.STATUS_INOBJECT))this.m_nInObj--;this.m_aryChild.RemoveObject(t)}},Delete:function(){var t;var e;var i,n;if(this.IsFlag2(CFlags.STATUS2_TIMER)){this.ModifyFlag2(0,CFlags.STATUS2_TIMER);var s=this.GetSkin();if(s)s.m_nUpdateTimer--}this.ClearShowProp();if(this.m_aryChild){e=this.m_aryChild;n=e.length;for(i=0;i<n;i++){t=e[i];if(t==null)continue;if(t.IsFlag(CFlags.STATUS_POPUP))t.Destroy();else t.Delete()}e.RemoveAll();this.m_aryChild=null}if(this.m_aryShow){this.m_aryShow.RemoveAll();this.m_aryShow=null}if(this.m_aryTimer){this.m_aryTimer.RemoveAll();this.m_aryTimer=null}this.m_parent=null;this.m_stage=null;this.m_toolInfo=null;if(this.m_aryColor){this.m_aryColor.RemoveAll();this.m_aryColor=null}this.DestroyTimerRun();if(this.m_arySort){this.m_arySort.RemoveAll();this.m_arySort=null}if(this.m_transform){this.m_transform.Delete();this.m_transform=null}this.m_ptC=null;this.m_wParam=null;this.m_lParam=null;if(this.IsFlag(CFlags.STATUS_POPUP)&&this.m_uFlag2&CFlags.STATUS2_DOMBUFFER&&CWebPage&&CWebPage.domModalID!=null){CMyGlobal.SetPreventEvent(true)}},ClearBuffer:function(){this._RemoveDomPopup();if(this.m_buffer){this.m_buffer.Delete();this.m_buffer=null}},Prepare:function(t,e,i){this.OnPrepare();if(e&&this.IsFlag2(CFlags.STATUS2_TIMER))e.push(this);if(this.m_aryChild){var n,s;var r,a=CUtil.CRect(0,0,0,0);var o=0;var l=this.GetSkin();var _=this.m_stage;var h=this.m_parent;var f=this.m_aryChild;var C=f.length;var m=this.m_arySort;if(m)m.RemoveAll();if(_.m_backScreen)i=_.m_bUpdateAll;if(f){if(t==null){for(n=0;n<C;n++){s=f[n];if(s.IsFlag(CFlags.STATUS_POPUP))continue;if(s.IsFlag2(CFlags.STATUS2_DELETE)){f.RemoveAt(n);s.Delete();C--;n--;continue}s.Prepare(null,e,i)}}else{var u;if(this.m_nInObj>0){u=this.GetInnerClip();this.ClientToStage(u)}for(n=0;n<C;n++){s=f[n];if(s.IsFlag(CFlags.STATUS_POPUP))continue;if(s.IsFlag2(CFlags.STATUS2_DELETE)){f.RemoveAt(n);s.Delete();C--;n--;o++;continue}s.GetObjectRect(a);if(s.m_uFlag2&CFlags.STATUS2_TRANSFORM){s.TransformRect(a)}if(u&&s.IsFlag(CFlags.STATUS_INOBJECT)){r=u}else{r=t}if(!a.Intersect(r)||!s.IsFlag(CFlags.STATUS_SHOW)){s.Prepare(null,e,i);continue}else{o=s.Prepare(a,e,i)}if(i){s.ModifyFlag2(CFlags.STATUS2_UPDATE,0);o++}else{if(s.OrFlag2(CFlags.STATUS2_UPDATE|CFlags.STATUS2_REDRAW)){o++}else if(_.CheckUpdate(a)){s.ModifyFlag2(CFlags.STATUS2_UPDATE,0);o++}}m.push(s)}}}}return o},OnPrepare:function(){},CheckRedraw:function(t){if(t==null)return false;if(t.IntersectRect(this.m_stage.m_rcStage)){if(this.m_parent&&!this.OrFlag(CFlags.MASK_NOCLIP)){var e=this.m_parent.GetObjectRect();if(!e.IntersectRect(t))return false;if(this.IsFlag2(CFlags.STATUS2_UPDATEPARENT)||this.m_parent.IsFlag(CFlags.STATUS_ALPHA)){this.m_parent.CheckRedraw(e)}}this.ModifyFlag2(CFlags.STATUS2_REDRAW,0);return true}return false},UpdateRect:function(){if(this.m_buffer){var t=this.GetShowRect();if(t)this.m_stage.InvalidateRect(t)}else{this.Invalidate()}},Invalidate:function(t){this.ModifyFlag2(CFlags.STATUS2_REDRAW,0);if(t==undefined){if(!(this.m_uFlag&CFlags.STATUS_SHOW))return}var e=this.m_stage;if(e&&e.OrFlag(CFlags.STAGEST_MASK_CANUPDATE)){var i=this.GetShowRect();if(i&&this.CheckRedraw(i)){e.InvalidateRect(i);return}}},InvalidateRect:function(t){this.ModifyFlag2(CFlags.STATUS2_REDRAW,0);var e=this.m_stage;if(e&&e.OrFlag(CFlags.STAGEST_MASK_CANUPDATE)){if(this.IsFlag(CFlags.STATUS_SHOW)){this.ClientToStage(t);if(this.CheckRedraw(t)){if(this.m_uFlag2&CFlags.STATUS2_TRANSFORM){this.TransformRect(t)}this.m_stage.InvalidateRect(t);return}}}},ReverseTransformPointC:function(t){var e,i;if(this.m_ptC==null){e=this.m_width/2;i=this.m_height/2}else{e=this.m_ptC.x;i=this.m_ptC.y}t.Offset(-e,-i);if(this.m_nAngle%360!=0){var n=this.m_nAngle*Math.PI/180*-1;var s=Math.cos(n);var r=Math.sin(n);var a,o;a=s*t.x-r*t.y;o=r*t.x+s*t.y;t.x=a;t.y=o}var l=this.GetScaleX();var _=this.GetScaleY();if(l!=1){t.x=t.x/l}if(_!=1){t.y=t.y/_}t.Offset(e,i)},ReverseTransformPoint:function(t){var e,i;if(this.m_ptC==null){e=this.m_x+this.m_width/2;i=this.m_y+this.m_height/2}else{e=this.m_x+this.m_ptC.x;i=this.m_y+this.m_ptC.y}t.Offset(-e,-i);if(this.m_nAngle%360!=0){var n=this.m_nAngle*Math.PI/180*-1;var s=Math.cos(n);var r=Math.sin(n);var a,o;a=s*t.x-r*t.y;o=r*t.x+s*t.y;t.x=a;t.y=o}var l=this.GetScaleX();var _=this.GetScaleY();if(l!=1){t.x=t.x/l}if(_!=1){t.y=t.y/_}t.Offset(e,i)},TransformPointC:function(t){var e,i;if(this.m_ptC==null){e=this.m_width/2;i=this.m_height/2}else{e=this.m_ptC.x;i=this.m_ptC.y}t.Offset(-e,-i);if(this.m_nAngle%360!=0){var n=this.m_nAngle*Math.PI/180;var s=Math.cos(n);var r=Math.sin(n);var a,o;a=s*t.x-r*t.y;o=r*t.x+s*t.y;t.x=a;t.y=o}var l=this.GetScaleX();var _=this.GetScaleY();if(l!=1){t.x=t.x*l}if(_!=1){t.y=t.y*_}t.Offset(e,i)},TransformPoint:function(t){var e,i;if(this.m_ptC==null){e=this.m_x+this.m_width/2;i=this.m_y+this.m_height/2}else{e=this.m_x+this.m_ptC.x;i=this.m_y+this.m_ptC.y}t.Offset(-e,-i);if(this.m_nAngle%360!=0){var n=this.m_nAngle*Math.PI/180;var s=Math.cos(n);var r=Math.sin(n);var a,o;a=s*t.x-r*t.y;o=r*t.x+s*t.y;t.x=a;t.y=o}var l=this.GetScaleX();var _=this.GetScaleY();if(l!=1){t.x=t.x*l}if(_!=1){t.y=t.y*_}t.Offset(e,i)},TransformRectC:function(t){var e=t.Clone();var i,n;if(this.m_ptC==null){i=this.m_width/2;n=this.m_height/2}else{i=this.m_ptC.x;n=this.m_ptC.y}t.Offset(-i,-n);if(this.m_nAngle%360!=0){var s=this.m_nAngle*Math.PI/180;var r=Math.cos(s);var a=Math.sin(s);var o,l,_,h,f,C;_=o=r*t.left-a*t.top;h=l=a*t.left+r*t.top;f=r*t.right-a*t.top;C=a*t.right+r*t.top;if(f>_)_=f;else if(f<o)o=f;if(C>h)h=C;else if(C<l)l=C;f=r*t.right-a*t.bottom;C=a*t.right+r*t.bottom;if(f>_)_=f;else if(f<o)o=f;if(C>h)h=C;else if(C<l)l=C;f=r*t.left-a*t.bottom;C=a*t.left+r*t.bottom;if(f>_)_=f;else if(f<o)o=f;if(C>h)h=C;else if(C<l)l=C;t.left=o;t.top=l;t.right=_;t.bottom=h}var m=this.GetScaleX();var u=this.GetScaleY();if(m!=1){t.left*=m;t.right*=m}if(u!=1){t.top*=u;t.bottom*=u}t.Offset(i,n);t.UnionRect(e);t.IntB()},TransformRect:function(t){var e=t.Clone();var i,n;if(this.m_ptC==null){i=this.m_x+this.m_width/2;n=this.m_y+this.m_height/2}else{i=this.m_x+this.m_ptC.x;n=this.m_y+this.m_ptC.y}t.Offset(-i,-n);if(this.m_nAngle%360!=0){var s=this.m_nAngle*Math.PI/180;var r=Math.cos(s);var a=Math.sin(s);var o,l,_,h,f,C;_=o=r*t.left-a*t.top;h=l=a*t.left+r*t.top;f=r*t.right-a*t.top;C=a*t.right+r*t.top;if(f>_)_=f;else if(f<o)o=f;if(C>h)h=C;else if(C<l)l=C;f=r*t.right-a*t.bottom;C=a*t.right+r*t.bottom;if(f>_)_=f;else if(f<o)o=f;if(C>h)h=C;else if(C<l)l=C;f=r*t.left-a*t.bottom;C=a*t.left+r*t.bottom;if(f>_)_=f;else if(f<o)o=f;if(C>h)h=C;else if(C<l)l=C;t.left=o;t.top=l;t.right=_;t.bottom=h}var m=this.GetScaleX();var u=this.GetScaleY();if(m!=1){t.left*=m;t.right*=m}if(u!=1){t.top*=u;t.bottom*=u}t.Offset(i,n);t.UnionRect(e);t.IntB()},CreateP:function(t,e,i,n,s,r){if(this.m_stage||t==null)return false;e.IntR();this.m_stage=t;this.m_parent=r;this.m_nID=i;this.m_x=e.left;this.m_y=e.top;this.m_width=e.Width();this.m_height=e.Height();this.ModifyFlag(n,0);this.ModifyFlagEx(s,0);if(vx.bUseDomPopup&&this.IsFlag(CFlags.STATUS_POPUP)){this.ModifyFlag2(CFlags.STATUS2_DOMBUFFER,0)}if(this.m_parent&&this.m_parent.OrFlag2(CFlags.STATUS2_DOMBUFFER|CFlags.STATUS2_FORCEDRAW)){this.ModifyFlag2(CFlags.STATUS2_FORCEDRAW,0)}if(!this.OnCreate())return false;if(this.m_parent){this.m_parent.AddObject(this);if(this.IsFlag(CFlags.STATUS_POPUP))this.m_stage.AddObject(this)}else{this.m_stage.AddObject(this)}if(this.IsFlag(CFlags.STATUS_POPUP)){if(this.IsFlag(CFlags.STATUS_MODAL)&&vx.Global.g_bUseModalBack){var a=this.m_stage.GetStageRect();if(!e.Equal(a)){this.m_stage.CreateModalBack(this)}}this.PopupOrder()}else{this.ModifyFlag(0,CFlags.STATUS_MODAL);this.m_nZOrder=vx.nPopupOrder;vx.nPopupOrder++}if(this.IsFlag(CFlags.STATUS_MODAL)){this.ModifyFlag(CFlags.STATUS_SHOW,0);this.GetSkin().AddModalStack(this)}if(this.IsFlag(CFlags.STATUS_INOBJECT)){this.ModifyFlag(CFlags.STATUS_NOFOCUS,0)}this.OnSize();this.Invalidate();if(this.OrFlagEx2(CFlags.MASK_SHOWINEFFECT)&&this.IsFlag(CFlags.STATUS_SHOW)){if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFADEIN))this.ShowFade(true);if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTRAISE))this.ShowRaise(true)}return true},Create:function(t,e,i,n,s,r){var a=e.Clone();if(r&&!(n&CFlags.STATUS_POPUP))r.StageToClient(a);return this.CreateP(t,a,i,n,s,r)},OnCreate:function(){if(this.OrFlag2(CFlags.STATUS2_RSTICKER|CFlags.STATUS2_BSTICKER)){this.SetSticker(this.IsFlag2(CFlags.STATUS2_RSTICKER),this.IsFlag2(CFlags.STATUS2_BSTICKER))}return true},OnSize:function(){this.ClearBuffer();if(this.m_aryChild){var t,e,i,n,s,r;var a=this.m_aryChild.length;n=this.m_width;s=this.m_height;for(var o=0;o<a;o++){t=this.m_aryChild.GetAt(o);if(t.OrFlag2(CFlags.STATUS2_BSTICKER|CFlags.STATUS2_RSTICKER)){e=CUtil.LOWORD(t.m_dwRbStk);i=CUtil.HIWORD(t.m_dwRbStk);r=t.GetObjectRectP();if(t.IsFlag2(CFlags.STATUS2_RSTICKER)){r.right=n-e;r.left=r.right-t.m_width}if(t.IsFlag2(CFlags.STATUS2_BSTICKER)){r.bottom=s-i;r.top=r.bottom-t.m_height}t.MoveObjectP(r)}}}},OnMove:function(t,e){if(this.IsFlag2(CFlags.STATUS2_DOMBUFFER)&&this.m_buffer){var i=this.GetObjectRect();this.GetSkin().ViewToWindow(i);this.m_buffer.m_canvas.style.left=i.left.toString()+"px";this.m_buffer.m_canvas.style.top=i.top.toString()+"px";this.m_buffer.m_canvas.style.width=i.Width().toString()+"px";this.m_buffer.m_canvas.style.height=i.Height().toString()+"px"}},OnDestroy:function(){},Destroy:function(){this.OnDestroy();if(this.m_modalback!=undefined&&this.m_modalback){this.m_modalback.Destroy();this.m_modalback=null}if(this.IsFlag2(CFlags.STATUS2_TIMER)){this.ModifyFlag2(0,CFlags.STATUS2_TIMER);var t=this.GetSkin();if(t)t.m_nUpdateTimer--}if(this.m_parent&&this.IsFlag(CFlags.STATUS_POPUP)){this.m_parent.RemoveObject(this);this.m_parent=null}this.ModifyFlag2(CFlags.STATUS2_DELETE,0);this.Invalidate(true)},ShowObject:function(t){if(t){if(this.IsFlag(CFlags.STATUS_SHOW))return;if(this.OrFlag(CFlags.MASK_POPUP))this.PopupOrder();if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFADEIN))this.ShowFade(true);else if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTRAISE))this.ShowRaise(true);else{this.ModifyFlag(CFlags.STATUS_SHOW,0);this.Invalidate()}}else{if(!this.IsFlag(CFlags.STATUS_SHOW))return;if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFADEOUT))this.ShowFade(false,0,false);else if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFALL))this.ShowRaise(false);else{this.ModifyFlag(0,CFlags.STATUS_SHOW);this.Invalidate(true)}}this.OnShow(t)},OnShow:function(t){},EnableObject:function(t){if(t){if(this.IsFlag(CFlags.STATUS_ENABLED))return;this.ModifyFlag(CFlags.STATUS_ENABLED,0);this.Invalidate()}else{if(!this.IsFlag(CFlags.STATUS_ENABLED))return;this.ModifyFlag(0,CFlags.STATUS_ENABLED);this.Invalidate();if(this.GetCaptureObject()==this)this.m_stage.SetCaptureObject(null);if(this.GetFocusObject()==this)this.m_stage.SetFocusObject(null);if(this.m_uFlag&CFlags.STATUS_MODAL)this.m_stage.m_skin.RemoveModalStack(this)}this.OnEnable(t)},OnEnable:function(t){},Close:function(){if(!this.OnClose())return;this.Destroy()},OnClose:function(){return true},OnTimer:function(t,e,i,n){if(this.m_nTmDelay>0){if(this.m_nTmDelay>e){this.m_nTmDelay-=e;return}e-=this.m_nTmDelay;this.m_nTmDelay=0;this.OnTimerDelayEnd()}var s;if(t==CDefine.DEFTIMER_MOVE){if(this.m_moveProp){var r=new vx.rect(0,0,0,0);var a=new vx.point(0,0);if(this.m_nMoveWait){if(this.m_nMoveWait>=e){this.m_nMoveWait-=e;return}else{e-=this.m_nMoveWait;this.m_nMoveWait=0}}var o=this.m_moveProp.TimerRun(e,r,a);if(o&CDefine.MOVERESULT_CLEAR){this.KillTimer(CDefine.DEFTIMER_MOVE)}else if(o&CDefine.MOVERESULT_CHANGE){if(o&CDefine.MOVERESULT_CALLBACK)this.OnTimerMoveCall(r,a.x,a.y);if(o&CDefine.MOVERESULT_MOVEEND)this.OnTimerMoveEnd()}}else{this.KillTimer(CDefine.DEFTIMER_MOVE)}}else if(t==CDefine.DEFTIMER_TRANSFORM){this.DoTransform(e)}else if(t==CDefine.DEFTIMER_EFFECTIN){if(!this.IsFlag(CFlags.STATUS_SHOW))this.ShowObject(true);this.m_nTmAlpha+=e;if(this.m_nTmAlphaLimit<=0||this.m_nTmAlphaLimit<=this.m_nTmAlpha){this.KillTimer(t);if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTRAISE)){this.ModifyFlagEx2(0,CFlags.STATUSEX2_EFFECTRAISE);this.SetScale(1,1)}if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFADEIN)){this.ModifyFlagEx2(0,CFlags.STATUSEX2_EFFECTFADEIN);this.SetAlpha(1)}}else{if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTRAISE)){s=this.m_nTmAlpha/this.m_nTmAlphaLimit;this.SetScale(s,s)}if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFADEIN)){this.SetAlpha(this.m_nTmAlpha/this.m_nTmAlphaLimit)}}}else if(t==CDefine.DEFTIMER_EFFECTOUT){this.m_nTmAlpha+=e;if(this.m_nTmAlphaLimit<=0||this.m_nTmAlphaLimit<=this.m_nTmAlpha){this.KillTimer(t);if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTOUT_DESTROY)){this.Destroy()}else{if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFALL)){this.ModifyFlagEx2(0,CFlags.STATUSEX2_EFFECTFALL);this.SetScale(1,1)}if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFADEOUT)){this.ModifyFlagEx2(0,CFlags.STATUSEX2_EFFECTFADEOUT);this.SetAlpha(1)}this.ShowObject(false)}}else{if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFALL)){s=1-this.m_nTmAlpha/this.m_nTmAlphaLimit;this.SetScale(s,s)}if(this.IsFlagEx2(CFlags.STATUSEX2_EFFECTFADEOUT)){this.SetAlpha(1-this.m_nTmAlpha/this.m_nTmAlphaLimit)}}}},OnTimerDelayEnd:function(){},OnTimerMoveEnd:function(){},OnTimerMoveCall:function(t,e,i){},Timer:function(t){if(!this.IsFlag2(CFlags.STATUS2_TIMER))return;if(this.m_aryTimer){var e,i,n,s,r;s=this.m_aryTimer;n=s.length;for(i=0;i<n;i++){e=s[i];if(e.nDeleteFlag==1){s.RemoveAt(i);n--;i--;continue}e.nTimeSum+=t;if(e.nTimeGap==0){r=e.nTimeSum%1e3;this.OnTimer(e.nTimerID,t,e.nTimeSum/1e3,r);e.nTimeSum=r}else if(e.nTimeSum>=e.nTimeGap){r=e.nTimeSum%e.nTimeGap;this.OnTimer(e.nTimerID,e.nTimeSum-r,(e.nTimeSum-r)/e.nTimeGap,r);e.nTimeSum=r}}if(s.length<=0){this.ModifyFlag2(0,CFlags.STATUS2_TIMER);var a=this.GetSkin();if(a)a.m_nUpdateTimer--}}},SetTimer:function(t,e){var i=this.GetSkin();if(i==null)return;var n,s,r,a;if(!this.IsFlag2(CFlags.STATUS2_TIMER)){this.ModifyFlag2(CFlags.STATUS2_TIMER,0);i.m_nUpdateTimer++}if(!this.m_aryTimer)this.m_aryTimer=new ObArray;a=this.m_aryTimer;r=this.m_aryTimer.length;for(s=0;s<r;s++){n=a[s];if(n.nTimerID==t){n.nTimeSum=0;n.nTimeGap=e;n.nDeleteFlag=0;return}}n=new vx.timer_info(t,e);this.m_aryTimer.AddTail(n)},KillTimer:function(t){if(this.m_aryTimer==null)return;var e,i,n,s;s=this.m_aryTimer;n=s.length;for(i=0;i<n;i++){e=s[i];if(e.nTimerID==t){e.nDeleteFlag=1;return}}},IsTimer:function(t){if(this.m_aryTimer==null)return false;var e,i,n,s;s=this.m_aryTimer;n=s.length;for(i=0;i<n;i++){e=s[i];if(e.nTimerID==t&&e.nDeleteFlag!=1){return true}}return false},Draw:function(t){if(this.m_uFlag2&CFlags.STATUS2_NODRAW){this.ModifyFlag2(0,CFlags.STATUS2_UPDATE|CFlags.STATUS2_REDRAW|CFlags.STATUS2_DOCUMENTONLY);return}var e=this.m_x;var i=this.m_y;var n=this.m_width;var s=this.m_height;var r=this.m_uFlag&CFlags.STATUS_ALPHA;var a=this.m_uFlag2&CFlags.STATUS2_TRANSFORM;var o;if(this.m_uFlag&CFlags.STATUS_NOCLIP){o=null}else if(this.m_parent&&!(this.m_uFlag&CFlags.STATUS_POPUP)){o=this.m_parent.GetChildClipRect(this);if(o){if(o.IsEmpty())return;o.Offset(-e,-i)}}else{if(a){o=new vx.rect(e,i,e+n,i+s);this.TransformRect(o);o.Offset(-e,-i)}else{o=new vx.rect(0,0,n,s)}}t.TranslateClip(e,i,o);if(a){var l,_;if(this.m_ptC==null){l=n/2;_=s/2}else{l=this.m_ptC.x;_=this.m_ptC.y}t.Transform(l,_,this.m_nAngle,this.GetScaleX(),this.GetScaleY())}var h=this.GetSkin();var f=this.m_stage;var C=t;if(this.m_uFlag&CFlags.STATUS_NOBUFFER){this.ClearBuffer();if(r)t.Alpha(this.m_nAlpha)}else if(r||this.m_uFlag&CFlags.STATUS_USEBUFFER||this.m_uFlag2&CFlags.STATUS2_DOMBUFFER){if(!this.m_buffer){this.m_buffer=new vx.buffer(null,n,s);this.ModifyFlag2(CFlags.STATUS2_REDRAW,0);if(this.IsFlag2(CFlags.STATUS2_DOMBUFFER))this._AppendDomPopup(this.m_buffer)}else if(this.m_uFlag2&CFlags.STATUS2_DOMBUFFER){this.ModifyFlag2(CFlags.STATUS2_REDRAW,0)}C=this.m_buffer;if(this.m_uFlag2&CFlags.STATUS2_REDRAW)C.VX_Clear()}var m=new vx.rect(0,0,n,s);if(t==C)t.OffsetTransform(m);var u=m.Clone();this.DeflateBound(u);var T=u.Clone();this.DeflateWork(T);var S=false;CUtil.SortingObject_ByType(this.m_aryShow,this.m_arySort,this.m_nSortType);if(this.m_uFlag2&CFlags.STATUS2_REDRAW||t==C){if(this.m_parent&&this.m_uFlag2&CFlags.STATUS2_PARENTDRAW){S=true;if(this.m_bUseNcBnd){var c=this.m_parent.OnDrawFrameChild(C,u.Clone(),this);if(c!=undefined&&c!=null)T=c}C.Clip(T);this.m_parent.OnDrawChild(C,m,this);C.Restore();if(t!=C&&!(this.m_uFlag2&CFlags.STATUS2_LOCK)){this.DrawChild(C)}}else{if(this.m_uFlag&CFlags.STATUS_SHADOW){this.OnDrawShadow(C,m.Clone())}if(this.m_uFlag&CFlags.STATUS_PARTALPHA){this.OnDrawPartAlpha(C,u.Clone())}if(this.m_bUseNcBnd){var c=this.OnDrawFrame(C,u.Clone());if(c!=undefined&&c!=null)T=c}C.Clip(T);this.OnDraw(C,T);C.Restore();if(t!=C&&this.m_uFlag2&CFlags.STATUS2_LOCK){this.DrawChild(C)}}}if(t!=C){if(r){if(!(this.m_uFlag2&CFlags.STATUS2_LOCK))this.DrawChild(C);t.Alpha(this.m_nAlpha);t.BltBlock(C,-t.m_cx,-t.m_cy,0,0,n,s);t.RestoreAlpha()}else if(this.IsFlag2(CFlags.STATUS2_DOMBUFFER)){this.DrawChild(C);t.BltBlock(C,-t.m_cx,-t.m_cy,0,0,n,s)}else{if(this.m_uFlagEx2&CFlags.STATUSEX2_GRIDBLT_MASK){if(this.m_uFlagEx2&CFlags.STATUSEX2_HORZGRIDBLT)t.HorzGridBlt(C,-t.m_cx,-t.m_cy,0,0,n,s,this.m_minBlt);else if(this.m_uFlagEx2&CFlags.STATUSEX2_VERTGRIDBLT)t.VertGridBlt(C,-t.m_cx,-t.m_cy,0,0,n,s,this.m_minBlt)}else t.BltBlock(C,-t.m_cx,-t.m_cy,0,0,n,s);if(!(this.m_uFlag2&CFlags.STATUS2_LOCK))this.DrawChild(t)}}else{this.DrawChild(t);if(r)t.RestoreAlpha()}if(this.m_uFlag&CFlags.STATUS_DRAWAFTER){if(S)this.m_parent.OnDrawAfterChild(t,u,this);else this.OnDrawAfter(t,u)}if(a)t.RestoreTransform();t.Restore();this.ModifyFlag2(0,CFlags.STATUS2_UPDATE|CFlags.STATUS2_REDRAW|CFlags.STATUS2_DOCUMENTONLY)},DrawChild:function(t){if(this.m_aryChild){var e,i=this.m_aryShow;var n,s=i.length;for(n=0;n<s;n++){e=i[n];if(!e.OrFlag2(CFlags.STATUS2_UPDATE|CFlags.STATUS2_REDRAW|CFlags.STATUS2_FORCEDRAW))continue;e.Draw(t)}}},OnDraw:function(t,e){var i=this.GetColor(CColor.INDEX_CONTROLBKGND);var n=this.GetColor(CColor.INDEX_CONTROLBORDER);t.FillSolidRect(e,i,n,n)},OnDrawFrame:function(t,e){return e},OnDrawPartAlpha:function(t,e){},OnDrawShadow:function(t,e){},OnDrawFrameChild:function(t,e,i){},OnDrawChild:function(t,e,i){},OnDrawAfterChild:function(t,e,i){},OnDrawAfter:function(t,e,i){},DestroyTimerRun:function(){if(this.m_moveProp==null)return;this.m_moveProp.Delete();this.m_moveProp=null;this.KillTimer(CDefine.DEFTIMER_MOVE)},CreateTimerRun:function(){if(this.m_moveProp!=null)return;this.m_moveProp=new vx.move_prop(this);if(this.IsFlag2(CFlags.STATUS2_CONTINUEPROP))this.m_moveProp.ModifyProp(CDefine.MOVEPROP_CONTINUEPROP,0)},SetMoveProperty:function(t,e){if(this.m_moveProp==null)this.CreateTimerRun();this.m_moveProp.ModifyProp(t,e)},Moving:function(t,e,i,n,s,r){switch(arguments.length){case 6:break;case 5:r=65535;break;case 4:r=65535;s=-1;break;case 3:r=65535;s=-1;n=-1;i=-1;break;case 2:r=65535;s=-1;n=-1;i=-1;e=-1;break;default:return}this.CreateTimerRun();return this.m_moveProp.MovingByRect(t,e,i,n,s,r)},MovingP:function(t,e,i,n,s,r){switch(arguments.length){case 6:break;case 5:r=65535;break;case 4:r=65535;s=-1;break;case 3:r=65535;s=-1;n=-1;i=-1;break;case 2:r=65535;s=-1;n=-1;i=-1;e=-1;break;default:return}this.CreateTimerRun();return this.m_moveProp.MovingByRectP(t,e,i,n,s,r)},Pumping:function(t,e,i,n,s,r,a,o){switch(arguments.length){case 8:break;case 7:o=0;break;case 6:o=0;a=.2;break;case 5:o=0;a=.2;r=.5;s=1;break;default:return}this.CreateTimerRun();return this.m_moveProp.Pumping(t,e,i,n,s,r,a,o)},PumpingPoint:function(t,e,i,n,s,r){switch(arguments.length){case 6:break;case 5:r=.5;break;case 4:r=.5;s=1;break;default:return}this.CreateTimerRun();var a=this.GetObjectRect();var o=new vx.point((a.left+a.top)/2,(a.top+a.bottom)/2);return this.m_moveProp.PumpingPoint(o,t,e,i,n,s,r)},ClientToStage:function(t){var e=this;while(e){t.Offset(e.m_x,e.m_y);if(e.IsFlag(CFlags.STATUS_POPUP))break;e=e.m_parent}},StageToClient:function(t){var e=this;while(e){t.Offset(-e.m_x,-e.m_y);if(e.IsFlag(CFlags.STATUS_POPUP))break;e=e.m_parent}},ClientToStagePoint:function(t){var e=this;while(e){t.Offset(e.m_x,e.m_y);if(e.IsFlag(CFlags.STATUS_POPUP))break;e=e.m_parent}},StageToClientPoint:function(t){var e=this;while(e){t.Offset(-e.m_x,-e.m_y);if(e.IsFlag(CFlags.STATUS_POPUP))break;e=e.m_parent}},GetShowRect:function(t){if(arguments.length==0)t=CUtil.CRect(this.m_x,this.m_y,this.m_x+this.m_width,this.m_y+this.m_height);else t.SetRect(this.m_x,this.m_y,this.m_x+this.m_width,this.m_y+this.m_height);if(this.m_uFlag2&CFlags.STATUS2_TRANSFORM)this.TransformRect(t);if(this.m_uFlag&CFlags.STATUS_POPUP)return t;var e=this.m_parent;while(e){t.Offset(e.m_x,e.m_y);if(e.m_uFlag2&CFlags.STATUS2_TRANSFORM)e.TransformRect(t);if(e.m_uFlag&CFlags.STATUS_POPUP)return t;e=e.m_parent}return t;return null},GetObjectRect:function(t){if(arguments.length==0)t=CUtil.CRect(this.m_x,this.m_y,this.m_x+this.m_width,this.m_y+this.m_height);else t.SetRect(this.m_x,this.m_y,this.m_x+this.m_width,this.m_y+this.m_height);if(this.m_uFlag&CFlags.STATUS_POPUP)return t;if(this.m_parent&&!(this.m_uFlag&CFlags.STATUS_POPUP))this.m_parent.ClientToStage(t);return t},GetObjectRectP:function(t){if(arguments.length==0)t=CUtil.CRect(this.m_x,this.m_y,this.m_x+this.m_width,this.m_y+this.m_height);else t.SetRect(this.m_x,this.m_y,this.m_x+this.m_width,this.m_y+this.m_height);return t},GetClientRect:function(t){if(arguments.length==0)t=CUtil.CRect(0,0,this.m_width,this.m_height);else t.SetRect(0,0,this.m_width,this.m_height);return t},GetBoundRect:function(t){if(arguments.length==0)t=this.GetClientRect();this.DeflateBound(t);return t},GetWorkRect:function(t){if(arguments.length==0)t=this.GetClientRect();this.DeflateBound(t);this.DeflateWork(t);return t},GetWorkRectA:function(){var t=this.GetObjectRect();this.DeflateBound(t);this.DeflateWork(t);return t},DeflateBound:function(t){t.left+=this.m_nSdOff_l;t.top+=this.m_nSdOff_t;t.right-=this.m_nSdOff_r;t.bottom-=this.m_nSdOff_b},DeflateWork:function(t){t.left+=this.m_nNcBnd_l;t.top+=this.m_nNcBnd_t;t.right-=this.m_nNcBnd_r;t.bottom-=this.m_nNcBnd_b},InflateBound:function(t){t.left-=this.m_nSdOff_l;t.top-=this.m_nSdOff_t;t.right+=this.m_nSdOff_r;t.bottom+=this.m_nSdOff_b},InflateWork:function(t){t.left-=this.m_nNcBnd_l;t.top-=this.m_nNcBnd_t;t.right+=this.m_nNcBnd_r;t.bottom+=this.m_nNcBnd_b},SetShadowGap:function(t,e,i,n){this.m_nSdOff_l=Math.floor(t);this.m_nSdOff_t=Math.floor(e);this.m_nSdOff_r=Math.floor(i);this.m_nSdOff_b=Math.floor(n)},AddShadowGap:function(t,e,i,n){this.m_nSdOff_l+=Math.floor(t);this.m_nSdOff_t+=Math.floor(e);this.m_nSdOff_r+=Math.floor(i);this.m_nSdOff_b+=Math.floor(n)},SetBorderGap:function(t,e,i,n){this.m_nNcBnd_l=0;this.m_nNcBnd_t=0;this.m_nNcBnd_r=0;this.m_nNcBnd_b=0;this.AddBorderGap(t,e,i,n)},SetBorderGapEx:function(t,e){switch(e){case 0:this.m_nNcBnd_l=0;break;case 1:this.m_nNcBnd_t=0;break;case 2:this.m_nNcBnd_r=0;break;case 3:this.m_nNcBnd_b=0;break;default:return}this.AddBorderGapEx(t,e)},AddBorderGap:function(t,e,i,n){this.m_nNcBnd_l+=Math.floor(t);this.m_nNcBnd_t+=Math.floor(e);this.m_nNcBnd_r+=Math.floor(i);this.m_nNcBnd_b+=Math.floor(n);if(this.m_nNcBnd_l!=0||this.m_nNcBnd_t!=0||this.m_nNcBnd_r!=0||this.m_nNcBnd_b!=0)this.m_bUseNcBnd=true;else this.m_bUseNcBnd=false},AddBorderGapEx:function(t,e){var i=this.IsFlagEx(CFlags.VXBOX_RESIZEBORDER);switch(e){case 0:this.m_nNcBnd_l+=Math.floor(t);break;case 1:this.m_nNcBnd_t+=Math.floor(t);break;case 2:this.m_nNcBnd_r+=Math.floor(t);break;case 3:this.m_nNcBnd_b+=Math.floor(t);break;default:return}if(this.m_nNcBnd_l!=0||this.m_nNcBnd_t!=0||this.m_nNcBnd_r!=0||this.m_nNcBnd_b!=0)this.m_bUseNcBnd=true;else this.m_bUseNcBnd=false},GetBorderGapEx:function(t){switch(t){case 0:return this.m_nNcBnd_l;case 1:return this.m_nNcBnd_t;case 2:return this.m_nNcBnd_r;case 3:return this.m_nNcBnd_b;default:return 0}},GetPointRect:function(t){var e=this.m_width;var i=this.m_height;return new vx.rect(t.x-e/2,t.y-i/2,t.x-e/2+e,t.y-i/2+i)},GetChildClipRect:function(t){var e,i=t.GetObjectRectP();if(t.m_uFlag2&CFlags.STATUS2_TRANSFORM){t.TransformRect(i)}if(t.IsFlag(CFlags.STATUS_INOBJECT)){e=this.GetInnerClip()}else{e=this.GetBoundRect()}e.IntersectRect(i);return e},GetInnerClip:function(){var t=this.GetWorkRect();if(this.m_uFlag2&CFlags.STATUS2_TRANSFORM){this.TransformRect(t)}return t},ChangeModalStack:function(t){},SetZOrder:function(t){if(this.OrFlag(CFlags.MASK_POPUP))return;this.m_nZOrder=t},PopupOrder:function(){var t;if(this.OrFlag(CFlags.MASK_POPUP))t=this;else t=this.GetTopLevelObject();if(t&&t.OrFlag(CFlags.MASK_POPUP)){if(vx.nPopupOrder-1==t.m_nZOrder)return;t.m_nZOrder=vx.nPopupOrder;if(t.IsFlag2(CFlags.STATUS2_DOMBUFFER)&&t.m_buffer){t.m_buffer.m_canvas.style.zIndex=vx.nPopupOrder}vx.nPopupOrder++;t.Invalidate();t.PopupOrderChild()}},PopupOrderChild:function(){if(this.m_aryChild){var t;var e=this.m_aryChild.length;for(var i=0;i<e;i++){t=this.m_aryChild[i];if(t.OrFlag(CFlags.MASK_POPUP)){t.m_nZOrder=vx.nPopupOrder;if(t.IsFlag2(CFlags.STATUS2_DOMBUFFER)&&t.m_buffer){t.m_buffer.m_canvas.style.zIndex=vx.nPopupOrder}vx.nPopupOrder++;t.Invalidate();t.PopupOrderChild()}}}},GetTopLevelObject:function(){var t=this;var e=this.m_parent;while(e){t=e;if(e.OrFlag(CFlags.MASK_POPUP))break;e=e.m_parent}return t},SetSticker:function(t,e){if(!this.m_parent)return;var i,n,s;var r=this.m_parent.m_width;var a=this.m_parent.m_height;i=this.GetObjectRectP();if(t){n=r-i.right;this.ModifyFlag2(CFlags.STATUS2_RSTICKER,0)}else{n=0;this.ModifyFlag2(0,CFlags.STATUS2_RSTICKER)}if(e){s=a-i.bottom;this.ModifyFlag2(CFlags.STATUS2_BSTICKER,0)}else{s=0;this.ModifyFlag2(0,CFlags.STATUS2_BSTICKER)}this.m_dwRbStk=CUtil.MAKELONG(n,s)},GetCommonImage:function(){var t=this.m_uFlag;if(t&CFlags.STATUS_COMMONIMAGE0)return 0;else if(t&CFlags.STATUS_COMMONIMAGE1)return 1;else if(t&CFlags.STATUS_COMMONIMAGE2)return 2;else return-1},SetImageShadowGap:function(t){if(t&&t.IsResize()){var e=t.GetImageRect();var i=t.m_rcInner.Clone();if(t.IsFlag(CDefine.PKFLAG_HALFSHADOW)){this.AddShadowGap(0,0,(e.right-i.right)/2,(e.bottom-i.bottom)/2)}else{this.AddShadowGap((i.left-e.left)/2,(i.top-e.top)/2,(e.right-i.right)/2,(e.bottom-i.bottom)/2)}return true}return false},GetColor:function(t){if(this.m_aryColor==null){return CColor.GetColor(t)}else{var e=this.m_aryColor.GetAt(t);if(e==4026531839)return 4294967295;else if(e==4294967295)return CColor.GetColor(t);else return e}},SetColor:function(t,e){if(this.m_aryColor==null){this.m_aryColor=new ObArray;for(var i=0;i<CColor.INDEX_MAXCOLOR;i++){this.m_aryColor.Add(4294967295)}}this.m_aryColor.SetAt(t,e)},GetColorArray:function(t){if(t==null)return;t.RemoveAll();if(this.m_aryColor==null)t.AddTails(CColor.g_aryColor);else t.AddTails(this.m_aryColor)},SetColorArray:function(t){if(t==null)return;if(this.m_aryColor==null)this.m_aryColor=new ObArray;else this.m_aryColor.RemoveAll();this.m_aryColor.AddTails(t);this.Invalidate()},Focus:function(){},FocusClear:function(){},SetCaptureObject:function(){if(this.m_stage)this.m_stage.SetCaptureObject(this)},GetCaptureObject:function(){if(this.m_stage)return this.m_stage.GetCaptureObject();else return null},ReleaseCaptureObject:function(){if(this.m_stage)this.m_stage.ReleaseCaptureObject()},SetFocusObject:function(){if(this.m_stage)this.m_stage.SetFocusObject(this)},GetFocusObject:function(){if(this.m_stage)return this.m_stage.GetFocusObject();else return null},OnReleaseCapture:function(){},MessageDispatch:function(t,e,i,n,s){if(this.IsFlag(CFlags.STATUS_NOMESSAGE)||!this.IsFlag(CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED))return 0;var r=0;e-=this.m_x;i-=this.m_y;var a=this.GetCaptureObject();var o=new vx.point(e,i);if(this.m_uFlag2&CFlags.STATUS2_TRANSFORM)this.ReverseTransformPointC(o);switch(t){case CMessage.WM_MOUSEMOVE:if(this.IsFlag(CFlags.STATUS_NOMOUSEMOVE))return 0;if(a==this){e=o.x;i=o.y;this.OnMouseMove(e,i,n);if(this.m_toolInfo)this.m_stage.ShowToolTip(this,e,i,n);r++;break}if(this.HitTest(e,i)){e=o.x;i=o.y;r=this.MessageDispatchChild(t,e,i,n,s);if(r==0){this.OnSetCursor(CDefine.HTCLIENT,CMessage.WM_MOUSEMOVE);this.OnMouseMove(e,i,n);if(this.m_toolInfo)this.m_stage.ShowToolTip(this,e,i,n);r++}else{if(this.IsOverToolTip())this.m_stage.CloseToolTip(this);if(this.IsFlag2(CFlags.STATUS2_NOCLEARFOCUSBYCHILD)){this.ModifyFlag2(CFlags.STATUS2_SKIPCURSOR,0);this.OnMouseMove(e,i,n);this.ModifyFlag2(0,CFlags.STATUS2_SKIPCURSOR)}else{this.OnMouseLeave()}}}else{e=o.x;i=o.y;this.MessageDispatchChild(CMessage.WM_MOUSELEAVE,e,i,n,s);if(this.IsOverToolTip())this.m_stage.CloseToolTip(this);this.OnMouseLeave()}break;case CMessage.WM_LBUTTONDOWN:if(this.IsOverToolTip())this.m_stage.CloseToolTip(this,false);if(a==this||this.HitTest(e,i)){e=o.x;i=o.y;if((r=this.MessageDispatchChild(t,e,i,n,s))>0)break;this.PopupOrder();this.SetFocusObject();this.OnLButtonDown(e,i,n);this.ModifyFlag2(CFlags.STATUS2_PREVDLBCLK,0);r++}break;case CMessage.WM_LBUTTONDBLCLK:if(this.IsOverToolTip())this.m_stage.CloseToolTip(this,false);if(a==this||this.HitTest(e,i)){e=o.x;i=o.y;if((r=this.MessageDispatchChild(t,e,i,n,s))>0)break;if(this.IsFlag2(CFlags.STATUS2_PREVDLBCLK)){this.OnLButtonDblClk(e,i,n);this.ModifyFlag2(0,CFlags.STATUS2_PREVDLBCLK);r++}}break;case CMessage.WM_LBUTTONUP:if(this.IsOverToolTip())this.m_stage.CloseToolTip(this,false);if(a==this||this.HitTest(e,i)){e=o.x;i=o.y;if((r=this.MessageDispatchChild(t,e,i,n,s))>0)break;this.OnLButtonUp(e,i,n);r++}break;case CMessage.WM_MOUSELEAVE:e=o.x;i=o.y;r=this.MessageDispatchChild(t,e,i,n,s);if(this.IsOverToolTip())this.m_stage.CloseToolTip(this);this.OnMouseLeave();r=0;break;case CMessage.WM_MOUSEWHEEL:if(this.m_stage.GetFocusObject()==this){e=o.x;i=o.y;this.OnMouseWheel(e,i,n,s);r++}break;case CMessage.WM_KEYDOWN:if(this.m_stage.GetFocusObject()==this){this.OnKeyDown(n,s);r++}break;case CMessage.WM_CHAR:if(this.m_stage.GetFocusObject()==this){this.OnChar(n,s);r++}break;case CMessage.WM_KEYUP:if(this.m_stage.GetFocusObject()==this){this.OnKeyUp(n,s);r++}break;case CMessage.WM_GRAPMODESTART:e=o.x;i=o.y;this.OnGrapModeStart(e,i,n);this.MessageDispatchChild(CMessage.WM_CANCELMODE,e,i,n,0);break;case CMessage.WM_GRAPMODE:e=o.x;i=o.y;this.OnGrapMode(e,i,n);break;case CMessage.WM_GRAPMODEEND:e=o.x;i=o.y;this.OnGrapModeEnd(e,i,n);break;case CMessage.WM_CANCELMODE:this.OnCancelMode();this.MessageDispatchChild(CMessage.WM_CANCELMODE,e,i,n,s);break;case CMessage.WM_RESIZESTAGE:this.OnResizeStage();this.MessageDispatchChild(CMessage.WM_RESIZESTAGE,e,i,n,s);break;case CMessage.WM_PAGEVISIBLE:this.OnPageVisible(e);this.MessageDispatchChild(CMessage.WM_PAGEVISIBLE,e,0,0,0);break;case CMessage.WM_RBUTTONDOWN:if(this.IsOverToolTip())this.m_stage.CloseToolTip(this,false);if(a==this||this.HitTest(e,i)){e=o.x;i=o.y;if((r=this.MessageDispatchChild(t,e,i,n,s))>0)break;this.PopupOrder();this.SetFocusObject();this.OnRButtonDown(e,i,n);r++}break}return r},MessageDispatchChild:function(t,e,i,n,s){if(this.m_aryShow==null)return 0;var r,a=this.m_aryShow;var o=a.length;var l=0;for(var _=o-1;_>=0;_--){r=a[_];if(r.m_uFlag&CFlags.STATUS_POPUP)continue;l+=r.MessageDispatch(t,e,i,n,s);if(t==CMessage.WM_CANCELMODE)continue;if(l>0){if(t==CMessage.WM_MOUSEMOVE){t=CMessage.WM_MOUSELEAVE;continue}if(t!=CMessage.WM_MOUSELEAVE)return l}}return l},HitNoModalArea:function(t,e,i,n,s){this.SetFocusObject();return 1},OnLButtonDown:function(t,e,i){},OnRButtonDown:function(){},OnMouseMove:function(t,e,i){},OnGrapModeStart:function(t,e,i){},OnGrapMode:function(t,e,i){},OnGrapModeEnd:function(t,e,i){},OnLButtonUp:function(t,e,i){},OnLButtonDblClk:function(t,e,i){},OnMouseWheel:function(t,e,i,n){},OnMouseLeave:function(){},OnCancelMode:function(t){},OnPageVisible:function(t){this.m_bPageShow=t},OnResizeStage:function(){},OnKeyDown:function(t,e){},OnChar:function(t,e){},OnKeyUp:function(t,e){},OnDropObject:function(t,e,i,n){},OnDropObjectNotifyOwner:function(t,e,i,n){},OnSetCursor:function(t,e){},HitTest:function(t,e){if(!this.IsFlag(CFlags.STATUS_ENABLED))return false;var i=this.GetBoundRect();if(this.m_uFlag2&CFlags.STATUS2_TRANSFORM){this.TransformRect(i)}if(this.m_parent&&this.m_uFlag&CFlags.STATUS_INOBJECT){var n=this.m_parent.GetInnerClip();n.Offset(-this.m_x,-this.m_y);i.IntersectRect(n)}return i.Contain(t,e)},HitBorderTest:function(t,e){var i=this.GetBoundRect();var n=this.m_nBorderGap;var s=CUtil.CRect(i.left,i.top,i.left+n,i.top+n);var r=CUtil.CRect(i.right-n,i.top,i.right,i.top+n);var a=CUtil.CRect(i.right-n,i.bottom-n,i.right,i.bottom);var o=CUtil.CRect(i.left,i.bottom-n,i.left+n,i.bottom);var l=CUtil.CRect(i.left,i.top,i.left+n,i.bottom);var _=CUtil.CRect(i.left,i.top,i.right,i.top+n);var h=CUtil.CRect(i.right-n,i.top,i.right,i.bottom);var f=CUtil.CRect(i.left,i.bottom-n,i.right,i.bottom);if(a.Contain(t,e))return CDefine.HTBOTTOMRIGHT;else if(r.Contain(t,e))return CDefine.HTTOPRIGHT;else if(o.Contain(t,e))return CDefine.HTBOTTOMLEFT;else if(s.Contain(t,e))return CDefine.HTTOPLEFT;else if(f.Contain(t,e))return CDefine.HTBOTTOM;else if(h.Contain(t,e))return CDefine.HTRIGHT;else if(_.Contain(t,e))return CDefine.HTTOP;else if(l.Contain(t,e))return CDefine.HTLEFT;else return CDefine.HTCLIENT},OffsetObject:function(t,e){t=Math.round(t);e=Math.round(e);if(t==0&&e==0)return;if(this.m_buffer)this.UpdateRect();else this.Invalidate();this.m_x+=t;this.m_y+=e;this.OnMove(t,e);if(this.m_buffer)this.UpdateRect();else this.Invalidate()},MoveObjectP:function(t){t.IntR();if(t.left>t.right)t.right=t.left;if(t.top>t.bottom)t.bottom=t.top;var e=t.left;var i=t.top;var n=t.right-t.left;var s=t.bottom-t.top;var r,a;if(e!=this.m_x||i!=this.m_y)r=true;else r=false;if(n!=this.m_width||s!=this.m_height)a=true;else a=false;if(r||a){if(this.m_buffer&&!a){this.UpdateRect()}else{this.Invalidate()}if(r){ox=e-this.m_x;oy=i-this.m_y;this.m_x=e;this.m_y=i;this.OnMove(ox,oy)}if(a){this.m_width=n;this.m_height=s;this.OnSize()}if(this.m_buffer&&!a){this.UpdateRect()}else{this.Invalidate()}}},MoveObject:function(t){if(this.m_uFlag&CFlags.STATUS_POPUP){this.MoveObjectP(t);return}var e=t.Clone();if(this.m_parent)this.m_parent.StageToClient(e);this.MoveObjectP(e)},NotifyParent:function(t,e,i){if(this.m_stage==null)return false;if(!this.IsFlag2(CFlags.STATUS2_SELFNOTIFY)){this.ModifyFlag2(CFlags.STATUS2_SELFNOTIFY,0);if(!this.SelfEventSync(t,e,i)){this.ModifyFlag2(0,CFlags.STATUS2_SELFNOTIFY);return true}this.ModifyFlag2(0,CFlags.STATUS2_SELFNOTIFY)}if(this.m_parent){if(this.IsFlag2(CFlags.STATUS2_MESSAGECHILD)){var n=this.GetMessageParent();if(n)n.EventSync(t,e,i,this);else this.m_stage.EventSync(t,e,i,this)}else{this.m_parent.EventSync(t,e,i,this)}}else{this.m_stage.EventSync(t,e,i,this)}return true},_NotifyParent:function(t,e,i,n){if(this.m_stage==null)return false;if(this.m_parent){if(this.IsFlag2(CFlags.STATUS2_MESSAGECHILD)){var s=this.GetMessageParent();if(s)this.msgParent.EventSync(t,e,i,n);else this.m_stage.EventSync(t,e,i,n)}else{this.m_parent.EventSync(t,e,i,n)}}else{this.m_stage.EventSync(t,e,i,n)}return true},NotifyStage:function(t,e,i,n){if(this.m_stage==null)return false;this.m_stage.EventSync(t,e,i,n);return true},AsyncNotifyParent:function(t,e,i){if(this.m_stage==null)return false;if(!this.IsFlag2(CFlags.STATUS2_SELFNOTIFY)){this.ModifyFlag2(CFlags.STATUS2_SELFNOTIFY,0);if(!this.SelfEventSync(t,e,i)){this.ModifyFlag2(0,CFlags.STATUS2_SELFNOTIFY);return true}this.ModifyFlag2(0,CFlags.STATUS2_SELFNOTIFY)}var n=this.GetSkin();if(this.m_parent){if(this.IsFlag2(CFlags.STATUS2_MESSAGECHILD)){var s=this.GetMessageParent();if(s)n.InputQueue(false,t,e,i,this,s);else n.InputQueue(true,t,e,i,this,this.m_stage)}else{n.InputQueue(false,t,e,i,this,this.m_parent)}}else{n.InputQueue(true,t,e,i,this,this.m_stage)}return true},_AsyncNotifyParent:function(t,e,i,n){if(this.m_stage==null)return false;var s=this.GetSkin();if(this.m_parent){if(this.IsFlag2(CFlags.STATUS2_MESSAGECHILD)){var r=this.GetMessageParent();if(r)s.InputQueue(false,t,e,i,this,r);else s.InputQueue(true,t,e,i,n,this.m_stage)}else{s.InputQueue(false,t,e,i,n,this.m_parent)}}else{s.InputQueue(true,t,e,i,n,this.m_stage)}return true},AsyncNotifyStage:function(t,e,i,n){if(this.m_stage==null)return false;var s=this.GetSkin();s.InputQueue(true,t,e,i,n,this.m_stage);return true},PostMessage:function(t,e,i,n){if(arguments.length==3)n=null;var s=this.GetSkin();s.InputQueue(false,t,e,i,n,this)},SendMessage:function(t,e,i,n){if(arguments.length==3)n=null;this.EventSync(t,e,i,n)},NotifyEvent:function(t,e,i,n){if(arguments.length==3)n=false;if(n)this.PostMessage(t,e,i,this);else this.SendMessage(t,e,i,this)},SelfEventSync:function(t,e,i){return true},EventSync:function(t,e,i,n){if(this.m_parent&&this.IsFlagEx2(CFlags.VXOBJECT2_EVENT_PASSPARENT)){this.m_parent.EventSync(t,e,i,n)}},GetMessageParent:function(){if(this.m_parent==null)return null;if(this.m_parent.IsFlag2(CFlags.STATUS2_MESSAGEPARENT))return this.m_parent;else return this.m_parent.GetMessageParent()},SetMessageParent:function(t){if(t==null)return;this.ModifyFlag2(CFlags.STATUS2_MESSAGECHILD,0);t.ModifyFlag2(CFlags.STATUS2_MESSAGEPARENT,0)},SetTypeCode:function(t){this.m_nTypeCode=t},SetRound:function(t,e,i,n){this.m_dwRndVal=CUtil.MAKEFRAME(t,e,i,n)},IsValid:function(){if(this.m_stage==null||this.m_uFlag2&CFlags.STATUS2_DELETE)return false;else return true},FindImage:function(t){if(this.m_stage)return this.m_stage.FindImage(t);else return vx.Global.g_skin.FindImage(t)},FindText:function(t){if(this.m_stage)return this.m_stage.FindText(t);else return vx.Global.g_skin.FindText(t)},FindObject:function(t,e){if(!this.m_aryChild)return null;if(arguments.length<2)e=false;var i,n=this.m_aryChild;var s,r=n.length;for(s=0;s<r;s++){i=n[s];if(i==null||!i.IsValid())continue;if(i.m_nID==t)return i;if(e){i=i.FindObject(t,e);if(i)return i}}return null},FindDropObjectByPoint:function(t,e){t-=this.m_x;e-=this.m_y;if(!this.HitTest(t,e))return null;if(this.m_aryChild==null)return null;var i;var n;var s=this.m_aryShow.length;for(var r=0;r<s;r++){i=this.m_aryShow.GetAt(r);if(i==null)continue;n=i.FindDropObjectByPoint(t,e);if(n)break}if(!n){if(this.IsFlagEx2(CFlags.VXOBJECT2_DROPENABLED)&&this.IsFlag(CFlags.STATUS_ENABLED))n=this}return n},SetRotate:function(t,e,i){if(this.m_nAngle%360!=0||t%360!=0){this.UpdateRect();this.m_nAngle=t%360;if(e!=undefined&&i!=undefined){this.m_ptC=new vx.point(e,i)}this.CheckTransform();this.UpdateRect()}},SetScale:function(t,e,i,n){this.UpdateRect();this.m_nScaleX=t;this.m_nScaleY=e;if(i!=undefined&&n!=undefined){this.m_ptC=new vx.point(i,n)}this.CheckTransform();this.UpdateRect()},SetTurnScale:function(t,e){this.UpdateRect();this.m_nTurnX=t;this.m_nTurnY=e;this.CheckTransform();this.UpdateRect()},GetScaleX:function(){if(this.m_nTurnX==undefined)return this.m_nScaleX;else return this.m_nTurnX*this.m_nScaleX},GetScaleY:function(){if(this.m_nTurnY==undefined)return this.m_nScaleY;else return this.m_nTurnY*this.m_nScaleY},SetTurnOver:function(t,e){if(t%180==0){this.SetTurnScale(1,1);this.ModifyFlagEx2(0,CFlags.STATUSEX2_HORZGRIDBLT|CFlags.STATUSEX2_VERTGRIDBLT);return}else if(t%90==0){if(e)this.SetTurnScale(0,1);else this.SetTurnScale(1,0);this.ModifyFlagEx2(0,CFlags.STATUSEX2_HORZGRIDBLT|CFlags.STATUSEX2_VERTGRIDBLT);return}var i,n,s,r,a,o,l,_,h,f;if(horz){o=this.m_width;n=this.m_height}else{o=this.m_height;n=this.m_width}if(angle<0){f=-1;angle=-angle}else{f=1}if(angle>=90&&angle<180||angle>=270&&angle<360){angle=90-angle%90;f=-f}else{angle=angle%90}i=(n*2.5-o)/2.5;if(i<0)i=0;s=n*2-i;_=Math.PI*angle/180;a=Math.cos(_);l=o*a;r=(s-n)*Math.sin(_);h=(n+r)/n;if(horz){this.SetTurnScale(l/o,h);this.ModifyFlagEx2(CFlags.STATUSEX2_HORZGRIDBLT,CFlags.STATUSEX2_VERTGRIDBLT)}else{this.SetTurnScale(h,l/o);this.ModifyFlagEx2(CFlags.STATUSEX2_VERTGRIDBLT,CFlags.STATUSEX2_HORZGRIDBLT)}this.m_minBlt=Math.floor(((n-i)*a+i)/h)*f},CheckTransform:function(){if(this.m_nAngle!=0||this.GetScaleX()!=1||this.GetScaleY()!=1){this.ModifyFlag2(CFlags.STATUS2_TRANSFORM,0)}else{this.ModifyFlag2(0,CFlags.STATUS2_TRANSFORM)}},SetAlpha:function(t){if(t>1)t=1;else if(t<0)t=0;this.m_nAlpha=t;if(this.m_nAlpha==1){this.ModifyFlag(0,CFlags.STATUS_ALPHA);if(!this.IsFlag(CFlags.STATUS_USEBUFFER)&&!this.IsFlag2(CFlags.STATUS2_DOMBUFFER)){this.ClearBuffer()}}else{this.ModifyFlag(CFlags.STATUS_ALPHA,0)}this.UpdateRect()},StopTransform:function(t){var e=0;var i=this.m_transform;if(i){if(t!=undefined){switch(t){case CDefine.TRANSFORM_ROTATE:if(i.rotate)i.rotate.bEnable=false;break;case CDefine.TRANSFORM_ALPHA:if(i.alpha)i.alpha.bEnable=false;break;case CDefine.TRANSFORM_XSCALE:if(i.xscale)i.xscale.bEnable=false;break;case CDefine.TRANSFORM_YSCALE:if(i.yscale)i.yscale.bEnable=false;break;case CDefine.TRANSFORM_HORZTURN:if(i.horzturn)i.horzturn.bEnable=false;break;case CDefine.TRANSFORM_VERTTURN:if(i.vertturn)i.vertturn.bEnable=false;break}}else{if(i.rotate)i.rotate.bEnable=false;if(i.alpha)i.alpha.bEnable=false;if(i.xscale)i.xscale.bEnable=false;if(i.yscale)i.yscale.bEnable=false;if(i.horzturn)i.horzturn.bEnable=false;if(i.vertturn)i.vertturn.bEnable=false}if(i.rotate&&i.rotate.bEnable)e++;if(i.alpha&&i.alpha.bEnable)e++;if(i.xscale&&i.xscale.bEnable)e++;if(i.yscale&&i.yscale.bEnable)e++;if(i.horzturn&&i.horzturn.bEnable)e++;if(i.vertturn&&i.vertturn.bEnable)e++}if(e==0){this.KillTimer(CDefine.DEFTIMER_TRANSFORM);this.ModifyFlag2(0,CFlags.STATUS2_LOCK);if(!this.IsFlagEx2(CFlags.STATUSEX2_CHECKBUFFER))this.ModifyFlag(0,CFlags.STATUS_USEBUFFER);else this.ModifyFlagEx2(0,CFlags.STATUSEX2_CHECKBUFFER)}},PlayTransform:function(t,e,i,n,s,r,a){if(this.IsFlag2(CFlags.STATUS2_DOMBUFFER))return;if(this.m_transform==null){this.m_transform=new vx.transform_info}if(this.IsFlag(CFlags.STATUS_USEBUFFER))this.ModifyFlagEx2(CFlags.STATUSEX2_CHECKBUFFER,0);var o=this.m_transform;var l;switch(t){case CDefine.TRANSFORM_ROTATE:if(o.rotate==null)o.rotate=new vx.transform_prop;l=o.rotate;break;case CDefine.TRANSFORM_ALPHA:if(o.alpha==null)o.alpha=new vx.transform_prop;l=o.alpha;break;case CDefine.TRANSFORM_XSCALE:if(o.xscale==null)o.xscale=new vx.transform_prop;l=o.xscale;break;case CDefine.TRANSFORM_YSCALE:if(o.yscale==null)o.yscale=new vx.transform_prop;l=o.yscale;break;case CDefine.TRANSFORM_HORZTURN:if(o.horzturn==null)o.horzturn=new vx.transform_prop;l=o.horzturn;this.ModifyFlag(CFlags.STATUS_USEBUFFER,0);this.Invalidate();break;case CDefine.TRANSFORM_VERTTURN:if(o.vertturn==null)o.vertturn=new vx.transform_prop;l=o.vertturn;this.ModifyFlag(CFlags.STATUS_USEBUFFER,0);this.Invalidate();break}if(l==null)return;l.nStart=e;l.nEnd=i;l.nUnit=n;l.nCurrent=e;l.nTimeSum=0;l.nTimeGap=s;l.nTimeIndex=0;l.bEnable=true;if(r!=undefined&&a!=undefined){l.cx=r;l.cy=a}this.SetTimer(CDefine.DEFTIMER_TRANSFORM,0);this.ModifyFlag2(CFlags.STATUS2_LOCK,0)},DoTransform:function(t){var e=this.m_transform;if(e==null){this.KillTimer(CDefine.DEFTIMER_TRANSFORM);if(!this.IsFlagEx2(CFlags.STATUSEX2_CHECKBUFFER))this.ModifyFlag(0,CFlags.STATUS_USEBUFFER);else this.ModifyFlagEx2(0,CFlags.STATUSEX2_CHECKBUFFER);this.ModifyFlag2(0,CFlags.STATUS2_LOCK);return}var i,n,s,r,a,o;i=n=1;s=0;a=0;r=false;if(e.rotate&&e.rotate.bEnable){if(e.rotate.Play(t)){if(e.rotate.cx==undefined||e.rotate.cy==undefined)this.SetRotate(e.rotate.nCurrent);else this.SetRotate(e.rotate.nCurrent,e.rotate.cx,e.rotate.cy);a++}if(e.rotate.bEnable)s++;else this.NotifyParent(CDefine.CMD_TRANSFORM_DONE,CDefine.TRANSFORM_ROTATE,0)}if(e.alpha&&e.alpha.bEnable){if(e.alpha.Play(t)){this.SetAlpha(e.alpha.nCurrent);a++}if(e.alpha.bEnable)s++;else this.NotifyParent(CDefine.CMD_TRANSFORM_DONE,CDefine.TRANSFORM_ALPHA,0)}if(e.xscale&&e.xscale.bEnable){if(e.xscale.Play(t)){i=e.xscale.nCurrent;r=true}if(e.xscale.bEnable)s++;else this.NotifyParent(CDefine.CMD_TRANSFORM_DONE,CDefine.TRANSFORM_XSCALE,0)}if(e.yscale&&e.yscale.bEnable){if(e.yscale.Play(t)){n=e.yscale.nCurrent;r=true}if(e.yscale.bEnable)s++;else this.NotifyParent(CDefine.CMD_TRANSFORM_DONE,CDefine.TRANSFORM_YSCALE,0)}if(r){if(e.xscale.cx==undefined||e.yscale.cy==undefined)this.SetScale(i,n);else this.SetScale(i,n,e.xscale.cx,e.yscale.cy);a++}if(e.horzturn&&e.horzturn.bEnable){o=e.horzturn.nCurrent;if(e.horzturn.Play(t)){if(CUtil.CheckQuad90(o,e.horzturn.nCurrent))this.OnTurnView(true,e.horzturn.nCurrent,o);this.SetTurnOver(e.horzturn.nCurrent,true);o=e.horzturn.nCurrent%360;if(o>=90&&o<270)this.ModifyFlagEx2(CFlags.STATUSEX2_DRAWBACK,0);else this.ModifyFlagEx2(0,CFlags.STATUSEX2_DRAWBACK);a++}if(e.horzturn.bEnable)s++;else this.NotifyParent(CDefine.CMD_TRANSFORM_DONE,CDefine.TRANSFORM_HORZTURN,0)}if(e.vertturn&&e.vertturn.bEnable){o=e.vertturn.nCurrent;if(e.vertturn.Play(t)){if(CUtil.CheckQuad90(o,e.vertturn.nCurrent))this.OnTurnView(false,e.vertturn.nCurrent,o);this.SetTurnOver(e.vertturn.nCurrent,false);o=e.vertturn.nCurrent%360;if(o>=90&&o<270)this.ModifyFlagEx2(CFlags.STATUSEX2_DRAWBACK,0);else this.ModifyFlagEx2(0,CFlags.STATUSEX2_DRAWBACK);a++}if(e.vertturn.bEnable)s++;else this.NotifyParent(CDefine.CMD_TRANSFORM_DONE,CDefine.TRANSFORM_VERTTURN,0)}if(a>0&&!(this.m_uFlag&CFlags.STATUS_SHOW))this.ShowObject(true);if(s==0){if(e.rotate&&e.rotate.bEnable)s++;if(e.alpha&&e.alpha.bEnable)s++;if(e.xscale&&e.xscale.bEnable)s++;if(e.yscale&&e.yscale.bEnable)s++;if(e.horzturn&&e.horzturn.bEnable)s++;if(e.vertturn&&e.vertturn.bEnable)s++;if(s==0){this.KillTimer(CDefine.DEFTIMER_TRANSFORM);if(!this.IsFlagEx2(CFlags.STATUSEX2_CHECKBUFFER))this.ModifyFlag(0,CFlags.STATUS_USEBUFFER);else this.ModifyFlagEx2(0,CFlags.STATUSEX2_CHECKBUFFER);this.ModifyFlag2(0,CFlags.STATUS2_LOCK);this.NotifyParent(CDefine.CMD_TRANSFORM_END,0,0)}}},OnTurnView:function(t,e,i){this.Invalidate()},GetCenterRect:function(t,e){var i=this.GetObjectRect();var n=i.CenterPoint();return CUtil.CRect(n.x-t/2,n.y-e/2,n.x-t/2+t,n.y-e/2+e)},ClearShowProp:function(){if(this.m_stage){if(this.m_stage.GetCaptureObject()==this)this.m_stage.ReleaseCaptureObject();if(this.m_stage.GetFocusObject()==this)this.m_stage.SetFocusObject(null);if(this.m_uFlag&CFlags.STATUS_MODAL)this.m_stage.m_skin.RemoveModalStack(this)}this.ClearBuffer()},ShowFade:function(t,e,i){switch(arguments.length){case 3:break;case 2:i=true;break;case 1:i=true;e=this.m_nTmAlphaLimit;break;default:return}this.m_nTmAlpha=0;if(e==0)this.m_nTmAlphaLimit=200;else this.m_nTmAlphaLimit=e;if(t){this.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTFADEIN,0);if(this.m_nTmDelay==0)this.ModifyFlag(CFlags.STATUS_SHOW,0);this.SetAlpha(0);this.SetTimer(CDefine.DEFTIMER_EFFECTIN,CDefine.TIME_TIC)}else{this.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTFADEOUT,0);if(i)this.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTOUT_DESTROY,0);this.SetTimer(CDefine.DEFTIMER_EFFECTOUT,CDefine.TIME_TIC)}},ShowRaise:function(t,e,i){switch(arguments.length){case 3:break;case 2:i=true;break;case 1:i=true;e=this.m_nTmAlphaLimit;break;default:return}this.m_nTmAlpha=0;if(e==0)this.m_nTmAlphaLimit=200;else this.m_nTmAlphaLimit=e;if(t){if(this.m_nTmDelay==0)this.ModifyFlag(CFlags.STATUS_SHOW,0);this.SetScale(0,0);this.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTRAISE,0);this.SetTimer(CDefine.DEFTIMER_EFFECTIN,CDefine.TIME_TIC)}else{this.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTFALL,0);if(i)this.ModifyFlagEx2(CFlags.STATUSEX2_EFFECTOUT_DESTROY,0);this.SetTimer(CDefine.DEFTIMER_EFFECTOUT,CDefine.TIME_TIC)}},TimerDelay:function(t){this.m_nTmDelay=t},GetPrivateToolTip:function(){if(this.m_toolInfo==null)return null;return this.m_toolInfo.GetPrivateToolTip()},CreateToolTip:function(t,e,i,n,s){switch(arguments.length){case 5:break;case 4:s=16;break;case 3:s=16;n=CDefine.DT_CENTER;break;case 2:s=16;n=CDefine.DT_CENTER;i;break;case 1:s=16;n=CDefine.DT_CENTER;i;e=0;break;default:return}var r;if(t.indexOf("\n")!=-1){r=vx.tagcont.GetEnterTag(t,this.GetColor(CColor.INDEX_TOOLTIP_TEXT),0,4294967295,s)}else{r=vx.tag.Text(t,this.GetColor(CColor.INDEX_TOOLTIP_TEXT),CDefine.TAGTYPE_SMALL)}return this.CreateToolTipTag(r,e,i,n)},CreateToolTipTag:function(t,e,i,n){switch(arguments.length){case 4:break;case 3:n=CDefine.DT_CENTER;break;case 2:n=CDefine.DT_CENTER;i;break;case 1:n=CDefine.DT_CENTER;i;e=0;break;default:return}if(this.m_toolInfo==null){this.m_toolInfo=new vx.toolinfo2(this,i)}else{if(this.m_toolInfo.m_pTool&&i)this.m_toolInfo.m_pTool=i}this.m_toolInfo.SetToolTipDirect(e);this.m_toolInfo.SetTagText(t,n);if(i){if(i.m_stage==null)i.Create(this.m_stage,CUtil.CRect(0,0,0,0),CDefine.VXID_NONE,CFlags.STATUS_POPUP|CFlags.STATUS_TOPMOST,0,null);var s=i;s.Reference();return s}else{if(this.m_stage)return this.m_stage.GetGlobalToolTip();else return null}},DestroyToolTip:function(){if(this.m_toolInfo){var t;if(this.m_toolInfo.m_pTool){t=this.m_toolInfo.m_pTool;t.Release()}else{if(this.m_stage){t=this.m_stage.GetGlobalToolTip();if(t&&t.GetToolInfo()==this.m_toolInfo){this.m_stage.CloseToolTip(this)}}}this.m_toolInfo.Delete();this.m_toolInfo=null}},SetToolTipTag:function(t,e){if(arguments.length<2)e=CDefine.DT_CENTER;if(this.m_toolInfo==null)return;this.m_toolInfo.SetTagText(t,e)},SetToolTipText:function(t,e){if(arguments.length<2)e=CDefine.DT_CENTER;if(this.m_toolInfo==null)return;var i;if(t.indexOf("\n")!=-1){i=vx.tagcont.GetEnterTag(t,this.GetColor(CColor.INDEX_TOOLTIP_TEXT),0,4294967295)}else{i=vx.tag.Text(t,this.GetColor(CColor.INDEX_TOOLTIP_TEXT),0)}this.m_toolInfo.SetTagText(i,e)},IsOverToolTip:function(){if(this.m_toolInfo&&this.IsFlag2(CFlags.STATUS2_TOOLOVER))return true;else return false},ShowControl:function(t,e){var i=this.FindObject(t);if(i)i.ShowObject(e);return i},EnableControl:function(t,e){var i=this.FindObject(t);if(i)i.EnableObject(e);return i},MoveControl:function(t,e){var i=this.FindObject(t);if(i)i.MoveObject(e);return i},MoveControlP:function(t,e){var i=this.FindObject(t);if(i)i.MoveObjectP(e);return i},OffsetControl:function(t,e,i){var n=this.FindObject(t);if(n&&(e!=0||i!=0)){var s=n.GetObjectRect();s.Offset(e,i);n.MoveObject(s)}return n},MessageBoxTag:function(t,e,i,n,s,r,a,o){if(this.m_stage)return this.m_stage.MessageBoxTag(t,e,i,n,s,r,a,o);else return null},MessageBox:function(t,e,i,n,s,r,a,o){if(this.m_stage)return this.m_stage.MessageBox(t,e,i,n,s,r,a,o);else return null},PlayBGM:function(t,e,i,n){if(this.m_stage)this.m_stage.m_skin.PlayBGM(t,e,i,n)},StopBGM:function(){if(this.m_stage)this.m_stage.m_skin.StopBGM()},SetVolumeBGM:function(t){if(this.m_stage)this.m_stage.m_skin.SetVolumeBGM(t)},PlaySound:function(t,e,i){if(this.m_stage)this.m_stage.m_skin.PlaySound(t,e,i)},StopSound:function(){if(this.m_stage)this.m_stage.m_skin.StopSound()},SetVolumeSound:function(t){if(this.m_stage)this.m_stage.m_skin.SetVolumeSound(t)},IsPageShow:function(){return this.m_bPageShow},_AppendDomPopup:function(t){if(t){var e=this.GetSkin().GetViewRect();e.Inflate(5,5);this.m_blankLayer=document.createElement("div");this.m_blankLayer.owner=this;this.m_blankLayer.style.position="absolute";this.m_blankLayer.style.left=e.left.toString()+"px";this.m_blankLayer.style.top=e.top.toString()+"px";this.m_blankLayer.style.width=e.Width().toString()+"px";this.m_blankLayer.style.height=e.Height().toString()+"px";this.m_blankLayer.style.border="0px solid #ff0000";this.m_blankLayer.style.resize="none";this.m_blankLayer.style.overflow="hidden";this.m_blankLayer.style.zIndex=this.m_nZOrder-1;if(CWebPage.domModalID!=null){CMyGlobal.SetPreventEvent(false)}document.body.appendChild(this.m_blankLayer);document.body.getElementsByClassName(t.m_canvas.id);this.m_buffer.m_canvas.style.position="absolute";this.m_buffer.m_canvas.style.left=this.m_x.toString()+"px";this.m_buffer.m_canvas.style.top=this.m_y.toString()+"px";this.m_buffer.m_canvas.style.width=this.m_width.toString()+"px";this.m_buffer.m_canvas.style.height=this.m_height.toString()+"px";this.m_buffer.m_canvas.style.zIndex=this.m_nZOrder;document.body.appendChild(this.m_buffer.m_canvas)}},_RemoveDomPopup:function(){if(this.m_blankLayer){document.body.removeChild(this.m_blankLayer);this.m_blankLayer=null}if(this.IsFlag2(CFlags.STATUS2_DOMBUFFER)&&this.m_buffer){document.body.removeChild(this.m_buffer.m_canvas)}}});vx.object.DrawDefault_Button=function(t,e,i,n){switch(arguments.length){case 4:break;case 3:n=-1;break;default:return}var s;if(n!=-1){s=n}else{s=3;if(i.IsFlag(CFlags.STATUS_ENABLED)){if(i.OrFlag2(CFlags.STATUS2_PRESS|CFlags.STATUS2_CHECK))s=2;else if(i.IsFlag2(CFlags.STATUS2_MOUSEOVER))s=1;else s=0}}var r,a,o,l,_;_=i.GetColor(CColor.INDEX_CONTROLBORDER);if(i.IsFlagEx(CFlags.VXCLICK_FACE2)||i.IsFlag2(CFlags.STATUS2_BLINK)){o=i.GetColor(CColor.INDEX_CONTROL_LT2);l=i.GetColor(CColor.INDEX_CONTROL_RB2);switch(s){case 0:r=i.GetColor(CColor.INDEX_CONTROLFACE2);a=i.GetColor(CColor.INDEX_CONTROLFACE2);break;case 1:r=i.GetColor(CColor.INDEX_CONTROLFACE_FOCUS2);a=i.GetColor(CColor.INDEX_CONTROLFACE_FOCUS2_GR);break;case 2:a=r=i.GetColor(CColor.INDEX_CONTROLFACE_DOWN2);break;default:a=r=i.GetColor(CColor.INDEX_CONTROLFACE_GRAY2);break}}else{o=i.GetColor(CColor.INDEX_CONTROL_LT);l=i.GetColor(CColor.INDEX_CONTROL_RB);switch(s){case 0:r=i.GetColor(CColor.INDEX_CONTROLFACE);a=i.GetColor(CColor.INDEX_CONTROLFACE_GR);break;case 1:r=i.GetColor(CColor.INDEX_CONTROLFACE_FOCUS);a=i.GetColor(CColor.INDEX_CONTROLFACE_FOCUS_GR);break;case 2:a=r=i.GetColor(CColor.INDEX_CONTROLFACE_DOWN);break;default:a=r=i.GetColor(CColor.INDEX_CONTROLFACE_GRAY);break}}t.DrawButton(e,s,r,a,o,l,_,i.m_dwRndVal)};vx.object.DrawDefault_Drag=function(t,e,i,n){switch(arguments.length){case 4:break;case 3:n=-1;break;default:return}var s;if(n!=-1){s=n}else{s=3;if(i.IsFlag(CFlags.STATUS_ENABLED)){if(i.OrFlag2(CFlags.STATUS2_PRESS|CFlags.STATUS2_CHECK|CFlags.STATUS2_MOUSEOVER))s=1;else s=0}}var r,a,o,l,_;_=i.GetColor(CColor.INDEX_CONTROLBORDER);if(i.IsFlagEx(CFlags.VXCLICK_FACE2)||i.IsFlag2(CFlags.STATUS2_BLINK)){o=i.GetColor(CColor.INDEX_CONTROL_LT2);l=i.GetColor(CColor.INDEX_CONTROL_RB2);switch(s){case 0:r=i.GetColor(CColor.INDEX_CONTROLFACE2);a=i.GetColor(CColor.INDEX_CONTROLFACE2);break;case 1:r=i.GetColor(CColor.INDEX_CONTROLFACE_FOCUS2);a=i.GetColor(CColor.INDEX_CONTROLFACE_FOCUS2_GR);break;case 2:a=r=i.GetColor(CColor.INDEX_CONTROLFACE_DOWN2);break;default:a=r=i.GetColor(CColor.INDEX_CONTROLFACE_GRAY2);break}}else{o=i.GetColor(CColor.INDEX_CONTROL_LT);l=i.GetColor(CColor.INDEX_CONTROL_RB);switch(s){case 0:r=i.GetColor(CColor.INDEX_CONTROLFACE);a=i.GetColor(CColor.INDEX_CONTROLFACE_GR);break;case 1:r=i.GetColor(CColor.INDEX_CONTROLFACE_FOCUS);a=i.GetColor(CColor.INDEX_CONTROLFACE_FOCUS_GR);break;case 2:a=r=i.GetColor(CColor.INDEX_CONTROLFACE_DOWN);break;default:a=r=i.GetColor(CColor.INDEX_CONTROLFACE_GRAY);break}}t.DrawButton(e,s,r,a,o,l,_,i.m_dwRndVal)};vx.modalback=vx.object.extend({init:function(){this._super();this.m_color=0;this.m_nRatio=.7},toString:function(){return"(vx.modalback)"},OnDraw:function(t,e){t.m_context.fillStyle=CColor.Value(this.m_color,this.m_nRatio);t.m_context.fillRect(e.left,e.top,e.Width(),e.Height())}});vx.click=vx.object.extend({init:function(){this._super();this.m_nShape=CDefine.SHAPE_NONE;this.m_nIncrease=0;this.m_nClickGap=200;this.m_dwFrame=0;this.m_dwOff=0;this.m_pImage=null;this.m_src=null;this.m_srcIn=null;this.m_crBndF=CColor.RGB(255,255,255);this.m_nHT=CDefine.BUTTON_DEPTH;this.SetOffset(1,1);this.SetRound(2,2,2,2);this.SetTypeCode(CDefine.VXCODE_CLICK)},toString:function(){return"(vx.click)"},Delete:function(){this.m_pImage=null;this.m_src=null;this.m_srcIn=null;this._super()},OnCreate:function(){if(!this._super())return false;if(this.IsFlagEx(CFlags.VXCLICK_TIMECLICK)){this.ModifyFlagEx(CFlags.VXCLICK_CAPTURE|CFlags.VXCLICK_DOWNEVENT,0)}switch(this.m_nID){case CDefine.VXID_CLOSE:this.SetShapeType(CDefine.SHAPE_CLOSE);break;case CDefine.VXID_MAXIMIZE:this.SetShapeType(CDefine.SHAPE_MAXIMIZE);break;case CDefine.VXID_MINIMIZE:this.SetShapeType(CDefine.SHAPE_MINIMIZE);break}return true},OnDraw:function(t,e){if(this.m_pImage){this.DrawImage(t,e)}else{var i,n;if(this.IsFlagEx(CFlags.VXCLICK_FRAMETRANS)||this.IsFlag(CFlags.STATUS_TRANS)){i=4294967295;n=this.GetColor(CColor.INDEX_CONTROLTEXT);if(!this.IsFlag(CFlags.STATUS_ENABLED))return}else{var s=3;if(this.IsFlag(CFlags.STATUS_ENABLED)){if(this.OrFlag2(CFlags.STATUS2_PRESS|CFlags.STATUS2_CHECK))s=2;else if(this.IsFlag2(CFlags.STATUS2_MOUSEOVER))s=1;else s=0}var r,a,o,l,_;if(this.IsFlagEx(CFlags.VXCLICK_FOCUS_BORDER))_=this.m_crBndF;else _=this.GetColor(CColor.INDEX_CONTROLBORDER);if(this.IsFlagEx(CFlags.VXCLICK_FACE2)||this.IsFlag2(CFlags.STATUS2_BLINK)){o=this.GetColor(CColor.INDEX_CONTROL_LT2);l=this.GetColor(CColor.INDEX_CONTROL_RB2);switch(s){case 0:r=this.GetColor(CColor.INDEX_CONTROLFACE2);a=this.GetColor(CColor.INDEX_CONTROLFACE2);break;case 1:r=this.GetColor(CColor.INDEX_CONTROLFACE_FOCUS2);a=this.GetColor(CColor.INDEX_CONTROLFACE_FOCUS2_GR);break;case 2:a=r=this.GetColor(CColor.INDEX_CONTROLFACE_DOWN2);break;default:a=r=this.GetColor(CColor.INDEX_CONTROLFACE_GRAY2);break}}else{o=this.GetColor(CColor.INDEX_CONTROL_LT);l=this.GetColor(CColor.INDEX_CONTROL_RB);switch(s){case 0:r=this.GetColor(CColor.INDEX_CONTROLFACE);a=this.GetColor(CColor.INDEX_CONTROLFACE_GR);break;case 1:r=this.GetColor(CColor.INDEX_CONTROLFACE_FOCUS);a=this.GetColor(CColor.INDEX_CONTROLFACE_FOCUS_GR);break;case 2:a=r=this.GetColor(CColor.INDEX_CONTROLFACE_DOWN);break;default:a=r=this.GetColor(CColor.INDEX_CONTROLFACE_GRAY);break}}t.DrawButton(e,s,r,a,o,l,_,this.m_dwRndVal,this.m_nHT);i=r;if(this.IsFlag(CFlags.STATUS_ENABLED))n=this.GetColor(CColor.INDEX_CONTROLTEXT);else n=this.GetColor(CColor.INDEX_CONTROL_LTDARK2)}if(this.m_nShape!=CDefine.SHAPE_NONE){var h=e.Clone();if(this.OrFlag2(CFlags.STATUS2_PRESS|CFlags.STATUS2_CHECK))h.Offset(CUtil.FRAME0(this.m_dwOff),CUtil.FRAME1(this.m_dwOff));t.DrawShape(h,this.m_nShape,n,i)}}},DrawImage:function(t,e){if(!this.m_pImage)return;var i=e.Clone();var n,s=0;if(this.IsFlagEx(CFlags.VXCLICK_OFFSETIMAGE))s=4;var r=false;if(!this.IsFlag(CFlags.STATUS_ENABLED))n=CUtil.FRAME3(this.m_dwFrame)+s;else if(this.IsFlag2(CFlags.STATUS2_PRESS)||this.IsFlag2(CFlags.STATUS2_CHECK)){n=CUtil.FRAME2(this.m_dwFrame)+s;r=true}else if(this.IsFlag2(CFlags.STATUS2_MOUSEOVER))n=CUtil.FRAME1(this.m_dwFrame)+s;else n=CUtil.FRAME0(this.m_dwFrame)+s;if(this.IsFlag2(CFlags.STATUS2_BLINK)){if(this.m_pImage.GetFrameCount()>n+4)n+=4;else n=CUtil.FRAME3(this.m_dwFrame)}if(this.IsFlagEx(CFlags.VXCLICK_SINGLEIMAGE)&&r)i.Offset(CUtil.FRAME0(this.m_dwOff),CUtil.FRAME1(this.m_dwOff));if(this.m_src){var a=this.m_src.Clone();if(this.IsFlagEx2(CFlags.VXBUTTON2_SRCHORZ))a.Offset(0,n*a.Height());else a.Offset(n*a.Width(),0);if(this.m_srcIn){var o=this.m_srcIn.Clone();o.Offset(n*a.Width(),0);this.m_pImage._DrawBox(t,i,o,a,CDefine.BOXFLAG_ALL)}else{this.m_pImage.DrawEx(t,i.left,i.top,a,0)}}else{this.m_pImage.DrawBox(t,i,n)}},OnSize:function(){this._super()},OnClose:function(){if(!this._super())return false;return true},OnLButtonDown:function(t,e,i){if(this.IsFlag2(CFlags.STATUS2_INACTIVE))return;if(this.HitTest(t,e)){if(!this.IsFlag2(CFlags.STATUS2_PRESS)){this.ModifyFlag2(CFlags.STATUS2_PRESS,0);this.Invalidate();if(this.IsFlagEx(CFlags.VXCLICK_CAPTURE))this.SetCaptureObject()}if(this.IsFlagEx(CFlags.VXCLICK_DOWNEVENT)){if(this.IsFlagEx(CFlags.VXCLICK_TIMECLICK)){this.m_nIncrease=0;this.SetTimer(CDefine.DEFTIMER_CLICK,this.m_nClickGap)}this.DoClick()}}},OnMouseMove:function(t,e,i){if(this.HitTest(t,e)){if(this.GetCaptureObject()==this&&!this.IsFlag2(CFlags.STATUS2_PRESS)){this.SetTimer(CDefine.DEFTIMER_CLICK,this.m_nClickGap/4);if(this.IsFlag2(CFlags.STATUS2_MOUSEOVER|CFlags.STATUS2_PRESS))return;this.ModifyFlag2(CFlags.STATUS2_MOUSEOVER|CFlags.STATUS2_PRESS,0);this.Invalidate()}if(!this.IsFlag(CFlags.STATUS_NOTRACK)){if(this.IsFlag2(CFlags.STATUS2_MOUSEOVER))return;this.ModifyFlag2(CFlags.STATUS2_MOUSEOVER,0);this.Invalidate()}}else{this.OnMouseLeave()}},OnLButtonUp:function(t,e,i){if(this.IsFlag2(CFlags.STATUS2_INACTIVE))return;var n=false;if(this.IsFlagEx(CFlags.VXCLICK_CAPTURE)&&this.GetCaptureObject()==this){n=this.IsFlag2(CFlags.STATUS2_PRESS);this.ReleaseCaptureObject()}if(this.HitTest(t,e)){if(n||this.IsFlag2(CFlags.STATUS2_PRESS)){this.OnReleaseCapture();if(!this.IsFlagEx(CFlags.VXCLICK_DOWNEVENT))this.DoClick()}}},OnLButtonDblClk:function(t,e,i){if(this.IsFlagEx(CFlags.VXCLICK_USEDBLCLK))this.OnLButtonDown(t,e,i)},OnMouseLeave:function(){if(this.IsFlag2(CFlags.VXCLICK_NOMOUSELEAVE))return;this.KillTimer(CDefine.DEFTIMER_CLICK);if(this.OrFlag2(CFlags.STATUS2_MOUSEOVER|CFlags.STATUS2_PRESS)){this.ModifyFlag2(0,CFlags.STATUS2_MOUSEOVER|CFlags.STATUS2_PRESS);this.Invalidate()}},OnCancelMode:function(){this.OnMouseLeave()},OnReleaseCapture:function(){if(this.IsFlag2(CFlags.STATUS2_PRESS)){if(this.IsFlagEx(CFlags.VXCLICK_TIMECLICK))this.KillTimer(CDefine.DEFTIMER_CLICK);this.ModifyFlag2(0,CFlags.STATUS2_PRESS);this.Invalidate()}},OnTimer:function(t,e,i,n){this._super(t,e,i,n);if(t==CDefine.DEFTIMER_CLICK){if(!this.IsFlag(CFlags.STATUS_ENABLED)){this.KillTimer(CDefine.DEFTIMER_CLICK);this.ModifyFlag2(0,CFlags.STATUS2_PRESS);this.Invalidate();return}this.m_nIncrease++;if(this.m_nIncrease==2){this.SetTimer(CDefine.DEFTIMER_CLICK,this.m_nClickGap/4);return}this.DoClick()}},DoClick:function(){},SetShapeType:function(t){this.m_nShape=t;switch(this.m_nShape){case CDefine.SHAPE_UPARROW:case CDefine.SHAPE_DOWNARROW:case CDefine.SHAPE_LEFTARROW:case CDefine.SHAPE_RIGHTARROW:this.SetOffset(0,0);break}},SetClickGap:function(t){this.m_nClickGap=t},GetCheck:function(){return this.IsFlag2(CFlags.STATUS2_CHECK)},SetOffset:function(t,e,i,n){if(arguments.length==2){i=n=0}this.m_dwOff=CUtil.MAKELONG(CUtil.MAKEWORD(t,e),CUtil.MAKEWORD(i,n))},SetCheck:function(t){if(t){if(this.IsFlag2(CFlags.STATUS2_CHECK))return;this.ModifyFlag2(CFlags.STATUS2_CHECK,0)}else{if(!this.IsFlag2(CFlags.STATUS2_CHECK))return;this.ModifyFlag2(0,CFlags.STATUS2_CHECK)}this.Invalidate()},SetFrame:function(t,e){if(arguments.length==1)e=false;if(e){this.m_dwFrame=CUtil.MAKEFRAME(t,t,t,t);this.ModifyFlagEx(CFlags.VXCLICK_SINGLEIMAGE,0);return}if(t==0){this.m_dwFrame=CUtil.MAKEFRAME(0,1,2,3)}else{if(CUtil.FRAME0(t)>0&&CUtil.FRAME1(t)==0&&CUtil.FRAME2(t)==0&&CUtil.FRAME3(t)==0){this.m_dwFrame=CUtil.MAKEFRAME(t,t+1,t+2,t+3)}else{this.m_dwFrame=t}}},SetImage:function(t,e,i){if(arguments.length<3)i=false;this.m_pImage=t;this.SetFrame(e,i);if(this.m_stage&&this.m_pImage&&!this.m_pImage.IsResize()){var n=this.m_pImage.GetFrameSize();var s=this.GetObjectRectP();s.right=s.left+n.x;s.bottom=s.top+n.y;this.MoveObjectP(s);this.Invalidate()}},SetImageName:function(t,e,i){if(arguments.length<3)i=false;var n=this.FindImage(t);if(n)this.SetImage(n,e,i)},SetImageEx:function(t,e,i,n){if(i==undefined||i==null){this.SetImage(t,e,false);return}if(n!=undefined&&i!=null)this.m_srcIn=n.Clone();this.m_pImage=t;this.m_src=i.Clone();this.SetFrame(e,false);if(this.m_stage&&this.m_pImage&&!this.m_srcIn){var s=this.GetObjectRectP();s.right=s.left+this.m_src.Width();s.bottom=s.top+this.m_src.Height();this.MoveObjectP(s);this.Invalidate()}}});vx.button=vx.click.extend({init:function(){this._super();this.m_crUnder=0;this.m_nBlinkCnt=-1;this.m_dwAddFrame=0;this.m_dwMargin=0;this.m_pGroup=null;this.m_pAddImage=null;this.m_cTag=new vx.tagcont;this.SetTypeCode(CDefine.VXCODE_BUTTON);this.SetMargin(4,2,4,2)},toString:function(){return"(vx.button)"},Delete:function(){this.m_pGroup=null;this.m_pAddImage=null;if(this.m_cTag){this.m_cTag.Delete();this.m_cTag=null}this._super()},OnEnable:function(t){if(this.IsFlagEx(CFlags.VXBUTTON_SETBLINK))this.SetBlink(false)},HitTest:function(t,e){var i=this._super(t,e);if(i){var n;if(this.IsFlagEx(CFlags.VXBUTTON_GROUPBOX)){if(this.OrFlagEx(CFlags.VXBUTTON_CHECK|CFlags.VXBUTTON_RADIO)&&this.IsFlagEx(CFlags.VXBUTTON_HASTAG)){n=this.GetGroupTextRect();return n.Contain(t,e)}return false}else if(this.IsFlagEx(CFlags.VXBUTTON_MARGINHIT)){n=this.GetBoundRect();n.Deflate(CUtil.MARGINLEFT(this.m_dwMargin),CUtil.MARGINTOP(this.m_dwMargin),CUtil.MARGINRIGHT(this.m_dwMargin),CUtil.MARGINBOTTOM(this.m_dwMargin));return n.Contain(t,e)}}return i},DoClick:function(){if(this.IsFlagEx(CFlags.VXBUTTON_RADIO)||this.IsFlagEx(CFlags.VXBUTTON_GROUPBUTTON)){if(this.GetCheck())return;this.SetCheck(true)}else if(this.IsFlagEx(CFlags.VXBUTTON_CHECK)||this.IsFlagEx(CFlags.VXBUTTON_USECHECK)){this.SetCheck(!this.GetCheck())}if(this.m_pGroup&&this.IsFlag2(CFlags.STATUS2_GROUP))this.m_pGroup.NotifyGroup(this);this.NotifyParent(CDefine.CMD_VXBUTTON_CLICK,this.m_nID,null)},OnDraw:function(t,e){var i=e.Clone();var n=e.Clone();if(this.IsFlagEx(CFlags.VXBUTTON_GROUPBOX)){i=this.DrawGroupBorder(t,n);if(this.OrFlagEx(CFlags.VXBUTTON_RADIO|CFlags.VXBUTTON_CHECK)){i.left+=5;i.left+=this.DrawCheck(t,i,this.IsFlag2(CFlags.STATUS2_CHECK))+5}}else{if(this.OrFlagEx(CFlags.VXBUTTON_RADIO|CFlags.VXBUTTON_CHECK)){i.left+=this.DrawCheck(t,n,this.IsFlag2(CFlags.STATUS2_CHECK))+CUtil.MARGINLEFT(this.m_dwMargin)}else{if(!this.IsFlagEx(CFlags.VXBUTTON_TEXTONLY)){this._super(t,n)}if(this.IsFlag2(CFlags.STATUS2_PRESS)||this.IsFlag2(CFlags.STATUS2_CHECK))i.Offset(CUtil.FRAME0(this.m_dwOff),CUtil.FRAME1(this.m_dwOff));i.Offset(CUtil.FRAME2(this.m_dwOff),CUtil.FRAME3(this.m_dwOff))}}if(this.IsFlagEx(CFlags.VXBUTTON_HASTAG)){this.DrawText(t,i);var s=false;if(this.IsFlagEx(CFlags.VXBUTTON_TEXTCHECKUNDERLINE)&&this.IsFlag2(CFlags.STATUS2_CHECK)||this.IsFlagEx(CFlags.VXBUTTON_TEXTUNDERLINE))s=true;if(s){n.top=n.bottom-1;t.FillSolidRect(n,this.m_crUnder)}}},OnCreate:function(){if(!this._super())return false;if(this.m_buffer)this.m_buffer.SetUseTagBuffer(true);if(this.OrFlag(CFlags.MASK_COMMONIMAGE)){var t=this.GetCommonIndex();if(t>=0){if(this.IsFlagEx(CFlags.VXBUTTON_CHECK))this.SetCheckImage(vx.Global.VXS_GetCheckImage(t));else if(this.IsFlagEx(CFlags.VXBUTTON_RADIO))this.SetCheckImage(vx.Global.VXS_GetRadioImage(t));else this.SetImage(vx.Global.VXS_GetButtonImage(t),0)}}return true},OnKeyDown:function(t,e){if(this.IsFlag(CFlags.STATUS_TABSTOP)){switch(e){case CKeys.VK_SPACE:case CKeys.VK_ENTER:{var i;if(this.IsFlagEx(CFlags.VXBUTTON_GROUPBOX)){if(this.OrFlagEx(CFlags.VXBUTTON_CHECK|CFlags.VXBUTTON_RADIO)&&this.IsFlagEx(CFlags.VXBUTTON_HASTAG)){i=this.GetGroupTextRect()}else{this._super(t,e);return}}else if(this.IsFlagEx(CFlags.VXBUTTON_MARGINHIT)){i=this.GetBoundRect();i.Deflate(CUtil.MARGINLEFT(this.m_dwMargin),CUtil.MARGINTOP(this.m_dwMargin),CUtil.MARGINRIGHT(this.m_dwMargin),CUtil.MARGINBOTTOM(this.m_dwMargin))}else{i=this.GetClientRect()}var n=i.CenterPoint();this.OnLButtonDown(n.x,n.y,t)}break;case CKeys.VK_UP:this.NotifyParent(CDefine.CMD_VXOBJECT_NOTIFYKEY,CDefine.NOTIFYKEY_ARROWUP,null);break;case CKeys.VK_DOWN:this.NotifyParent(CDefine.CMD_VXOBJECT_NOTIFYKEY,CDefine.NOTIFYKEY_ARROWDOWN,null);break;case CKeys.VK_LEFT:this.NotifyParent(CDefine.CMD_VXOBJECT_NOTIFYKEY,CDefine.NOTIFYKEY_ARROWUP,null);break;case CKeys.VK_RIGHT:this.NotifyParent(CDefine.CMD_VXOBJECT_NOTIFYKEY,CDefine.NOTIFYKEY_ARROWDOWN,null);break}}this._super(t,e)},OnKeyUp:function(t,e){if(this.IsFlag(CFlags.STATUS_TABSTOP)){switch(e){case CKeys.VK_SPACE:case CKeys.VK_ENTER:{var i;if(this.IsFlagEx(CFlags.VXBUTTON_GROUPBOX)){if(this.OrFlagEx(CFlags.VXBUTTON_CHECK|CFlags.VXBUTTON_RADIO)&&this.IsFlagEx(CFlags.VXBUTTON_HASTAG))i=this.GetGroupTextRect();else return this._super(e,t)}else if(this.IsFlagEx(CFlags.VXBUTTON_MARGINHIT)){i=this.GetBoundRect();i.Deflate(CUtil.MARGINLEFT(this.m_dwMargin),CUtil.MARGINTOP(this.m_dwMargin),CUtil.MARGINRIGHT(this.m_dwMargin),CUtil.MARGINBOTTOM(this.m_dwMargin))}else{i=this.GetClientRect()}var n=i.CenterPoint();this.OnLButtonUp(n.x,n.y,t)}break}}this._super(t,e)},OnTimer:function(t,e,i,n){this._super(t,e,i,n);if(t==CDefine.DEFTIMER_BLINK){if(this.IsFlag2(CFlags.STATUS2_BLINK))this.ModifyFlag2(0,CFlags.STATUS2_BLINK);else this.ModifyFlag2(CFlags.STATUS2_BLINK,0);this.Invalidate();if(this.m_nBlinkCnt>0)this.m_nBlinkCnt--;if(this.m_nBlinkCnt==0)this.SetBlink(false)}},GroupSync:function(t){},GetCommonIndex:function(){var t=-1;if(this.IsFlag(CFlags.STATUS_COMMONIMAGE0))t=0;else if(this.IsFlag(CFlags.STATUS_COMMONIMAGE1))t=1;else if(this.IsFlag(CFlags.STATUS_COMMONIMAGE2))t=2;return t},_DrawGroupBorderImage:function(t,e){var i=e.Clone();var n=CUtil.CRect(0,0,0,0);if(this.m_pImage==null)return n;if(!this.IsFlagEx(CFlags.VXBUTTON_HASTAG)){this.m_pImage.DrawBox(t,i,0);return n}n=this.GetGroupTextRect(i);if(!this.IsFlagEx2(CFlags.VXBUTTON2_FULLBOX)){i.top+=n.Height()/2}if(this.IsFlag(CFlags.STATUS_TRANS))this.m_pImage.DrawBox(t,i,0);else this.m_pImage.DrawBoxClip(t,i,0,n);return n},GetTextSize:function(t){var e=this.m_cTag.GetSize();if(t){e.x+=CUtil.MARGINLEFT(this.m_dwMargin)+CUtil.MARGINRIGHT(this.m_dwMargin);e.y+=CUtil.MARGINTOP(this.m_dwMargin)+CUtil.MARGINBOTTOM(this.m_dwMargin)}return e},GetGroupTextRect:function(t){if(arguments.length==0)t=null;var e=this.m_cTag.GetSize();var i;if(e.y<18)e.y=18;if(t==null)i=this.GetBoundRect();else i=CUtil.CRect(t.left,t.top,t.right,t.bottom);i.left+=CUtil.MARGINLEFT(this.m_dwMargin)+10;i.top+=CUtil.MARGINTOP(this.m_dwMargin);i.right=i.left+e.x+10;i.bottom=i.top+e.y;if(this.OrFlagEx(CFlags.VXBUTTON_CHECK|CFlags.VXBUTTON_RADIO))i.right+=e.y;return i},DrawGroupBorder:function(t,e){if(this.m_pImage){return this._DrawGroupBorderImage(t,e)}var i=e.Clone();var n=CUtil.CRect(0,0,0,0);var s=this.GetColor(CColor.INDEX_CONTROL_LT);var r=this.GetColor(CColor.INDEX_CONTROL_RB);if(!this.IsFlagEx(CFlags.VXBUTTON_HASTAG)){i.left++;i.top++;t.Draw3dRect(i,s,s);i.Offset(-1,-1);t.Draw3dRect(i,r,r);return n}n=this.GetGroupTextRect(i);if(this.IsFlagEx2(CFlags.VXBUTTON2_FULLBOX)){i.left++;i.top++;t.Draw3dRect(i,s,s);i.Offset(-1,-1);t.Draw3dRect(i,r,r);return n}i.top+=n.Height()/2;i.left++;i.right--;i.bottom--;var a=new ObArray;a.Add(new vx.point(n.left,i.top));a.Add(new vx.point(i.left,i.top));a.Add(new vx.point(i.left,i.bottom));a.Add(new vx.point(i.right,i.bottom));a.Add(new vx.point(i.right,i.top));a.Add(new vx.point(n.right,i.top));t.DrawPolyline(a,s);a[0].x=n.left;a[0].y=i.top-1;a[1].x=i.left-1;a[1].y=i.top-1;a[2].x=i.left-1;a[2].y=i.bottom-1;a[3].x=i.right-1;a[3].y=i.bottom-1;a[4].x=i.right-1;a[4].y=i.top-1;a[5].x=n.right;a[5].y=i.top-1;t.DrawPolyline(a,r);a.RemoveAll();return n},SetUnderlineButton:function(t){if(arguments.length==0)t=4294967295;if(!this.IsFlagEx(CFlags.VXBUTTON_HASTAG))return;if(t==4294967295)this.m_crUnder=this.GetColor(CColor.INDEX_CONTROLTEXT);else this.m_crUnder=this.crUnder;this.ModifyFlagEx(CFlags.VXBUTTON_TEXTUNDERLINE|CFlags.VXBUTTON_TEXTONLY,0);var e=this.GetObjectRectP();var i=e.CenterPoint();var n=this.m_cTag.GetSize();var s=CUtil.CRect(i.x-n.x/2,i.y-n.y/2,i.x-n.x/2+n.x,i.y-n.y/2+n.y);this.MoveObjectP(s)},DrawText:function(t,e){var i=e.Clone();var n,s;var r=4294967295;if(this.IsFlagEx(CFlags.VXBUTTON_CHECKINVERT)){if(this.OrFlag2(CFlags.STATUS2_PRESS|CFlags.STATUS2_CHECK))n=true;r=this.m_cTag.m_tag.color;if(!this.IsFlag(CFlags.STATUS_ENABLED))this.m_cTag.m_tag.color=this.GetColor(CColor.INDEX_CONTROLTEXT_GRAY)}else if(this.IsFlagEx(CFlags.VXBUTTON_FOCUSINVERT)){n=this.OrFlag2(CFlags.STATUS2_PRESS|CFlags.STATUS2_MOUSEOVER);r=this.m_cTag.m_tag.color;if(!this.IsFlag(CFlags.STATUS_ENABLED))this.m_cTag.m_tag.color=this.GetColor(CColor.INDEX_CONTROLTEXT_GRAY)}else n=!this.IsFlag(CFlags.STATUS_ENABLED);s=this.m_cTag.SetSelect(n);if(!this.OrFlagEx(CFlags.VXBUTTON_CHECK|CFlags.VXBUTTON_RADIO)){if(this.IsFlagEx(CFlags.VXBUTTON_TEXTWIDTH)){i.Deflate(CUtil.MARGINLEFT(this.m_dwMargin),0,CUtil.MARGINRIGHT(this.m_dwMargin),0)}else if(this.IsFlagEx(CFlags.VXBUTTON_TEXTRESIZE)){i.Deflate(CUtil.MARGINLEFT(this.m_dwMargin),CUtil.MARGINTOP(this.m_dwMargin),CUtil.MARGINRIGHT(this.m_dwMargin),CUtil.MARGINBOTTOM(this.m_dwMargin))}else{var a=i.CenterPoint();i=CUtil.CRect(a.x-this.m_cTag.m_szTag.x/2,a.y-this.m_cTag.m_szTag.y/2,a.x-this.m_cTag.m_szTag.x/2+this.m_cTag.m_szTag.x,a.y-this.m_cTag.m_szTag.y/2+this.m_cTag.m_szTag.y)}}this.m_cTag.Draw(t,i);this.m_cTag.SetSelect(s);if(r!=4294967295){this.m_cTag.m_tag.color=r}},DrawCheck:function(t,e,i){var n=e.Clone();var s;var r=e.CenterPoint();var a,o;if(this.IsFlag2(CFlags.STATUS2_CHECK))a=4;else a=0;if(!this.IsFlag(CFlags.STATUS_ENABLED))o=CUtil.FRAME3(this.m_dwAddFrame)+a;else if(this.IsFlag2(CFlags.STATUS2_PRESS))o=CUtil.FRAME2(this.m_dwAddFrame)+a;else if(this.IsFlag2(CFlags.STATUS2_MOUSEOVER))o=CUtil.FRAME1(this.m_dwAddFrame)+a;else o=CUtil.FRAME0(this.m_dwAddFrame)+a;if(this.IsFlagEx(CFlags.VXBUTTON_USE2IMG)){if(this.GetCheck())o=CUtil.FRAME2(m_dwAddFrame);else o=CUtil.FRAME0(m_dwAddFrame)}if(this.m_pAddImage){s=this.m_pAddImage.GetFrameSize();if(a==4){switch(this.m_pAddImage.GetFrameCount()){case 2:o=1;break;case 3:case 4:o=2;break}}n=CUtil.CRect(n.left,r.y-s.y/2,n.left+s.x,r.y-s.y/2+s.y);this.m_pAddImage.DrawFrame(t,n.left,n.top,o,0);return s.x}else{var l;var _;n.Inflate(-1,-1);if(!this.IsFlag(CFlags.STATUS_ENABLED)||this.IsFlag2(CFlags.STATUS2_PRESS))_=this.GetColor(CColor.INDEX_EDIT_GRAY);else _=this.GetColor(CColor.INDEX_EDIT_BKGND);n.right=n.left+n.Height();if(this.IsFlagEx(CFlags.VXBUTTON_CHECK)){l=t.DrawShape(n,CDefine.SHAPE_CHECKBOUND,this.GetColor(CColor.INDEX_EDIT_BORDER),_);if(this.IsFlag2(CFlags.STATUS2_CHECK)){t.DrawShape(n,CDefine.SHAPE_CHECK,this.GetColor(CColor.INDEX_EDIT_BORDER),_)}}else{l=t.DrawShape(n,CDefine.SHAPE_RADIOBOUND,this.GetColor(CColor.INDEX_EDIT_BORDER),_);if(this.IsFlag2(CFlags.STATUS2_CHECK)){t.DrawShape(n,CDefine.SHAPE_RADIO,this.GetColor(CColor.INDEX_EDIT_BORDER),_)}}return l}},GetButtonText:function(){return this.m_cTag.m_tag.GetText()},ResizeButton:function(){this.ModifyFlagEx(CFlags.VXBUTTON_TEXTRESIZE,0);var t=this.GetMarginText();var e;var i=this.GetObjectRectP();if(this.IsFlagEx(CFlags.VXBUTTON_CENTERRESIZE)){var n=i.CenterPoint();e=CUtil.CRect(n.x-t.x/2,n.y-t.y/2,n.x-t.x/2+t.x,n.y-t.y/2+t.y);if(this.IsFlagEx(CFlags.VXBUTTON_TEXTWIDTH)){e.top=i.top;e.bottom=i.bottom}}else{e=CUtil.CRect(i.left,i.top,i.left+t.x,i.top+t.y);if(this.IsFlagEx(CFlags.VXBUTTON_TEXTWIDTH))e.bottom=i.bottom}this.MoveObjectP(e)},SetButtonTag:function(t,e,i){switch(arguments.length){case 3:break;case 2:i=4294967295;break;case 1:i=4294967295;e=4294967295;break;default:return}if(t==null||t.IsNull()){this.ModifyFlagEx(0,CFlags.VXBUTTON_HASTAG);this.Invalidate();return}if(e!=4294967295)this.SetTextBoundColor(CDefine.INDEX_BOUNDLT,e);if(i!=4294967295)this.SetTextBoundColor(CDefine.INDEX_BOUNDRB,i);var n;if(this.OrFlagEx(CFlags.VXBUTTON_CHECK|CFlags.VXBUTTON_RADIO))n=CDefine.DT_LEFT;else n=CDefine.DT_CENTER;if(t.vcolor==-1)t.vcolor=this.GetColor(CColor.INDEX_CONTROLTEXT_GRAY);this.m_cTag.SetTag(t,n,null);this.ModifyFlagEx(CFlags.VXBUTTON_HASTAG,0);if(this.OrFlagEx(CFlags.VXBUTTON_TEXTRESIZE|CFlags.VXBUTTON_TEXTWIDTH)){var s=this.GetMarginText();var r;var a=this.GetObjectRectP();if(this.IsFlagEx(CFlags.VXBUTTON_CENTERRESIZE)){var o=a.CenterPoint();r=CUtil.CRect(o.x-s.x/2,o.y-s.y/2,o.x-s.x/2+s.x,o.y-s.y/2+s.y);if(this.IsFlagEx(CFlags.VXBUTTON_TEXTWIDTH)){r.top=a.top;r.bottom=a.bottom}}else{r=CUtil.CRect(a.left,a.top,a.left+s.x,a.top+s.y);if(this.IsFlagEx(CFlags.VXBUTTON_TEXTWIDTH))r.bottom=a.bottom}this.MoveObjectP(r)}this.Invalidate()},SetButtonText:function(t,e,i,n,s,r){switch(arguments.length){case 6:break;case 5:r=4294967295;break;case 4:r=4294967295;s=4294967295;break;case 3:r=4294967295;s=4294967295;n=4294967295;break;default:return}if(t==""){this.SetButtonTag(vx.tag.TNULL());return}if(t.search("_")!=-1)t=this.FindText(t);var a;if((a=vx.Global.FindSeperatorNum(t))>=0){t=vx.Global.g_referString;var o=vx.Global.VXS_GetButtonIcon();if(o){var l=vx.tag.Image(o,o.GetFrameRect(a));l.Append(vx.tag.TWIDTH(4));l.Append(vx.tag.Text(this.FindText(t),i,e,n));this.SetButtonTag(l,s,r)}else{this.SetButtonTag(vx.tag.Text(this.FindText(t),i,e,n),s,r)}}else{this.SetButtonTag(vx.tag.Text(t,i,e,n),s,r)}},GetMarginText:function(){var t;var e=this.m_cTag.GetSize();if(this.OrFlagEx(CFlags.VXBUTTON_CHECK|CFlags.VXBUTTON_RADIO)){e.x+=CUtil.MARGINLEFT(this.m_dwMargin);if(this.m_pAddImage){t=this.m_pAddImage.GetFrameSize();if(t.y>e.y)e.y=t.y;e.x+=t.x}else{e.x+=this.m_height}}else{if(this.m_pImage&&!this.m_pImage.IsResize()){t=this.m_pImage.GetFrameSize();if(t.x>e.x)e.x=t.x;if(t.y>e.y)e.y=t.y}else{e.x+=CUtil.MARGINLEFT(this.m_dwMargin)+CUtil.MARGINRIGHT(this.m_dwMargin);e.y+=CUtil.MARGINTOP(this.m_dwMargin)+CUtil.MARGINBOTTOM(this.m_dwMargin)}}return e},SetTextBoundColor:function(t,e){this.m_cTag.SetBoundColor(t,e)},SetCheckImageName:function(t,e){if(arguments.length<2)e=0;this.SetCheckImage(this.FindImage(t),e)},SetCheckImage:function(t,e){if(arguments.length<2)e=0;this.m_pAddImage=t;this.SetCheckFrame(e);if(this.m_stage&&this.m_pAddImage){var i=this.GetObjectRectP();var n=this.m_pAddImage.GetFrameSize();if(i.Height()<n.y)MoveObjectP(CUtil.CRect(i.left,i.top,i.right,i.top+n.y))}},SetCheckFrame:function(t){if(t==0){this.m_dwAddFrame=CUtil.MAKEFRAME(0,1,2,3)}else{if(CUtil.FRAME0(t)>0&&CUtil.FRAME1(t)==0&&CUtil.FRAME2(t)==0&&CUtil.FRAME3(t)==0){this.m_dwAddFrame=CUtil.MAKEFRAME(CUtil.FRAME0(t),CUtil.FRAME0(t)+1,CUtil.FRAME0(t)+2,CUtil.FRAME0(t)+3)}else{this.m_dwAddFrame=t}}},SetCheckText:function(t,e,i,n,s,r){this.ModifyFlagEx(CFlags.VXBUTTON_CHECK,0);this.SetButtonText(t,e,i,n,s,r)},SetMargin:function(t,e,i,n){this.m_dwMargin=CUtil.MAKEMARGIN(t,e,i,n)},SetBlink:function(t,e){if(arguments.length<2)e=-1;if(t){this.m_nBlinkCnt=e;this.ModifyFlagEx(CFlags.VXBUTTON_SETBLINK,0);this.SetTimer(CDefine.DEFTIMER_BLINK,500)}else{this.m_nBlinkCnt=-1;this.ModifyFlagEx(0,CFlags.VXBUTTON_SETBLINK);this.KillTimer(CDefine.DEFTIMER_BLINK);if(this.IsFlag2(CFlags.STATUS2_BLINK)){this.ModifyFlag2(0,CFlags.STATUS2_BLINK);this.Invalidate()}}}});vx.drag=vx.object.extend({init:function(){this._super();this.m_ptD=CUtil.CPoint(0,0);this.m_ptVal=CUtil.CPoint(0,0);this.m_rcRange=null;this.m_rcDragPrev=CUtil.CRect(0,0,0,0);this.m_pDropOwner=null;this.m_bDragOn=null;this.m_nHT=CDefine.BUTTON_DEPTH},toString:function(){return"(vx.drag)"},Delete:function(){this.m_ptD=null;this.m_ptVal=null;this.m_rcRange=null;this.m_rcDragPrev=null;this.m_pDropOwner=null;this.m_bDragOn=null;this._super()},OnCreate:function(){if(!this._super())return false;return true},OnDraw:function(t,e){var i=3;if(this.IsFlag(CFlags.STATUS_ENABLED)){if(this.IsFlag2(CFlags.STATUS2_MOUSEOVER))i=1;else i=0}var n,s,r,a,o;if(this.IsFlagEx(CFlags.VXCLICK_FOCUS_BORDER))o=this.m_crBndF;else o=this.GetColor(CColor.INDEX_CONTROLBORDER);if(this.IsFlagEx(CFlags.VXCLICK_FACE2)){r=this.GetColor(CColor.INDEX_CONTROL_LT2);a=this.GetColor(CColor.INDEX_CONTROL_RB2);switch(i){case 0:n=this.GetColor(CColor.INDEX_CONTROLFACE2);s=this.GetColor(CColor.INDEX_CONTROLFACE2);break;case 1:n=this.GetColor(CColor.INDEX_CONTROLFACE_FOCUS2);s=this.GetColor(CColor.INDEX_CONTROLFACE_FOCUS2_GR);break;default:s=n=this.GetColor(CColor.INDEX_CONTROLFACE_GRAY2);break}}else{r=this.GetColor(CColor.INDEX_CONTROL_LT);a=this.GetColor(CColor.INDEX_CONTROL_RB);switch(i){case 0:n=this.GetColor(CColor.INDEX_CONTROLFACE);s=this.GetColor(CColor.INDEX_CONTROLFACE_GR);break;case 1:n=this.GetColor(CColor.INDEX_CONTROLFACE_FOCUS);s=this.GetColor(CColor.INDEX_CONTROLFACE_FOCUS_GR);break;default:s=n=this.GetColor(CColor.INDEX_CONTROLFACE_GRAY);break}}t.DrawButton(e,i,n,s,r,a,o,this.m_dwRndVal,this.m_nHT)},OnSize:function(){this._super()},OnClose:function(){if(!this._super())return false;return true},OnMouseMove:function(t,e,i){if(this.IsFlag2(CFlags.STATUS2_CAPTURE|CFlags.STATUS2_PRESS)){if((i&CKeys.MK_LBUTTON)==CKeys.MK_LBUTTON){this.SetDrag(t,e)}else{this.ModifyFlag2(0,CFlags.STATUS2_CAPTURE);this.ReleaseCaptureObject();this.Invalidate()}}else{if(this.HitTest(t,e)){if(!this.IsFlag(CFlags.STATUS_NOMOUSEMOVE)&&!this.IsFlag2(CFlags.STATUS2_MOUSEOVER)){this.ModifyFlag2(CFlags.STATUS2_MOUSEOVER,0);this.Invalidate()}}else{if(this.IsFlag2(CFlags.STATUS2_MOUSEOVER)){this.OnMouseLeave()}}}},OnLButtonUp:function(t,e,i){if(this.IsFlag2(CFlags.STATUS2_PRESS)){this.ModifyFlag2(0,CFlags.STATUS2_PRESS);if(!this.HitTest(t,e))this.ModifyFlag2(0,CFlags.STATUS2_MOUSEOVER);this.Invalidate()}if(this.IsFlag2(CFlags.STATUS2_CAPTURE)){if(this.IsFlagEx2(CFlags.VXDRAG2_DROPNOTIFY)){var n=CUtil.CPoint(t,e);this.ClientToStagePoint(n);this.NotifyDrop(n.x,n.y,i)}else if(this.IsFlagEx(CFlags.VXDRAG_NOTIFYPARENT)){this.NotifyParent(CDefine.CMD_VXDRAG_DRAGEND,this.m_ptD.x+this.m_ptVal.x,this.m_ptD.y+this.m_ptVal.y)}this.ReleaseCaptureObject()}},OnMouseLeave:function(){if(this.IsFlag2(CFlags.STATUS2_CAPTURE))return;if(this.OrFlag2(CFlags.STATUS2_MOUSEOVER|CFlags.STATUS2_PRESS)){this.ModifyFlag2(0,CFlags.STATUS2_MOUSEOVER|CFlags.STATUS2_PRESS);this.Invalidate()}},SetRange:function(t){if(this.m_rcRange==null){this.m_rcRange=t.Clone()}else{this.m_rcRange.Set(t)}this.m_rcRange.Int()},CalculateRange:function(){if(this.m_rcRange==null){this.ModifyFlagEx(CFlags.VXDRAG_DEFAULTRANGE,0);this.m_rcRange=CUtil.CRect(0,0,0,0)}var t;if(this.IsFlagEx(CFlags.VXDRAG_DEFAULTRANGE)){if(this.m_parent){t=this.m_parent.GetClientRect()}else{t=this.m_stage.m_skin.GetViewRect();t.Offset(this.m_stage.m_rcStage.left,this.m_stage.m_rcStage.top)}this.m_rcRange.Set(t)}},GetRange:function(){this.CalculateRange();return this.m_rcRange.Clone()},OnLButtonDown:function(t,e,i){if(this.HitTest(t,e)){this.CalculateRange();this.GetObjectRectP(this.m_rcDragPrev);if(this.m_uFlag2&CFlags.STATUS2_TRANSFORM){var n=new vx.point(t,e);this.TransformPointC(n);t=n.x;e=n.y}this.m_ptD.x=t+this.m_x;this.m_ptD.y=e+this.m_y;this.ModifyFlag2(CFlags.STATUS2_PRESS|CFlags.STATUS2_LOCK,0);this.SetCaptureObject();this.Invalidate();if(this.IsFlagEx(CFlags.VXDRAG_NOTIFYPARENT))this.NotifyParent(CDefine.CMD_VXDRAG_DRAGSTART,this.m_ptD.x,this.m_ptD.y)}},OnReleaseCapture:function(){if(this.IsFlag2(CFlags.STATUS2_LOCK)){this.ModifyFlag2(0,CFlags.STATUS2_PRESS|CFlags.STATUS2_LOCK);this.Invalidate()}},SetDrag:function(t,e){if(this.m_uFlag2&CFlags.STATUS2_TRANSFORM){var i=new vx.point(t,e);this.TransformPointC(i);t=i.x;e=i.y}var n=this.m_rcRange;var s=this.m_rcDragPrev.Clone();this.m_ptVal.x=t+this.m_x-this.m_ptD.x;this.m_ptVal.y=e+this.m_y-this.m_ptD.y;s.Offset(this.m_ptVal.x,this.m_ptVal.y);this.DeflateBound(s);if(this.IsFlagEx(CFlags.VXDRAG_USERANGECLIP)){var r=s.Width();var a=s.Height();if(s.left<n.left){if(s.top<n.top)s.SetRect(n.left,n.top,n.left+r,n.top+a);else if(s.bottom>n.bottom)s.SetRect(n.left,n.bottom-a,n.left+r,n.bottom);else s.SetRect(n.left,s.top,n.left+r,s.bottom)}else if(s.right>n.right){if(s.top<n.top)s.SetRect(n.right-r,n.top,n.right,n.top+a);else if(s.bottom>n.bottom)s.SetRect(n.right-r,n.bottom-a,n.right,n.bottom);else s.SetRect(n.right-r,s.top,n.right,s.bottom)}else if(s.top<n.top){s.SetRect(s.left,n.top,s.right,n.top+a)}else if(s.bottom>n.bottom){s.SetRect(s.left,n.bottom-a,s.right,n.bottom)}}this.InflateBound(s);this.MoveObjectP(s);if(this.IsFlagEx(CFlags.VXDRAG_NOTIFYPARENT)){this.NotifyParent(CDefine.CMD_VXDRAG_DRAG,this.m_ptVal.x,this.m_ptVal.y)}},SetDropOwner:function(t){this.m_pDropOwner=t},NotifyDrop:function(t,e,i){var n=null;if(this.IsFlagEx2(CFlags.VXDRAG2_DROPLIMITPARENT)){var s=this.m_parent;while(s){if(s.IsFlagEx2(CFlags.VXOBJECT2_DROPENABLED)&&s.IsFlag(CFlags.STATUS_ENABLED)&&s.IsFlag(CFlags.STATUS_SHOW)){n=s;break}s=s.m_parent}}else{n=this.m_stage.m_skin.FindDropEnableObject(t,e)}if(n){if(n==this.m_pDropOwner){if(this.OnDragDropCancel(true)){this.MoveObjectP(this.m_rcDragPrev);return}}if(this.OnDragDropOk()){n.OnDropObject(t,e,i,this);if(this.m_pDropOwner)this.m_pDropOwner.OnDropObjectNotifyOwner(t,e,i,this)}}else{if(this.OnDragDropCancel(true)){this.MoveObjectP(this.m_rcDragPrev)}else{if(this.m_stage&&this.m_stage.IsFlag(CFlags.STAGEST_DROPENABLED)&&this.m_stage.IsFlag(CFlags.STAGEST_ENABLED)&&this.m_stage.IsFlag(CFlags.STAGEST_SHOW)){this.m_stage.OnDropObject(t,e,i,this)}}}},EnableNotifyDrop:function(t,e){if(t){this.ModifyFlagEx2(CFlags.VXDRAG2_DROPNOTIFY,0);if(e)this.ModifyFlagEx(CFlags.VXDRAG2_DROPLIMITPARENT,0);else this.ModifyFlagEx(0,CFlags.VXDRAG2_DROPLIMITPARENT)}else{this.ModifyFlagEx2(0,CFlags.VXDRAG2_DROPNOTIFY|CFlags.VXDRAG2_DROPLIMITPARENT)}},OnDragDropOk:function(){return true},OnDragDropCancel:function(t){return true}});vx.box=vx.drag.extend({init:function(t){this._super();this.m_title=new vx.tagcont;this.m_pBoxImage=null;this.m_pSysImage=null;this.m_pShadowImage=null;this.m_pHilight=null;this.m_bResizing=false;this.m_iResizingType=0;this.m_ptFixed=new vx.point(0,0);this.m_rcSet=null;this.m_crBackground=4294967295;this.m_nAlphaBk=.5;this.m_crAlpha=0;this.m_pParam=null;this.m_diKey=0;this.m_diRatio=null;this.m_noBox=0;this.m_bNoBuf=false;this.m_rcRB=new vx.rect;if(t==undefined)this.m_nID=0;else this.m_nID=t;if(this.m_nID!=0)this.SetDialogInfoKey(this.m_nID);this.SetTypeCode(CDefine.VXCODE_BOX);this.SetRound(3,3,3,3);this.m_pParam=vx.Global.g_boxparam},toString:function(){return"(vx.box)"},Delete:function(){this.m_title=null;this.m_pBoxImage=null;this.m_pSysImage=null;this.m_pShadowImage=null;this.m_pHilight=null;this.m_ptFixed=null;this.m_rcSet=null;this.m_pParam=null;this.m_rcRB=null;this._super()},OnCreate:function(){if(!this._super())return false;if(this.IsFlagEx(CFlags.VXBOX_RESIZEBORDER)){this.m_nBorderGap=this.m_pParam.sys_resize_border;if(this.m_pParam.out_lborder<this.m_nBorderGap)this.SetBoxParam(CDefine.BPI_OUTLBORDER,this.m_nBorderGap);if(this.m_pParam.out_tborder<this.m_nBorderGap)this.SetBoxParam(CDefine.BPI_OUTTBORDER,this.m_nBorderGap);if(this.m_pParam.out_rborder<this.m_nBorderGap)this.SetBoxParam(CDefine.BPI_OUTRBORDER,this.m_nBorderGap);if(this.m_pParam.out_bborder<this.m_nBorderGap)this.SetBoxParam(CDefine.BPI_OUTBBORDER,this.m_nBorderGap)}else if(this.IsFlag(CFlags.STATUS_TRANS)||this.IsFlagEx(CFlags.VXBOX_NOFRAME)){if(!this.m_pBoxImage){this.m_nBorderGap=1;this.SetBorderGap(this.m_nBorderGap,this.m_nBorderGap,this.m_nBorderGap,this.m_nBorderGap);this.SetBoxParam(CDefine.BPI_OUTLBORDER,this.m_nBorderGap,true);this.SetBoxParam(CDefine.BPI_OUTTBORDER,this.m_nBorderGap,true);this.SetBoxParam(CDefine.BPI_OUTRBORDER,this.m_nBorderGap,true);this.SetBoxParam(CDefine.BPI_OUTBBORDER,this.m_nBorderGap,true)}}else{this.m_nBorderGap=CGlobal.DEFAULT_BOXBORDER}if(this.IsFlagEx(CFlags.VXBOX_CAPTION)){this.SetBorderGap(this.m_pParam.out_lborder,this.m_pParam.out_tborder+this.m_pParam.sys_caption,this.m_pParam.out_rborder,this.m_pParam.out_bborder);this.ModifyFlagEx(0,CFlags.VXBOX_NOFRAME)}else if(!this.IsFlagEx(CFlags.VXBOX_NOFRAME)){this.SetBorderGap(this.m_pParam.out_lborder,this.m_pParam.out_tborder,this.m_pParam.out_rborder,this.m_pParam.out_bborder)}if(!this.m_pBoxImage&&this.IsFlagEx(CFlags.VXBOX_NOFRAME)){if(this.IsFlag(CFlags.STATUS_TRANS)){this.SetBorderGap(0,0,0,0)}else{if(this.IsFlagEx(CFlags.VXBOX_BORDERSUNKEN))this.SetBorderGap(2,2,2,2);else this.SetBorderGap(1,1,1,1)}}if(!this.m_pBoxImage&&this.OrFlag(CFlags.MASK_COMMONIMAGE)&&!this.IsFlagEx(CFlags.VXBOX_NOFRAME)){var t=this.GetCommonImage();var e=null;var i=vx.Global.VXS_GetBoxImage(t);if(!this.m_pShadowImage&&this.IsFlag(CFlags.STATUS_POPUP))e=vx.Global.VXS_GetShadowImage();if(i){var n=i.GetFrameRect(0);var s=i.m_rcInner.left-n.left;var r=n.right-i.m_rcInner.right;var a=n.bottom-i.m_rcInner.bottom;var o=i.m_rcInner.top-n.top;if(o-a>5){if(this.GetBoxParam(CDefine.BPI_SYSCAPTION)>o-a)this.SetBoxParam(CDefine.BPI_SYSCAPTION,o-a);if(this.GetBoxParam(CDefine.BPI_OUTBBORDER)>a)this.SetBoxParam(CDefine.BPI_OUTBBORDER,a);if(this.GetBoxParam(CDefine.BPI_OUTTBORDER)>o)this.SetBoxParam(CDefine.BPI_OUTTBORDER,o)}if(s<r)r=s;else s=r;if(this.GetBoxParam(CDefine.BPI_OUTLBORDER)>s)this.SetBoxParam(CDefine.BPI_OUTLBORDER,s);if(this.GetBoxParam(CDefine.BPI_OUTRBORDER)>r)this.SetBoxParam(CDefine.BPI_OUTRBORDER,r)}this.SetFrameImage(this.GetBoxParam(CDefine.BPI_SYSCAPTION),this.GetBoxParam(CDefine.BPI_OUTLBORDER),this.GetBoxParam(CDefine.BPI_OUTTBORDER),i,vx.Global.VXS_GetSysImage(t),e)}if(!this.m_pShadowImage&&this.IsFlag(CFlags.STATUS_SHADOW))this.m_pShadowImage=vx.Global.VXS_GetShadowImage();if(this.m_pShadowImage){if(this.SetImageShadowGap(this.m_pShadowImage))this.ModifyFlag(CFlags.STATUS_SHADOW,0)}else{this.ModifyFlag(0,CFlags.STATUS_SHADOW)}if(this.IsFlagEx(CFlags.VXBOX_CAPTION|CFlags.VXBOX_SYSCLOSE)){var l=this.GetSysButtonRect();l.Offset(-this.m_pParam.sys_xmargin,this.m_pParam.sys_ymargin-this.m_pParam.out_tborder/2);var _=new vx.button;_.SetShapeType(CDefine.SHAPE_CLOSE);_.CreateP(this.m_stage,l,CDefine.VXID_BOXCLOSE,CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED|CFlags.STATUS_TABSTOP|CFlags.STATUS_NOCLIP,CFlags.VXCLICK_FACE2,this);if(this.m_pSysImage){if(this.m_pSysImage.IsFrame())_.SetImage(this.m_pSysImage,0);else _.SetImageEx(this.m_pSysImage,0,vx.Global.VXS_GetSysImageRect(this.GetCommonImage()))}_.SetSticker(true,false)}if(this.m_crBackground==4294967295){this.m_crBackground=this.GetColor(CColor.INDEX_POPUPBKGND)}if(this.m_diKey!=0)this.DoDialogFlags(this.m_diKey);return true},OnDrawPartAlpha:function(t,e){e.Deflate(this.m_pParam.out_lborder,this.m_pParam.out_tborder,this.m_pParam.out_rborder,this.m_pParam.out_bborder);t.DrawRectangle(e,this.m_crAlpha,4294967295,this.m_nAlphaBk,1)},OnDrawShadow:function(t,e){if(this.IsFlagEx(CFlags.VXBOX_NOFRAME)||!this.m_pShadowImage)return;this.m_pShadowImage.DrawBox(t,e,0)},OnDrawFrame:function(t,e){var i=this.IsFlag(CFlags.STATUS_PARTALPHA);var n=0;var s=e.Clone();this.DeflateWork(s);if(this.IsFlag(CFlags.STATUS_TRANS)){if(this.m_pBoxImage){if(i){n=this.m_pBoxImage.m_uFlag;this.m_pBoxImage.ModifyFlag(CDefine.PKFLAG_IMAGENOINNER,0)}this.m_pBoxImage.DrawBox(t,e,this.m_noBox);if(i)this.m_pBoxImage.m_uFlag=n}this.DeflateInnerGap(s)}else{if(this.m_pBoxImage){if(this.m_pBoxImage.IsFlag(CDefine.PKFLAG_IMAGENOINNER)&&!i&&!this.IsFlagEx(CFlags.VXBOX_TRANSINNER)){this.DeflateWork(s);t.FillSolidRect(s,this.m_crBackground)}if(i){n=this.m_pBoxImage.m_uFlag;this.m_pBoxImage.ModifyFlag(CDefine.PKFLAG_IMAGENOINNER,0)}this.m_pBoxImage.DrawBox(t,e,0);if(i)this.m_pBoxImage.m_uFlag=n;this.DeflateInnerGap(s)}else{s=e.Clone();this.DeflateWork(s);var r=this.m_dwRndVal;var a=this.GetColor(CColor.INDEX_FRAMEFACE);var o=this.GetColor(CColor.INDEX_FRAMEFACE_GR);var l=this.GetColor(CColor.INDEX_CONTROLBORDER);var _=this.GetColor(CColor.INDEX_FRAME_LT);var h=this.GetColor(CColor.INDEX_FRAME_RB);if(i==0){t.FillSolidRect(s,this.m_crBackground,4294967295,4294967295,1,1,0)}t.DrawFrameRect(0,e,s,a,l,1,1,r);var f=e.Clone();f.Deflate(1,1,1,1);var C=f.Clone();var m=Math.floor(this.m_nBorderGap/2);C.Deflate(m,m,m,m);t.DrawFrameRect(1,f,C,_,4294967295,1,1,r);t.DrawFrameRect(2,f,C,h,4294967295,1,1,r);f.left=s.left;f.top=(f.top+s.top)/2;f.bottom=s.top-1;f.right=s.right;t.FillSolidRect(f,o,4294967295,4294967295,1,1,r&65535);this.DeflateInnerGap(s)}}var u=this.GetCaptionRect();t.OffsetTransform(u);if(this.IsFlagEx(CFlags.VXBOX_CAPTION)&&this.m_pParam.sys_caption>7){var T=this.m_pParam.title_ymargin-this.m_pParam.out_tborder/2;u.top+=T;u.left+=this.m_pParam.title_xmargin;u.bottom+=T;this.m_title.Draw(t,u)}return s},OnDraw:function(t,e){},EventSync:function(t,e,i,n){this._super(t,e,i,n);if(t==CDefine.CMD_VXBUTTON_CLICK){if(e==CDefine.VXID_BOXCLOSE){this.Close()}}},OnSize:function(){this._super();var t=this.GetInnerRect();this.m_rcRB.SetRect(t.right,t.bottom,this.m_width,this.m_height)},OnClose:function(){if(!this._super())return false;return true},OnLButtonDown:function(t,e,i){if(this.IsFlagEx(CFlags.VXBOX_RESIZEBORDER)){var n=this.HitBorderTest(t,e);if(n!=CDefine.HTCLIENT&&n>0){this.m_iResizingType=n;this.m_bResizing=true;this.m_ptFixed.x=t+this.m_x;this.m_ptFixed.y=e+this.m_y;this.m_rcSet=this.GetObjectRectP();this.CalculateRange();this.ClearBuffer();this.m_bNoBuf=this.IsFlag(CFlags.STATUS_NOBUFFER);if(!this.m_bNoBuf)this.ModifyFlag(CFlags.STATUS_NOBUFFER,0);this.ModifyFlag2(CFlags.STATUS2_PRESS,0);this.SetCaptureObject();this.Invalidate();this.OnSetCursor(n,CMessage.WM_LBUTTONDOWN);return}}var s=this.GetCaptionRect();if(!this.IsFlagEx(CFlags.VXBOX_NODRAG)&&s.Contain(t,e)){this._super(t,e,i)}},OnMouseMove:function(t,e,i){if(this.m_bResizing){if(this.IsFlag2(CFlags.STATUS2_CAPTURE)){if((i&CKeys.MK_LBUTTON)==CKeys.MK_LBUTTON){var n=new vx.point(t+this.m_x,e+this.m_y);this.SetBoxSize(n)}else{this.ModifyFlag2(0,CFlags.STATUS2_CAPTURE);this.ReleaseCaptureObject()}}}else{if(!this.IsFlag2(CFlags.STATUS2_CAPTURE)){if(this.IsFlagEx(CFlags.VXBOX_RESIZEBORDER))this.OnSetCursor(this.HitBorderTest(t,e),CMessage.WM_MOUSEMOVE)}else{if(!this.IsFlagEx(CFlags.VXBOX_NODRAG))this._super(t,e,i)}}},OnLButtonUp:function(t,e,i){if(this.m_bResizing){var n=new vx.point(t+this.m_x,e+this.m_y);this.SetBoxSize(n);this.ReleaseCaptureObject()}else{if(!this.IsFlagEx(CFlags.VXBOX_NODRAG))this._super(t,e,i)}},OnMouseLeave:function(){if(this.m_bResizing){if(this.IsFlag2(CFlags.STATUS2_CAPTURE))return;if(this.OrFlag2(CFlags.STATUS2_MOUSEOVER|CFlags.STATUS2_PRESS)){this.ModifyFlag2(0,CFlags.STATUS2_MOUSEOVER|CFlags.STATUS2_PRESS)}this.m_bResizing=false}else{this._super()}},OnReleaseCapture:function(){if(this.m_bResizing){if(!this.m_bNoBuf)this.ModifyFlag(0,CFlags.STATUS_NOBUFFER);this.m_bNoBuf=false;this.m_bResizing=false}this._super()},SetDialogInfoKey:function(t){},DoDialogFlags:function(t){},DoDialogTemplete:function(t,e){},GetCaptionRect:function(){if(!this.IsFlagEx(CFlags.VXBOX_CAPTION))return CUtil.CRect(0,0,0,0);var t=this.GetBoundRect();t.top+=this.m_pParam.out_tborder;t.left+=this.m_pParam.out_lborder;t.bottom=t.top+this.m_pParam.sys_caption;t.right-=this.m_pParam.out_rborder;return t},GetSysButtonRect:function(){var t=this.GetCaptionRect();var e=t.CenterPoint();t=CUtil.CRect(t.right-this.m_pParam.sys_button_dx,e.y-this.m_pParam.sys_button_dy/2,t.right,e.y-this.m_pParam.sys_button_dy/2+this.m_pParam.sys_button_dy);t.IntR();if(this.m_pParam){if(this.m_pBoxImage)t.Offset(-this.m_pParam.sys_xmargin,this.m_pParam.sys_ymargin-this.m_pParam.out_tborder/2);else t.Offset(-this.m_pParam.sys_xmargin,0)}return t},SetFrameImage:function(t,e,i,n,s,r){var a,o,l,_;this.m_pBoxImage=n;if(this.m_pBoxImage){if(!this.m_pBoxImage.IsResize()){a=this.GetObjectRectP();l=CUtil.CenterPoint(a);_=this.m_pBoxImage.GetImageSize();o=CUtil.CRect(l.x-_.x/2,l.y-_.y/2,l.x-_.x/2+_.x,l.y-_.y/2+_.y);this.MoveObjectP(o)}if(t!=-1)this.SetBoxParam(CDefine.BPI_SYSCAPTION,t);if(e!=-1){this.SetBoxParam(CDefine.BPI_OUTLBORDER,e);this.SetBoxParam(CDefine.BPI_OUTRBORDER,e)}if(i!=-1){this.SetBoxParam(CDefine.BPI_OUTTBORDER,i);this.SetBoxParam(CDefine.BPI_OUTBBORDER,i)}if(!this.m_pBoxImage.IsFlag(CDefine.PKFLAG_IMAGENOTRANS))this.ModifyFlag(CFlags.STATUS_TRANS,0)}this.m_pSysImage=s;if(this.m_pSysImage){_=null;if(this.m_pSysImage.IsFrame()){_=this.m_pSysImage.GetFrameSize()}else{var h=vx.Global.VXS_GetSysImageRect();if(h)_=CUtil.CRect(h.Width(),h.Height())}if(_){this.SetBoxParam(CDefine.BPI_SYSBUTTONDX,_.x);this.SetBoxParam(CDefine.BPI_SYSBUTTONDY,_.y)}}this.m_pShadowImage=r;if(this.IsFlagEx(CFlags.VXBOX_CAPTION|CFlags.VXBOX_SYSCLOSE)){var f=this.FindObject(CDefine.VXID_BOXCLOSE);if(f)f.MoveObjectP(this.GetSysButtonRect())}},SetBoxFrame:function(t){this.m_noBox=t},SetBoxSize:function(t){if(this.IsFlagEx(CFlags.VXDRAG_USERANGECLIP)&&!this.m_rcRange.Contain(t.x,t.y))return;var e=t.x-this.m_ptFixed.x;var i=t.y-this.m_ptFixed.y;var n=this.m_rcSet.Clone();switch(this.m_iResizingType){case CDefine.HTLEFT:n.left+=e;break;case CDefine.HTTOP:n.top+=i;break;case CDefine.HTRIGHT:n.right+=e;break;case CDefine.HTBOTTOM:n.bottom+=i;break;case CDefine.HTTOPLEFT:n.left+=e;n.top+=i;break;case CDefine.HTTOPRIGHT:n.right+=e;n.top+=i;break;case CDefine.HTBOTTOMLEFT:n.left+=e;n.bottom+=i;break;case CDefine.HTBOTTOMRIGHT:n.right+=e;n.bottom+=i;break}var s=this.GetObjectRectP();if(n.left<n.right&&n.top<n.bottom){if(n.Width()<this.m_pParam.minbox_dx||n.Width()>this.m_pParam.maxbox_dx){n.left=s.left;n.right=s.right}if(n.Height()<this.m_pParam.minbox_dy||n.Height()>this.m_pParam.maxbox_dy){n.top=s.top;n.bottom=s.bottom}this.MoveObjectP(n)}},SetTitle:function(t,e,i){switch(arguments.length){case 3:break;case 2:i=null;break;case 1:i=null;e=-1;break}if(t!=null&&t!=""){var n=t.indexOf("_");if(n!=-1)t=this.FindText(t);if(e==-1){e=vx.Global.FindSeperatorNum(t);if(e>=0)t=vx.Global.g_referString}}var s=vx.tag.TNULL();var r,a,o;var l=0;if(this.m_stage){var _=this.GetCaptionRect();if(_.Height()<=18)l=CDefine.TAGTYPE_SMALL}if(i==null)i=vx.Global.VXS_GetTitleIcon();if(i&&e>=0)s=vx.tag.Image(i,i.GetFrameRect(e));r=this.GetColor(CColor.INDEX_FRAMETEXT);a=this.GetColor(CColor.INDEX_FRAMETEXT_BOUNDLT);o=this.GetColor(CColor.INDEX_FRAMETEXT_BOUNDRB);var h;if(vx.Global.g_uBoxTitleFormat==0)h=CDefine.DT_LEFT|CDefine.DT_VCENTER;else h=vx.Global.g_uBoxTitleFormat;if(t!=null&&t!=""){s.Append(vx.tag.TWIDTH(4));s.Append(vx.tag.Text(t,r,vx.Global.g_title_tagtype|l))}this.m_title.SetTag(s,h);this.m_title.SetBoundColor(CDefine.INDEX_BOUNDLT,a);this.m_title.SetBoundColor(CDefine.INDEX_BOUNDRB,o);this.Invalidate()},SetTitleTag:function(t){var e,i,n;i=this.GetColor(CColor.INDEX_FRAMETEXT_BOUNDLT);n=this.GetColor(CColor.INDEX_FRAMETEXT_BOUNDRB);if(vx.Global.g_uBoxTitleFormat==0)e=CDefine.DT_LEFT|CDefine.DT_VCENTER;else e=vx.Global.g_uBoxTitleFormat;this.m_title.SetTag(t,e);this.m_title.SetBoundColor(CDefine.INDEX_BOUNDLT,i);this.m_title.SetBoundColor(CDefine.INDEX_BOUNDRB,n);this.Invalidate()},SetBoxParam:function(t,e,i){if(i==undefined)i=false;if(this.GetBoxParam(t)==e)return;if(this.m_pParam==vx.Global.g_boxparam){this.m_pParam=vx.Global.g_boxparam.Copy()}var n;switch(t){case CDefine.BPI_SYSBUTTONDX:this.m_pParam.sys_button_dx=e;break;case CDefine.BPI_SYSBUTTONDY:this.m_pParam.sys_button_dy=e;break;case CDefine.BPI_SYSRESIZEBORDER:this.m_pParam.sys_resize_border=e;break;case CDefine.BPI_SYSCAPTION:if(!i){n=this.GetBorderGapEx(1);n-=this.m_pParam.sys_caption;n+=e;this.SetBorderGapEx(n,1)}this.m_pParam.sys_caption=e;break;case CDefine.BPI_OUTLBORDER:if(!i){n=this.GetBorderGapEx(0);n-=this.m_pParam.out_lborder;n+=e;this.SetBorderGapEx(n,0)}this.m_pParam.out_lborder=e;break;case CDefine.BPI_OUTTBORDER:if(!i){n=this.GetBorderGapEx(1);n-=this.m_pParam.out_tborder;n+=e;this.SetBorderGapEx(n,1)}this.m_pParam.out_tborder=e;break;case CDefine.BPI_OUTRBORDER:if(!i){n=this.GetBorderGapEx(2);n-=this.m_pParam.out_rborder;n+=e;this.SetBorderGapEx(n,2)}this.m_pParam.out_rborder=e;break;case CDefine.BPI_OUTBBORDER:if(!i){n=this.GetBorderGapEx(3);n-=this.m_pParam.out_bborder;n+=e;this.SetBorderGapEx(n,3)}this.m_pParam.out_bborder=e;break;case CDefine.BPI_MINBOXDX:this.m_pParam.minbox_dx=e;break;case CDefine.BPI_MINBOXDY:this.m_pParam.minbox_dy=e;break;case CDefine.BPI_MAXBOXDX:this.m_pParam.maxbox_dx=e;break;case CDefine.BPI_MAXBOXDY:this.m_pParam.maxbox_dy=e;break;case CDefine.BPI_DEFAULTBTNDX:this.m_pParam.default_btn_dx=e;break;case CDefine.BPI_DEFAULTBTNDY:this.m_pParam.default_btn_dy=e;break;case CDefine.BPI_TITLEXMARGIN:this.m_pParam.title_xmargin=e;break;case CDefine.BPI_TITLEYMARGIN:this.m_pParam.title_ymargin=e;break;case CDefine.BPI_SYSXMARGIN:this.m_pParam.sys_xmargin=e;break;case CDefine.BPI_SYSYMARGIN:this.m_pParam.sys_ymargin=e;break;case CDefine.BPI_HLYMARGIN:this.m_pParam.hl_ymargin=e;break;case CDefine.BPI_HLYOFFSET:this.m_pParam.hl_yoffset=e;break;case CDefine.BPI_MESSAGEXMARGIN:this.m_pParam.message_xmargin=e;break;case CDefine.BPI_MESSAGEYMARGIN:this.m_pParam.message_ymargin=e;break}},GetBoxParam:function(t){switch(t){case CDefine.BPI_SYSBUTTONDX:return this.m_pParam.sys_button_dx;case CDefine.BPI_SYSBUTTONDY:return this.m_pParam.sys_button_dy;case CDefine.BPI_SYSRESIZEBORDER:return this.m_pParam.sys_resize_border;case CDefine.BPI_SYSCAPTION:return this.m_pParam.sys_caption;case CDefine.BPI_OUTLBORDER:return this.m_pParam.out_lborder;case CDefine.BPI_OUTTBORDER:return this.m_pParam.out_tborder;case CDefine.BPI_OUTRBORDER:return this.m_pParam.out_rborder;case CDefine.BPI_OUTBBORDER:return this.m_pParam.out_bborder;case CDefine.BPI_MINBOXDX:return this.m_pParam.minbox_dx;case CDefine.BPI_MINBOXDY:return this.m_pParam.minbox_dy;case CDefine.BPI_MAXBOXDX:return this.m_pParam.maxbox_dx;case CDefine.BPI_MAXBOXDY:return this.m_pParam.maxbox_dy;case CDefine.BPI_DEFAULTBTNDX:return this.m_pParam.default_btn_dx;case CDefine.BPI_DEFAULTBTNDY:return this.m_pParam.default_btn_dy;case CDefine.BPI_TITLEXMARGIN:return this.m_pParam.title_xmargin;case CDefine.BPI_TITLEYMARGIN:return this.m_pParam.title_ymargin;case CDefine.BPI_SYSXMARGIN:return this.m_pParam.sys_xmargin;case CDefine.BPI_SYSYMARGIN:return this.m_pParam.sys_ymargin;case CDefine.BPI_HLYMARGIN:return this.m_pParam.hl_ymargin;case CDefine.BPI_HLYOFFSET:return this.m_pParam.hl_yoffset;case CDefine.BPI_MESSAGEXMARGIN:return this.m_pParam.message_xmargin;case CDefine.BPI_MESSAGEYMARGIN:return this.m_pParam.message_ymargin}return 0},DeflateInnerGap:function(t){},HitBorderTest:function(t,e){if(this.m_rcRB.Contain(t,e))return CDefine.HTBOTTOMRIGHT;return this._super(t,e)},GetInnerRect:function(t){if(arguments.length==0)t=this.GetWorkRect();return t},GetChildClipRect:function(t){var e,i=t.GetObjectRectP();if(t.m_uFlag2&CFlags.STATUS2_TRANSFORM){t.TransformRect(i)}if(t.IsFlag(CFlags.STATUS_INOBJECT)){e=this.GetInnerClip()}else{e=this.GetBoundRect();if(!this.IsFlagEx(CFlags.VXBOX_NOFRAME)){e.top+=this.m_pParam.out_tborder;e.left+=this.m_pParam.out_lborder;e.right-=this.m_pParam.out_rborder;e.bottom-=this.m_pParam.out_bborder}}e.IntersectRect(i);return e},SetBackgroundColor:function(t){this.m_crBackground=t},OnDrawControlBorder:function(t,e,i,n){var s,r;var a=e.Clone();if(this.IsFlagEx(CFlags.VXBOX_BORDERSUNKEN)){s=this.GetColor(CColor.INDEX_FRAME_RBDARK);r=this.GetColor(CColor.INDEX_FRAME_LT);if(i==4294967295)t.Draw3dRect(a,s,r);else t.FillSolidRect(a,i,s,r);s=this.GetColor(CColor.INDEX_FRAME_RB);r=this.GetColor(CColor.INDEX_FRAME_LTDARK);a.Inflate(-1,-1);t.Draw3dRect(a,s,r,1,this.m_dwRndVal)}else{s=r=n;if(i==4294967295)t.Draw3dRect(a,s,r,1,1,this.m_dwRndVal);else t.FillSolidRect(a,i,s,r,1,1,this.m_dwRndVal)}a.Inflate(-1,-1);return a}});vx.menu=vx.box.extend({init:function(t,e,i,n){if(t==undefined)t=0;if(e==undefined)e=0;if(i==undefined)i=null;if(n==undefined)n=null;this._super(0);this.m_uFlag=t;this.m_uFlagEx=e;this.m_wmax=0;this.m_hmax=0;this.m_pPopupMenu=null;this.m_pStartMenu=null;this.m_nTimeSum=0;this.m_nLineHeight=24;this.m_nLeftBar=24;this.m_nGapWidth=20;this.m_nGapSplit=3;this.m_pEventObject=null;this.m_pPointObj=null;this.m_pIconImage=null;this.m_pMenuImage=null;this.m_aryMenuItem=new ObArray;this.m_pParentMenu=null;this.m_pKeyEnableMenu=null;this.m_pColorSet=null;this.m_bDeleteColorSet=false;this.m_ptStart=null;this.m_ptEnd=null;this.m_nSdLeft=0;this.m_nSdTop=0;this.m_nSdRight=0;this.m_nSdBottom=0;this.SetTypeCode(CDefine.VXCODE_MENU);if(i!=null)this.m_pIconImage=this.FindImage(i);else this.m_pIconImage=null;if(this.IsFlagEx(CFlags.VXMENU_USESAHDOW)){if(n!=null)this.m_pShadowImage=this.FindImage(n);else this.m_pShadowImage=vx.Global.VXS_GetShadowImage()}else{this.m_pShadowImage=null}},toString:function(){return"(vx.menu)"},Delete:function(){if(this.m_pPopupMenu){this.m_pPopupMenu.Delete();this.m_pPopupMenu=null}this.m_pStartMenu=null;this.m_pParentMenu=null;this.m_pKeyEnableMenu=null;if(this.m_aryMenuItem){this.m_aryMenuItem.RemoveAll();this.m_aryMenuItem=null}this.m_pEventObject=null;this.m_pPointObj=null;this.m_pIconImage=null;this.m_pMenuImage=null;this.m_ptStart=null;this.m_ptEnd=null;if(this.m_bDeleteColorSet&&this.m_pColorSet){this.m_pColorSet.RemoveAll();this.m_pColorSet=null;this.m_bDeleteColorSet=false}vx.Global.g_nPopupDirect=0;vx.changemenu.Clear();this._super()},AddObject:function(t){if(t==null)return false;t.ModifyFlag(CFlags.STATUS_NOFOCUS,0);return this._super(t)},NotifyParent:function(t,e,i){if(this.m_stage==null)return false;if(this.m_pEventObject)this.m_pEventObject.EventSync(t,e,i,this);else this.m_stage.EventSync(t,e,i,this);return true},_NotifyParent:function(t,e,i,n){if(this.m_stage==null)return false;if(this.m_pEventObject)this.m_pEventObject.EventSync(t,e,i,n);else this.m_stage.EventSync(t,e,i,n);return true},AsyncNotifyParent:function(t,e,i){if(this.m_stage==null)return false;var n=this.GetSkin();if(this.m_pEventObject){n.InputQueue(false,t,e,i,this,this.m_pEventObject);return true}else n.InputQueue(true,t,e,i,this,this.m_stage);return true},_AsyncNotifyParent:function(t,e,i,n){if(this.m_stage==null)return false;var s=this.GetSkin();if(this.m_pEventObject){s.InputQueue(false,t,e,i,n,this.m_pEventObject);return true}else s.InputQueue(true,t,e,i,this,this.m_stage);return true},OnKeyDown:function(t,e){if(this.m_pParentMenu==null){if(this.m_pKeyEnableMenu&&this.m_pKeyEnableMenu!=this){this.m_pKeyEnableMenu.OnKeyDown(t,e);return this._super(t,e)}}var i,n,s;switch(e){case CKeys.VK_UP:this.SelectArrow(false);return;case CKeys.VK_DOWN:this.SelectArrow(true);return;case CKeys.VK_RETURN:{n=this.m_aryMenuItem.GetSize();for(i=0;i<n;i++){s=this.m_aryMenuItem.GetAt(i);if(s==null)continue;if(s.m_nID>0&&s.m_nID!=-1){if(s.IsFlag2(CFlags.STATUS2_MOUSEOVER)){this.EventSync(CDefine.CMD_VXBUTTON_CLICK,s.m_nID,null,s);this.Close();return}}}}return;case CKeys.VK_LEFT:if(this.m_pParentMenu){this.m_pParentMenu.CloseAllSubMenu(null);this.SetKeyEnableMenu(this.m_pParentMenu)}return;case CKeys.VK_RIGHT:{n=this.m_aryMenuItem.GetSize();for(i=0;i<n;i++){s=this.m_aryMenuItem.GetAt(i);if(s==null)continue;if(s.m_nID!=0||s.m_pSubPopup){if(s.IsFlag2(CFlags.STATUS2_MOUSEOVER)){s.SetMenuFocus(true);if(s.m_pVXMenu){s.m_pVXMenu.SetKeyEnableMenu(s.m_pVXMenu);s.m_pVXMenu.SelectDefault()}break}}}}return;case CKeys.VK_TAB:case CKeys.VK_ESCAPE:{var r=this.CloseParent();if(r)r.Close()}return}this._super(t,e)},OnShow:function(t){if(!t)this.KillTimer(CDefine.DEFTIMER_OPENMENU)},OnTimer:function(t,e,i,n){this._super(t,e,i,n);if(this.m_ptStart==null)return;if(CDefine.DEFTIMER_OPENMENU==t){this.m_nTimeSum+=e;var s;if(this.m_nTimeSum>CDefine.OPENSLID_GAP){s=CUtil.CRect(this.m_ptStart.x,this.m_ptStart.y,this.m_ptEnd.x,this.m_ptEnd.y);this.KillTimer(t)}else{var r=(this.m_ptEnd.x-this.m_ptStart.x)*Math.floor(this.m_nTimeSum)/CDefine.OPENSLID_GAP;var a=(this.m_ptEnd.y-this.m_ptStart.y)*Math.floor(this.m_nTimeSum)/CDefine.OPENSLID_GAP;s=CUtil.CRect(this.m_ptStart.x,this.m_ptStart.y,this.m_ptStart.x+r,this.m_ptStart.y+a)}CUtil.NormalizeRect(s);this.MoveObject(s)}},OnDrawChild:function(t,e,i){var n=e.Clone();var s=i;var r;var a,o,l;var _,h,f;var C,m,u;if(s.IsFlag2(CFlags.STATUS2_MOUSEOVER)||s.m_pVXMenu&&s.m_pVXMenu.IsFlag(CFlags.STATUS_SHOW))m=true;else m=false;if(s.IsFlag2(CFlags.STATUS2_INACTIVE)&&s.m_nID!=0)u=true;else u=false;h=CUtil.CRect(n.left,n.top,n.right,n.bottom);if(this.m_nLeftBar==0)f=CUtil.CRect(h.left+this.m_nGapWidth,h.top,h.right,h.bottom);else f=CUtil.CRect(h.left+this.m_nLeftBar+this.m_nGapWidth,h.top,h.right,h.bottom);f.Int();r=CDefine.DT_LEFT;if(this.IsFlagEx(CFlags.VXBOX_BORDERFLAT)){o=this.GetMenuColor(CDefine.MENUCOLOR_EDGELEFTTOP2);l=this.GetMenuColor(CDefine.MENUCOLOR_EDGELEFTTOP2)}else{o=this.GetMenuColor(CDefine.MENUCOLOR_EDGELEFTTOP2);l=this.GetMenuColor(CDefine.MENUCOLOR_EDGERIGHTBOTTOM2)}if(this.m_pMenuImage){var T=0;if(!s.IsFlag(CFlags.STATUS_ENABLED))T=3;else if(m)T=1;else if(s.IsFlag2(CFlags.STATUS2_INACTIVE))T=2;this.m_pMenuImage.DrawBox(t,h,T);if(s.m_nID!=0){C=s.m_cTag.SetSelect(m);s.m_cTag.m_uFmt=r;s.m_cTag.Draw(t,f);s.m_cTag.SetSelect(C)}}else{if(m){t.FillSolidRect(h,this.GetMenuColor(CDefine.MENUCOLOR_BACKFOCUS));t.Draw3dRect(h,o,l)}else if(s.IsFlag2(CFlags.STATUS2_INACTIVE))t.FillSolidRect(h,this.GetMenuColor(CDefine.MENUCOLOR_BACKDOWN));else if(this.IsFlag(CFlags.STATUS_TRANS))t.FillSolidRect(h,this.GetMenuColor(CDefine.MENUCOLOR_BACKNORMAL));if(s.m_nID==0){t.Draw3dRect(CUtil.CRect(h.left,h.top,h.right,h.bottom),this.GetMenuColor(CDefine.MENUCOLOR_EDGERIGHTBOTTOM),this.GetMenuColor(CDefine.MENUCOLOR_EDGELEFTTOP))}else{C=s.m_cTag.SetSelect(m);s.m_cTag.m_uFmt=r;s.m_cTag.Draw(t,f);s.m_cTag.SetSelect(C)}}if(this.m_pIconImage&&s.m_nIcon>=0){var S=CUtil.CRect(n.left+1,n.top+1,n.left+this.m_nLeftBar-1,n.bottom-1);var c=CUtil.CenterPoint(S);var g=this.m_pIconImage.GetFrameSize();S=CUtil.CRect(c.x-g.x/2,c.y-g.y/2,c.x-g.x/2+g.x,c.y-g.y/2+g.y);this.m_pIconImage.DrawFrame(t,S.left,S.top,s.m_nIcon,0)}if(s.IsFlag2(CFlags.STATUS2_CHECK)){_=CUtil.CRect(h.left+this.m_nLeftBar,h.top,h.left+this.m_nLeftBar+this.m_nGapWidth,h.bottom);CUtil.DeflateRect(_,3,3,3,3);if(s.m_cTag.m_tag){if(m)a=s.m_cTag.m_tag.vcolor;else a=s.m_cTag.m_tag.color}else{a=0}t.DrawShape(_,CDefine.SHAPE_CHECK,a,a)}if(s.m_pSubPopup){_=CUtil.CRect(h.right-this.m_nGapWidth,h.top,h.right,h.bottom);CUtil.DeflateRect(_,2,2,2,2);_.Offset(2,0);if(s.m_cTag.m_tag){if(m)a=s.m_cTag.m_tag.vcolor;else a=s.m_cTag.m_tag.color}else{a=0}t.DrawShape(_,CDefine.SHAPE_RIGHTARROW,a,a)}},OnDrawFrame:function(t,e){var i;var n=e.Clone();if(this.m_pBoxImage){if(!this.IsFlag(CFlags.STATUS_DRAWAFTER))n=this._super(t,n);if(this.m_pBoxImage.IsFlag(CDefine.PKFLAG_IMAGENOINNER)){i=CUtil.CRect(n.left,n.top+this.m_nNcBnd_t,n.left+this.m_nLeftBar,n.bottom-this.m_nNcBnd_b);i.Offset(this.GetBoxParam(CDefine.BPI_OUTLBORDER),0);t.FillSolidRect(i,this.GetMenuColor(CDefine.MENUCOLOR_LEFTBAR))}return n}if(this.IsFlag(CFlags.STATUS_TRANS))return n;if(!this.IsFlag(CFlags.STATUS_PARTALPHA)&&!this.IsFlagEx(CFlags.VXBOX_TRANSINNER))t.FillSolidRect(n,this.GetMenuColor(CDefine.MENUCOLOR_BACKNORMAL));if(this.m_nLeftBar>0&&!this.IsFlagEx(CFlags.VXBOX_TRANSINNER)){i=CUtil.CRect(n.left,n.top,n.left+this.m_nLeftBar,n.bottom);i.Offset(this.GetBoxParam(CDefine.BPI_OUTLBORDER),0);t.FillSolidRect(i,this.GetMenuColor(CDefine.MENUCOLOR_LEFTBAR))}var s=CUtil.min(this.GetBoxParam(CDefine.BPI_OUTLBORDER),this.GetBoxParam(CDefine.BPI_OUTRBORDER));var r=CUtil.min(this.GetBoxParam(CDefine.BPI_OUTTBORDER),this.GetBoxParam(CDefine.BPI_OUTBBORDER));s=CUtil.min(s,r);if(s>0){var a,o;if(this.IsFlagEx(CFlags.VXBOX_BORDERFLAT)){a=this.GetMenuColor(CDefine.MENUCOLOR_EDGERIGHTBOTTOM2);o=this.GetMenuColor(CDefine.MENUCOLOR_EDGERIGHTBOTTOM2)}else{a=this.GetMenuColor(CDefine.MENUCOLOR_EDGERIGHTBOTTOM);o=this.GetMenuColor(CDefine.MENUCOLOR_EDGERIGHTBOTTOM2)}t.Draw3dRect(n,a,o);if(s>1){CUtil.DeflateRect(n,1,1,1,1);if(this.IsFlagEx(CFlags.VXBOX_BORDERFLAT)){a=this.GetMenuColor(CDefine.MENUCOLOR_EDGELEFTTOP);o=this.GetMenuColor(CDefine.MENUCOLOR_EDGELEFTTOP)}else{a=this.GetMenuColor(CDefine.MENUCOLOR_EDGELEFTTOP);o=this.GetMenuColor(CDefine.MENUCOLOR_EDGERIGHTBOTTOM)}t.Draw3dRect(n,a,o)}if(s>2){CUtil.DeflateRect(n,1,1,1,1);if(this.IsFlagEx(CFlags.VXBOX_BORDERFLAT)){a=this.GetMenuColor(CDefine.MENUCOLOR_EDGERIGHTBOTTOM2);o=this.GetMenuColor(CDefine.MENUCOLOR_EDGERIGHTBOTTOM2)}else{a=this.GetMenuColor(CDefine.MENUCOLOR_EDGELEFTTOP2);o=this.GetMenuColor(CDefine.MENUCOLOR_EDGELEFTTOP2)}t.Draw3dRect(n,a,o)}}return n},OnDrawAfter:function(t,e){if(this.m_pBoxImage){if(this.IsFlag(CFlags.STATUS_DRAWAFTER))this.m_pBoxImage.DrawBox(t,e,0);return}},OnDrawShadow:function(t,e){if(!this.m_pShadowImage)return;this.m_pShadowImage.DrawBox(t,e,0)},OnCreate:function(){this.m_nSdLeft=this.m_nSdOff_l;this.m_nSdTop=this.m_nSdOff_t;this.m_nSdRight=this.m_nSdOff_r;this.m_nSdBottom=this.m_nSdOff_b;this.ModifyFlag(CFlags.STATUS_POPUP,0);this.ModifyFlagEx(0,CFlags.VXBOX_CAPTION|CFlags.VXBOX_RESIZEBORDER);if(!this.m_pIconImage)this.m_pIconImage=vx.Global.VXS_GetMenuIcon();if(!this.m_pShadowImage&&this.IsFlagEx(CFlags.VXMENU_USESAHDOW))this.m_pShadowImage=vx.Global.VXS_GetShadowImage();if(!this._super())return false;if(!this.m_pBoxImage){this.m_nBorderGap=2;this.SetBorderGap(this.m_nBorderGap,this.m_nBorderGap,this.m_nBorderGap,this.m_nBorderGap);this.SetBoxParam(CDefine.BPI_OUTLBORDER,this.m_nBorderGap,true);this.SetBoxParam(CDefine.BPI_OUTTBORDER,this.m_nBorderGap,true);this.SetBoxParam(CDefine.BPI_OUTRBORDER,this.m_nBorderGap,true);this.SetBoxParam(CDefine.BPI_OUTBBORDER,this.m_nBorderGap,true)}return true},OnCancelMode:function(){this.Close()},OnClose:function(){if(!this._super())return false;this.CloseAllSubMenu(null,true);if(this.m_pParentMenu==null&&this.IsFlagEx(CFlags.VXMENU_WANTCLOSEEVENT)){this.AsyncNotifyParent(CDefine.CMD_VXMENU_CLICK,0,null)}return true},FocusClear:function(){this.Close()},EventSync:function(t,e,i,n){if(n==null)return;if(t==CDefine.CMD_VXBUTTON_CLICK){var s;var r=this.m_aryMenuItem.GetSize();for(var a=0;a<r;a++){s=this.m_aryMenuItem.GetAt(a);if(s&&s.m_nID==n.m_nID){if(this.IsFlagEx(CFlags.VXMENU_SYNCNOTIFY))this.NotifyParent(CDefine.CMD_VXMENU_CLICK,s.m_nID,i);else this.AsyncNotifyParent(CDefine.CMD_VXMENU_CLICK,s.m_nID,i);var o=this.CloseParent();if(o)o.Close();return}}}this._AsyncNotifyParent(t,e,i,n)},SetTextColor:function(t,e,i,n,s){this.AllocColorTable();if(t!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_TEXTNORMAL]=t;if(e!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_TEXTFOCUS]=e;if(i!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_TEXTDOWN]=i;if(n!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_TEXTGRAY]=n;if(s!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_TEXTBOUND]=s},SetBackColor:function(t,e,i,n){this.AllocColorTable();if(t!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_BACKNORMAL]=t;if(e!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_BACKFOCUS]=e;if(i!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_BACKDOWN]=i;if(n!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_BACKGRAY]=n},SetEdgeColor:function(t,e,i,n){this.AllocColorTable();if(t!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_EDGELEFTTOP]=t;if(e!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_EDGERIGHTBOTTOM]=e;if(i!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_EDGELEFTTOP2]=i;if(n!=4294967295)this.m_pColorSet[CDefine.MENUCOLOR_EDGERIGHTBOTTOM2]=n},SetMenuColor:function(t,e){if(t<0||t>CDefine.MENUCOLOR_MAX)return;this.AllocColorTable();this.m_pColorSet.SetAt(t,e)},AllocColorTable:function(){if(this.m_pColorSet==null){this.m_pColorSet=new ObArray;for(var t=0;t<CDefine.MENUCOLOR_MAX;t++){this.m_pColorSet.AddTail(4294967295)}}},GetMenuColor:function(t){if(this.m_pColorSet&&(t>=0||t<CDefine.MENUCOLOR_MAX)){if(this.m_pColorSet[t]!=4294967295)return this.m_pColorSet[t]}var e=CColor.RGB(0,0,0);switch(t){case CDefine.MENUCOLOR_TEXTNORMAL:e=this.GetColor(CColor.INDEX_EDITTEXT);break;case CDefine.MENUCOLOR_TEXTFOCUS:e=this.GetColor(CColor.INDEX_EDITTEXT_SELECT);break;case CDefine.MENUCOLOR_TEXTDOWN:e=this.GetColor(CColor.INDEX_CONTROLTEXT_DOWN);break;case CDefine.MENUCOLOR_TEXTGRAY:e=this.GetColor(CColor.INDEX_CONTROLTEXT_GRAY);break;case CDefine.MENUCOLOR_TEXTBOUND:e=this.GetColor(CColor.INDEX_CONTROLTEXT_BOUNDLT);break;case CDefine.MENUCOLOR_BACKNORMAL:e=this.GetColor(CColor.INDEX_CONTROLFACE_LIGHT);break;case CDefine.MENUCOLOR_BACKFOCUS:e=this.GetColor(CColor.INDEX_CONTROLFACE_DARK);break;case CDefine.MENUCOLOR_BACKDOWN:e=this.GetColor(CColor.INDEX_CONTROLFACE_DOWN);break;case CDefine.MENUCOLOR_BACKGRAY:e=this.GetColor(CColor.INDEX_CONTROLFACE_DARK);break;case CDefine.MENUCOLOR_EDGELEFTTOP:e=this.GetColor(CColor.INDEX_CONTROL_LT);break;case CDefine.MENUCOLOR_EDGERIGHTBOTTOM:e=this.GetColor(CColor.INDEX_CONTROL_RB);break;case CDefine.MENUCOLOR_EDGELEFTTOP2:e=this.GetColor(CColor.INDEX_CONTROL_LTDARK);break;case CDefine.MENUCOLOR_EDGERIGHTBOTTOM2:e=this.GetColor(CColor.INDEX_CONTROL_RBDARK);break}return e},SetKeyEnableMenu:function(t){var e=this.GetRootMenu();if(e){e.m_pKeyEnableMenu=t}},SelectArrow:function(t){var e,i=-1;var n;var s=this.m_aryMenuItem.GetSize();for(e=0;e<s;e++){n=this.m_aryMenuItem.GetAt(e);if(n==null)continue;if(n.m_nID!=0||n.m_pSubPopup){if(n.IsFlag2(CFlags.STATUS2_MOUSEOVER)){i=e;break}}}var r=false;var a=i;if(i==-1){if(t)i=0;else i=s-1;n=this.m_aryMenuItem.GetAt(i);if(n){if(n.m_nID==0||!n.IsFlag(CFlags.STATUS_ENABLED)||n.IsFlag2(CFlags.STATUS2_INACTIVE))r=true}}else{r=true}if(r){for(e=0;e<s;e++){i+=s;if(t)i++;else i--;i=i%s;n=this.m_aryMenuItem.GetAt(i);if(n){if(n.m_nID==0||!n.IsFlag(CFlags.STATUS_ENABLED)||n.IsFlag2(CFlags.STATUS2_INACTIVE))continue;else break}}}if(a>=0){n=this.m_aryMenuItem.GetAt(a);if(n)n.SetMenuFocus(false)}n=this.m_aryMenuItem.GetAt(i);if(n)n.SetMenuFocus(true)},SelectDefault:function(){var t=true;var e;var i=this.m_aryMenuItem.GetSize();for(var n=0;n<i;n++){e=this.m_aryMenuItem.GetAt(n);if(e==null)continue;if(t&&(e.m_nID!=0||e.m_pSubPopup)){e.SetMenuFocus(true);t=false}else{e.SetMenuFocus(false)}}},SelectClear:function(){var t=true;var e;var i=this.m_aryMenuItem.GetSize();for(var n=0;n<i;n++){e=this.m_aryMenuItem.GetAt(n);if(e==null)continue;e.SetMenuFocus(false)}},CloseParent:function(){var t,e=this;while(e){e.ShowObject(false);t=e.m_pParentMenu;if(t==null)break;e=t}return e},GetRootMenu:function(){var t,e=this;while(e){t=e.m_pParentMenu;if(t==null)break;e=t}return e},CloseAllSubMenu:function(t,e){if(e==undefined)e=false;if(!this.m_aryMenuItem)return;var i;var n=this.m_aryMenuItem.GetSize();for(var s=0;s<n;s++){i=this.m_aryMenuItem.GetAt(s);if(!i)continue;if(i.m_pVXMenu&&i.m_pVXMenu!=t){i.m_pVXMenu.CloseAllSubMenu(null,e);if(e){i.m_pVXMenu.Close()}else if(i.m_pVXMenu.IsFlag(CFlags.STATUS_SHOW)){i.ModifyFlag2(0,CFlags.STATUS2_PRESS);i.m_pVXMenu.ShowObject(false);i.Invalidate()}}}},RepositionShow:function(t,e,i,n,s,r){if(n==undefined)n=-1;if(s==undefined)s=-1;if(r==undefined)r=true;var a,o=this.m_stage.GetStageRect();if(n<=0||s<=0){n=this.m_wmax;s=this.m_hmax}if(!i)r=false;var l=false;var _=false;var h=this.GetObjectRect();if(i&&r){var f=i.GetObjectRect();if(vx.Global.g_nPopupDirect==-1){if(f.left-n>o.left){l=true;if(f.top+s>o.bottom){a=CUtil.CRect(f.left-n,f.bottom-s,f.left,f.bottom);a.Offset(0,this.m_nSdOff_b);_=true}else{a=CUtil.CRect(f.left-n,f.top,f.left,f.top+s);a.Offset(0,-this.m_nSdOff_t)}a.Offset(this.m_nSdOff_r,0)}else{if(f.top+s>o.bottom){_=true;a=CUtil.CRect(f.right,f.bottom-s,f.right+n,f.bottom);a.Offset(0,this.m_nSdOff_b)}else{a=CUtil.CRect(f.right,f.top,f.right+n,f.top+s);a.Offset(0,-this.m_nSdOff_t)}a.Offset(-this.m_nSdOff_l,0)}}else{if(f.right+n>o.right){l=true;if(vx.Global.g_nPopupDirect==0)vx.Global.g_nPopupDirect=-1;if(f.top+s>o.bottom){_=true;a=CUtil.CRect(f.left-n,f.bottom-s,f.left,f.bottom);a.Offset(0,this.m_nSdOff_b)}else{a=CUtil.CRect(f.left-n,f.top,f.left,f.top+s);a.Offset(0,-this.m_nSdOff_t)}a.Offset(this.m_nSdOff_l,0)}else{if(vx.Global.g_nPopupDirect==0)vx.Global.g_nPopupDirect=1;if(f.top+s>o.bottom){_=true;a=CUtil.CRect(f.right,f.bottom-s,f.right+n,f.bottom);a.Offset(0,this.m_nSdOff_b)}else{a=CUtil.CRect(f.right,f.top,f.right+n,f.top+s);a.Offset(0,-this.m_nSdOff_t)}a.Offset(-this.m_nSdOff_l,0)}}}else{if(t+n>o.right){l=true;if(e+s>o.bottom){_=true;a=CUtil.CRect(t-n,e-s,t,e)}else{a=CUtil.CRect(t-n,e,t,e+s)}}else{if(e+s>o.bottom){_=true;a=CUtil.CRect(t,e-s,t+n,e)}else{a=CUtil.CRect(t,e,t+n,e+s)}}}if(_){if(l){this.m_ptStart=CUtil.CPoint(a.right,a.bottom);this.m_ptEnd=CUtil.CPoint(a.left,a.top)}else{this.m_ptStart=CUtil.CPoint(a.left,a.bottom);this.m_ptEnd=CUtil.CPoint(a.right,a.top)}}else{if(l){this.m_ptStart=CUtil.CPoint(a.right,a.top);this.m_ptEnd=CUtil.CPoint(a.left,a.bottom)}else{this.m_ptStart=CUtil.CPoint(a.left,a.top);this.m_ptEnd=CUtil.CPoint(a.right,a.bottom)}}if(this.IsFlagEx(CFlags.VXMENU_OPENSLID)){this.m_nTimeSum=0;a=CUtil.CRect(this.m_ptStart.x,this.m_ptStart.y,this.m_ptStart.x,this.m_ptStart.y);this.SetTimer(CDefine.DEFTIMER_OPENMENU,15)}this.MoveObject(a);this.ShowObject(true);this.Invalidate()},CreatePopupMenu:function(t,e,i,n,s,r,a){if(a==undefined)a=null;var o=null;if(r)o=r.GetStage();else if(a)o=a.GetStage();else return false;if(o==null||r.GetStage()==null)return false;this.m_pEventObject=r;return this.CreatePopupMenuStage(t,e,i,n,s,r.GetStage(),a)},CreatePopupMenuStage:function(t,e,i,n,s,r,a){if(a==undefined)a=null;if(r==null)return false;var o,l,_;if(t==0)return false;o=vx.Global.g_skin.LoadMenu(t);if(!o)return false;l=o.GetSubMenu(e);if(!l)return false;if(i>=0){_=l.GetSubMenu(i);if(!_){_=l}}else{_=l}var h=_.Copy();this.m_pStartMenu=h;return this._CreatePopupMenu(h,n,s,r,null,a)},_CreatePopupMenu:function(t,e,i,n,s,r){if(s==undefined)s=null;if(r==undefined)r=null;var a,o=0;if(!n||!t)return false;this.m_pPointObj=r;vx.changemenu.Refresh(t);if(vx.changemenu.IsChangeColor()&&!s){AllocColorTable();vx.changemenu.CopyColor(this.m_pColorSet)}if(vx.changemenu.GetMenuIconName()!=""){var l=this.FindImage(vx.changemenu.GetMenuIconName());if(l)this.m_pIconImage=l}if(vx.changemenu.GetMenuImageName()!=""){var _=this.FindImage(vx.changemenu.GetMenuImageName());if(_)this.m_pMenuImage=_}if((o=t.GetMenuItemCount())<=0)return false;var h=CFlags.STATUS_ENABLED;var f=0;if(s){this.m_pEventObject=s.m_pEventObject;this.m_pColorSet=s.m_pColorSet;this.m_bDeleteColorSet=false;this.SetBorderImage(s.m_pBoxImage,s.GetBoxParam(CDefine.BPI_OUTLBORDER),s.GetBoxParam(CDefine.BPI_OUTTBORDER),s.GetBoxParam(CDefine.BPI_OUTRBORDER),s.GetBoxParam(CDefine.BPI_OUTBBORDER));this.SetMenuImage(s.m_pMenuImage);this.m_pIconImage=s.m_pIconImage;this.m_pShadowImage=s.m_pShadowImage;this.m_crAlpha=s.m_crAlpha;this.m_nAlphaBk=s.m_nAlphaBk;this.SetMenuProperty(s.m_nLineHeight,s.m_nLeftBar,s.m_nGapWidth,s.m_nGapSplit);h=s.m_uFlag;f=s.m_uFlagEx;this.m_uFlag2=s.m_uFlag2;this.m_uFlagEx2=s.m_uFlagEx2}if(this.m_pStartMenu!=t){h|=CFlags.STATUS_NOFOCUS}if(!this.Create(n,CUtil.CRect(0,0,0,0),CDefine.VXID_NONE,h,f,s))return false;var C;var m,u;var T;var S,c,g,E;var d;var O;var D,A;var G,F,R,p;var I;var M;this.m_wmax=this.m_hmax=0;G=this.GetMenuColor(CDefine.MENUCOLOR_TEXTNORMAL);F=this.GetMenuColor(CDefine.MENUCOLOR_TEXTFOCUS);R=this.GetMenuColor(CDefine.MENUCOLOR_TEXTGRAY);p=this.GetMenuColor(CDefine.MENUCOLOR_TEXTDOWN);if(this.m_pIconImage&&this.m_pIconImage.IsFrame()){m=this.m_pIconImage.GetFrameSize();if(m.x+4>this.m_nLeftBar)this.m_nLeftBar=m.x+4}else{m=CUtil.CPoint(0,0)}g=this.m_nLineHeight;if(g<m.y+4)g=m.y+4;this.m_aryMenuItem.RemoveAll();this.m_pPopupMenu=t;this.m_pParentMenu=s;var v=new vx.reference;for(a=0;a<o;a++){I=new vx.menuitem;T=0;h=CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED;d=vx.Global.g_uMenuTagType;S=t.GetMenuItemID(a);c=t.GetMenuState(a,CDefine.MF_BYPOSITION);O=t.GetMenuString(a,CDefine.MF_BYPOSITION);O=this.FindText(O);v.m_strRef=O;E=vx.changemenu.GetIconTextInfo(v);O=v.m_strRef;T=v.m_nRef;d=v.m_dwRef;I.SetIconIndex(E);if(c&CDefine.MF_GRAYED){h&=~CFlags.STATUS_ENABLED;D=vx.tag.Text(O,R,d,F)}else if(c&CDefine.MF_DISABLED){I.ModifyFlag2(CFlags.STATUS2_INACTIVE,0);D=vx.tag.Text(O,p,d,F)}else{D=vx.tag.Text(O,G,d,F)}u=vx.tagcont.GetTagSize(D);if(this.m_wmax<u.x)this.m_wmax=u.x;C=CUtil.CRect(0,this.m_hmax,this.m_wmax,this.m_hmax);if(S==-1){C.bottom=C.top+g;M=this.m_pPopupMenu.GetSubMenu(a);I.SetSubPopup(M,this)}else if(S==0){h&=~CFlags.STATUS_ENABLED;C.bottom=C.top+this.m_nGapSplit;I.SetSubPopup(null,this)}else{C.bottom=C.top+g;I.SetSubPopup(null,this)}I.Create(n,C,S,h,0,this);I.SetButtonTag(D);if(c&CDefine.MF_CHECKED||T!=0)I.ModifyFlag2(CFlags.STATUS2_CHECK,0);this.m_aryMenuItem.Add(I);this.m_hmax+=C.Height()}this.m_wmax+=this.m_nLeftBar+this.m_nGapWidth*2;var b,N,x,y;b=this.m_nSdOff_l+this.m_nNcBnd_l;N=this.m_nSdOff_t+this.m_nNcBnd_t;x=this.m_nSdOff_r+this.m_nNcBnd_r;y=this.m_nSdOff_b+this.m_nNcBnd_b;var B=0;var L;for(a=0;a<o;a++){I=this.m_aryMenuItem.GetAt(a);if(I){C=CUtil.CRect(b,N+B,b+this.m_wmax,N+B+I.m_height);I.MoveObject(C);B+=C.Height()}}this.m_wmax+=b+x;this.m_hmax+=N+y;var P=true;if(!this.IsFlagEx(CFlags.VXMENU_USEOBJECTRECT))P=false;this.RepositionShow(e,i,this.m_pPointObj,this.m_wmax,this.m_hmax,P);if(this.m_pStartMenu==t){vx.Global.g_popupFocus=this;n.SetFocusObject(this)}return true},SetMenuProperty:function(t,e,i,n){this.m_nLineHeight=t;this.m_nLeftBar=e;this.m_nGapWidth=i;this.m_nGapSplit=n},SetMenuImage:function(t){this.m_pMenuImage=t},SetMenuImageName:function(t){this.SetMenuImage(this.FindImage(t))},SetBorderImage:function(t,e,i,n,s){this.m_pBoxImage=t;if(this.m_pBoxImage){this.SetBoxParam(CDefine.BPI_OUTLBORDER,e);this.SetBoxParam(CDefine.BPI_OUTTBORDER,i);this.SetBoxParam(CDefine.BPI_OUTRBORDER,n);this.SetBoxParam(CDefine.BPI_OUTBBORDER,s);this.SetBorderGap(e,i,n,s)}},SetBorderImageName:function(t,e,i,n,s){this.SetBorderImage(this.FindImage(t),e,i,n,s)},SetImageProperty:function(t,e){this.m_pIconImage=t;this.m_pShadowImage=e}});vx.menuitem=vx.button.extend({init:function(){this._super();this.m_nIcon=-1;this.m_pVXMenu=null;this.m_pParentMenu=null;this.m_pSubPopup=null},toString:function(){return"(vx.menuitem)"},Delete:function(){if(this.m_pVXMenu){this.m_pVXMenu.Delete();this.m_pVXMenu=null}if(this.m_pSubPopup){this.m_pSubPopup.Delete();this.m_pSubPopup=null}this.m_pParentMenu=null;this._super()},OnLButtonDown:function(t,e,i){if(this.IsFlag2(CFlags.STATUS2_INACTIVE))return;if(this.m_nID==0)return;if(this.m_nID==-1){if(vx.bOverTouch){if(this.m_pSubPopup){if(this.m_pVXMenu==null){this.m_pVXMenu=new vx.menu;if(this.m_pParentMenu){this.m_pVXMenu.m_pEventObject=this.m_pParentMenu.m_pEventObject;this.m_pVXMenu.m_pColorSet=this.m_pParentMenu.m_pColorSet;this.m_pVXMenu.AddShadowGap(this.m_pParentMenu.m_nSdLeft,this.m_pParentMenu.m_nSdTop,this.m_pParentMenu.m_nSdRight,this.m_pParentMenu.m_nSdBottom)}this.m_pVXMenu._CreatePopupMenu(this.m_pSubPopup,t,e,this.GetStage(),m_pParentMenu);this.m_pVXMenu.RepositionShow(t,e,this)}if(this.m_pParentMenu)this.m_pParentMenu.CloseAllSubMenu(this.m_pVXMenu);if(!this.m_pVXMenu.IsFlag(CFlags.STATUS_SHOW)){this.m_pVXMenu.RepositionShow(t,e,this);this.m_pVXMenu.SelectClear()}}}return}this._super(t,e,i)},OnMouseMove:function(t,e,i){if(this.IsFlag2(CFlags.STATUS2_INACTIVE))return;this._super(t,e,i);if(!vx.bOverTouch){if(this.m_pSubPopup){if(this.m_pVXMenu==null){this.m_pVXMenu=new vx.menu;if(this.m_pParentMenu){this.m_pVXMenu.m_pEventObject=this.m_pParentMenu.m_pEventObject;this.m_pVXMenu.m_pColorSet=this.m_pParentMenu.m_pColorSet;this.m_pVXMenu.AddShadowGap(this.m_pParentMenu.m_nSdLeft,this.m_pParentMenu.m_nSdTop,this.m_pParentMenu.m_nSdRight,this.m_pParentMenu.m_nSdBottom)}this.m_pVXMenu._CreatePopupMenu(this.m_pSubPopup,t,e,this.GetStage(),m_pParentMenu);this.m_pVXMenu.RepositionShow(t,e,this)}if(this.m_pParentMenu)this.m_pParentMenu.CloseAllSubMenu(this.m_pVXMenu);if(!this.m_pVXMenu.IsFlag(CFlags.STATUS_SHOW)){this.m_pVXMenu.RepositionShow(t,e,this);this.m_pVXMenu.SelectClear()}}else{if(this.m_pParentMenu)this.m_pParentMenu.CloseAllSubMenu(null)}}},OnCreate:function(){if(!this._super())return false;if(this.m_parent)this.ModifyFlag2(CFlags.STATUS2_PARENTDRAW,0);return true},Invalidate:function(){if(this.m_parent&&this.m_parent.IsFlag(CFlags.STATUS_DRAWAFTER)){this.m_parent.Invalidate();return}this._super()},SetMenuFocus:function(t){if(t)this.OnMouseMove(this.m_width/2,this.m_height/2,0);else this.OnMouseLeave()},SetIconIndex:function(t){this.m_nIcon=t},SetSubPopup:function(t,e){this.m_pSubPopup=t;this.m_pParentMenu=e;if(this.m_pSubPopup){if(this.m_pVXMenu==null){this.m_pVXMenu=new vx.menu;if(this.m_pParentMenu){this.m_pVXMenu.m_pEventObject=this.m_pParentMenu.m_pEventObject;this.m_pVXMenu.m_pColorSet=this.m_pParentMenu.m_pColorSet;this.m_pVXMenu.AddShadowGap(this.m_pParentMenu.m_nSdLeft,this.m_pParentMenu.m_nSdTop,this.m_pParentMenu.m_nSdRight,this.m_pParentMenu.m_nSdBottom)}this.m_pVXMenu._CreatePopupMenu(this.m_pSubPopup,-1,-1,this.m_pParentMenu.GetStage(),this.m_pParentMenu);this.m_pVXMenu.ShowObject(false)}}}});vx.tooltip=vx.object.extend({init:function(t){if(arguments.length==0)t=0;this._super();this.ALPHA_BRINGUPTIME=500;this.DEFAULT_ARROWX=16;this.DEFAULT_ARROWY=16;this.m_szMargin=new vx.point(5,1);this.m_szOffset=new vx.point(2,2);this.m_pTipImage=null;this.m_pShadowImage=null;this.m_crBack=4294967295;this.m_crBorder=4294967295;this.m_nAlphaTime=this.ALPHA_BRINGUPTIME;this.m_nAlphaBk=0;this.m_nLAP=0;this.m_nTAP=0;this.m_nRAP=0;this.m_nBAP=0;this.m_nWidth=0;this.m_nHeight=0;this.m_nArrowLen=0;this.m_ptArrow=new vx.point(0,0);this.m_nReference=0;this.m_pToolInfo2=null;this.m_ptFixed=null;this.m_nHoldClose=0;this.SetTypeCode(CDefine.VXCODE_TOOLTIP);this.ModifyFlagEx(t,0)},toString:function(){return"(vx.tooltip)"},Delete:function(){this.m_nReference=0;this.m_szMargin=null;this.m_szOffset=null;this.m_pTipImage=null;this.m_pShadowImage=null;this.m_ptArrow=null;this.m_pToolInfo2=null;this.m_ptFixed=null;this._super()},OnCreate:function(){if(!this._super())return false;if(this.m_crBack==4294967295)this.m_crBack=CColor.GetColor(CColor.INDEX_TOOLTIP_BKGND);if(this.m_crBorder==4294967295)this.m_crBorder=CColor.GetColor(CColor.INDEX_TOOLTIP_BORDER);if(this.IsFlagEx(CFlags.VXTOOLTIP_HASSHADOW)){this.SetShadowImage(vx.Global.VXS_GetShadowImage())}this.ModifyFlag2(0,CFlags.STATUS2_DOMBUFFER);this.ModifyFlag(CFlags.STATUS_NOMESSAGE|CFlags.STATUS_NOMOUSEMOVE|CFlags.STATUS_NOFOCUS,CFlags.STATUS_ALPHA);return true},OnDrawShadow:function(t,e){if(this.m_pShadowImage&&this.IsFlagEx(CFlags.VXTOOLTIP_HASSHADOW)){this.m_pShadowImage.DrawBox(t,e,0)}},OnDraw:function(t,e){if(this.m_pToolInfo2==null)return;var i;var n=e.Clone();var s=this.m_ptArrow.Clone();if(!this.IsFlag(CFlags.STATUS_TRANS)){if(this.m_pTipImage){if(this.m_pTipImage.IsFlag(CDefine.PKFLAG_IMAGENOINNER)){if(this.m_nAlphaBk!=0){i=n.Clone();CUtil.DeflateRect(i,this.m_nLAP,this.m_nTAP,this.m_nRAP,this.m_nBAP);t.FillSolidRect(i,this.m_crBack,4294967295,4294967295,this.m_nAlphaBk,1,this.m_dwRndVal)}}this.m_pTipImage.DrawBox(t,n,0)}else{if(this.IsFlagEx(CFlags.VXTOOLTIP_USEARROW)){if(!this.DrawArrowBack(t,n,0,0,s)){t.FillSolidRect(n,this.m_crBack,this.m_crBorder,this.m_crBorder,1,1,this.m_dwRndVal)}}else{if(this.m_nAlphaBk!=0){i=n.Clone();CUtil.DeflateRect(i,this.m_nLAP,this.m_nTAP,this.m_nRAP,this.m_nBAP);t.FillSolidRect(i,this.m_crBack,4294967295,4294967295,this.m_nAlphaBk,1,this.m_dwRndVal);t.Draw3dRect(e,this.m_crBorder,this.m_crBorder,1,1,this.m_dwRndVal)}else{t.FillSolidRect(n,this.m_crBack,this.m_crBorder,this.m_crBorder,1,1,this.m_dwRndVal)}}}}i=n.Clone();CUtil.DeflateRect(i,this.m_szMargin.x,this.m_szMargin.y,this.m_szMargin.x,this.m_szMargin.y);this.m_pToolInfo2.m_tagCont.Draw(t,i)},CloseTool:function(){if(this.IsFlagEx(CFlags.VXTOOLTIP_NOCLOSE))return;this.KillTimer(CDefine.DEFTIMER_EFFECTIN);if(this.m_nHoldClose>0){this.SetTimer(CDefine.DEFTIMER_HOLD,this.m_nHoldClose);return}this.ShowObject(false);this.MoveObject(CUtil.CRect(0,0,0,0));this.m_pToolInfo2=null},OnTimer:function(t,e,i,n){this._super(t,e,i,n);if(t==CDefine.DEFTIMER_HOLD){this.KillTimer(t);this.ShowObject(false);this.MoveObject(CUtil.CRect(0,0,0,0));this.m_pToolInfo2=null}},DrawArrowBack:function(t,e,i,n,s){e.Inflate(-1,-1);var r=e.Clone();var a=r.Clone();CUtil.DeflateRect(a,this.m_nArrowLen,this.m_nArrowLen,this.m_nArrowLen,this.m_nArrowLen);s.x-=this.m_x;s.y-=this.m_y;if(CUtil.PtInRect(a,s.x,s.y))return false;var o=new ObArray;if(s.x<a.left&&s.y>r.top&&s.y<r.bottom){r.left+=this.m_nArrowLen;o.Add(new vx.point(r.left-i,r.top-n));o.Add(new vx.point(r.left-i,s.y-this.m_nArrowLen/2-1-n));o.Add(new vx.point(r.left-this.m_nArrowLen-i,s.y-1-n));o.Add(new vx.point(r.left-i,s.y+this.m_nArrowLen/2-1-n));o.Add(new vx.point(r.left-i,r.bottom-n));o.Add(new vx.point(r.right-i,r.bottom-n));o.Add(new vx.point(r.right-i,r.top-n))}else if(s.x>a.right&&s.y>r.top&&s.y<r.bottom){r.right-=this.m_nArrowLen;o.Add(new vx.point(r.left-i,r.top-n));o.Add(new vx.point(r.right-i,r.top-n));o.Add(new vx.point(r.right-i,s.y-this.m_nArrowLen/2-1-n));o.Add(new vx.point(r.right+this.m_nArrowLen-i,s.y-1-n));o.Add(new vx.point(r.right-i,s.y+this.m_nArrowLen/2-1-n));o.Add(new vx.point(r.right-i,r.bottom-n));o.Add(new vx.point(r.left-i,r.bottom-n))}else if(s.y<a.top&&s.x>r.left&&s.x<r.right){r.top+=this.m_nArrowLen;o.Add(new vx.point(r.left-i,r.top-n));o.Add(new vx.point(s.x-this.m_nArrowLen/2-i,r.top-n));o.Add(new vx.point(s.x-i,r.top-this.m_nArrowLen-n));o.Add(new vx.point(s.x+this.m_nArrowLen/2-i,r.top-n));o.Add(new vx.point(r.right-i,r.top-n));o.Add(new vx.point(r.right-i,r.bottom-n));o.Add(new vx.point(r.left-i,r.bottom-n))}else if(s.y>a.bottom&&s.x>r.left&&s.x<r.right){r.bottom-=this.m_nArrowLen;o.Add(new vx.point(r.left-i,r.top-n));o.Add(new vx.point(r.right-i,r.top-n));o.Add(new vx.point(r.right-i,r.bottom-n));o.Add(new vx.point(s.x+this.m_nArrowLen/2-i,r.bottom-n));o.Add(new vx.point(s.x-i,r.bottom+this.m_nArrowLen-n));o.Add(new vx.point(s.x-this.m_nArrowLen/2-i,r.bottom-n));o.Add(new vx.point(r.left-i,r.bottom-n))}else return false;t.DrawPolygon(o,this.m_crBack,this.m_crBorder);CUtil.SetCRect(e,r.left,r.top,r.right,r.bottom);return true},GetDirectRect:function(t,e,i,n){var s=this.m_stage.GetStageRect();var r;var a=this.m_szOffset.x;var o=this.m_szOffset.y;var l=e.Width();var _=e.Height();var h;switch(t){case CDefine.TTD_OBJECTUPPERRIGHT:r=CUtil.CRect(i.left,i.top-_,i.left+l,i.top);o*=-1;if(s.top>r.top){r=CUtil.CRect(i.left,i.bottom,i.left+l,i.bottom+_);o*=-1}if(s.right<r.right){r.Offset(-l+i.Width(),0);a*=-1}break;case CDefine.TTD_OBJECTDOWNRIGHT:r=CUtil.CRect(i.left,i.bottom,i.left+l,i.bottom+_);if(s.bottom<r.bottom){r=CUtil.CRect(i.left,i.top-_,i.left+l,i.top);o*=-1}if(s.right<r.right){r.Offset(-l+i.Width(),0);a*=-1}break;case CDefine.TTD_OBJECTUPPER:a=0;h=CUtil.CenterPoint(i);r=CUtil.CRect(h.x-l/2,i.top-_,h.x-l/2+l,i.top);o*=-1;if(s.top>r.top){r=CUtil.CRect(h.x-l/2,i.bottom,h.x-l/2+l,i.bottom+_);o*=-1}if(s.left>r.left||s.right<r.right){return this.GetDirectRect(CDefine.TTD_OBJECTUPPERRIGHT,e,i,n)}break;case CDefine.TTD_OBJECTDOWN:a=0;h=CUtil.CenterPoint(i);r=CUtil.CRect(h.x-l/2,i.bottom,h.x-l/2+l,i.bottom+_);if(s.bottom<r.bottom){r=CUtil.CRect(h.x-l/2,i.top-_,h.x-l/2+l,i.top);o*=-1}if(s.left>r.left||s.right<r.right){return this.GetDirectRect(CDefine.TTD_OBJECTDOWNRIGHT,e,i,n)}break;case CDefine.TTD_OBJECTLEFT:o=0;h=CUtil.CenterPoint(i);r=CUtil.CRect(i.left-l,h.y-_/2,i.left,h.y-_/2+_);a*=-1;if(s.bottom<r.bottom){r=CUtil.CRect(i.left-l,i.bottom-_,i.left,i.bottom);o*=-1}if(s.left>r.left){r.Offset(i.Width()+l,0);a*=-1}break;case CDefine.TTD_OBJECTRIGHT:o=0;h=CUtil.CenterPoint(i);r=CUtil.CRect(i.right,h.y-_/2,i.right+l,h.y-_/2+_);if(s.bottom<r.bottom){r=CUtil.CRect(i.right,i.bottom-_,i.right+l,i.bottom);o*=-1}if(s.right<r.right){r.Offset(-i.Width()-l,0);a*=-1}break;case CDefine.TTD_UPPERRIGHT:r=CUtil.CRect(n.x,n.y-_,n.x+l,n.y);o*=-1;if(s.top>r.top){r.Offset(0,this.DEFAULT_ARROWY+_);o*=-1}if(s.right<r.right){r.Offset(-l,0);a*=-1}break;case CDefine.TTD_UPPERLEFT:r=CUtil.CRect(n.x-l,n.y-_,n.x,n.y);a*=-1;o*=-1;if(s.top>r.top){r.Offset(0,this.DEFAULT_ARROWY+_);o*=-1}if(s.left>r.left){r.Offset(l,0);a*=-1}break;case CDefine.TTD_DOWNLEFT:r=CUtil.CRect(n.x-l,n.y+this.DEFAULT_ARROWY,n.x,n.y+this.DEFAULT_ARROWY+_);a*=-1;if(s.bottom<r.bottom){r.Offset(0,-(this.DEFAULT_ARROWY+_));o*=-1}if(s.left>r.left){r.Offset(l,0);a*=-1}break;case CDefine.TTD_OBJECTDOWNCENTER:h=CUtil.CenterPoint(i);r=CUtil.CRect(h.x-l/2,i.bottom,h.x-l/2+l,i.bottom+_);if(s.bottom<r.bottom){r=CUtil.CRect(h.x-l/2,i.top-_,h.x-l/2+l,i.top);o*=-1}if(s.left>r.left){r=CUtil.CRect(s.left,r.top,s.left+r.Width(),r.bottom)}else if(s.right<r.right){r=CUtil.CRect(s.right-r.Width(),r.top,s.right,r.bottom)}break;case CDefine.TTD_FIXEDPOSITION:if(!this.m_ptFixed)return this.GetDirectRect(CDefine.TTD_DOWNRIGHT,e,i,n);n.x=this.m_ptFixed.x;n.y=this.m_ptFixed.y;r=CUtil.CRect(n.x,n.y,n.x+l,n.y+_);break;default:r=CUtil.CRect(n.x,n.y+this.DEFAULT_ARROWY,n.x+l,n.y+this.DEFAULT_ARROWY+_);if(s.bottom<r.bottom){r.Offset(0,-(this.DEFAULT_ARROWY+_));o*=-1}if(s.right<r.right){r.Offset(-l,0);a*=-1}break}r.Offset(a,o);return r},GetToolInfo:function(){return this.m_pToolInfo2},Reference:function(){this.m_nReference++},Release:function(){this.m_nReference--;if(this.m_nReference<=0)this.Destroy()},SetAlphaBackground:function(t,e,i,n,s,r){switch(arguments.length){case 6:break;case 5:r=0;break;case 4:r=s=0;break;case 3:r=s=n=0;break;case 2:r=s=n=i=0;break;default:return}if(t>0&&t<1){this.SetAlpha(t);this.ModifyFlagEx(CFlags.VXTOOLTIP_ALPHA,0)}else{this.SetAlpha(1);this.ModifyFlagEx(0,CFlags.VXTOOLTIP_ALPHA)}this.m_nLAP=i;this.m_nTAP=n;this.m_nRAP=s;this.m_nBAP=r;this.m_nAlphaBk=e},SetFixedHeight:function(t){this.m_nHeight=t;if(this.m_nHeight>0)this.ModifyFlagEx(CFlags.VXTOOLTIP_FIXEDHEIGHT,0);else this.ModifyFlagEx(0,CFlags.VXTOOLTIP_FIXEDHEIGHT)},SetFixedWidth:function(t){this.m_nWidth=t;if(this.m_nWidth>0)this.ModifyFlagEx(CFlags.VXTOOLTIP_FIXEDWIDTH,0);else this.ModifyFlagEx(0,CFlags.VXTOOLTIP_FIXEDWIDTH)},SetFixedPosition:function(t,e,i,n){if(this.m_pToolInfo2)this.m_pToolInfo2.m_nDirect=CDefine.TTD_FIXEDPOSITION;this.m_ptFixed=new vx.point(t,e);if(i>0)this.SetFixedWidth(i);if(n>0)this.SetFixedHeight(n)},SetShadowImageName:function(t){this.SetShadowImage(this.FindImage(t))},SetShadowImage:function(t){if(t){this.m_pShadowImage=t;if(this.SetImageShadowGap(this.m_pShadowImage)){this.ModifyFlag(CFlags.STATUS_SHADOW,0);this.ModifyFlagEx(CFlags.VXTOOLTIP_HASSHADOW,0)}}},SetShowTool:function(t,e){if(t==null||t.m_pObject==null)return;if(t.m_tagCont.m_tag==null)return;if(this.m_nHoldClose>0&&this.IsTimer(CDefine.DEFTIMER_HOLD)){t.m_bUpdate=true;this.KillTimer(CDefine.DEFTIMER_HOLD)}if(this.IsFlag(CFlags.STATUS_SHOW)&&this.m_pToolInfo2==t){if(t.m_nDirect>=CDefine.TTD_OBJECTUPPER&&!this.IsFlagEx(CFlags.VXTOOLTIP_DRAGTOOL)){if(!this.m_pToolInfo2.IsUpdate())return}}this.PopupOrder();this.m_pToolInfo2=t;var i=this.m_pToolInfo2.GetSize();if(this.IsFlagEx(CFlags.VXTOOLTIP_FIXEDWIDTH))i.x=this.m_nWidth;if(this.IsFlagEx(CFlags.VXTOOLTIP_FIXEDHEIGHT))i.y=this.m_nHeight;var n=CUtil.CRect(0,0,i.x+this.m_szMargin.x*2,i.y+this.m_szMargin.y*2);this.InflateBound(n);switch(t.m_nDirect){case CDefine.TTD_OBJECTUPPER:case CDefine.TTD_OBJECTDOWN:case CDefine.TTD_OBJECTUPPERRIGHT:case CDefine.TTD_OBJECTDOWNRIGHT:n.Inflate(1,this.m_nArrowLen/2+1);break;case CDefine.TTD_OBJECTLEFT:case CDefine.TTD_OBJECTRIGHT:n.Inflate(this.m_nArrowLen/2+1,1);break}n=this.GetDirectRect(t.m_nDirect,n,this.m_pToolInfo2.m_pObject.GetObjectRect(),e);if(this.IsFlag(CFlags.STATUS_SHOW)){if(!this.IsFlagEx(CFlags.VXTOOLTIP_DRAGTOOL)&&this.IsFlagEx(CFlags.VXTOOLTIP_ALPHABRINGUP))this.ShowFade(true,this.ALPHA_BRINGUPTIME)}else{this.ModifyFlag(CFlags.STATUS_SHOW,0);if(this.IsFlagEx(CFlags.VXTOOLTIP_ALPHABRINGUP))this.ShowFade(true,this.ALPHA_BRINGUPTIME)}this.MoveObject(n);if(t.m_nDirect>=CDefine.TTD_OBJECTUPPER){var s=this.m_pToolInfo2.m_pObject.GetObjectRect();this.m_ptArrow=CUtil.CenterPoint(s)}else this.m_ptArrow=e;if(t.IsUpdate()){this.Invalidate();t.DoUpdate()}},SetToolColor:function(t,e){if(arguments.length<2)e=4294967295;if(t!=4294967295)this.m_crBack=t;if(e!=4294967295)this.m_crBorder=e},SetToolImageName:function(t){this.SetToolImage(this.FindImage(t))},SetToolImage:function(t){this.m_pTipImage=t},SetToolInfo2:function(t){this.m_pToolInfo2=t},SetToolMargins:function(t,e){if(arguments.length<2)e=null;if(t!=null)CUtil.SetPoint(this.m_szMargin,t.x,t.y);if(e!=null)CUtil.SetPoint(this.m_szOffset,e.x,e.y)},SetUseArrow:function(t){if(t%2!=0)t++;this.m_nArrowLen=t;this.ModifyFlagEx(CFlags.VXTOOLTIP_USEARROW,0)}});vx.socket=vx.Class.extend({init:function(t){this.m_owner=t;this.m_sock=null;this.m_uFlag=0;this.m_strIP="";this.m_nPort=0;this.m_bConnect=false},Delete:function(){if(this.m_sock){if(this.m_sock.readyState==WebSocket.OPEN||this.m_sock.readyState==WebSocket.CONNECTING){this.m_sock.close()}this.m_sock=null;console.log("["+this.m_strIP+"] - Delete Binary vxSocket!!!")}this.m_strIP=null;this.m_nPort=0;this.m_owner=null},toString:function(){return"(vx.socket)"},IsFlag:function(t){return(this.m_uFlag&t)==t},OrFlag:function(t){return this.m_uFlag&t},ModifyFlag:function(t,e){this.m_uFlag|=t;this.m_uFlag&=~e},Open:function(t,e){this.m_strIP=t;this.m_nPort=e;var i,n=this;if(this.m_owner==undefined)i=this;else i=this.m_owner;var s=String.format("ws://{0}:{1}",t,e);this.m_sock=new WebSocket(s);this.m_sock.onopen=function(t){i.OnConnect(n,t)};this.m_sock.onclose=function(t){i.OnClose(n,t)};this.m_sock.onmessage=function(t){i.OnReceive(n,t)};this.m_sock.onerror=function(t){i.OnError(n,t)}},IsOpen:function(){return this.m_sock&&this.m_sock.readyState==WebSocket.OPEN},IsClose:function(){return this.m_sock==null||this.m_sock&&this.m_sock.readyState==WebSocket.CLOSE},SetConnect:function(t){this.m_bConnect=t},IsConnect:function(){return this.m_bConnect},SendPacket:function(t){if(!this.m_sock)return false;var e=new ByteArrayEx;t.ExportData(e);this.m_sock.binaryType="arraybuffer";this.m_sock.send(e.m_arrayBuffer);if(vx.bDebug)CUtil.Dump(e);e.Delete();return true},OnConnect:function(t,e){console.log("Connect OK! - ["+e.currentTarget.url+"]")},OnClose:function(t,e){console.log("Socket Closed - ["+e.currentTarget.url+"]")},OnReceive:function(t,e){console.log("Receive Data! - ["+e.currentTarget.url+"]")},OnError:function(t,e){console.log("Socket Error - ["+e.currentTarget.url+"]")},Close:function(){if(this.m_sock){this.m_sock.close();this.m_sock=null}}});vx.static=vx.click.extend({init:function(t,e,i){if(t==undefined)t=null;if(e==undefined)e=-1;if(i==undefined)i=null;this._super();this.m_strImage=t;this.m_cTag=new vx.tagcont;this.m_crLabelBkgnd=0;this.m_crLabelLT=0;this.m_crLabelRB=0;this.m_rcArea=null;this.m_nStatic=e;this.m_dwMargin=0;this.m_nAlphaBk=.5;this.m_pCoverImage=null;this.m_nCoverStatic=-1;this.SetTypeCode(CDefine.VXCODE_STATIC);if(i!=null)this.m_rcArea=i.Clone();this.SetMargin(5,2,5,2)},toString:function(){return"(vx.static)"},Delete:function(){this.Clear();this.m_cTag.Delete();this.m_cTag=null;this._super()},OnCreate:function(){if(!this._super())return false;if(!this.IsFlagEx(CFlags.VXSTATIC_NOTIFYPARENT))this.ModifyFlag(CFlags.STATUS_NOMESSAGE,CFlags.STATUS_ENABLED);if(this.m_strImage!=null){if(this.m_rcArea!=null)this.SetStaticImageRectName(this.m_strImage,this.m_rcArea);else this.SetStaticImageName(this.m_strImage,this.m_nStatic)}return true},OnDrawFrame:function(t,e){this.DeflateWork(e);return e},OnDrawPartAlpha:function(t,e){var i=e.Clone();this.DeflateWork(i);t.DrawRectangle(i,this.m_crLabelBkgnd,4294967295,this.m_nAlphaBk,1)},OnDraw:function(t,e){if(this.IsFlagEx(CFlags.VXSTATIC_NODRAW))return;var i=e.Clone();if(this.IsFlagEx(CFlags.VXSTATIC_LABELBKGND)&&!this.IsFlag(CFlags.STATUS_PARTALPHA)){var n=true;var s,r,a,o;if(this.IsFlagEx(CFlags.VXSTATIC_GRADIENTBKGND_HORZ)){s=this.m_crLabelBkgnd;r=this.m_crLabelLT;a=this.m_crLabelRB;o=this.m_crLabelRB}else if(this.IsFlagEx(CFlags.VXSTATIC_GRADIENTBKGND_VERT)){n=false;s=this.m_crLabelBkgnd;r=this.m_crLabelLT;a=this.m_crLabelRB;o=this.m_crLabelRB}else{s=r=this.m_crLabelBkgnd;a=this.m_crLabelLT;o=this.m_crLabelRB}if(r==4294967295){a=o=4294967295}if(s==r){t.FillSolidRect(i,s,a,o,1,1,this.m_dwRndVal)}else if(s==4294967295){t.FillGradientRect(n,i,r-1,r,0,1,a,o,1,this.m_dwRndVal)}else if(r==4294967295){t.FillGradientRect(n,i,s-1,s,1,0,a,o,1,this.m_dwRndVal)}else{t.FillGradientRect(n,i,s,r,1,1,a,o,1,this.m_dwRndVal)}}this.DrawStatic(t,i,this.m_pImage,this.m_nStatic);if(this.IsFlagEx(CFlags.VXSTATIC_HASTAG)){if(this.IsFlagEx(CFlags.VXSTATIC_LABELBKGND)){CUtil.DeflateRect(i,CUtil.MARGINLEFT(this.m_dwMargin),CUtil.MARGINTOP(this.m_dwMargin),CUtil.MARGINRIGHT(this.m_dwMargin),CUtil.MARGINBOTTOM(this.m_dwMargin))}this.m_cTag.Draw(t,i)}},OnDrawAfter:function(t,e){this.DrawStatic(t,e,this.m_pCoverImage,this.m_nCoverStatic)},SelfEventSync:function(t,e,i){if(this.m_nID==CDefine.VXID_HILIGHT&&t==CDefine.CMD_VXOBJECT_MOVEEND){this.KillTimer(CDefine.DEFTIMER_MOVE);this.ShowObject(false);return false}return true},DoClick:function(){if(this.IsFlagEx(CFlags.VXSTATIC_NOTIFYPARENT))this.NotifyParent(CDefine.CMD_VXSTATIC_NOTIFY,this.m_nID,null)},OnLButtonDblClk:function(t,e,i){if(this.IsFlagEx(CFlags.VXSTATIC_NOTIFYPARENT))this._super(t,e,i)},OnLButtonDown:function(t,e,i){if(this.IsFlagEx(CFlags.VXSTATIC_NOTIFYPARENT))this._super(t,e,i)},OnLButtonUp:function(t,e,i){if(this.IsFlagEx(CFlags.VXSTATIC_NOTIFYPARENT))this._super(t,e,i)},OnMouseMove:function(t,e,i){if(this.IsFlagEx(CFlags.VXSTATIC_NOTIFYPARENT))this._super(t,e,i)},OnMouseLeave:function(){if(this.IsFlagEx(CFlags.VXSTATIC_NOTIFYPARENT))this._super()},DrawStatic:function(t,e,i,n){var s=0;if(this.IsFlagEx(CFlags.VXSTATIC_REVERSEHORZ))s|=CDefine.FLIP_HORZ;if(this.IsFlagEx(CFlags.VXSTATIC_REVERSEVERT))s|=CDefine.FLIP_VERT;if(i){var r,a,o,l;o=e.Clone();if(this.IsFlagEx(CFlags.VXSTATIC_RECTAREA)){this.NormalizeRect(i.GetImageRect(),this.m_rcArea);a=new vx.point(this.m_rcArea.Width(),this.m_rcArea.Height());if(a.x>e.Width())a.x=e.Width();if(a.y>e.Height())a.y=e.Height();l=this.m_rcArea.Clone();if(this.IsFlagEx(CFlags.VXSTATIC_CENTERIMAGE)){r=CUtil.CenterPoint(e);o=CUtil.CRect(r.x-a.x/2,r.y-a.y/2,r.x-a.x/2+a.x,r.y-a.x/2+a.y);r=CUtil.CenterPoint(l);l=CUtil.CRect(r.x-a.x/2,r.y-a.y/2,r.x-a.x/2+a.x,r.y-a.x/2+a.y)}else{o.right=o.left+a.x;o.bottom=o.top+a.y;l.right=l.left+a.x;l.bottom=l.top+a.y}i.DrawEx(t,o.left,o.top,l,s)}else{if(n==-1)return;var _=n;if(!CUtil.EqualRect(i.m_rcInner,0,0,0,0)){i.DrawBox(t,e,_)}else{a=i.GetFrameSize();if(e.Width()==a.x&&e.Height()==a.y){if(_>=0){i.DrawFrame(t,e.left,e.top,_,s)}else if(!this.IsFlagEx(CFlags.VXSTATIC_NOFRAMENODRAW)){i.DrawEx(t,o.left,o.top,i.GetImageRect(),s)}}else{if(a.x>e.Width())a.x=e.Width();if(a.y>e.Height())a.y=e.Height();if(_>=0)l=i.GetFrameRect(_);else if(this.IsFlagEx(CFlags.VXSTATIC_NOFRAMENODRAW))return;else l=i.GetImageRect();if(this.IsFlagEx(CFlags.VXSTATIC_CENTERIMAGE)){r=CUtil.CenterPoint(e);o=CUtil.CRect(r.x-a.x/2,r.y-a.y/2,r.x-a.x/2+a.x,r.y-a.y/2+a.y);r=CUtil.CenterPoint(l);l=CUtil.CRect(r.x-a.x/2,r.y-a.y/2,r.x-a.x/2+a.x,r.y-a.y/2+a.y)}else{o.right=o.left+a.x;o.bottom=o.top+a.y;l.right=l.left+a.x;l.bottom=l.top+a.y}i.DrawEx(t,o.left,o.top,l,s)}}if(this.IsFlagEx(CFlags.VXSTATIC_NOTIFYPARENT|CFlags.VXCLICK_FOCUS_BORDER)){if(this.OrFlag2(CFlags.STATUS2_MOUSEOVER|CFlags.STATUS2_PRESS)){t.Draw3dRect(e,this.m_crBndF,this.m_crBndF,1,1,this.m_dwRndVal)}}}}},Clear:function(){this.m_pImage=null;this.m_rcArea=null},SetStaticImageName:function(t,e){if(e==undefined)e=0;if(this.m_stage==null){this.m_strImage=t;this.m_nStatic=e;return}this.SetStaticImage(this.FindImage(t),e)},SetStaticImage:function(t,e){this.Clear();this.m_nStatic=e;this.m_pImage=t;if(t){var i;if(!this.m_pImage.IsFrame())this.SetStaticFrame(-1,false);if(this.m_nStatic>=0)i=this.m_pImage.GetFrameSize();else i=this.m_pImage.GetImageSize();if(!this.IsFlagEx(CFlags.VXSTATIC_NORESIZE)&&!this.m_pImage.IsResize()){var n=this.GetObjectRect();if(this.IsFlagEx(CFlags.VXSTATIC_CENTERRESIZE)){var s=CUtil.CenterPoint(n);n=CUtil.CRect(s.x-i.x/2,s.y-i.y/2,s.x-i.x/2+i.x,s.y-i.y/2+i.y)}else{n.right=n.left+i.x;n.bottom=n.top+i.y}this.MoveObject(n)}this.Invalidate()}else{this.Invalidate()}},SetStaticImageRectName:function(t,e){if(this.m_stage==null){if(e==null)return;this.m_nStatic=-1;this.m_strImage=t;this.m_rcArea=e.Clone();this.ModifyFlagEx(CFlags.VXSTATIC_RECTAREA,0);return}this.SetStaticImageRect(this.FindImage(t),e)},SetStaticImageRect:function(t,e){this.Clear();this.m_nStatic=-1;this.m_pImage=t;this.m_rcArea=e.Clone();if(this.m_pImage){this.ModifyFlagEx(CFlags.VXSTATIC_RECTAREA,0);if(!this.IsFlagEx(CFlags.VXSTATIC_NORESIZE)){var i,n,s,r;i=new vx.point(this.m_rcArea.Width(),this.m_rcArea.Height());r=this.GetObjectRect();if(this.IsFlagEx(CFlags.VXSTATIC_CENTERRESIZE)){n=CUtil.CenterPoint(r);s=CUtil.CRect(n.x-i.x/2,n.y-i.y/2,n.x-i.x/2+i.x,n.y-i.y/2+i.y)}else{s=CUtil.CRect(r.left,r.top,r.left+i.x,r.top+i.y)}this.MoveObject(s)}}else{this.ModifyFlagEx(0,CFlags.VXSTATIC_RECTAREA)}this.Invalidate()},SetStaticCoverImageName:function(t,e){this.SetStaticCoverImage(this.FindImage(t),e)},SetStaticCoverImage:function(t,e){this.m_pCoverImage=t;this.m_nCoverStatic=e;this.ModifyFlag(CFlags.STATUS_DRAWAFTER,0);this.Invalidate()},SetLabelForm:function(t,e,i){this.ModifyFlagEx(CFlags.VXSTATIC_LABELBKGND,0);this.m_crLabelBkgnd=t;this.m_crLabelLT=e;this.m_crLabelRB=i},SetStaticFrame:function(t,e){if(e==undefined)e=true;this.m_nStatic=t;if(e)this.Invalidate()},RefreshText:function(t){if(this.m_cTag==null)this.m_cTag=new vx.tagcont;var e=this.m_cTag.m_tag.GetTextType();var i=this.m_cTag.m_tag.GetTextColor();this.m_cTag.SetTag(vx.tag.Text(t,i,e));if(this.IsFlagEx(CFlags.VXSTATIC_TEXTRESIZE)){this.ResizeText()}this.Invalidate()},SetText:function(t,e,i,n,s,r){switch(arguments.length){case 6:break;case 5:r=4294967295;break;case 4:r=4294967295;s=4294967295;break;case 3:r=4294967295;s=4294967295;n=0;break;case 2:r=4294967295;s=4294967295;n=0;i=0;break;case 1:r=4294967295;s=4294967295;n=0;i=0;e=0;break;default:r=4294967295;s=4294967295;n=0;i=0;e=0;t=null;break}if(t==null){this.SetTextTag(vx.tag.TNULL());return}if(t.search("_")!=-1)t=this.FindText(t);var a;if((a=vx.Global.FindSeperatorNum(t))>=0){t=vx.Global.g_referString;var o=vx.Global.VXS_GetButtonIcon();if(o){var l=vx.tag.Image(o,o.GetFrameRect(a));l.Append(vx.tag.TWIDTH(4));l.Append(vx.tag.Text(FindText(t),n,e));this.SetTextTag(l,i,s,r)}else{this.SetTextTag(vx.tag.Text(FindText(t),n,e),i,s,r)}}else{this.SetTextTag(vx.tag.Text(t,n,e),i,s,r)}},SetTextTag:function(t,e,i,n){switch(arguments.length){case 4:break;case 3:n=4294967295;break;case 2:n=4294967295;i=4294967295;break;case 1:n=4294967295;i=4294967295;e=0;break;default:return}if(t.utype==CDefine.TAGTYPE_NULL){this.ModifyFlagEx(0,CFlags.VXSTATIC_HASTAG);this.Invalidate();return}if(i!=4294967295)this.m_cTag.SetBoundColor(CDefine.INDEX_BOUNDLT,i);if(n!=4294967295)this.m_cTag.SetBoundColor(CDefine.INDEX_BOUNDRB,n);if(t.vcolor==4294967295)t.vcolor=CColor.GetColor(CColor.INDEX_CONTROLTEXT_GRAY);this.m_cTag.SetTag(t,e,null);this.ModifyFlagEx(CFlags.VXSTATIC_HASTAG,0);if(this.IsFlagEx(CFlags.VXSTATIC_TEXTRESIZE)){this.ResizeText()}this.Invalidate()},ResizeText:function(){var t=this.m_cTag.GetSize();var e;var i=this.GetObjectRect();var n=CUtil.CenterPoint(i);if(this.m_pImage){var s=this.m_pImage.GetFrameSize();if(t.x<s.x)t.x=s.x;if(t.y<s.y)t.y=s.y}if(this.IsFlagEx(CFlags.VXSTATIC_LABELBKGND)){t.x+=CUtil.MARGINLEFT(this.m_dwMargin)+CUtil.MARGINRIGHT(this.m_dwMargin);t.y+=CUtil.MARGINTOP(this.m_dwMargin)+CUtil.MARGINBOTTOM(this.m_dwMargin)}if(this.m_cTag.m_uFmt==CDefine.DT_CENTER)e=CUtil.CRect(n.x-t.x/2,n.y-t.y/2,n.x-t.x/2+t.x,n.y-t.y/2+t.y);else if(this.m_cTag.m_uFmt==CDefine.DT_RIGHT)e=CUtil.CRect(i.right-t.x,n.y-t.y/2,i.right,n.y-t.y/2+t.y);else e=CUtil.CRect(i.left,n.y-t.y/2,i.left+t.x,n.y-t.y/2+t.y);this.MoveObject(e)},SetMargin:function(t,e,i,n){this.m_dwMargin=CUtil.MAKEMARGIN(t,e,i,n)},NormalizeRect:function(t,e){var i=e.Width();var n=e.Height();if(t.left>e.left){e.left=t.left;e.right=e.left+i}if(t.right<e.right){e.right=t.right;e.left=e.right-i}if(t.top>e.top){e.top=t.top;e.bottom=e.top+n}if(t.bottom<e.bottom){e.bottom=t.bottom;e.top=e.bottom-n}},OffsetRectArea:function(t,e){if(this.m_pImage==null||this.m_rcArea==null||!this.IsFlagEx(CFlags.VXSTATIC_RECTAREA))return;this.m_rcArea.Offset(t,e);this.NormalizeRect(this.m_pImage.GetImageRect(),this.m_rcArea);this.Invalidate()}});vx.soundmgr=vx.Class.extend({init:function(t){this.m_pSkin=t;this.m_AudioContext=null;this.m_bPossibleBGM=1;this.m_bPossibleSound=1;this.m_nVolumeBGM=.5;this.m_nVolumeSound=.5;this.m_sndBGM=null;this.m_arySound=new ObArray;this.m_sndPool={};try{window.AudioContext=window.AudioContext||window.webkitAudioContext;this.m_AudioContext=new AudioContext;console.log("Web Audio API(WAA) is supported in this browser. ")}catch(t){console.log("Web Audio API(WAA) is not supported in this browser. So, use the html5 Audio.")}},toString:function(){return"(vx.soundmgr)"},Delete:function(){this._super()},IsWAAPossible:function(){if(this.m_AudioContext)return true;else return false},OnPageVisible:function(t){if(t){this.PlayBGM("")}else{this.StopBGM();this.StopSound()}},SetPossibleBGM:function(t){this.m_bPossibleBGM=t;if(!t)this.StopBGM();else this.PlayBGM()},SetPossibleSound:function(t){this.m_bPossibleSound=t;if(!t)this.StopSound()},AudioSupportExt:function(){},SetVolumeBGM:function(t){this.m_nVolumeBGM=t;if(this.m_sndBGM){if(this.IsWAAPossible()){if(this.m_sndBGM.audio&&this.m_sndBGM.audio.m_buffer)this.m_sndBGM.audio.setVolume(this.m_nVolumeBGM)}else{this.m_sndBGM.volume=this.m_nVolumeBGM}}},SetVolumeSound:function(t){this.m_nVolumeSound=t;var e=null;var i=this.m_arySound.GetSize();for(var n=0;n<i;n++){e=this.m_arySound[n];if(this.IsWAAPossible())e.audio.setVolume(this.m_nVolumeSound);else e.volume=this.m_nVolumeSound}},PlayBGM:function(t,e,i,n){t=typeof t!=="undefined"?t:"";e=typeof e!=="undefined"?e:0;i=typeof i!=="undefined"?i:0;n=typeof n!=="undefined"?n:.5;if(!this.m_bPossibleBGM)return;if(n!=-1&&(n>=0&&n<=1))this.m_nVolumeBGM=n;if(this.IsWAAPossible()){vx.trace("Web Audio API playing");if(!this.m_sndBGM){var s=this.m_pSkin.FindSound(t);if(s&&s.audio&&s.audio.m_buffer){this.m_sndBGM=s;this.m_sndBGM.audio.setVolume(n);this.m_sndBGM.audio.play()}}else{if(i){this.m_sndBGM.audio.stop();this.m_sndBGM.audio.play()}else this.m_sndBGM.audio.resume()}}else{vx.trace("HTML5 Audio playing");try{if(!this.m_sndBGM){var s=this.m_pSkin.FindSound(t);if(s){var r=new Audio;r.src=s.url;r.preload="auto";r.volume=n;if(e)r.loop=true;r.play();this.m_sndBGM=r}}else{if(i){this.m_sndBGM.pause();this.m_sndBGM.currentTime=0}this.m_sndBGM.play()}}catch(t){vx.trace("HTML5 Audio error")}}},StopBGM:function(){if(this.m_sndBGM){if(this.IsWAAPossible()){if(this.m_sndBGM.audio&&this.m_sndBGM.audio.m_buffer){this.m_sndBGM.audio.pause()}}else{this.m_sndBGM.pause()}}},PrePareSound:function(){},PlaySound:function(t,e,i){e=typeof e!=="undefined"?e:-1;i=typeof i!=="undefined"?i:0;if(!this.m_bPossibleSound)return;pxSnd=this.m_pSkin.FindSound(t);if(!pxSnd)return;var n;var s=vx.soundmgr.SOUND_POOL_COUNT;if(e!=-1&&(e>=0&&e<=1))this.m_nVolumeSound=e;if(this.IsWAAPossible()){if(pxSnd.audio&&pxSnd.audio.m_buffer){n=new CSound;this.m_arySound.Add(n);n.m_buffer=pxSnd.audio.m_buffer;n.setVolume(this.m_nVolumeSound);n.play(i)}return}else{if(!this.m_sndPool.hasOwnProperty(t)){this.m_sndPool[t]={};for(var r=0;r<s;r++){n=new Audio;n.src=pxSnd.url;n.preload="auto";n.volume=this.m_nVolumeSound;this.m_sndPool[t][r]=n}}n=null;for(var r=0;r<s;r++){n=this.m_sndPool[t][r];if(n&&(n.currentTime==0||n.ended)){this.m_arySound.Add(n);n.volume=this.m_nVolumeSound;if(i)n.loop=true;n.play();break}}}},StopSound:function(){var t;for(var e=this.m_arySound.GetSize()-1;e>=0;e--){t=this.m_arySound[e];if(this.IsWAAPossible()){t.stop();t.Delete()}else{t.pause();try{t.currentTime=0}catch(t){}}this.m_arySound.RemoveAt(e)}}});vx.soundmgr.SOUND_POOL_COUNT=5;function CMyFlags(){}function CMyGlobal(){}CMyGlobal.gIcon=null;CMyGlobal.GetIconTag16=function(t){var e=CMyGlobal.gIcon;if(e==null)return vx.tag.TWIDTH(16);else return vx.tag.Image(e,CMyGlobal.GetIconRect(16,t))};CMyGlobal.GetIconTag28=function(t){var e=CMyGlobal.gIcon;if(e==null)return vx.tag.TWIDTH(28);else return vx.tag.Image(e,CMyGlobal.GetIconRect(28,t))};CMyGlobal.GetIconRect=function(t,e){var i=CUtil.CRect(0,0,0,0);switch(t){case 16:i.SetRect(0,0,16,16);break;case 24:i.SetRect(0,16,24,16+24);break;case 28:i.SetRect(0,16+24,28,16+24+28);break;case 32:i.SetRect(0,16+24+28,32,16+24+28+32);break;case 48:i.SetRect(0,16+24+28+32,48,16+24+28+32+48);break;case 64:i.SetRect(0,16+24+28+32+48,64,16+24+28+32+48+64);break;default:break}i.Offset(e*i.Width(),0);return i};CMyGlobal.DeleteArray=function(t){var e,i=t.length;for(e=0;e<i;e++){if(t[e]){t[e].Delete();t[e]=null}}t.splice(0,i)};CMyGlobal.CreateArrowButton=function(t,e,i,n,s){if(i==undefined)i=CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED|CFlags.STATUS_TRANS;var r=CFlags.VXCLICK_USEDBLCLK;if(n==undefined)n=false;if(s==undefined)s=false;var a,o=CMyGlobal.gIcon;if(o){var l,_=6;var h=e.CenterPoint();var f=24;var C=f*_;e.left=Math.floor(h.x-C/2);e.top=Math.floor(h.y-f/2);e.right=e.left+24;e.bottom=e.top+24;for(var m=0;m<_;m++){a=new CBarButton(16777215,0,4294967295);a.CreateP(t.m_stage,e,CMyDefine.IDC_ARROW_FIRST+m,i,r,t);l=CMyGlobal.GetIconTag16(m+10);a.SetButtonTag(l,0,0);a.SetSticker(n,s);e.Offset(24,0)}}};CMyGlobal.ShowArrowButton=function(t,e){var i,n;for(n=0;n<6;n++){i=t.FindObject(CMyDefine.IDC_ARROW_FIRST+n);if(i)i.ShowObject(e)}};CMyGlobal.EnableArrowButton=function(t,e){var i,n;for(n=0;n<6;n++){i=t.FindObject(CMyDefine.IDC_ARROW_FIRST+n);if(i)i.EnableObject(e)}};CMyGlobal.MoveArrowBoard=function(t,e){switch(e){case CMyDefine.IDC_ARROW_FIRST:t.ArrowMove(-999);break;case CMyDefine.IDC_ARROW_PREV5:t.ArrowMove(-5);break;case CMyDefine.IDC_ARROW_PREV:t.ArrowMove(-1);break;case CMyDefine.IDC_ARROW_NEXT:t.ArrowMove(1);break;case CMyDefine.IDC_ARROW_NEXT5:t.ArrowMove(5);break;case CMyDefine.IDC_ARROW_LAST:t.ArrowMove(999);break;case CMyDefine.IDC_TOOL_ALTERNATIVE:case CMyDefine.IDC_TOOL_BLACK:case CMyDefine.IDC_TOOL_WHITE:case CMyDefine.IDC_TOOL_LABEL:case CMyDefine.IDC_TOOL_CIRCLE:case CMyDefine.IDC_TOOL_CROSS:case CMyDefine.IDC_TOOL_RECT:case CMyDefine.IDC_TOOL_TRIANGLE:case CMyDefine.IDC_TOOL_ERASER:{var i=e-CMyDefine.IDC_BTN_TOOL;t.SetTool(i)}break;case CMyDefine.IDC_TOOL_REFRESH:t.SetTool(0);t.ResetReviewRefer();break;case CMyDefine.IDC_TOOL_SAVE:t.SaveRefer();break}};CMyGlobal.GetTerritoryText=function(t,e,i){if(e==i){return gRoot.FindText("FMT_TERRITORY_DRAW")}else{t=Math.floor(t/2);e=Math.floor(e/2);i=Math.floor(i/2);var n,s;if(e>i)n=gRoot.FindText("RT_BLACK");else n=gRoot.FindText("RT_WHITE");s=String.format(gRoot.FindText("FMT_TERRITORY_RESULT"),n,t);return String.format(gRoot.FindText("FMT_TERRITORY_INFO"),s,e,i)}};function CMyDefine(){}CMyDefine.CMD_BOARD_VIEWEXPLAIN=917765;CMyDefine.CMD_SELECTPOPUP_CLOSE=917511;CMyDefine.LOCALE_KOREA=1;CMyDefine.LOCALE_CHINA=2;CMyDefine.LOCALE_JAPAN=3;CMyDefine.LOCALE_THAIWAN=4;CMyDefine.LOCALE_ENGLISH=5;CMyDefine.IDC_BTN_TOOL=147456;CMyDefine.IDC_TOOL_ALTERNATIVE=CMyDefine.IDC_BTN_TOOL;CMyDefine.IDC_TOOL_BLACK=147457;CMyDefine.IDC_TOOL_WHITE=147458;CMyDefine.IDC_TOOL_LABEL=147459;CMyDefine.IDC_TOOL_CIRCLE=147460;CMyDefine.IDC_TOOL_CROSS=147461;CMyDefine.IDC_TOOL_RECT=147462;CMyDefine.IDC_TOOL_TRIANGLE=147463;CMyDefine.IDC_TOOL_ERASER=147464;CMyDefine.IDC_TOOL_SAVE=151553;CMyDefine.IDC_TOOL_COMMENT=151554;CMyDefine.IDC_TOOL_REFRESH=151555;CMyDefine.IDC_TOOL_PREV=151556;CMyDefine.IDC_TOOL_NEXT=151557;CMyDefine.IDC_BTN_REVIEW=50004;CMyDefine.IDC_BTN_SUSUN=50006;CMyDefine.IDC_BTN_COORD=50007;CMyDefine.IDC_BTN_TERRI=50008;CMyDefine.IDC_BTN_REFRESH=50009;CMyDefine.IDC_BTN_MENU=50010;CMyDefine.IDC_BTN_REFER=50011;CMyDefine.IDC_ARROW_FIRST=143361;CMyDefine.IDC_ARROW_PREV5=143362;CMyDefine.IDC_ARROW_PREV=143363;CMyDefine.IDC_ARROW_NEXT=143364;CMyDefine.IDC_ARROW_NEXT5=143365;CMyDefine.IDC_ARROW_LAST=143366;function CMyUtil(){}CMyUtil.AddParam=function(t,e,i){var n="";var s=/\?/;if(s.test(t))n="&"+e+"="+i;else n="?"+e+"="+i;return t+n};CMyUtil.GetPositionName=function(t){var e="";if(t>CMyDefine.IDC_VIEW_BASE&&t<CMyDefine.IDC_VIEW_BASE+1e4)e="";else if(t==CMyDefine.IDC_VIEW_HOME)e="";else if(t==CMyDefine.IDC_VIEW_HOME2)e="";else if(t==CMyDefine.IDC_VIEW_WAIT)e="";else if(t==CMyDefine.IDC_VIEW_DESK)e="";return e};var S_REQ_INFO=vx.Class.extend({init:function(t,e,i,n,s,r,a){this.sender=t;this.nCmd=e;this.url=i;this.sData=n;this.sMethod=r;this.nTimeout=s;this.nType=a}});var CWeb={};CWeb.ERR_OK=0;CWeb.ERR_TIMEOUT=1;CWeb.ERR_1=2;CWeb.ERR_PARSE=2;CWeb.queue=[];CWeb.lock=false;CWeb.flush=function(){if(CWeb.lock)return;if(CWeb.queue.length==0)return;CWeb.lock=true;info=CWeb.queue.shift();var t=CWeb.GetContentType(info.nType);var e=new XMLHttpRequest;e.open(info.sMethod,info.url);e.setRequestHeader("Content-Type",t);var i=false;setTimeout(function(){i=true},info.nTimeout);var n=false;e.onreadystatechange=function(){if(i){if(!n){n=true;this.abort();CWeb.ReceivePacket(CWeb.ERR_TIMEOUT,info.nCmd,"",info.sender);CWeb.NextStep()}}else{var t=e.readyState;var s=e.status;if(t>=0&&t<4){}else if(t==4){if(s==200)CWeb.ReceivePacket(CWeb.ERR_OK,info.nCmd,CWeb.GetData(e,info.nType),info.sender);else CWeb.ReceivePacket(CWeb.ERR_1,info.nCmd,null,info.sender);e=null;var r=String.format("*** WEB CMD RSP [cmd : {0}]",info.nCmd);if(s==200){var a=String.format("{0}",info.url);sLog=r+"completed. URL : "+a;vx.trace(sLog)}else{if(s==404)sLog=r+" Page not found";else if(s==0)sLog=r+" Unkown Error";else sLog=r+" Unkown Error. status : "+s;console.error(sLog)}CWeb.NextStep()}}};e.send(info.sData)};CWeb.NextStep=function(){CWeb.lock=false;CWeb.flush()};CWeb.Send=function(t,e,i,n,s){i=typeof i!=="undefined"?i:5e3;s=typeof s!=="undefined"?s:1;n=typeof n!=="undefined"?n:"POST";var r=e.CMD;var a=CWeb.GetContentType(s);var o=CWeb.GetURL(r);var l="REQ="+e.Export();var _=String.format("*** WEB CMD REQ [cmd : {0}] : {1} ",r,o);vx.trace(_);var h=new S_REQ_INFO(t,r,o,l,i,n,s);CWeb.queue.push(h);CWeb.flush()};CWeb.ReceivePacket=function(t,e,i,n){if(t==CWeb.ERR_TIMEOUT){n.OnReceiveFromWeb(t,e,s,null,n);return}var s;switch(e){case jpk.CMD_FOLLOWLIST_REQ:s=new JPK_FOLLOWLIST_RSP;break;case jpk.CMD_FOLLOWLIST_PID_REQ:s=new JPK_FOLLOWLIST_PID_RSP;break;case jpk.CMD_FOLLOWING_REQ:s=new JPK_FOLLOWING_RSP;break;case jpk.CMD_UNFOLLOWING_REQ:s=new JPK_UNFOLLOWING_RSP;break;case jpk.CMD_GIBOLIST_REQ:s=new JPK_GIBOLIST_RSP;break;case jpk.CMD_GIBO_REQ:s=new JPK_GIBO_RSP;break;case jpk.CMD_CONTESTGIBOLIST_REQ:s=new JPK_CONTESTGIBOLIST_RSP;break;case jpk.CMD_CONTESTLIST_REQ:s=new JPK_CONTESTLIST_RSP;break;case jpk.CMD_SCRAP_REQ:s=new JPK_SCRAP_RSP;break;case jpk.CMD_HOMEINFO_REQ:s=new JPK_HOMEINFO_RSP;break;case jpk.CMD_GIBOCOMMENT_REQ:s=new JPK_GIBOCOMMENT_RSP;break;case jpk.CMD_FOLLOWER_REQ:s=new JPK_FOLLOWER_RSP;break;case jpk.CMD_TRACE_REQ:s=new JPK_TRACE_RSP;break;case jpk.CMD_ADDLIKE_REQ:s=new JPK_ADDLIKE_RSP;break;case jpk.CMD_EDITCOMMENT_REQ:s=new JPK_EDITCOMMENT_RSP;break;case jpk.CMD_DELCOMMENT_REQ:s=new JPK_DELCOMMENT_RSP;break;case jpk.CMD_SKINUPDATE_REQ:s=new JPK_SKINUPDATE_RSP;break;case jpk.CMD_SKINPAGE_REQ:s=new JPK_SKINPAGE_RSP;break;case jpk.CMD_CREATEFOLDER_REQ:s=new JPK_CREATEFOLDER_RSP;break;case jpk.CMD_EDITFOLDER_REQ:s=new JPK_EDITFOLDER_RSP;break;case jpk.CMD_MOVEGIBO_REQ:s=new JPK_MOVEGIBO_RSP;break;case jpk.CMD_AVATARUPDATE_REQ:s=new JPK_AVATARUPDATE_RSP;break;case jpk.CMDL_LIKEUSER_REQ:s=new JPK_LIKEUSER_RSP;break}try{if(s)s.Import(i)}catch(e){t=CWeb.ERR_PARSE}n.OnReceiveFromWeb(t,e,s,null,n);if(s){s.Delete();s=null}};CWeb.GetContentType=function(t){var e;switch(t){case 0:e="";break;case 1:e="application/x-www-form-urlencoded";break;case 2:e="multipart/formed-data";break;case 3:e="application/xml";break;case 4:e="text/css";break;case 5:e="text/javascript";break;case 6:e="text/html";break;case 7:e="text/plain";break;default:e="";break}return e};CWeb.GetURL=function(t){var e;switch(t){case jpk.CMD_GIBO_REQ:case jpk.CMD_GIBOLIST_REQ:case jpk.CMD_CONTESTGIBOLIST_REQ:e=G_VAR.HOME_API_URL+G_VAR.GIBO_PHP_REQ;break;default:e=G_VAR.HOME_API_URL+G_VAR.HOME_PHP_REQ;break}return e};CWeb.GetData=function(t,e){var i=t.getResponseHeader("Content-Type");var n=i&&i.indexOf("xml")>=0;var s=e==3||n?t.responseXML:t.responseText;if(e==0)s=JSON.parse(s);return s};var S_REQ_INFO2=vx.Class.extend({init:function(t,e,i,n,s,r){this.sender=t;this.url=e;this.callback=i;this.nTimeout=n;this.sMethod=s;this.nType=r}});function CRequest(){}CRequest.ERR_OK=0;CRequest.ERR_TIMEOUT=1;CRequest.ERR_1=2;CRequest.queue=[];CRequest.lock=false;CRequest.flush=function(){if(CRequest.lock)return;if(CRequest.queue.length==0)return;CRequest.lock=true;info=CRequest.queue.shift();var t=CWeb.GetContentType(info.nType);var e=new XMLHttpRequest;e.open(info.sMethod,info.url);if(t!="")e.setRequestHeader("Content-Type",t);var i=false;setTimeout(function(){i=true;if(e)e.abort()},info.nTimeout);var n=false;e.onreadystatechange=function(){if(i){if(!n){n=true;info.callback.apply(info.sender,[CRequest.ERR_TIMEOUT,null,info]);CRequest.lock=false;CRequest.flush()}}else{var t=e.readyState;var s=e.status;if(t>=0&&t<4){}else if(t==4){var r="*** WEB RSP : ";if(s==200){var a=CWeb.GetData(e,info.nType);info.callback.apply(info.sender,[CRequest.ERR_OK,a,info]);var o=String.format("{0}",info.url);sLog=r+"completed. URL : "+o;vx.trace(sLog)}else{info.callback.apply(info.sender,[CRequest.ERR_1,null,info]);if(s==404)sLog=r+" Page not found";else if(s==0)sLog=r+" Unkown Error";else sLog=r+" Unkown Error. status : "+s;console.error(sLog)}e=null;CRequest.lock=false;CRequest.flush()}}};e.send()};CRequest.Request=function(t,e,i,n,s,r){n=typeof n!=="undefined"&&n!=-1?n:5e3;s=typeof s!=="undefined"&&s!=""?s:"POST";r=typeof r!=="undefined"?r:1;vx.trace("*** WEB REQ : "+e);var a=new S_REQ_INFO2(t,e,i,n,s,r);CRequest.queue.push(a);CRequest.flush()};function menu(){this.m_list=new ObArray;var t,e;t=new vx.MENUITEM(0,menu.IDR_MENU1,"IDR_MENU1");this.m_list.Add(t);e=t.AppendMenu(CDefine.MF_POPUP,-1,"editor");t=e;t.AppendMenu(0,menu.ID_MENU_SETBACK,"MENU_SETBACK");t.AppendMenu(0,menu.ID_MENU_SKIP,"MENU_SKIP");t=t.menu_parent;t=t.menu_parent}menu.IDR_MENU1=2001;menu.ID_MENU_SETBACK=2011;menu.ID_MENU_SKIP=2012;var gRoot=null;var MainApp=vx.skin.extend({init:function(t,e){this._super(t,e);this.m_main=null;this.m_aiUrl="http://ai.tygem.com/aibaduk.php";this.m_backColor=CColor.RGB(255,255,255);this.m_fnCallBack=null;this.m_rScale=1;gRoot=this},OnInitialize:function(){this.m_titleStage=new vx.stage;this._super();this.m_main=new CEditorStage;this.m_main.Create(this,"MAIN",CFlags.STAGEST_SHOW|CFlags.STAGEST_ENABLED|CFlags.STAGEST_MUSTGETKEY,null);this.SelectStage("MAIN");this.LoadResource(RESOURCE_URL+MAIN_RESOURCE_NAME+"?ver="+MAIN_RESOURCE_VERSION)},OnDownloadProgress:function(t,e,i,n,s){},OnDownloadResource:function(t,e){if(t==MAIN_RESOURCE_NAME){CColor.SetColor(CColor.INDEX_DEFAULTSTAGE,this.m_backColor);CColor.SetColor(CColor.INDEX_BACKGROUND,this.m_backColor);CColor.SetColor(CColor.INDEX_POPUPBKGND,CColor.RGB(255,255,255));CColor.SetColor(CColor.INDEX_FRAMEFACE,CColor.RGB(52,52,52));CColor.SetColor(CColor.INDEX_FRAMEFACE_GR,CColor.RGB(32,32,32));CColor.SetColor(CColor.INDEX_FRAME_LT,CColor.RGB(72,72,72));CColor.SetColor(CColor.INDEX_FRAME_RB,CColor.RGB(42,42,42));CColor.SetColor(CColor.INDEX_FRAMETEXT,12105912);CColor.SetColor(CColor.INDEX_CONTROLTEXT,5197647);CColor.SetColor(CColor.INDEX_CONTROL_LT,14277081);CColor.SetColor(CColor.INDEX_CONTROL_RB,11184810);CColor.SetColor(CColor.INDEX_CONTROLFACE,13027014);CColor.SetColor(CColor.INDEX_CONTROLFACE_FOCUS,13027014);CColor.SetColor(CColor.INDEX_CONTROLFACE_DOWN,7171437);CColor.SetColor(CColor.INDEX_CONTROLFACE_GRAY,14277081);CColor.SetColor(CColor.INDEX_CONTROLFACE_LIGHT,16777215);CColor.SetColor(CColor.INDEX_CONTROLBORDER,6710886);CColor.SetColor(CColor.INDEX_PROGRESS,16777215);CColor.SetColor(CColor.INDEX_PROGRESS_GR,16777215);CColor.SetColor(CColor.INDEX_PROGRESS_SHADOW,11776947);CColor.SetColor(CColor.INDEX_PROGRESS_SHADOW_GR,11776947);this.BuildResourceText("lang.xml");this.m_resMgr.AddMenuList(new menu);this.m_main.CreateBoard()}},setMove:function(t){if(this.m_main)this.m_main.SetMove(t)},showNumber:function(t){if(this.m_main)this.m_main.ShowNumber(t)},setReviewMode:function(t){if(this.m_main)this.m_main.SetReviewMode(t)},setReferMode:function(t){if(this.m_main)this.m_main.SetReferMode(t)},resetReviewRefer:function(){if(this.m_main)this.m_main.ResetReviewRefer()},setTool:function(t){if(this.m_main)this.m_main.SetTool(t)},setResolution:function(t){var e=this.m_screen.m_canvas;if(e){this.m_rScale=t;var i=e.width/t;var n=e.height/t;e.style.width=i.toString()+"px";e.style.height=n.toString()+"px"}},openBoard:function(t,e){if(this.m_main)this.m_main.OpenBoard(t,e)},newBoard:function(t,e){if(this.m_main)this.m_main.NewBoard(t,e)},saveBoard:function(t){if(this.m_main)return this.m_main.SaveBoard(t);else return""},setDocument:function(t){if(this.m_main)this.m_main.SetDocument(t)},resizeBoard:function(t,e){this.Resize(t,e);this.ResizeStage();if(this.m_main)this.m_main.ResizeBoard()},showMenu:function(t){if(this.m_main)this.m_main.ShowMenu(t)},showCoord:function(t){if(this.m_main)this.m_main.ShowCoord(t)},showTerritory:function(t,e){if(this.m_main)this.m_main.ShowTerritory(t,e)},setAIPath:function(t){this.m_aiUrl=t},setBackgroundColor:function(t,e,i){this.m_backColor=CColor.RGB(t,e,i);CColor.SetColor(CColor.INDEX_DEFAULTSTAGE,this.m_backColor);CColor.SetColor(CColor.INDEX_BACKGROUND,this.m_backColor);var n=this.GetCurrentStage();if(n)n.Invalidate()},setExplainCallBack:function(t){if(t==undefined)t=null;this.m_fnCallBack=t}});var CEditorStage=vx.stage.extend({init:function(){this._super();this.m_editor=null;this.m_sgf=null;this.m_bCommentator=false;this.m_line=-1;this.m_rule=-1;this.m_bShowMenu=false;this.m_bShowCoord=false},Delete:function(){this.m_sgf=null;this.m_editor=null;this._super()},ResetContent:function(){},OnCreate:function(){if(!this._super())return false;return true},CreateBoard:function(){CMyGlobal.gIcon=this.FindImage("icon.png");this.m_editor=new CGoEditor;this.m_editor.CreateP(this,this.GetStageRect(),CDefine.VXID_NONE,CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED,0,null);this.m_editor.ShowMenu(this.m_bShowMenu);this.m_editor.ShowCoord(this.m_bShowCoord);if(this.m_sgf){this.m_editor.OpenBoard(this.m_sgf,this.m_bCommentator);this.m_sgf=null}else if(this.m_line!=-1&&this.m_rule!=-1){this.m_editor.NewBoard(this.m_line,this.m_rule)}},PlaySoundEx:function(t,e){this.PlaySound(t)},SetMove:function(t){if(this.m_editor)this.m_editor.SetMove(t)},ShowNumber:function(t){if(this.m_editor)this.m_editor.ShowNumber(t)},SetReviewMode:function(t){if(this.m_editor)this.m_editor.SetReviewMode(t)},SetReferMode:function(t){if(this.m_editor)this.m_editor.SetReferMode(t)},ResetReviewRefer:function(){if(this.m_editor)this.m_editor.ResetReviewRefer()},SetTool:function(t){if(this.m_editor)this.m_editor.SetTool(t)},OpenBoard:function(t,e){this.m_bCommentator=e;if(this.m_editor)this.m_editor.OpenBoard(t,e);else this.m_sgf=t},NewBoard:function(t,e){if(t==undefined)t=19;if(e==undefined)e=0;if(this.m_editor){this.m_editor.NewBoard(t,e)}else{this.m_line=t;this.m_rule=e}},SaveBoard:function(t){if(this.m_editor)return this.m_editor.SaveBoard(t);else return""},SetDocument:function(t){if(this.m_editor)this.m_editor.SetDocument(t)},ResizeBoard:function(){if(this.m_editor)this.m_editor.Resize()},ShowMenu:function(t){if(this.m_editor)this.m_editor.ShowMenu(t);else this.m_bShowMenu=t},ShowCoord:function(t){if(this.m_editor)this.m_editor.ShowCoord(t);else this.m_bShowCoord=t},ShowTerritory:function(t,e){if(this.m_editor)this.m_editor.ShowTerritory(t,e)}});var CGoEditor=vx.object.extend({init:function(){this._super();this.m_gboard=new CBoard;this.m_gmenu=new CBoardMenu(true);this.m_boxInfo=null;this.m_idxTerri=0;this.MENU_H=32;this.m_fnCallBackTerri=null},Delete:function(){this.m_fnCallBackTerri=null;this.m_boxInfo=null;this.m_gmenu=null;this.m_gboard=null;this._super()},ResetContent:function(){},OnCreate:function(){if(!this._super())return false;var t=CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED;var e=this.GetClientRect();this.m_gboard.CreateP(this.m_stage,e,CDefine.VXID_NONE,t,0,this);this.m_gmenu.Init(this.m_gboard);e.top=e.bottom-this.MENU_H;t=CFlags.STATUS_ENABLED;var i=e.Clone();i.right=i.left+153;CMyGlobal.CreateArrowButton(this,i,t|CFlags.STATUS_TRANS,false,true);i.Set(e);i.left=i.right-60;i.Deflate(0,2);var n;n=this.CreateMenuButton(i,CMyDefine.IDC_BTN_COORD,"BT_COORD",true);n.ModifyFlagEx(CFlags.VXBUTTON_USECHECK,0);n.SetCheck(true);this.CreateMenuButton(i,CMyDefine.IDC_BTN_SUSUN,"BT_ORDER",true);n=this.CreateMenuButton(i,CMyDefine.IDC_BTN_REVIEW,"BT_REVIEW",true);n.ModifyFlagEx(CFlags.VXBUTTON_USECHECK,0);n=this.CreateMenuButton(i,CMyDefine.IDC_BTN_TERRI,"BT_TERRI",true);n.ModifyFlagEx(CFlags.VXBUTTON_USECHECK,0);return true},OnDraw:function(t,e){},EventSync:function(t,e,i,n){if(t==CDefine.CMD_VXBUTTON_CLICK){var s;switch(e){case CMyDefine.IDC_BTN_SUSUN:this.m_gboard.ShowNumber();break;case CMyDefine.IDC_BTN_COORD:this.m_gboard.ShowCoord(n.GetCheck());break;case CMyDefine.IDC_BTN_REVIEW:s=n.GetCheck();this.m_gboard.SetReviewMode(s);CMyGlobal.ShowArrowButton(this,!s);this.m_gmenu.ResetTool();this.m_gmenu.ShowMenu(s);break;case CMyDefine.IDC_BTN_REFER:s=n.GetCheck();this.m_gboard.SetReferMode(s);CMyGlobal.ShowArrowButton(this,!s);this.m_gmenu.ResetTool();this.m_gmenu.ShowMenu(s);break;case CMyDefine.IDC_BTN_MENU:{var r=n.GetObjectRect();var a=new vx.menu(0,CFlags.VXBOX_BORDERFLAT|CFlags.VXMENU_USESAHDOW|CFlags.VXMENU_WANTCLOSEEVENT,"icon_title.png","shadow.png");a.SetMenuProperty(30,0,15,0);a.SetBackColor(16777215,CColor.RGB(108,108,108),0,0);a.SetTextColor(0,16777215,16777215,4294967295,4294967295);a.SetEdgeColor(16777215,0,16777215,0);a.CreatePopupMenu(menu.IDR_MENU1,0,-1,r.left,r.top,this)}break;case CMyDefine.IDC_BTN_TERRI:if(!n.GetCheck()){this.m_gboard.ShowTerritory(null);if(this.m_boxInfo)this.m_boxInfo.ShowObject(false)}else{var o=this.m_gboard.GetCurrentIndex();if(o<2){n.SetCheck(false);return}if(this.m_idxTerri==o&&this.m_gboard.m_terriPan&&this.m_boxInfo){this.m_gboard.m_terriPan.ShowObject(true);if(!this.m_fnCallBackTerri)this.m_boxInfo.ShowObject(true);return}var l=this.m_gboard.GetStoneString(true);if(l){var _=this.MakeAIUrl(4,l);CRequest.Request(this,_,this.OnRecvAnalyze,-1,"",0);this.m_idxTerri=o}}break;default:CMyGlobal.MoveArrowBoard(this.m_gboard,e);break}}else if(t==CDefine.CMD_VXMENU_CLICK){switch(e){case menu.ID_MENU_SETBACK:this.m_gboard.SetBack();break;case menu.ID_MENU_SKIP:this.m_gboard.Pass();break}}else if(t==CMyDefine.CMD_BOARD_VIEWEXPLAIN){var h=this.GetSkin();if(h&&h.m_fnCallBack)h.m_fnCallBack(e,i,h.m_name)}this._super(t,e,i,n)},CreateMenuButton:function(t,e,i,n){var s=new vx.button;s.CreateP(this.m_stage,t,e,CFlags.STATUS_ENABLED,0,this);s.SetButtonText(this.FindText(i),CDefine.TAGTYPE_SMALL,0,0);if(n){s.m_nHT=0;t.Offset(-61,0)}return s},Resize:function(){var t=this.m_stage.GetStageRect();this.MoveObject(t);if(this.IsFlagEx(CGoEditor.GOEDITOR_SHOWMENU))t.bottom-=this.MENU_H;this.m_gboard.MoveObject(t);this.m_gmenu.Reposition()},ShowButton:function(t){CMyGlobal.ShowArrowButton(this,t);this.ShowControl(CMyDefine.IDC_BTN_COORD,t);this.ShowControl(CMyDefine.IDC_BTN_SUSUN,t);this.ShowControl(CMyDefine.IDC_BTN_TERRI,t);this.ShowControl(CMyDefine.IDC_BTN_REVIEW,t);this.ShowControl(CMyDefine.IDC_BTN_MENU,t);this.ShowControl(CMyDefine.IDC_BTN_REFER,t)},SetEditorMode:function(t){var e=false;btn=this.FindObject(CMyDefine.IDC_BTN_COORD);if(t){if(btn)e=btn.IsFlag(CFlags.STATUS_SHOW);this.ModifyFlagEx(CGoEditor.GOEDITOR_MAKESGF,0);btn=this.FindObject(CMyDefine.IDC_BTN_TERRI);if(btn){btn.ModifyFlagEx(0,CFlags.VXBUTTON_USECHECK);btn.m_nID=CMyDefine.IDC_BTN_MENU;btn.SetButtonText(this.FindText("BT_MENU"),CDefine.TAGTYPE_SMALL,0,0);btn.ShowObject(e)}btn=this.FindObject(CMyDefine.IDC_BTN_REVIEW);if(btn){btn.m_nID=CMyDefine.IDC_BTN_REFER;btn.SetButtonText(this.FindText("BT_REFER"),CDefine.TAGTYPE_SMALL,0,0)}}else{this.ModifyFlagEx(0,CGoEditor.GOEDITOR_MAKESGF);btn=this.FindObject(CMyDefine.IDC_BTN_MENU);if(btn){btn.m_nID=CMyDefine.IDC_BTN_TERRI;btn.SetButtonText(this.FindText("BT_TERRI"),CDefine.TAGTYPE_SMALL,0,0);btn.ModifyFlagEx(CFlags.VXBUTTON_USECHECK,0);btn.ShowObject(false)}if(this.m_gboard.m_nType==CBoard.BOARDTYPE_VIEWER){btn=this.FindObject(CMyDefine.IDC_BTN_REFER);if(btn){btn.m_nID=CMyDefine.IDC_BTN_REVIEW;btn.SetButtonText(this.FindText("BT_REVIEW"),CDefine.TAGTYPE_SMALL,0,0)}}else{btn=this.FindObject(CMyDefine.IDC_BTN_REVIEW);if(btn){btn.m_nID=CMyDefine.IDC_BTN_REFER;btn.SetButtonText(this.FindText("BT_REFER"),CDefine.TAGTYPE_SMALL,0,0)}}}},SetMove:function(t){this.m_gboard.ArrowMove(t)},ShowNumber:function(t){if(this.m_gboard)this.m_gboard.ShowNumber(t)},SetReviewMode:function(t){if(this.m_gboard)this.m_gboard.SetReviewMode(t)},SetReferMode:function(t){if(this.m_gboard)this.m_gboard.SetReferMode(t)},ResetReviewRefer:function(){if(this.m_gboard)this.m_gboard.ResetReviewRefer()},SetTool:function(t){if(this.m_gboard)this.m_gboard.SetTool(t)},ShowMenu:function(t){if(t){if(this.IsFlagEx(CGoEditor.GOEDITOR_SHOWMENU))return;this.ModifyFlagEx(CGoEditor.GOEDITOR_SHOWMENU,0)}else{if(!this.IsFlagEx(CGoEditor.GOEDITOR_SHOWMENU))return;this.ModifyFlagEx(0,CGoEditor.GOEDITOR_SHOWMENU)}this.ShowButton(t);this.Resize()},ShowCoord:function(t){this.m_gboard.ShowCoord(t)},ShowTerritory:function(t,e){if(e==undefined)e=null;this.m_fnCallBackTerri=e;var i=CMyDefine.IDC_BTN_TERRI;var n=this.FindObject(i);if(n){n.SetCheck(t);this.SendMessage(CDefine.CMD_VXBUTTON_CLICK,i,null,n)}},OpenBoard:function(t,e){if(e==undefined)e=false;var i;if(e)i=CBoard.BOARDTYPE_COMMENTATOR;else i=CBoard.BOARDTYPE_VIEWER;this.m_gboard.OpenGame(i,t);this.SetEditorMode(false)},NewBoard:function(t,e){this.m_gboard.NewGame(CBoard.BOARDTYPE_TEACHER,t,e,0,GSGF.TYPE_EMPTY);this.SetEditorMode(true)},SaveBoard:function(t){if(t==undefined)t=false;if(t)return this.m_gboard.SaveCurrentBoard();else return this.m_gboard.SaveGame(true)},SetDocument:function(t){this.m_gboard.DocumentSet(t)},OnRecvAnalyze:function(t,e,i){if(!GSGF.IsValid(this.m_gboard))return;vx.trace("CModalBoard - OnRecvAnalyze : "+t);if(t==CRequest.ERR_OK){var n=this.m_gboard.ShowTerritory(e);this.SetTerritoryInfo(n,e.wzip-e.bzip)}else{this.m_idxTerri=0;var s;if(t==CRequest.ERR_TIMEOUT)s=this.FindText("ERR_WEB_REQ_DELAY");else s="OnRecv Error : "+t;this.MessageBox(null,s,CDefine.MB_OK,this.FindText("INFO"));this.m_gboard.ShowTerritory(null)}},SetTerritoryInfo:function(t,e){if(this.m_fnCallBackTerri){this.m_fnCallBackTerri(t,e,this.GetSkin().m_name);return}if(!this.m_boxInfo){this.m_boxInfo=new CBoxInfo;this.m_boxInfo.CreateP(this.m_stage,this.GetBoxInfoRect(),CDefine.VXID_NONE,CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED|CFlags.STATUS_POPUP,0,this)}this.m_boxInfo.SetInfo(t,e)},GetBoxInfoRect:function(){var t=this.GetObjectRect();t.top=t.bottom-this.MENU_H;return t},OnSize:function(){if(this.m_boxInfo)this.m_boxInfo.MoveObject(this.GetBoxInfoRect());this._super()},MakeAIUrl:function(t,e){var i=String.format("{0}?action={1}&board={2}",this.GetSkin().m_aiUrl,t,e);return i},GetTerritoryText:function(t,e,i){if(e==i){return this.FindText("FMT_TERRITORY_DRAW")}else{t=Math.floor(t/2);e=Math.floor(e/2);i=Math.floor(i/2);var n,s;if(e>i)n=this.FindText("RT_BLACK");else n=this.FindText("RT_WHITE");s=String.format(this.FindText("FMT_TERRITORY_RESULT"),n,t);return s}}});CGoEditor.GOEDITOR_SHOWMENU=1;CGoEditor.GOEDITOR_MAKESGF=2;var CSelectPopup=vx.object.extend({init:function(t,e){this._super();this.m_crBk=t;this.m_crBnd=e;this.SetRound(0,0,0,0);this.m_nBnd=0;this.m_xsum=0;this.m_ymax=0;this.m_ary=new ObArray;this.m_sep=new ObArray},Delete:function(){this.m_ary.RemoveAll();this.m_ary=null;this.m_sep.RemoveAll();this.m_sep=null;this._super()},toString:function(){return"(CSelectPopup)"},OnCreate:function(){if(!this._super())return false;this.ModifyFlag2(0,CFlags.STATUS2_DOMBUFFER);return true},OnDraw:function(t,e){var i=CMyGlobal.gIcon;if(i){var n=CMyGlobal.GetIconRect(28,0);var s=n.Clone();s.Deflate(6,0);i._DrawBox(t,e,s,n,CDefine.BOXFLAG_ALL)}var r,a=this.m_sep.length;for(r=0;r<a;r++){e.left=this.m_nBnd+this.m_sep[r];t.DrawLine(e.left,e.top+2,e.left,e.bottom-2,5132111)}},EventSync:function(t,e,i,n){this._super(t,e,i,n);if(t==CDefine.CMD_VXBUTTON_CLICK){this.SelectButton(n.m_nID);this.m_parent.SendMessage(t,e,i,n)}},ClosePopup:function(){this.m_parent.SetCheck(false);this.ShowObject(false)},OnCancelMode:function(){this.m_parent.PostMessage(CMyDefine.CMD_SELECTPOPUP_CLOSE,0,0,this)},FocusClear:function(){this.m_parent.PostMessage(CMyDefine.CMD_SELECTPOPUP_CLOSE,0,0,this)},AddButton:function(t,e,i){if(i.y>this.m_ymax)this.m_ymax=i.y;var n=new vx.button;var s=CUtil.CRect(this.m_nBnd+this.m_xsum,this.m_nBnd,this.m_nBnd+this.m_xsum+i.x,this.m_nBnd+i.y);n.CreateP(this.m_stage,s,t,CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED|CFlags.STATUS_NOFOCUS|CFlags.STATUS_NOMOUSEMOVE,0,this);n.SetImageEx(CMyGlobal.gIcon,CUtil.MAKEFRAME(2,2,3,2),CMyGlobal.GetIconRect(28,0));n.SetButtonTag(e);this.m_xsum+=i.x;this.m_ary.AddTail(n)},AddSeperator:function(t){this.m_sep.AddTail(this.m_xsum+Math.floor(t/2));this.m_xsum+=t},SelectButton:function(t){var e=null;var i,n,s=this.m_ary.length;for(n=0;n<s;n++){i=this.m_ary[n];if(i.m_nID==t)e=i;else i.SetCheck(false)}if(e)e.SetCheck(true);return e},ShowPopup:function(t){var e=this.m_xsum+this.m_nBnd*2;var i=this.m_ymax+this.m_nBnd*2;var n=this.m_parent.GetObjectRect();switch(t){case 1:n.right=n.left+e;n.bottom=n.top-2;n.top-=i;n.Offset(this.m_nBnd,-this.m_nBnd);break;case 2:n.right=n.left;n.left-=e;n.bottom=n.top+i;n.Offset(-this.m_nBnd,-this.m_nBnd);break;default:n.left=n.right;n.right+=e;n.bottom=n.top+i;n.Offset(this.m_nBnd+2,-this.m_nBnd);break}this.MoveObject(n);this.ShowObject(true);this.SetFocusObject()}});var CSelectButton=vx.button.extend({init:function(t,e,i){this._super();this.m_popup=null;this.m_select=null;this.m_nShowType=0;this.m_crBk=t;this.m_crPress=e;this.m_crBnd=i;this.ModifyFlagEx(CFlags.VXCLICK_DOWNEVENT,0)},Delete:function(){this.m_popup=null;this.m_select=null;this._super()},EventSync:function(t,e,i,n){this._super(t,e,i,n);if(t==CDefine.CMD_VXBUTTON_CLICK){this.EventSync(CMyDefine.CMD_SELECTPOPUP_CLOSE,0,0,this.m_popup);this.m_select=n;this.Invalidate();this.m_parent.SendMessage(t,e,i,n)}else if(t==CMyDefine.CMD_SELECTPOPUP_CLOSE){if(this.m_popup)this.m_popup.ShowObject(false);this.SetCheck(false)}},OnDraw:function(t,e){this._super(t,e);if(this.m_select)this.m_select.m_cTag.Draw(t,e)},DoClick:function(){if(this.m_popup){if(this.IsFlagEx(CFlags.VXBUTTON_CHECK)||this.IsFlagEx(CFlags.VXBUTTON_USECHECK)){this.SetCheck(!this.GetCheck())}if(this.GetCheck())this.m_popup.ShowPopup(this.m_nShowType);else this.m_popup.ShowObject(false)}},AddSubButton:function(t,e,i){if(this.m_popup==null){this.m_popup=new CSelectPopup(this.m_crPress,this.m_crBnd);this.m_popup.Create(this.m_stage,CUtil.CRect(0,0,0,0),CDefine.VXID_NONE,CFlags.STATUS_ENABLED|CFlags.STATUS_POPUP,0,this)}this.m_popup.AddButton(t,e,i)},AddSubSeperator:function(t){if(this.m_popup)this.m_popup.AddSeperator(t)},SelectSubButton:function(t){if(this.m_popup){this.m_select=this.m_popup.SelectButton(t);this.Invalidate()}}});var CBarButton=vx.button.extend({init:function(t,e,i){this._super();this.m_crBk=t;this.m_crBnd=e;this.m_crUnder=i},OnDraw:function(t,e){var i=false;var n,s=4294967295;if(this.IsFlag(CFlags.STATUS_ENABLED)){n=false;if(this.OrFlag2(CFlags.STATUS2_CHECK|CFlags.STATUS2_PRESS)){if(this.IsFlag2(CFlags.STATUS2_PRESS))s=this.m_crBnd;t.FillSolidRect(e,this.m_crBk,s,s);i=true}else if(this.IsFlag2(CFlags.STATUS2_MOUSEOVER)){i=true}if(i&&this.m_crUnder!=4294967295){var r=e.Clone();r.top=r.bottom-2;r.Deflate(2,0);t.FillSolidRect(r,this.m_crUnder,s,s)}}else{n=true}if(n)t.Alpha(.3);this._super(t,e);t.RestoreAlpha()}});var CBoxInfo=vx.static.extend({init:function(){this._super();this.m_nWinner=0;this.m_crTxt=0;this.m_crBk=0},Delete:function(){this._super()},OnCreate:function(){if(!this._super())return false;this.ModifyFlag(CFlags.STATUS_ENABLED,CFlags.STATUS_NOMESSAGE);var t=this.GetClientRect();t.left=t.right-t.Height();t.Deflate(2,2,2,3);var e=new vx.button;e.CreateP(this.m_stage,t,CDefine.VXID_BOXCLOSE,CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED,0,this);e.SetSticker(true,false);e.SetShapeType(CDefine.SHAPE_CLOSE);return true},OnDraw:function(t,e){var i=e.Clone();i.bottom--;t.DrawRectangle(i,this.m_crBk,this.m_crTxt);this._super(t,e)},EventSync:function(t,e,i,n){this._super(t,e,i,n);if(t==CDefine.CMD_VXBUTTON_CLICK){if(e==CDefine.VXID_BOXCLOSE){var s=this.m_parent.FindObject(CMyDefine.IDC_BTN_TERRI);if(s){s.SetCheck(false);this.m_parent.SendMessage(t,CMyDefine.IDC_BTN_TERRI,i,s)}this.ShowObject(false)}}},SetInfo:function(t,e){this.m_nWinner=e;var i=0;var n=16777215;if(e<0){i=16777215;n=4210752}else if(e==0){n=10526880}this.SetText(t,0,CDefine.DT_VCENTER|CDefine.DT_CENTER,i);this.m_crTxt=i;this.m_crBk=n;this.ShowObject(true)}});var GSGF=GSGF||{};GSGF.nDebug=10;GSGF.nInc=0;GSGF.nFail=0;GSGF.nDepth=0;GSGF.bComment=true;GSGF.PLATFORM="Web Tygem";GSGF.TYPE_GAME=0;GSGF.TYPE_EXPLAIN=1;GSGF.TYPE_QUESTION=2;GSGF.TYPE_EMPTY=3;GSGF.CMD_GAMESTONE="G";GSGF.CMD_REFERSTONE="R";GSGF.CMD_ADDSTONE="W";GSGF.CMD_REFERPRESTONE="E";GSGF.CMD_ADDPRESTONE="P";GSGF.CMD_NEXTSTONE="N";GSGF.CMD_SETBACK="B";GSGF.CMD_ADDMARK="X";GSGF.CMD_ERASEMARK="x";GSGF.CMD_ARROWMOVE="M";GSGF.CMD_SETMOVE="H";GSGF.CMD_OPENSGF="O";GSGF.CMD_SAVEREFER="S";GSGF.CMD_ADDSGF="F";GSGF.CMD_REFERMODE_ON="Q";GSGF.CMD_REFERMODE_OFF="q";GSGF.CMD_GEGA_ON="Z";GSGF.CMD_DEADSTONE="K";GSGF.CMD_DEADSTONE_CANCEL="k";GSGF.CMD_DEADSTONE_CONFIRM="C";GSGF.CMD_DEADSTONE_RETRY="c";GSGF.CMD_GEGA_OFF="z";GSGF.CMD_CHOILGGI_CHANGE="T";GSGF.CMD_DOCUMENT_ADD="D";GSGF.CMD_DOCUMENT_DEL="d";GSGF.CMD_DOCUMENT_SET="Y";GSGF.CMD_AUTOGEGA_ADD="A";GSGF.CMD_AUTOGEGA_DEL="a";GSGF.GT_EMPTY=0;GSGF.GT_BLACK=1;GSGF.GT_WHITE=2;GSGF.GT_PRESTONE=3;GSGF.GT_BHOUSE=6;GSGF.GT_WHOUSE=7;GSGF.GT_BLACKRECT=8;GSGF.GT_WHITERECT=9;GSGF.GT_BLACKTERI=10;GSGF.GT_WHITETERI=11;GSGF.GT_LABEL=13;GSGF.GT_CIRCLE=14;GSGF.GT_CROSS=15;GSGF.GT_RECT=16;GSGF.GT_TRIANGLE=17;GSGF.GT_NOTHOUSE=64;GSGF.GT_CHAR_START=65;GSGF.GT_CHAR_END=90;GSGF.GT_RHOUSE=127;GSGF.DEFAULT_BOARD_WIDTH=19;GSGF.GSSTACKMAXNUM=361;GSGF.NEXT_UP=8;GSGF.NEXT_RIGHT=4;GSGF.NEXT_DOWN=2;GSGF.NEXT_LEFT=1;GSGF.BOARD11=[[7,3,3,7],[3,7,3,7]];GSGF.BOARD13=[[9,3,3,9,3,9,6,6,6],[3,9,3,9,6,6,3,9,6]];GSGF.BOARD19=[[15,3,3,15,3,15,9,9,9],[3,15,3,15,9,9,3,15,9]];GSGF.GNODE_MODIFIED=65536;GSGF.GNODE_TEMP=131072;GSGF.GNODE_CURRENT=1;GSGF.GNODE_REFER=2;GSGF.GNODE_GEGA=32;GSGF.GNODE_BCONFIRM=64;GSGF.GNODE_WCONFIRM=128;GSGF.TRAVEL_SELECTALL=1;GSGF.TRAVEL_NODEFLAG=2;GSGF.TRAVEL_RESETTEMP=3;GSGF.IsValid=function(t){return t!=undefined&&t!=null};GSGF.IsValidPos=function(t,e){return t&&t.x>=0&&t.y>=0&&t.x<e&&t.y<e};GSGF.SquareBracket=function(t,e){if(t.pos+1>t.len)return false;var i=t.str.indexOf("[",t.pos);if(i==-1)return false;var n=t.str.indexOf("]",i);if(n==-1)return false;e.token=t.str.substring(t.pos,i);e.nValue=t.str.substring(i+1,n);t.pos=n+1;return true};GSGF.Point=function(t,e){if(t==undefined)t=-1;if(e==undefined)e=-1;var i=new Object;i.x=t;i.y=e;return i};GSGF.PointAscii=function(t){var e=GSGF.Point();var i=t.length;if(i>2){var n=t;t="";for(var s=0;s<i;s++){if(n.charAt(s)==" "||n.charAt(s)=="\t"||n.charAt(s)=="\n"||n.charAt(s)=="\r")continue;t+=n.charAt(s)}i=t.length}if(t.length>=2&&t!="tt"){e.x=t.charCodeAt(0)-97;e.y=t.charCodeAt(1)-97;if(e.x>=19&&e.y>=19){e.x=e.y=-1}}return e};GSGF.AsciiString=function(t){if(!isNaN(t.x)&&!isNaN(t.y)){if(t.x!=-1&&t.y!=-1){var e=String.fromCharCode(t.x+97);e+=String.fromCharCode(t.y+97);return e}}return"tt"};GSGF.StrStone=function(t,e,i){var n;switch(i){case GSGF.GT_EMPTY:n="N[]";return n;case GSGF.GT_BLACK:n="B[";break;case GSGF.GT_WHITE:n="W[";break;case GSGF.GT_PRESTONE:n="P[";break;default:return""}n+=String.fromCharCode(t+97);n+=String.fromCharCode(e+97)+"]";return n};GSGF.PointArrayString=function(t,e){if(e==undefined||e==null)return"";var i,n=e.length;if(n==0)return"";var s=t;for(i=0;i<n;i++)s+="["+GSGF.AsciiString(e[i])+"]";return s};GSGF.PointArrayString2=function(t,e,i){if(e==undefined||e==null)return"";var n,s=e.length;if(s==0)return"";var r=t;for(n=0;n<s;n++)r+="["+GSGF.AsciiString(e[n])+":"+i[n]+"]";return r};GSGF.CharCmd=function(t){var e,i,n=t.length;for(i=0;i<n;i++){e=t.charAt(i);if(e!=" "&&e!="\t"&&e!="\n"&&e!="\r")return e}return null};GSGF.TrimLeft=function(t){var e;var i,n,s=t.length;i=0;for(n=0;n<s;n++){e=t.charAt(n);if(e==" "||e=="\t"||e=="\n"||e=="\r")continue;i=n;break}return t.substr(i)};GSGF.Trim=function(t){var e;var i,n,s,r=t.length;i=0;n=r-1;for(s=0;s<r;s++){e=t.charAt(s);if(e==" "||e=="\t"||e=="\n"||e=="\r")continue;i=s;break}for(s=r-1;s>=0;s--){e=t.charAt(s);if(e==" "||e=="\t")continue;n=s;break}return t.substr(i,n-i+1)};GSGF.TokenLeft=function(t,e){var i=t.indexOf(e);if(i==-1)return"";return t.substr(0,i)};GSGF.TokenRight=function(t,e){var i=t.indexOf(e);if(i==-1)return"";return t.substr(i+1)};GSGF.TokenCenter=function(t,e,i){var n=t.indexOf(e);if(n==-1)return"";var s=t.indexOf(i,n+1);if(s==-1)return"";return t.substring(n+1,s)};GSGF.TokenCenter2=function(t,e,i){var n=e.length;var s=i.length;var r=t.indexOf(e);if(r==-1)return"";var a=t.indexOf(i,r+n);if(a==-1)return"";return t.substring(r+n,a)};GSGF.ClearArray=function(t){if(t==null||t==undefined)return;var e,i=t.length;for(e=0;e<i;e++)t[e]=null;t.splice(0,i)};GSGF.PBuffer=function(t){this.str=t;if(t!=null)this.len=t.length;else this.len=0;this.pos=0};GSGF.BOARDSTRUCT=function(t,e){if(t==undefined)t=-1;if(e==undefined)e=-1;this.x=t;this.y=e;this.nValue=GSGF.GT_EMPTY;this.nSearched=0;this.nNextSearch=GSGF.NEXT_UP;this.nIndex=-1};GSGF.NewBSMatrix=function(t,e){var i,n,s,r=new Array;for(i=0;i<t;i++){s=new Array;for(n=0;n<e;n++)s.push(new GSGF.BOARDSTRUCT(i,n));r.push(s)}return r};GSGF.NewMatrix=function(t,e,i){if(i==undefined)i=null;var n,s,r,a=new Array;for(n=0;n<t;n++){r=new Array;for(s=0;s<e;s++)r.push(i);a.push(r)}return a};GSGF.ClearMatrix=function(t,e){if(e==undefined)e=null;var i,n,s,r=t.length;for(i=0;i<r;i++){s=t[i].length;for(n=0;n<s;n++)t[i][n]=e}return t};GSGF.DeleteMatrix=function(t){var e,i,n,s,r=t.length;for(e=0;e<r;e++){n=t[e];s=n.length;for(i=0;i<s;i++)n[i]=null;n.splice(0,s);t[e]=null}t.splice(0,r)};(function(){var t=false,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;GSGF.Class=function(){};GSGF.Class.extend=function(i){var n=this.prototype;t=true;var s=new this;t=false;for(var r in i){s[r]=typeof i[r]=="function"&&typeof n[r]=="function"&&e.test(i[r])?function(t,e){return function(){var i=this._super;this._super=n[t];var s=e.apply(this,arguments);this._super=i;return s}}(r,i[r]):i[r]}function a(){if(!t&&this.init)this.init.apply(this,arguments)}a.prototype=s;a.prototype.constructor=a;a.extend=arguments.callee;return a}})();var GNode=GSGF.Class.extend({init:function(t){this.m_key=GSGF.nInc;GSGF.nInc++;this.m_str="";this.m_parent=null;this.m_child=null;this.m_sibling=null;this.m_uFlag=0;this.m_nColor=0;this.m_ptPos=null;if(t){var e=new GSGF.PBuffer(t);this.LoadString(e);e.str=null}},toString:function(){return"(GNode)"},Delete:function(){this.Clear();this.m_parent=null;this.m_child=null;this.m_sibling=null},IsIsolate:function(){return!this.m_parent&&!this.m_child&&!this.m_sibling},IsSameProp:function(t,e,i){if(this.m_nColor==i&&this.m_ptPos&&this.m_ptPos.x==t&&this.m_ptPos.y==e)return true;else return false},IsSame:function(t){if(this.m_nColor==t.m_nColor){if(this.m_ptPos==null&&t.m_ptPos==null)return true;else if(this.m_ptPos&&t.m_ptPos&&this.m_ptPos.x==t.m_ptPos.x&&this.m_ptPos.y==t.m_ptPos.y)return true}return false},Clear:function(){if(GSGF.nDebug<1&&this.m_str!=undefined)console.log("Clear",this.m_key,this.m_str);for(var t in this){if(t.length>0&&t.charAt(0)=="_"){if(Array.isArray(this[t]))GSGF.ClearArray(this[t]);this[t]=null}}this.m_str="";this.m_uFlag=0;this.m_nColor=0;this.m_ptPos=null},ClearToken:function(t){if(GSGF.IsValid(this[t])){if(Array.isArray(this[t]))GSGF.ClearArray(this[t]);this[t]=null}},IsFlag:function(t){return(this.m_uFlag&t)==t},OrFlag:function(t){return this.m_uFlag&t},ModifyFlag:function(t,e){this.m_uFlag|=t;this.m_uFlag&=~e},Child:function(t){this.m_child=t;if(t)t.m_parent=this},Sibling:function(t){this.m_sibling=t;if(t)t.m_parent=this},LastChild:function(t){if(!t)return;var e=this;while(e.m_child)e=e.m_child;e.m_child=t;t.m_parent=e},LastSibling:function(t){if(!t)return;var e=this;while(e.m_sibling)e=e.m_sibling;e.m_sibling=t;t.m_parent=e},FindLastChild:function(){var t=this;while(t.m_child)t=t.m_child;return t},FindLastSibling:function(){var t=this;while(t.m_sibling)t=t.m_sibling;return t},SameSiblingMerging:function(){if(!this.m_sibling)return;var t,e,i=this.m_sibling;while(i){if(this.IsSame(i)){t=i;if(t.m_child){if(this.m_child)e=this.m_child;else e=this.AddChild();e.LastSibling(t.m_child);t.m_child=null}t.m_parent.Sibling(t.m_sibling);i=i.m_sibling;console.log("Delete Node",t.m_ptPos.x,t.m_ptPos.y);t.Delete()}else{i=i.m_sibling}}},AddChild:function(t){var e=new GNode;this.Child(e);if(GSGF.IsValid(t)){e.m_str=t;e.ParsingNode()}else{e.ModifyFlag(GSGF.GNODE_MODIFIED,0)}if(GSGF.nDebug<1)console.log(" >",this.m_key,"child",e._key);return e},AddSibling:function(t){var e=new GNode;this.Sibling(e);if(GSGF.IsValid(t)){e.m_str=t;e.ParsingNode()}else{e.ModifyFlag(GSGF.GNODE_MODIFIED,0)}if(GSGF.nDebug<1)console.log("(",this.m_key,"sibling ---\x3e",e._key,")");return e},LoadString:function(t,e){if(e==undefined){e=true;GSGF.nDepth=GSGF.nFail=0}GSGF.nFail++;if(GSGF.nFail>GSGF.nDepth)GSGF.nDepth=GSGF.nFail;var i=false;var n,s=this;while(t.pos<t.len){n=t.str.charAt(t.pos);t.pos++;if(n=="("){if(e)continue;i=false;s.LoadString(t,false);continue}else if(n==")"){if(!s.m_child)s.ParsingNode();break}else if(n==";"){i=true;if(e){e=false;continue}if(s.m_child){s=s.m_child;while(s.m_sibling)s=s.m_sibling;s=s.AddSibling()}else{s.ParsingNode();s=s.AddChild()}continue}if(i)s.m_str+=n}GSGF.nFail--},SaveString:function(t){if(t==undefined){t=true;GSGF.nDepth=GSGF.nFail=0}GSGF.nFail++;if(GSGF.nFail>GSGF.nDepth)GSGF.nDepth=GSGF.nFail;var e,i=this;if(t)e="(";else e="";while(i){if(i.IsBranch()){e+="(;"+i.WriteNode();if(i.m_child)e+=i.m_child.SaveString(false);e+=")";i=i.m_sibling}else{e+=";"+i.WriteNode();i=i.m_child}}if(t)e+=")";GSGF.nFail--;return e},InsertAt:function(){var t=this.m_child;var e=this.AddChild();e.Child(t);return e},RemoveAt:function(){if(this.m_parent==null)return;if(this.IsBranch()){if(this.m_parent.m_child==this)this.m_parent.Child(this.m_child);else this.m_parent.Sibling(this.m_child);if(this.m_child){if(this.m_child.m_sibling){var t=this.m_child.m_sibling;while(t){if(t.m_sibling)t=t.m_sibling;else break}t.Sibling(this.m_sibling)}else{this.m_child.Sibling(this.m_sibling)}}else if(this.m_sibling){this.m_parent.Child(this.m_sibling)}}else{this.m_parent.Child(this.m_child)}this.Delete()},RemoveAll:function(t){if(this.IsBranch()){if(this.m_parent.m_child==this)this.m_parent.Child(this.m_sibling);else this.m_parent.Sibling(this.m_sibling)}else if(this.m_parent){this.m_parent.Child(null)}if(this.m_child){var e=new Array;this.m_child.ListUpChild(e);var i,n=e.length;for(i=n-1;i>=0;i--)e[i].Delete();GSGF.ClearArray(e)}if(t==undefined||t)this.Delete()},RemoveNextAll:function(){var t=new Array;var e,i=this.GetNextChoice(t);for(e=0;e<i;e++){t[e].RemoveAll()}GSGF.ClearArray(t)},ParsingNode:function(){if(GSGF.nDebug<1)console.log(this.m_key,"Parse...",this.m_str);var t=new GSGF.PBuffer(this.m_str);var e=null;var i,n,s,r={};while(GSGF.SquareBracket(t,r)){if(r.token==""){if(e)r.token=e}else{e=r.token}if(r.token=="B"||r.token=="W"){this.m_ptPos=GSGF.PointAscii(r.nValue);if(r.token=="B")this.m_nColor=GSGF.GT_BLACK;else this.m_nColor=GSGF.GT_WHITE}else if(r.token=="CR"||r.token=="MA"||r.token=="TR"||r.token=="SQ"||r.token=="LB"||r.token=="AB"||r.token=="AW"||r.token=="DB"||r.token=="DW"){s="_"+r.token;if(!GSGF.IsValid(this[s]))this[s]=new Array;n=GSGF.PointAscii(r.nValue);this[s].push(n);if(r.token=="LB"){s+="C";if(!GSGF.IsValid(this[s]))this[s]=new Array;i=GSGF.TrimLeft(GSGF.TokenRight(r.nValue,":"));if(i.length==0)i="A";this[s].push(i)}else if(r.token=="AB"||r.token=="AW"){this.m_nColor=GSGF.GT_PRESTONE;if(!this.m_ptPos)this.m_ptPos=GSGF.Point(n.x,n.y)}}else if(r.token=="FL"){this.m_uFlag|=parseInt(r.nValue,16)}else{this["_"+r.token]=r.nValue}}r.nValue=null;r.token=null;t.s=null},WriteNode:function(){if(this.IsFlag(GSGF.GNODE_MODIFIED)){this.ModifyFlag(0,GSGF.GNODE_MODIFIED);this.m_str="";switch(this.m_nColor){case GSGF.GT_BLACK:this.m_str="B["+GSGF.AsciiString(this.m_ptPos)+"]";break;case GSGF.GT_WHITE:this.m_str="W["+GSGF.AsciiString(this.m_ptPos)+"]";break;case GSGF.GT_PRESTONE:if(GSGF.IsValid(this._AB))this.m_str+=GSGF.PointArrayString("AB",this._AB);if(GSGF.IsValid(this._AW))this.m_str+=GSGF.PointArrayString("AW",this._AW);break;case GSGF.GT_EMPTY:if(this.m_parent)this.m_str="N[]";break}if(this.m_str!=""||this.m_parent==null){var t;for(var e in this){if(e.length>0&&e.charAt(0)=="_"&&e!="_AB"&&e!="_AW"&&e!="_LBC"){if(e.toUpperCase()==e&&GSGF.IsValid(this[e])){if(Array.isArray(this[e])){if(e=="_LB")this.m_str+=GSGF.PointArrayString2(e.substr(1),this[e],this["_LBC"]);else this.m_str+=GSGF.PointArrayString(e.substr(1),this[e])}else{if(e=="_C"&&!GSGF.bComment)continue;t=this[e];if(GSGF.IsValid(t)){this.m_str+=e.substr(1)+"["+t+"]"}}}}}var i=this.m_uFlag&4095;if(i){this.m_str+="FL["+i.toString(16)+"]"}}}return this.m_str},OnTravel:function(t,e,i){if(GSGF.nDebug<1)console.log("OnTravel",this.m_key,this.m_str);if(t==GSGF.TRAVEL_NODEFLAG){if(this.m_uFlag&15){if(this.m_uFlag&GSGF.GNODE_CURRENT){e.m_viewNode=e.m_curNode=this}if(this.m_uFlag&GSGF.GNODE_REFER){e.m_refNode=this}this.m_uFlag&=~15;this.m_uFlag|=GSGF.GNODE_MODIFIED}}else if(t==GSGF.TRAVEL_RESETTEMP){if(this.m_uFlag&GSGF.GNODE_TEMP){this.m_uFlag&=~GSGF.GNODE_TEMP;this.m_uFlag|=GSGF.GNODE_MODIFIED}}else if(t==GSGF.TRAVEL_SELECTALL){if(GSGF.IsValid(i))i.push(this)}},IsBranch:function(){return this.m_sibling||this.m_parent&&this.m_parent.m_sibling==this},IsSibling:function(){return this.m_parent&&this.m_parent.m_sibling==this},IsRoot:function(){return!this.m_parent&&!this.m_sibling},IsLast:function(){return!this.m_child},IsFail:function(){return GSGF.nFail},IsMainLine:function(){var t=this;while(t){if(t.IsSibling())return false;t=t.m_parent}return true},GetDepth:function(){return GSGF.nDepth},GetParent:function(){var t=this;while(t){if(!t.IsSibling())return t.m_parent;t=t.m_parent}return null},GetRoot:function(){var t,e=this;while(e){t=e.GetParent();if(t==null)return e;e=t}return e},GetRootDepth:function(){var t=0;var e,i=this;while(i){if(i.m_nColor==GSGF.GT_BLACK||i.m_nColor==GSGF.GT_WHITE)t++;e=i.GetParent();if(e==null)return t;i=e}return t},GetNextChoice:function(t){GSGF.ClearArray(t);var e=this.m_child;while(e){t.push(e);e=e.m_sibling}return t.length},Travel:function(t,e,i){var n=this;while(n){n.OnTravel(t,e,i);if(n.IsBranch()){if(n.m_child)n.m_child.Travel(t,e,i);n=n.m_sibling}else{n=n.m_child}}},Navigate:function(t,e,i){var n=this;while(n){t(n,e,i);if(n.IsBranch()){if(n.m_child)n.m_child.Navigate(t,e,i);n=n.m_sibling}else{n=n.m_child}}},ListUpChild:function(t,e){if(e==undefined||e)GSGF.ClearArray(t);var i=this;while(i){t.push(i);if(i.IsBranch()){if(i.m_child)i.m_child.ListUpChild(t,false);i=i.m_sibling}else{i=i.m_child}}},ListUpParent:function(t,e){if(e==undefined||e)GSGF.ClearArray(t);var i,n=this;while(n){t.splice(0,0,n);if(n.IsBranch()){i=n;n=n.m_parent;while(n){if(n.IsBranch()&&n.m_child!=i){i=n;n=n.m_parent}else break}}else{n=n.m_parent}}},LineUp:function(t,e){if(e==undefined||e)GSGF.ClearArray(t);if(this.IsRoot())t.push(this);else this.ListUpParent(t,false);var i=this.m_child;while(i){t.push(i);i=i.m_child}},LastAll:function(t,e){if(e==undefined||e)GSGF.ClearArray(t);var i=this;while(i){if(i.m_child==null)t.push(i);if(i.IsBranch()){if(i.m_child)i.m_child.LastAll(t,false);i=i.m_sibling}else{i=i.m_child}}},KindAll:function(t){GSGF.ClearArray(t);if(!this.IsRoot())return;var e=new Array;this.LastAll(e);var i,n=e.length;for(i=0;i<n;i++){e[i].LineUp(t,false)}},FindByKey:function(t){var e,i=this;while(i){if(i.m_key==t)return i;if(i.IsBranch()){if(i.m_child){e=i.m_child.FindByKey(t);if(e)return e}i=i.m_sibling}else{i=i.m_child}}return null}});var CRuleBoard=GSGF.Class.extend({init:function(){this.m_nLineCount=GSGF.DEFAULT_BOARD_WIDTH;this.m_mtBS=null;this.m_mtShape=null;this.m_szDead=GSGF.Point(0,0);this.m_ptPae=GSGF.Point(-1,-1);this.m_ptLast=GSGF.Point(-1,-1);this.m_nNextColor=GSGF.GT_EMPTY;this.m_nStoneIndex=0;this.m_nShapeCount=0;this.m_nNextCode=GSGF.GT_CHAR_START;this.owner=0;this.gs_top=0;this.gs_node=new Array},toString:function(){return"(CRuleBoard)"},Delete:function(){this.m_ptPae=null;this.m_ptLast=null;this.m_szDead=null;if(this.gs_node){GSGF.ClearArray(this.gs_node);this.gs_node=null}if(this.m_mtBS){GSGF.DeleteMatrix(this.m_mtBS);this.m_mtBS=null}if(this.m_mtShape){GSGF.DeleteMatrix(this.m_mtShape);this.m_mtShape=null}},GetAt:function(t,e){if(this.m_mtBS)return this.m_mtBS[t][e].nValue;else return 0},SetAt:function(t,e,i){if(this.m_mtBS)this.m_mtBS[t][e].nValue=i},GetShapeAt:function(t,e){if(this.m_mtShape)return this.m_mtShape[t][e];else return 0},SetShapeAt:function(t,e,i){if(this.m_mtShape){this.m_mtShape[t][e]=i;this.m_nShapeCount++}},GenerateMark:function(t){this.gt_resetshape();this.m_nNextCode=GSGF.GT_CHAR_START;var e,i,n,s,r,a;e=t["_CR"];if(GSGF.IsValid(e)){r=e.length;for(s=0;s<r;s++){a=e[s];this.m_mtShape[a.x][a.y]=GSGF.GT_CIRCLE;this.m_nShapeCount++}}e=t["_MA"];if(GSGF.IsValid(e)){r=e.length;for(s=0;s<r;s++){a=e[s];this.m_mtShape[a.x][a.y]=GSGF.GT_CROSS;this.m_nShapeCount++}}e=t["_TR"];if(GSGF.IsValid(e)){r=e.length;for(s=0;s<r;s++){a=e[s];this.m_mtShape[a.x][a.y]=GSGF.GT_TRIANGLE;this.m_nShapeCount++}}e=t["_SQ"];if(GSGF.IsValid(e)){r=e.length;for(s=0;s<r;s++){a=e[s];this.m_mtShape[a.x][a.y]=GSGF.GT_RECT;this.m_nShapeCount++}}e=t["_LB"];i=t["_LBC"];if(GSGF.IsValid(e)&&GSGF.IsValid(i)){var o;this.m_nNextCode=GSGF.GT_CHAR_START;r=e.length;for(s=0;s<r;s++){a=e[s];n=i[s];o=n.charCodeAt(0);if(this.m_nNextCode<=o)this.m_nNextCode=o+1;this.m_mtShape[a.x][a.y]=o;this.m_nShapeCount++}}var l=t["_AG"];if(GSGF.IsValid(l)){var r=l.length;var _,h=0;var f,C,m=this.m_nLineCount;if(r==m*m){for(C=0;C<m;C++){for(f=0;f<m;f++){switch(Number(l.charAt(h))){case 1:_=GSGF.GT_BHOUSE;break;case 2:_=GSGF.GT_WHOUSE;break;default:_=0}this.m_mtShape[f][C]=_;this.m_nShapeCount++;h++}}}}},gs_push:function(t){if(this.gs_top==GSGF.GSSTACKMAXNUM)return false;this.gs_node[this.gs_top]=t;this.gs_top++;return true},gs_pop:function(){if(this.gs_top==0)return null;var t=this.gs_node[this.gs_top-1];this.gs_top--;return t},gs_gettop:function(){if(this.gs_top==0)return null;return this.gs_node[this.gs_top-1]},gs_getnum:function(){return this.gs_top},gs_clear:function(){this.gs_top=0},gt_initialize:function(){this.m_nStoneIndex=0;var t=this.m_nLineCount;var e=this.m_mtBS;for(var i=0;i<t;i++){for(var n=0;n<t;n++){e[i][n].nValue=GSGF.GT_EMPTY;e[i][n].x=i;e[i][n].y=n;e[i][n].nSearched=0;e[i][n].nNextSearch=GSGF.NEXT_UP;e[i][n].nIndex=-1}}},gt_resetdata:function(){var t=this.m_nLineCount;var e=this.m_mtBS;for(var i=0;i<t;i++){for(var n=0;n<t;n++){e[i][n].nSearched=0;e[i][n].nNextSearch=GSGF.NEXT_UP}}},gt_resetshape:function(){this.m_nShapeCount=0;var t=this.m_nLineCount;var e=this.m_mtShape;for(var i=0;i<t;i++){for(var n=0;n<t;n++){e[i][n]=0}}},gt_gethousegroupnum:function(t,e){var i,n,s,r,a,o,l,_,h;var f=this.m_nLineCount;_=this.m_mtBS;h=this.m_mtShape;s=r=a=0;o=_[t][e].nValue;this.gs_clear();this.gs_push(_[t][e]);while(this.gs_getnum()){i=this.gs_gettop();i.nSearched=1;l=false;while(i.nNextSearch){n=this.gt_neighborstone(i.nNextSearch,i.x,i.y);i.nNextSearch>>=1;if(n!=null){if(n.nValue==o&&n.nSearched==0){this.gs_push(n);l=true;break}else if(n.nValue==GSGF.GT_BLACK&&n.nSearched==0){++a}else if(n.nValue==GSGF.GT_WHITE&&n.nSearched==0){++r}}}if(!l){i=this.gs_pop();++s;if(i){h[i.x][i.y]=GSGF.GT_RHOUSE}}}if(a!=0&&r==0)this.owner=GSGF.GT_BLACK;else if(a==0&&r!=0)this.owner=GSGF.GT_WHITE;else this.owner=GSGF.GT_EMPTY;for(e=0;e<f;++e){for(t=0;t<f;++t){if(h[t][e]==GSGF.GT_RHOUSE){if(this.owner==GSGF.GT_EMPTY){h[t][e]=GSGF.GT_EMPTY}else if(this.owner==GSGF.GT_BLACK){h[t][e]=GSGF.GT_BHOUSE;this.m_nShapeCount++}else if(this.owner==GSGF.GT_WHITE){h[t][e]=GSGF.GT_WHOUSE;this.m_nShapeCount++}}}}return s},gt_addstone:function(t,e,i,n,s,r){if(r==undefined)r=0;var a,o,l,_,h,f,C,m,u,T,S;u=true;T=this.m_mtBS;S=this.m_nLineCount;f=C=-1;m=_=h=0;if(GSGF.nDebug<1)console.log("addstone ",t,e,i);if(t==-1&&e==-1){this.m_nStoneIndex++;s.x=-1;s.y=-1;return true}if(r!=2&&(T[t][e].nValue==GSGF.GT_BLACK||T[t][e].nValue==GSGF.GT_WHITE))return false;T[t][e].nValue=i;if(r==1)return u;l=GSGF.NEXT_UP;while(l){o=this.gt_neighborstone(l,t,e);l>>=1;if(o!=null){if(o.nValue!=T[t][e].nValue&&((o.nValue==GSGF.GT_BLACK||o.nValue==GSGF.GT_WHITE)&&(T[t][e].nValue==GSGF.GT_BLACK||T[t][e].nValue==GSGF.GT_WHITE))){a=this.gt_getstonegroupstate(o.x,o.y);if(a==0){_+=this.gt_deletestonegroup(o.x,o.y);f=o.x;C=o.y;if(i==GSGF.GT_BLACK)n.y+=_;else if(i==GSGF.GT_WHITE)n.x+=_;m+=_;_=0}}}}if(m==0){a=this.gt_getstonegroupstate(t,e);if(a==0){T[t][e].nValue=GSGF.GT_EMPTY;u=false}else{s.x=-1;s.y=-1}}else if(m==1){h=this.gt_getstonegroupnum(t,e);a=this.gt_getstonegroupstate(t,e);if(h==1&&a==1){s.x=f;s.y=C}else{s.x=-1;s.y=-1}}else{s.x=-1;s.y=-1}if(u){this.m_nStoneIndex++;if(t!=-1&&e!=-1)T[t][e].nIndex=this.m_nStoneIndex}return u},gt_gethouse:function(t){var e,i,n,s,r,a;this.gt_resetdata();s=this.m_mtBS;a=this.m_nLineCount;e=i=0;for(var o=0;o<a;++o){for(var l=0;l<a;++l){if(s[l][o].nValue==GSGF.GT_EMPTY&&s[l][o].nSearched==0){n=this.gt_gethousegroupnum(l,o);switch(this.owner){case GSGF.GT_BLACK:e+=n;break;case GSGF.GT_WHITE:i+=n;break;default:break}}}}t.x=e;t.y=i;return true},gt_deletestonegroup:function(t,e){var i=this.m_mtBS;var n,s,r,a,o;r=0;a=i[t][e].nValue;this.gt_resetdata();this.gs_clear();this.gs_push(i[t][e]);while(this.gs_getnum()){n=this.gs_gettop();n.nSearched=1;o=false;while(n.nNextSearch){s=this.gt_neighborstone(n.nNextSearch,n.x,n.y);n.nNextSearch>>=1;if(s!=null){if(s.nValue==a&&s.nSearched==0){this.gs_push(s);o=true;break}else if(s.nValue==GSGF.GT_EMPTY&&s.nSearched==0){s.nSearched=1}}}if(!o){n.nValue=GSGF.GT_EMPTY;n=this.gs_pop();++r}}return r},gt_deletestonegroups:function(t,e){var i=this.m_mtBS;var n,s,r,a,o;r=0;a=i[t][e].nValue;this.gt_resetdata();this.gs_clear();this.gs_push(i[t][e]);while(this.gs_getnum()){n=this.gs_gettop();n.nSearched=1;o=false;while(n.nNextSearch){s=this.gt_neighborstone(n.nNextSearch,n.x,n.y);n.nNextSearch>>=1;if(s!=null){if((s.nValue==a||s.nValue==GSGF.GT_EMPTY)&&s.nSearched==0){this.gs_push(s);o=true;break}else if(s.nSearched==0){s.nSearched=1}}}if(!o){if(n.nValue!=GSGF.GT_EMPTY)++r;n.nValue=GSGF.GT_EMPTY;n=this.gs_pop()}}return r},gt_getstonegroupnum:function(t,e){var i=this.m_mtBS;var n,s,r,a,o;r=0;a=i[t][e].nValue;this.gt_resetdata();this.gs_clear();this.gs_push(i[t][e]);while(this.gs_getnum()){n=this.gs_gettop();n.nSearched=1;o=false;while(n.nNextSearch){s=this.gt_neighborstone(n.nNextSearch,n.x,n.y);n.nNextSearch>>=1;if(s!=null){if(s.nValue==a&&s.nSearched==0){this.gs_push(s);o=true;break}else if(s.nValue==GSGF.GT_EMPTY&&s.nSearched==0){s.nSearched=1}}}if(!o){n=this.gs_pop();++r}}return r},gt_getstonegroupstate:function(t,e){var i=this.m_mtBS;var n,s,r,a,o;r=0;a=i[t][e].nValue;this.gt_resetdata();this.gs_clear();this.gs_push(i[t][e]);while(this.gs_getnum()){n=this.gs_gettop();n.nSearched=1;o=false;while(n.nNextSearch){s=this.gt_neighborstone(n.nNextSearch,n.x,n.y);n.nNextSearch>>=1;if(s!=null){if(s.nValue==a&&s.nSearched==0){this.gs_push(s);o=true;break}else if(s.nValue==GSGF.GT_EMPTY&&s.nSearched==0){++r;s.nSearched=1}}}if(!o){n=this.gs_pop()}}return r},gt_neighborstone:function(t,e,i){var n=this.m_nLineCount;var s=this.m_mtBS;var r=null;switch(t){case GSGF.NEXT_UP:if(i>0)--i;else break;r=s[e][i];break;case GSGF.NEXT_RIGHT:if(e<n-1)++e;else break;r=s[e][i];break;case GSGF.NEXT_DOWN:if(i<n-1)++i;else break;r=s[e][i];break;case GSGF.NEXT_LEFT:if(e>0)--e;else break;r=s[e][i];break;default:break}return r},gt_getdeletestonegroup:function(t,e,i){var n=this.m_mtBS;var s=this.m_mtShape;var r,a,o,l;o=n[t][e].nValue;this.gt_resetdata();this.gs_clear();this.gs_push(n[t][e]);while(this.gs_getnum()){r=this.gs_gettop();r.nSearched=1;l=false;while(r.nNextSearch){a=this.gt_neighborstone(r.nNextSearch,r.x,r.y);r.nNextSearch>>=1;if(a!=null){if(a.nValue==o&&a.nSearched==0){this.gs_push(a);l=true;break}else if(a.nValue==GSGF.GT_EMPTY&&a.nSearched==0){a.nSearched=1}}}if(!l){s[r.x][r.y]=i;r=this.gs_pop()}}},gt_getdeletestonegroups:function(t,e,i){var n=this.m_mtBS;var s=this.m_mtShape;var r,a,o,l;o=n[t][e].nValue;this.gt_resetdata();this.gs_clear();this.gs_push(n[t][e]);while(this.gs_getnum()){r=this.gs_gettop();r.nSearched=1;l=false;while(r.nNextSearch){a=this.gt_neighborstone(r.nNextSearch,r.x,r.y);r.nNextSearch>>=1;if(a!=null){if((a.nValue==o||a.nValue==GSGF.GT_EMPTY)&&a.nSearched==0){this.gs_push(a);l=true;break}else if(a.nSearched==0){a.nSearched=1}}}if(!l){if(s[r.x][r.y]!=GSGF.GT_NOTHOUSE)s[r.x][r.y]=i;this.m_nShapeCount++;r=this.gs_pop()}}},ResetBoardMatrix:function(t){if(t==undefined)t=this.m_nLineCount;this.m_szDead.x=this.m_szDead.y=0;this.m_ptPae.x=this.m_ptPae.y=-1;this.m_ptLast.x=this.m_ptLast.y=-1;this.m_nNextColor=GSGF.GT_EMPTY;if(this.m_nLineCount!=t){if(this.m_mtBS){GSGF.DeleteMatrix(this.m_mtBS);this.m_mtBS=null}if(this.m_mtShape){GSGF.DeleteMatrix(this.m_mtShape);this.m_mtShape=null}this.m_nLineCount=t}if(!this.m_mtBS)this.m_mtBS=GSGF.NewBSMatrix(this.m_nLineCount,this.m_nLineCount);if(!this.m_mtShape)this.m_mtShape=GSGF.NewMatrix(this.m_nLineCount,this.m_nLineCount,0);this.gs_clear();this.gt_initialize();this.gt_resetshape()},PutStone:function(t,e,i,n){if(t==-1&&e==-1){if(GSGF.nDebug<1)console.log(i,"---\x3e Pass!")}else{if(t==this.m_ptPae.x&&e==this.m_ptPae.y){if(GSGF.nDebug<1)console.log(i,":",t,e,"---\x3e Pae!");return false}else if(t<0||t>=this.m_nLineCount||e<0||e>=this.m_nLineCount){if(GSGF.nDebug<1)console.log(i,":",t,e,"---\x3e Invalid position!");return false}}if(this.gt_addstone(t,e,i,this.m_szDead,this.m_ptPae,n)){if(n!=1){this.m_ptLast.x=t;this.m_ptLast.y=e;this.m_nNextColor=i%2+1}return true}return false},MarkDeadStone:function(t,e,i){if(this.GetAt(t,e)==i){if(i==GSGF.GT_BLACK)this.gt_getdeletestonegroups(t,e,GSGF.GT_WHITERECT);else this.gt_getdeletestonegroups(t,e,GSGF.GT_BLACKRECT);return true}return false},DeleteDeadStone:function(t,e){var i=this.m_mtBS;var n=i[t][e].nValue;var s=this.gt_deletestonegroups(t,e);if(n==GSGF.GT_BLACK)this.m_szDead.x+=s;else if(n==GSGF.GT_WHITE)this.m_szDead.y+=s}});var CRuleSGF=GNode.extend({init:function(t){this._super(t);this.m_bViewSync=true;this.m_nLine=GSGF.DEFAULT_BOARD_WIDTH;this.m_nRule=0;this.m_nDum=0;this.m_nType=0;this.m_nTimeStatusW=0;this.m_nTimeStatusB=0;this.m_aryTmp=new Array;this.m_viewNode=this.m_curNode=this.m_putNode=this;this.m_refNode=null;this.m_pboard=new CRuleBoard;this.m_cboard=new CRuleBoard;this.m_vboard=new CRuleBoard},toString:function(){return"(CRuleSGF)"},Delete:function(){this.m_refNode=this.m_viewNode=this.m_curNode=this.m_putNode=null;if(this.m_pboard){this.m_pboard.Delete();this.m_pboard=null}if(this.m_cboard){this.m_cboard.Delete();this.m_cboard=null}if(this.m_vboard){this.m_vboard.Delete();this.m_vboard=null}if(this.m_aryTmp){GSGF.ClearArray(this.m_aryTmp);this.m_aryTmp=null}this.RemoveAll(false);this._super()},ResetContent:function(){this.m_bViewSync=true;if(this.m_pboard){this.m_pboard.Delete();this.m_pboard=null}if(this.m_cboard){this.m_cboard.Delete();this.m_cboard=null}if(this.m_vboard){this.m_vboard.Delete();this.m_vboard=null}if(this.m_aryTmp){GSGF.ClearArray(this.m_aryTmp)}this.RemoveAll(false);this.Clear();this.m_parent=null;this.m_child=null;this.m_sibling=null;this.m_viewNode=this.m_curNode=this.m_putNode=this;this.m_refNode=null;this.m_pboard=new CRuleBoard;this.m_cboard=new CRuleBoard;this.m_vboard=new CRuleBoard;this.m_nLine=GSGF.DEFAULT_BOARD_WIDTH;this.m_nRule=0;this.m_nDum=0;this.m_nType=0;this.m_nTimeStatusW=0;this.m_nTimeStatusB=0},SetSingleBoard:function(){if(this.m_cboard){this.m_cboard.Delete();this.m_cboard=null}if(this.m_vboard){this.m_vboard.Delete();this.m_vboard=null}this.m_cboard=this.m_vboard=this.m_pboard},NewBoard:function(t,e,i,n){if(t==undefined)t=GSGF.DEFAULT_BOARD_WIDTH;if(this.m_str!="")this.ResetContent();this.ResetSGFMatrix(t);this.ModifyFlag(GSGF.GNODE_MODIFIED,0);this["_AP"]=GSGF.PLATFORM;if(n==undefined)n=GSGF.TYPE_GAME;this["_TP"]=n;var s=null;if(t<11){t=9;e=0}else if(t<13){t=11;s=GSGF.BOARD11;if(e>4)e=4}else if(t<19){t=13;s=GSGF.BOARD13;if(e>9)e=9}else{t=19;s=GSGF.BOARD19;if(e>9)e=9}this.m_nType=n;this.m_nRule=e;this.m_nDum=0;this.m_nLine=t;if(e==0){if(i==undefined)i=65;this.m_nDum=i}else{if(i!=undefined)this.m_nDum=i}this["_SZ"]=t;this["_RU"]=e;this["_DUM"]=this.m_nDum;if(e>=2&&s){this.m_nColor=GSGF.GT_PRESTONE;var r=new Array;var a,o,l,_,h,f=s[0].length;o=GSGF.Point(0,0);l=GSGF.Point();for(a=1;a<=e;a++){if((a==5||a==7)&&a==e){_=s[0][f-1];h=s[1][f-1]}else{_=s[0][a-1];h=s[1][a-1]}r.push(GSGF.Point(_,h))}this.m_pboard.m_nNextColor=GSGF.GT_WHITE;this["_AB"]=r}else{this.m_pboard.m_nNextColor=GSGF.GT_BLACK}this.m_curNode=this.m_viewNode=this.m_putNode=this.Generate(null,this.m_pboard)},OpenBoard:function(t){if(this.m_str!="")this.ResetContent();var e=new GSGF.PBuffer(t);this.LoadString(e);e.str=null;if(GSGF.IsValid(this["_TP"]))this.m_nType=Number(this["_TP"]);if(GSGF.IsValid(this["_RU"]))this.m_nRule=Number(this["_RU"]);if(GSGF.IsValid(this["_DUM"]))this.m_nDum=Number(this["_DUM"]);this.m_nLine=GSGF.DEFAULT_BOARD_WIDTH;if(GSGF.IsValid(this["_SZ"]))this.m_nLine=Number(this["_SZ"]);this.ResetSGFMatrix(this.m_nLine);this.Travel(GSGF.TRAVEL_NODEFLAG,this,null);this.m_putNode=this.FindPutNode();this.Generate(this.m_putNode,this.m_pboard);if(this.m_curNode==this)this.m_curNode=this.m_putNode;this.m_viewNode=this.m_curNode;if(this.m_curNode!=this.m_putNode)this.Generate(this.m_curNode,this.m_cboard);else this.m_cboard.GenerateMark(this.m_curNode)},SaveBoard:function(){var t;if(this.m_bViewSync)t=this.m_curNode;else t=this.m_viewNode;t.ModifyFlag(GSGF.GNODE_CURRENT|GSGF.GNODE_MODIFIED,0);if(this.m_refNode)this.m_refNode.ModifyFlag(GSGF.GNODE_REFER|GSGF.GNODE_MODIFIED,0);var e=this.SaveString();t.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_CURRENT);if(this.m_refNode)this.m_refNode.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_REFER);return e},SaveCurrentBoard:function(){var t;if(this.m_bViewSync)t=this.m_curNode;else t=this.m_viewNode;t.ModifyFlag(GSGF.GNODE_CURRENT|GSGF.GNODE_MODIFIED,0);if(this.m_refNode)this.m_refNode.ModifyFlag(GSGF.GNODE_REFER|GSGF.GNODE_MODIFIED,0);var e="(";var i=new Array;t.ListUpParent(i);var n,s=i.length;for(n=0;n<s;n++){e+=";"+i[n].WriteNode()}e+=")";GSGF.ClearArray(i);t.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_CURRENT);if(this.m_refNode)this.m_refNode.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_REFER);return e},FindPutNode:function(){var t=this;var e=this;while(t.m_child){if(t.m_child.m_nColor==GSGF.GT_EMPTY){t=t.m_child;continue}e=t=t.m_child}return e},GameStone:function(t,e,i,n){if(n==undefined)n=true;if(this.m_pboard.PutStone(t,e,i)){var s=false;if(this.m_putNode==this.m_curNode)s=true;var r=this.m_putNode;if(r.m_nColor!=GSGF.GT_EMPTY||r.m_parent==null){if(r.m_child){r=r.m_child;while(r){if(r.m_nColor==GSGF.GT_EMPTY)break;if(!r.m_child){r=r.AddChild();break}r=r.m_child}}else{r=r.AddChild()}}r.m_ptPos=GSGF.Point(t,e);r.m_nColor=i;r.ModifyFlag(GSGF.GNODE_MODIFIED,0);this.m_putNode=r;if(s)this.SetCurNode(r);var a=GSGF.CMD_GAMESTONE;if(n)return a+"|"+r.WriteNode();else return a}return""},ReferStone:function(t,e,i,n){if(n==undefined)n=true;if(this.m_cboard.PutStone(t,e,i)){var s,r=null;s=this.m_curNode;if(s.m_nColor!=GSGF.GT_EMPTY||s.m_parent==null){if(s.m_child){s=s.m_child;if(s.IsSameProp(t,e,i)&&!s.IsMainLine()){r=s}else{while(s.m_sibling){s=s.m_sibling;if(s.IsSameProp(t,e,i)||s.m_nColor==GSGF.GT_EMPTY){r=s;break}}if(!r){s=s.AddSibling();s.ModifyFlag(GSGF.GNODE_TEMP|GSGF.GNODE_MODIFIED,0)}}if(r)s=r}else{s=s.AddChild();if(this.m_curNode==this.m_putNode)s=s.AddSibling();s.ModifyFlag(GSGF.GNODE_TEMP|GSGF.GNODE_MODIFIED,0)}}s.m_ptPos=GSGF.Point(t,e);s.m_nColor=i;s.ModifyFlag(GSGF.GNODE_MODIFIED,0);this.SetCurNode(s);this.m_cboard.GenerateMark(s);var a=GSGF.CMD_REFERSTONE;if(n)return a+"|"+s.WriteNode();else return a}return""},AddStone:function(t,e,i,n){if(n==undefined)n=true;if(this.m_pboard.PutStone(t,e,i)){var s,r=null;s=this.m_putNode;if(s.m_nColor!=GSGF.GT_EMPTY||s.m_parent==null){if(s.m_child){s=s.m_child;if(s.IsSameProp(t,e,i)||s.m_nColor==GSGF.GT_EMPTY){r=s}else{while(s.m_sibling){s=s.m_sibling;if(s.IsSameProp(t,e,i)||s.m_nColor==GSGF.GT_EMPTY){r=s;break}}if(!r)s=s.AddSibling()}if(r)s=r}else{s=s.AddChild()}}s.m_ptPos=GSGF.Point(t,e);s.m_nColor=i;s.ModifyFlag(GSGF.GNODE_MODIFIED,0);this.m_pboard.GenerateMark(s);this.m_putNode=s;var a=GSGF.CMD_ADDSTONE;if(n)return a+"|"+s.WriteNode();else return a}return""},NextStone:function(t,e,i){if(i==undefined)i=true;var n=!this.m_bViewSync;if(!i)n=false;var s;if(n)s=this.m_viewNode.m_child;else s=this.m_curNode.m_child;if(s==null)return"";while(s.m_sibling){s=s.m_sibling;if(s.m_ptPos&&s.m_ptPos.x==t&&s.m_ptPos.y==e){if(n){this.m_viewNode=this.Generate(s.FindLastChild(),this.m_vboard);break}else{this.SetCurNode(this.Generate(s.FindLastChild(),this.m_cboard));var r=GSGF.CMD_NEXTSTONE;if(i)return r+"["+GSGF.AsciiString(s.m_ptPos)+"]|";else return r}}}return""},AddPreStone:function(t,e,i,n){if(n==undefined)n=true;var s=1;if(this.m_pboard.PutStone(t,e,i,s)){var r,a,o=this.m_curNode;if(!o.IsRoot()&&o.m_nColor!=GSGF.GT_PRESTONE&&o.m_nColor!=GSGF.GT_EMPTY){o=o.InsertAt()}o.m_nColor=GSGF.GT_PRESTONE;if(i==GSGF.GT_BLACK)r="_AB";else r="_AW";a=o[r];if(!GSGF.IsValid(a)){a=new Array;o[r]=a}a.push(GSGF.Point(t,e));if(o.m_ptPos){o.m_ptPos.x=a[0].x;o.m_ptPos.y=a[0].y}else{o.m_ptPos=GSGF.Point(t,e)}o.ModifyFlag(GSGF.GNODE_MODIFIED,0);this.SetCurNode(o);this.m_pboard.GenerateMark(o);var l=GSGF.CMD_ADDPRESTONE;if(n)return l+"|"+GSGF.StrStone(t,e,i);else return l}return""},ReferPreStone:function(t,e,i,n){if(n==undefined)n=true;var s=1;var r,a,o=this.m_curNode;var l=o.IsRoot()&&this.m_pboard.m_nStoneIndex==0?true:false;if(l){if(!this.m_pboard.PutStone(t,e,i,s))return""}if(this.m_cboard.PutStone(t,e,i,s)){if(!l&&o.m_nColor!=GSGF.GT_EMPTY&&o.m_nColor!=GSGF.GT_PRESTONE){if(o.IsMainLine()){if(o.m_child)o=o.m_child;else o=o.AddChild();while(o.m_sibling)o=o.m_sibling;o=o.AddSibling()}else{o=o.InsertAt()}o.ModifyFlag(GSGF.GNODE_TEMP,0)}o.m_nColor=GSGF.GT_PRESTONE;if(i==GSGF.GT_BLACK)r="_AB";else r="_AW";a=o[r];if(!GSGF.IsValid(a)){a=new Array;o[r]=a}a.push(GSGF.Point(t,e));if(!o.m_ptPos)o.m_ptPos=GSGF.Point(t,e);o.ModifyFlag(GSGF.GNODE_MODIFIED,0);this.SetCurNode(o);this.m_cboard.GenerateMark(o);var _=GSGF.CMD_REFERPRESTONE;if(n)return _+"|"+GSGF.StrStone(t,e,i);else return _}return""},AddMark:function(t,e,i,n){if(n==undefined)n=true;i+=10;var s,r,a,o,l,_=this.m_curNode;var h=_.IsRoot()&&this.m_pboard.m_nStoneIndex==0?true:false;if(!h&&_.IsMainLine()&&this.m_cboard!=this.m_pboard){if(_.m_child)_=_.m_child;else _=_.AddChild();while(_.m_sibling)_=_.m_sibling;_=_.AddSibling();this.SetCurNode(_);_.ModifyFlag(GSGF.GNODE_TEMP|GSGF.GNODE_MODIFIED,0)}else{_.ModifyFlag(GSGF.GNODE_MODIFIED,0)}if(_.m_ptPos==null){_.m_ptPos=GSGF.Point(t,e)}var f=this.m_cboard.GetShapeAt(t,e);if(f>0){return""}var C=GSGF.CMD_ADDMARK;if(i==GSGF.GT_LABEL){l=_["_LB"];if(!GSGF.IsValid(l)){l=new Array;_["_LB"]=l}else{r=l.length;for(s=0;s<r;s++){if(l[s].x==t&&l[s].y==e)return""}}var m,u,T,S=_["_LBC"];if(!GSGF.IsValid(S)){S=new Array;_["_LBC"]=S}m=GSGF.GT_CHAR_START;r=S.length;for(s=0;s<r;s++){T=S[s].charCodeAt(0);if(m<=T)m=T+1}if(m>GSGF.GT_CHAR_END)m=GSGF.GT_CHAR_START;a=GSGF.Point(t,e);l.push(a);u=String.fromCharCode(m);S.push(u);this.m_cboard.SetShapeAt(t,e,m);if(m+1>GSGF.GT_CHAR_END)this.m_cboard.m_nNextCode=GSGF.GT_CHAR_START;else this.m_cboard.m_nNextCode=m+1;if(n)return C+"|LB["+GSGF.AsciiString(a)+"]"}else{switch(i){case GSGF.GT_CIRCLE:o="_CR";break;case GSGF.GT_CROSS:o="_MA";break;case GSGF.GT_RECT:o="_SQ";break;case GSGF.GT_TRIANGLE:o="_TR";break;default:return""}l=_[o];if(!GSGF.IsValid(l)){l=new Array;_[o]=l}else{r=l.length;for(s=0;s<r;s++){if(l[s].x==t&&l[s].y==e)return""}}a=GSGF.Point(t,e);l.push(a);this.m_cboard.SetShapeAt(t,e,i);if(n)return C+"|"+o.substr(1)+"["+GSGF.AsciiString(a)+"]"}return C},EraseMark:function(t,e,i){if(i==undefined)i=true;var n,s,r,a,o,l,_=this.m_curNode;for(var h in _){if(h.length>0&&h.charAt(0)=="_"){if(h.toUpperCase()==h){if(Array.isArray(_[h])&&h!="_LBC"){o=_[h];r=o.length;for(n=0;n<r;n++){if(o[n].x==t&&o[n].y==e){var f=o[n];o[n]=null;o.splice(n,1);if(h=="_LB"){l=_["_LBC"];if(GSGF.IsValid(l)){r=l.length;if(n<r){l[n]=null;l.splice(n,1)}var C,m=GSGF.GT_CHAR_START;a=l.length;for(s=0;s<a;s++){C=l[s].charCodeAt(0);if(m<=C)m=C+1}if(m>GSGF.GT_CHAR_END)m=GSGF.GT_CHAR_START;this.m_cboard.m_nNextCode=m}}if(_.m_nColor==GSGF.GT_PRESTONE&&(h=="_AW"||h=="_AB")){var u=0;if(GSGF.IsValid(_["_AW"]))u+=_["_AW"].length;if(GSGF.IsValid(_["_AB"]))u+=_["_AB"].length;if(u==0)_.m_nColor=GSGF.GT_EMPTY;this.m_cboard.SetAt(t,e,GSGF.GT_EMPTY);if(_.IsRoot()&&this.m_cboard!=this.m_pboard)this.m_pboard.SetAt(t,e,GSGF.GT_EMPTY)}this.m_cboard.SetShapeAt(t,e,0);_.ModifyFlag(GSGF.GNODE_MODIFIED,0);var T=GSGF.CMD_ERASEMARK;if(i)return T+"["+GSGF.AsciiString(f)+"]|";else return T}}}}}}return""},RemoveDeadStone:function(t,e,i,n){if(n==undefined)n=true;var s,r;if(i==GSGF.GT_BLACK)s="_DB";else s="_DW";r=this.m_putNode[s];if(GSGF.IsValid(r)){var a,o=r.length;for(a=0;a<o;a++){if(t==r[a].x&&e==r[a].y)return""}}if(this.m_pboard.GetAt(t,e)==GSGF.GT_EMPTY){this.m_pboard.SetShapeAt(t,e,GSGF.GT_NOTHOUSE)}else{if(!this.m_pboard.MarkDeadStone(t,e,i))return""}if(!GSGF.IsValid(r)){r=new Array;this.m_putNode[s]=r}r.push(GSGF.Point(t,e));var l=GSGF.CMD_DEADSTONE;if(n)return l+"|"+GSGF.StrStone(t,e,i);else return l},AnalyzeAdd:function(t,e){if(e==undefined)e=true;this.ModifyFlag(GSGF.GNODE_GEGA,0);this.m_putNode["_AG"]=t;this.m_pboard.GenerateMark(this.m_putNode)},AnalyzeDel:function(t,e){if(e==undefined)e=true;this.m_putNode["_AG"]=null;this.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_GEGA);this.m_pboard.GenerateMark(this.m_putNode)},AutoGegaAdd:function(t,e){if(e==undefined)e=true;var i=t.length;if(this.m_nLine*this.m_nLine!=i)return"";this.ModifyFlag(GSGF.GNODE_GEGA|GSGF.GNODE_MODIFIED,0);this.m_putNode["_AG"]=t;this.m_pboard.GenerateMark(this.m_putNode);var n=GSGF.CMD_AUTOGEGA_ADD;if(e)return n+"|"+t;else return n},AutoGegaDel:function(t){if(t==undefined)t=true;this.m_putNode["_AG"]=null;this.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_GEGA);this.m_pboard.GenerateMark(this.m_putNode);var e=GSGF.CMD_AUTOGEGA_DEL;if(t)return e+"|";else return e},GenerateDeadStone:function(t){if(t==undefined)this.Generate(null,this.m_pboard);var e=GSGF.Point(0,0);this.m_pboard.gt_gethouse(e);var i,n,s,r=this.m_putNode;s=r["_DB"];if(GSGF.IsValid(s)){n=s.length;for(i=0;i<n;i++){if(this.m_pboard.GetAt(s[i].x,s[i].y)==GSGF.GT_EMPTY)this.m_pboard.SetShapeAt(s[i].x,s[i].y,GSGF.GT_NOTHOUSE);else this.m_pboard.MarkDeadStone(s[i].x,s[i].y,GSGF.GT_BLACK)}}s=r["_DW"];if(GSGF.IsValid(s)){n=s.length;for(i=0;i<n;i++){if(this.m_pboard.GetAt(s[i].x,s[i].y)==GSGF.GT_EMPTY)this.m_pboard.SetShapeAt(s[i].x,s[i].y,GSGF.GT_NOTHOUSE);else this.m_pboard.MarkDeadStone(s[i].x,s[i].y,GSGF.GT_WHITE)}}},DeadStoneStart:function(t){if(t==undefined)t=true;var e=GSGF.Point(0,0);this.m_pboard.gt_gethouse(e);this.ModifyFlag(GSGF.GNODE_GEGA|GSGF.GNODE_MODIFIED,0);var i=GSGF.CMD_GEGA_ON;if(t)return i+"|";else return i},DeadStoneCancel:function(t,e){if(t==undefined)t=0;if(e==undefined)e=true;var i,n=this.m_putNode;if(t==GSGF.GT_BLACK){i=n["_DB"];GSGF.ClearArray(i);n["_DB"]=null}else if(t==GSGF.GT_WHITE){i=n["_DW"];GSGF.ClearArray(i);n["_DW"]=null}else{i=n["_DB"];GSGF.ClearArray(i);i=n["_DW"];GSGF.ClearArray(i);n["_DB"]=n["_DW"]=null}this.GenerateDeadStone();var s=GSGF.CMD_DEADSTONE_CANCEL;if(e)return s+"["+t+"]|";else return s},DeadStoneConfirm:function(t,e){if(e==undefined)e=true;var i=GSGF.CMD_DEADSTONE_CONFIRM;if(t==GSGF.GT_BLACK)this.ModifyFlag(GSGF.GNODE_BCONFIRM|GSGF.GNODE_MODIFIED,0);else if(t==GSGF.GT_WHITE)this.ModifyFlag(GSGF.GNODE_WCONFIRM|GSGF.GNODE_MODIFIED,0);else this.ModifyFlag(GSGF.GNODE_BCONFIRM|GSGF.GNODE_WCONFIRM|GSGF.GNODE_MODIFIED,0);if(e)return i+"["+t+"]|";else return i},IsBothConfirm:function(){return this.IsFlag(GSGF.GNODE_BCONFIRM|GSGF.GNODE_WCONFIRM)},DeadStoneRetry:function(t,e){if(e==undefined)e=true;var i=GSGF.CMD_DEADSTONE_RETRY;if(t==GSGF.GT_BLACK)this.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_BCONFIRM);else if(t==GSGF.GT_WHITE)this.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_WCONFIRM);else this.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_BCONFIRM|GSGF.GNODE_WCONFIRM);if(e)return i+"["+t+"]|";else return i},DeadStoneReturn:function(t){if(t==undefined)t=true;this.DeadStoneCancel();this.ModifyFlag(GSGF.GNODE_MODIFIED,GSGF.GNODE_GEGA|GSGF.GNODE_BCONFIRM|GSGF.GNODE_WCONFIRM);var e=GSGF.CMD_GEGA_OFF;if(t)return e+"|";else return e},GetLastBranchIndex:function(){var t;if(this.m_bViewSync)t=this.m_curNode;else t=this.m_viewNode;while(t){if(t.IsSibling()){var e=t.GetRootDepth();if(t.m_nColor==GSGF.GT_PRESTONE||t.m_nColor==GSGF.GT_EMPTY)e++;return e}t=t.m_parent}return-1},GetLastBranchBackCount:function(t){if(t==undefined)t=false;var e,i=1;if(this.m_bViewSync)e=this.m_curNode;else e=this.m_viewNode;if(t){if(e.IsFlag(GSGF.GNODE_TEMP)){while(e){if(e.IsSibling())return i;e=e.m_parent;if(e&&e.IsFlag(GSGF.GNODE_TEMP))i++}}}else{while(e){if(e.IsSibling())return i;e=e.m_parent;i++}}return 0},GetStone:function(t,e){if(!this.m_bViewSync)return this.m_vboard.m_mtBS[t][e];else if(this.m_curNode==this.m_putNode)return this.m_pboard.m_mtBS[t][e];else return this.m_cboard.m_mtBS[t][e]},GetLast:function(){if(!this.m_bViewSync)return this.m_vboard.m_ptLast;else if(this.m_curNode==this.m_putNode)return this.m_pboard.m_ptLast;else return this.m_cboard.m_ptLast},GetNextColor:function(t){if(t==undefined)t=false;if(t)return this.m_cboard.m_nNextColor;else return this.m_pboard.m_nNextColor},IsSync:function(){if(this.m_curNode==this.m_putNode)return true;else return false},IsGega:function(t){if(t==undefined)t=this.m_viewNode;if(t==this.m_putNode&&this.IsFlag(GSGF.GNODE_GEGA))return true;else return false},Pass:function(t){if(t==undefined)t=this.m_pboard.m_nNextColor;else if(t!=this.m_pboard.m_nNextColor)return"";return this.GameStone(-1,-1,t)},SetBack:function(t,e){if(e==undefined)e=true;if(this.m_putNode==this)return"";if(t==undefined)t=this.m_pboard.m_nNextColor;var i,n,s=this.m_putNode;var r=false;if(this.m_putNode==this.m_curNode)r=true;if(t==this.m_pboard.m_nNextColor)n=1;else n=2;for(i=0;i<n&&s.m_parent;i++){if(s.m_child&&s.m_child.m_sibling){var a=s.FindLastSibling();a=a.AddSibling(s.WriteNode());a.Child(s.m_child.m_sibling);s.m_child.m_sibling=null}s.Clear();s.ModifyFlag(GSGF.GNODE_MODIFIED,0);s=s.m_parent}this.m_putNode=this.Generate(s,this.m_pboard);if(r)this.SetCurNode(this.m_putNode);var o=GSGF.CMD_SETBACK;if(e)return o+"["+t+"]|";else return o},SetError:function(){if(this.m_putNode==this)return;var t,e,i=this.m_putNode;var n=false;if(this.m_putNode==this.m_curNode)n=true;e=1;for(t=0;t<e&&i.m_parent;t++){if(i.m_child&&i.m_child.m_sibling){var s=i.FindLastSibling();s=s.AddSibling(i.WriteNode());s.Child(i.m_child.m_sibling);i.m_child.m_sibling=null}i.Clear();i.ModifyFlag(GSGF.GNODE_MODIFIED,0);i=i.m_parent}this.m_putNode=this.Generate(i,this.m_pboard);if(n)this.SetCurNode(this.m_putNode)},Generate:function(t,e){if(!GSGF.IsValid(t))this.LineUp(this.m_aryTmp);else t.ListUpParent(this.m_aryTmp);e.ResetBoardMatrix();e.m_nNextColor=GSGF.GT_BLACK;var i,n,s,r,a,o=this.m_aryTmp.length;for(s=0;s<o;s++){n=this.m_aryTmp[s];switch(n.m_nColor){case GSGF.GT_PRESTONE:i=n["_AB"];if(GSGF.IsValid(i)){a=i.length;for(r=0;r<a;r++)e.gt_addstone(i[r].x,i[r].y,GSGF.GT_BLACK,e.m_szDead,e.m_ptPae,1)}i=n["_AW"];if(GSGF.IsValid(i)){a=i.length;for(r=0;r<a;r++)e.gt_addstone(i[r].x,i[r].y,GSGF.GT_WHITE,e.m_szDead,e.m_ptPae,1)}if(s==0)e.m_nNextColor=GSGF.GT_WHITE;break;case GSGF.GT_BLACK:e.gt_addstone(n.m_ptPos.x,n.m_ptPos.y,GSGF.GT_BLACK,e.m_szDead,e.m_ptPae,2);e.m_nNextColor=GSGF.GT_WHITE;break;case GSGF.GT_WHITE:e.gt_addstone(n.m_ptPos.x,n.m_ptPos.y,GSGF.GT_WHITE,e.m_szDead,e.m_ptPae,2);e.m_nNextColor=GSGF.GT_BLACK;break}if(n.m_nColor!=GSGF.GT_PRESTONE&&n.m_ptPos){e.m_ptLast.x=n.m_ptPos.x;e.m_ptLast.y=n.m_ptPos.y}}if(this.IsGega(t)){if(GSGF.IsValid(this.m_putNode["_AG"]))e.GenerateMark(this.m_putNode);else this.GenerateDeadStone(true)}else{e.GenerateMark(n)}return n},ArrowMove:function(t,e){if(e==undefined)e=true;var i,n,s,r,a=Math.abs(t);var o=!this.m_bViewSync;if(!e)o=false;if(o){if(this.m_viewNode.IsIsolate()){s=this.m_curNode;this.m_bViewSync=false}else{if(t==-999||t==999){if(t==-999){s=this}else{s=this.m_putNode}}else{s=this.m_viewNode;for(n=0;n<a;n++){if(t>0){if(s==this.m_putNode)r=null;else r=s.m_child}else{r=s.GetParent()}if(r==null)break;s=r}}}if(this.m_viewNode!=s){this.m_viewNode=this.Generate(s,this.m_vboard);return GSGF.CMD_ARROWMOVE}}else{if(t<0&&this.m_curNode.IsFlag(GSGF.GNODE_TEMP))i=true;else i=false;if(!i&&(t==-999||t==999)){if(t==-999){s=this}else{s=this.m_putNode}}else{s=this.m_curNode;for(n=0;n<a;n++){if(t>0){if(s==this.m_putNode)r=null;else r=s.m_child}else{r=s.GetParent();if(s.IsFlag(GSGF.GNODE_TEMP))s.RemoveAt()}if(r==null)break;s=r}}if(this.m_curNode!=s){this.SetCurNode(this.Generate(s,this.m_cboard));var l=GSGF.CMD_ARROWMOVE;if(e)return l+"["+t+"]|";else return l}}return""},SetMove:function(t,e){if(e==undefined)e=true;var i,n=Math.abs(t);var s=!this.m_bViewSync;if(!e)s=false;var r=0;i=this;while(i){if(i.m_nColor==GSGF.GT_BLACK||i.m_nColor==GSGF.GT_WHITE)r++;if(!i.m_child||r==n)break;i=i.m_child}if(s){this.m_viewNode=this.Generate(i,this.m_vboard);return GSGF.CMD_ARROWMOVE}else{this.SetCurNode(this.Generate(i,this.m_cboard));var a=GSGF.CMD_ARROWMOVE;if(e)return a+"["+t+"]|";else return a}return""},SetReferMode:function(t,e){if(e==undefined)e=true;var i,n;if(t){if(this.IsSync())this.Generate(this.m_curNode,this.m_cboard);this.m_refNode=this.m_curNode;n=GSGF.CMD_REFERMODE_ON;if(e)i=n+"|";else i=n}else{if(this.m_curNode!=this.m_refNode){if(this.m_curNode.IsFlag(GSGF.GNODE_TEMP)){var s,r=this.m_curNode;while(r){s=r.m_parent;if(s==null||!s.IsFlag(GSGF.GNODE_TEMP))break;r=s}r.RemoveAll()}this.SetCurNode(this.Generate(this.m_refNode,this.m_cboard))}else{this.m_cboard.m_nNextColor=this.m_curNode.m_nColor%2+1}this.m_refNode=null;n=GSGF.CMD_REFERMODE_OFF;if(e)i=n+"|";else i=n}return i},SaveRefer:function(t){if(t==undefined)t=true;this.Travel(GSGF.TRAVEL_RESETTEMP,this,null);var e=GSGF.CMD_SAVEREFER;if(t)return e+"|";else return e},DocumentAdd:function(t,e){if(e==undefined)e=true;if(this.m_curNode){this.m_curNode.ModifyFlag(GSGF.GNODE_MODIFIED,0);var i=this.m_curNode["_C"];if(GSGF.IsValid(i))this.m_curNode["_C"]+=t;else this.m_curNode["_C"]=t;this.m_curNode["_C"]+="\n";if(this.m_refNode){this.Travel(GSGF.TRAVEL_RESETTEMP,this,null)}var n=GSGF.CMD_DOCUMENT_ADD;if(e)return n+"|"+t;else return n}return""},DocumentSet:function(t,e){if(e==undefined)e=true;if(this.m_curNode){this.m_curNode.ModifyFlag(GSGF.GNODE_MODIFIED,0);var i=this.m_curNode["_C"];this.m_curNode["_C"]=t+"\n";if(this.m_refNode){this.Travel(GSGF.TRAVEL_RESETTEMP,this,null)}var n=GSGF.CMD_DOCUMENT_ADD;if(e)return n+"|"+t;else return n}return""},DocumentDel:function(t){if(t==undefined)t=true;if(this.m_curNode){this.m_curNode.ModifyFlag(GSGF.GNODE_MODIFIED,0);var e=this.m_curNode["_C"];if(GSGF.IsValid(e)){this.m_curNode["_C"]=null;var i=GSGF.CMD_DOCUMENT_DEL;if(t)return i+"|";else return i}}return""},SetTimeStatus:function(t,e,i){if(i==undefined)i=true;var n;if(e>0){var s;if(t==GSGF.GT_WHITE)s="W";else if(t==GSGF.GT_BLACK)s="B";else return"";if(i)n=GSGF.CMD_CHOILGGI_CHANGE+"|"+s+"["+e+"]";else n=GSGF.CMD_CHOILGGI_CHANGE}else return"";if(t==GSGF.GT_WHITE)this.m_nTimeStatusW=e;else if(t==GSGF.GT_BLACK)this.m_nTimeStatusB=e;else return"";return n},GetTimeStatus:function(t){if(t==GSGF.GT_WHITE)return this.m_nTimeStatusW;else if(t==GSGF.GT_BLACK)return this.m_nTimeStatusB;else return-1},ResetSGFMatrix:function(t){this.m_pboard.ResetBoardMatrix(t);if(this.m_pboard!=this.m_vboard)this.m_vboard.ResetBoardMatrix(t);if(this.m_pboard!=this.m_cboard)this.m_cboard.ResetBoardMatrix(t)},DoCommand:function(t,e){var i,n,s=GSGF.TokenLeft(t,"|");if(s=="")return null;var r=GSGF.CharCmd(s);if(r==GSGF.CMD_GAMESTONE||r==GSGF.CMD_REFERSTONE||r==GSGF.CMD_ADDSTONE||r==GSGF.CMD_ADDPRESTONE||r==GSGF.CMD_REFERPRESTONE||r==GSGF.CMD_DEADSTONE){var a=new GNode;a.m_str=GSGF.TokenRight(t,"|");a.ParsingNode();if(a.m_ptPos==null){a.Delete();return null}if(r==GSGF.CMD_GAMESTONE){if(e!=undefined){e.x=a.m_ptPos.x;e.y=a.m_ptPos.y}this.GameStone(a.m_ptPos.x,a.m_ptPos.y,a.m_nColor,false)}else if(r==GSGF.CMD_REFERSTONE){if(e!=undefined){e.x=a.m_ptPos.x;e.y=a.m_ptPos.y}this.ReferStone(a.m_ptPos.x,a.m_ptPos.y,a.m_nColor,false)}else if(r==GSGF.CMD_ADDSTONE){if(e!=undefined){e.x=a.m_ptPos.x;e.y=a.m_ptPos.y}this.AddStone(a.m_ptPos.x,a.m_ptPos.y,a.m_nColor,false)}else if(r==GSGF.CMD_ADDPRESTONE){if(e!=undefined){e.x=a.m_ptPos.x;e.y=a.m_ptPos.y}this.AddPreStone(a.m_ptPos.x,a.m_ptPos.y,a.m_nColor,false)}else if(r==GSGF.CMD_REFERPRESTONE){if(e!=undefined){e.x=a.m_ptPos.x;e.y=a.m_ptPos.y}this.ReferPreStone(a.m_ptPos.x,a.m_ptPos.y,a.m_nColor,false)}else if(r==GSGF.CMD_DEADSTONE){if(e!=undefined){e.x=-2;e.y=-2}this.RemoveDeadStone(a.m_ptPos.x,a.m_ptPos.y,a.m_nColor,false);this.GenerateDeadStone()}else{a.Delete();return null}a.Delete()}else{if(r==GSGF.CMD_SETBACK){n=Number(GSGF.TokenCenter(s,"[","]"));this.SetBack(n,false)}else if(r==GSGF.CMD_ARROWMOVE){if(e!=undefined){e.x=-2;e.y=-2}var o=Number(GSGF.TokenCenter(s,"[","]"));this.ArrowMove(o,false)}else if(r==GSGF.CMD_SETMOVE){if(e!=undefined){e.x=-2;e.y=-2}var o=Number(GSGF.TokenCenter(s,"[","]"));this.SetMove(o,false)}else if(r==GSGF.CMD_NEXTSTONE){i=GSGF.PointAscii(GSGF.TokenCenter(s,"[","]"));this.NextStone(i.x,i.y,false)}else if(r==GSGF.CMD_REFERMODE_ON){this.SetReferMode(true,false)}else if(r==GSGF.CMD_REFERMODE_OFF){this.SetReferMode(false,false)}else if(r==GSGF.CMD_OPENSGF){this.OpenBoard(GSGF.TokenRight(t,"|"))}else if(r==GSGF.CMD_ADDMARK){t=GSGF.TokenRight(t,"|");s=GSGF.TokenLeft(t,"[");i=GSGF.PointAscii(GSGF.TokenCenter(t,"[","]"));if(e!=undefined){e.x=i.x;e.y=i.y}if(s=="CR")this.AddMark(i.x,i.y,GSGF.GT_CIRCLE-10,false);else if(s=="MA")this.AddMark(i.x,i.y,GSGF.GT_CROSS-10,false);else if(s=="SQ")this.AddMark(i.x,i.y,GSGF.GT_RECT-10,false);else if(s=="TR")this.AddMark(i.x,i.y,GSGF.GT_TRIANGLE-10,false);else if(s=="LB")this.AddMark(i.x,i.y,GSGF.GT_LABEL-10,false)}else if(r==GSGF.CMD_ERASEMARK){i=GSGF.PointAscii(GSGF.TokenCenter(s,"[","]"));if(e!=undefined){e.x=i.x;e.y=i.y}this.EraseMark(i.x,i.y,false)}else if(r==GSGF.CMD_SAVEREFER){this.SaveRefer(false)}else if(r==GSGF.CMD_DOCUMENT_ADD){this.DocumentAdd(GSGF.TokenRight(t,"|"),false)}else if(r==GSGF.CMD_DOCUMENT_SET){this.DocumentSet(GSGF.TokenRight(t,"|"),false)}else if(r==GSGF.CMD_DOCUMENT_DEL){this.DocumentDel(false)}else if(r==GSGF.CMD_GEGA_ON){if(e!=undefined){e.x=-2;e.y=-2}this.DeadStoneStart(false)}else if(r==GSGF.CMD_GEGA_OFF){if(e!=undefined){e.x=-2;e.y=-2}this.DeadStoneReturn(false)}else if(r==GSGF.CMD_DEADSTONE_CANCEL){if(e!=undefined){e.x=-2;e.y=-2}n=Number(GSGF.TokenCenter(s,"[","]"));this.DeadStoneCancel(n,false)}else if(r==GSGF.CMD_DEADSTONE_CONFIRM){if(e!=undefined){e.x=-2;e.y=-2}n=Number(GSGF.TokenCenter(s,"[","]"));this.DeadStoneConfirm(n,false)}else if(r==GSGF.CMD_DEADSTONE_RETRY){if(e!=undefined){e.x=-2;e.y=-2}n=Number(GSGF.TokenCenter(s,"[","]"));this.DeadStoneRetry(n,false)}else if(r==GSGF.CMD_CHOILGGI_CHANGE){t=GSGF.TokenRight(t,"|");s=GSGF.TokenLeft(t,"[");var l=Number(GSGF.TokenCenter(t,"[","]"));if(s=="W")this.m_nTimeStatusW=l;else if(s=="B")this.m_nTimeStatusB=l;else return null}else if(r==GSGF.CMD_AUTOGEGA_ADD){if(e!=undefined){e.x=-2;e.y=-2}this.AutoGegaAdd(GSGF.TokenRight(t,"|"),false)}else if(r==GSGF.CMD_AUTOGEGA_DEL){if(e!=undefined){e.x=-2;e.y=-2}this.AutoGegaDel(false)}else{return null}}return r},GetHouse:function(t){this.m_pboard.gt_resetshape();var e,i,n,s=this.m_putNode;n=s["_DB"];if(GSGF.IsValid(n)){i=n.length;for(e=0;e<i;e++){if(this.m_pboard.GetAt(n[e].x,n[e].y)==GSGF.GT_EMPTY){this.m_pboard.SetAt(n[e].x,n[e].y,GSGF.GT_NOTHOUSE);this.m_pboard.SetShapeAt(n[e].x,n[e].y,GSGF.GT_NOTHOUSE)}else{this.m_pboard.DeleteDeadStone(n[e].x,n[e].y)}}}n=s["_DW"];if(GSGF.IsValid(n)){i=n.length;for(e=0;e<i;e++){if(this.m_pboard.GetAt(n[e].x,n[e].y)==GSGF.GT_EMPTY){this.m_pboard.SetAt(n[e].x,n[e].y,GSGF.GT_NOTHOUSE);this.m_pboard.SetShapeAt(n[e].x,n[e].y,GSGF.GT_NOTHOUSE)}else{this.m_pboard.DeleteDeadStone(n[e].x,n[e].y)}}}var r=GSGF.Point(0,0);this.m_pboard.gt_gethouse(r);t.nBlackHouse=r.x;t.nWhiteHouse=r.y;t.nBlackDead=this.m_pboard.m_szDead.x;t.nWhiteDead=this.m_pboard.m_szDead.y;t.nDum=this.m_nDum;var a=(t.nBlackHouse+t.nWhiteDead)*10;var o=(t.nWhiteHouse+t.nBlackDead)*10+this.m_nDum;return(o-a)/10},SetCurNode:function(t){if(this.m_bViewSync){this.m_viewNode=this.m_curNode=t}else{this.m_curNode=t}},SetViewSync:function(t){this.m_bViewSync=t;if(t)this.m_viewNode=this.m_curNode},IsViewSync:function(){return this.m_viewNode==this.m_curNode},GetStoneDepth:function(){var t=0;var e=this.m_child;while(e){t++;e=e.m_child}return t},FindStoneNode:function(t){var e=0;var i=this.m_child;while(i){e++;if(t==e)return i;i=i.m_child}return null}});var TDefine=TDefine||{};TDefine.WINCODE_BLACK=0;TDefine.WINCODE_WHITE=1;TDefine.WINCODE_EQUAL=2;TDefine.WINCODE_BLACKDRAW=3;TDefine.WINCODE_WHITEDRAW=4;TDefine.WINCODE_BLACKHALT=5;TDefine.WINCODE_WHITEHALT=6;TDefine.WINCODE_BLACKTIME=7;TDefine.WINCODE_WHITETIME=8;TDefine.WINCODE_DRAWALL=9;var CStringFile=vx.Class.extend({init:function(t){if(t==undefined)t="";this.buf=t;this.nRead=0},Delete:function(){this.buf=null},GetLength:function(){return this.buf.length},SeekToFirst:function(){this.nRead=0},SeekToLast:function(){this.nRead=this.GetLength()},Write:function(t){this.buf+=t},ReadString:function(){var t=this.nRead;var e,i=this.GetLength();if(i<=t)return null;var n,s="";for(e=t;e<i;e++){n=this.buf[e];this.nRead++;if(n=="\r")continue;else if(n=="\n"||n=="\t")return s;s+=n}return s}});var CPKG_GAME_MATCH_IND_EX=vx.Class.extend({init:function(){this.roomNo=0;this.betflag=0;this.broad=0;this.recvID="";this.r_geuk=0;this.sendID="";this.s_geuk=0;this.time=0;this.sec=0;this.seccnt=0;this.daekukrule=0;this.dum=0;this.dolsel=0;this.backallow=0;this.response=0;this.daekuktype=0;this.moneytype=0;this.teritory=0;this.recvPath=0;this.sendPath=0;this.rbflag=0;this.gameExtFlag=0;this.sbflag=0;this.use_chinarule=0;this.rUserNick="";this.rsvd3=0;this.r_sCode=0;this.sUserNick="";this.rsvd4=0;this.s_sCode=0;this.r_avatanum=0;this.s_avatanum=0;this.savetime=0},SetTime:function(t){this.time=t},SetSaveTime:function(t){this.savetime=t/1e3},GetBangjang:function(t){if(t==undefined)t=new CUSERNAME(this.sendID,this.s_geuk,this.sUserNick,this.s_sCode,this.rsvd4);else t.Set(this.sendID,this.s_geuk,this.sUserNick,this.s_sCode,this.rsvd4);return t},SetBangjang:function(t){this.sendID=t.id;this.s_geuk=t.grade;this.sUserNick=t.nick;this.s_sCode=t.sCode;this.rsvd4=0},GetPartner:function(t){if(t==undefined)t=new CUSERNAME(this.recvID,this.r_geuk,this.rUserNick,this.r_sCode,this.rsvd3);else t.Set(this.recvID,this.r_geuk,this.rUserNick,this.r_sCode,this.rsvd3);return t},SetPartner:function(t){this.recvID=t.id;this.r_geuk=t.grade;this.rUserNick=t.nick;this.r_sCode=t.sCode;this.rsvd3=0},GetBangjangDolColor:function(){return this.dolsel==0?false:true},GetWhite:function(t){if(t==undefined)t=new CUSERNAME;if(this.GetBangjangDolColor())return this.GetBangjang(t);else return this.GetPartner(t)},GetBlack:function(t){if(t==undefined)t=new CUSERNAME;if(!this.GetBangjangDolColor())return this.GetBangjang(t);else return this.GetPartner(t)},GetBangjangAvata:function(){var t=new ObArray;t.Add(this.sbflag);t.Add(this.sendPath);t.Add(this.s_avatanum);t.Add(this.s_sCode);return t},GetPartnerAvata:function(){var t=new ObArray;t.Add(this.rbflag);t.Add(this.recvPath);t.Add(this.r_avatanum);t.Add(this.r_sCode);return t},GetWhiteAvata:function(){if(this.GetBangjangDolColor())return this.GetBangjangAvata();else return this.GetPartnerAvata()},GetBlackAvata:function(){if(!this.GetBangjangDolColor())return this.GetBangjangAvata();else return this.GetPartnerAvata()}});var CPKG_GAME_DONE_IND=vx.Class.extend({init:function(){this.roomNo=0;this.owner=0;this.broad=0;this.id="";this.geuk=0;this.response=0;this.subcmd=0;this.zipcnt=0;this.sucnt=0;this.reserved=0;this.InvalidCause=0;this.wtime=0;this.btime=0;this.strheader=""}});var CUSERNAME=vx.Class.extend({init:function(){this.id="";this.grade=0;this.nick="";this.sCode=0;this.nCode=0},Delete:function(){this.id=null;this.nick=null},Set:function(t,e,i,n,s){if(s==undefined)s=0;this.id=t;this.grade=e;this.nick=i;this.sCode=n;this.nCode=s}});var lb_util=lb_util||{};lb_util.CFG_GetToken=function(t){if(t.length<3)return"";var e,i;var n=null;var s=t[0];var r=t[1];var a=t[2];e=s.indexOf(r);if(e==-1)return"";s=s.substring(e+r.length);e=s.indexOf(a);if(e==-1)return"";n=s.substr(0,e);s=s.substring(e+a.length);t[0]=s;return n};var CUserImage=CUserImage||{};CUserImage.GetImagePathToNum=function(t){if(t.indexOf("tu000_")==-1)return 0;var e=new ObArray;e.Add(t);e.Add("tu000_");e.Add(".jpg");return Number(lb_util.CFG_GetToken(e))};var CTextRefer=vx.Class.extend({init:function(t){var e=new ObArray;e.Add(t);e.Add("\\[REFSUSUN=");e.Add("\\]");this.susun=Number(lb_util.CFG_GetToken(e));e.SetAt(1,"\\[REFEXPLAIN=");this.explain=lb_util.CFG_GetToken(e);e.SetAt(1,"\\[REFNUM=");this.refnum=Number(lb_util.CFG_GetToken(e));e.SetAt(1,"\\[REFGIBO=");this.lbk=lb_util.CFG_GetToken(e)},Delete:function(){this.explain=this.lbk=null}});var TGiboFile=vx.Class.extend({init:function(){this.m_sCode=0;this.m_type=0;this.m_szaudio=0;this.m_gnFlag=0;this.m_gpFlag=0;this.m_version=0;this.m_lineCnt=19;this.m_commentator="";this.m_gamename="";this.m_gamedate="";this.m_gameplace="";this.m_comment="";this.m_gameOpenPath="";this.m_error=0;this.m_strHeader="";this.m_strReferHeader="";this.m_pReferList=null;this.m_fpLBK=null},Delete:function(){if(this.m_fpLBK){this.m_fpLBK.Delete();this.m_fpLBK=null}this.m_commentator=null;this.m_gamename=null;this.m_gamedate=null;this.m_gameplace=null;this.m_comment=null;this.m_gameOpenPath=null;this.m_strHeader=null;this.m_strReferHeader=null;if(this.m_pReferList){var t,e,i=this.m_pReferList.GetSize();for(e=0;e<i;e++){t=this.m_pReferList.GetAt(e);t.Delete()}this.m_pReferList.RemoveAll();this.m_pReferList=null}},GetGameDate_GAMETAG:function(t){var e;var i=new ObArray;var n,s,r,a,o,l;e=CUtil.Replace(t,":","][");if(e==t)return 0;e=String.format("[{0}]",e);i.Add(e);i.Add("[");i.Add("]");n=Number(lb_util.CFG_GetToken(i));s=Number(lb_util.CFG_GetToken(i));r=Number(lb_util.CFG_GetToken(i));a=Number(lb_util.CFG_GetToken(i));o=Number(lb_util.CFG_GetToken(i));l=Number(lb_util.CFG_GetToken(i));if(n==0||s==0||r==0)return 0;var _=new Date(n,s,r,a,o,l,0);i.RemoveAll();return Number(_.getTime())},GetGameDate_GAMEINFOSUB:function(t){var e;var i=new ObArray;var n,s,r,a,o,l;e=CUtil.Replace(t,"-","][");if(e==t)return 0;e=String.format("[{0}]",e);i.Add(e);i.Add("[");i.Add("]");n=Number(lb_util.CFG_GetToken(i));s=Number(lb_util.CFG_GetToken(i));r=Number(lb_util.CFG_GetToken(i));a=Number(lb_util.CFG_GetToken(i));o=Number(lb_util.CFG_GetToken(i));l=Number(lb_util.CFG_GetToken(i));if(n==0||s==0||r==0)return 0;var _=new Date(n,s,r,a,o,l,0);i.RemoveAll();return Number(_.getTime())},GetTimeInfo_GAMETAG:function(t,e){var i;var n,s,r;var a=new ObArray;i=CUtil.Replace(t,"-","][");i=String.format("[{0}]",i);a.Add(i);a.Add("[");a.Add("]");n=Number(lb_util.CFG_GetToken(a));s=Number(lb_util.CFG_GetToken(a));r=Number(lb_util.CFG_GetToken(a));a.RemoveAll();e.Add(n);e.Add(s);e.Add(CUtil.HTONS(r));return true},GetTimeInfo_GAMEINFOMAIN:function(t,e){var i;var n,s,r;var a=new ObArray;i=CUtil.Replace(t,"-","][");i=String.format("[{0}]",i);a.Add(i);a.Add("[");a.Add("]");r=Number(lb_util.CFG_GetToken(a));s=Number(lb_util.CFG_GetToken(a));n=Number(lb_util.CFG_GetToken(a));a.RemoveAll();e.Add(n);e.Add(s);e.Add(r);return true},GetParam:function(t,e){if(this.m_strHeader==null)return null;var i,n;var s;e.m_dwRef=0;if(t==null)return null;s="\\["+t;i=CUtil.Find(this.m_strHeader,s,0);if(i==-1)return null;i+=s.length;s="\\]";n=CUtil.Find(this.m_strHeader,s,i);if(n==-1)return null;var r=CUtil.Mid(this.m_strHeader,i,n-i);i=CUtil.Find(r,"=",0);if(i==-1)return null;e.m_dwRef=1;n=r.length;r=CUtil.Right(r,n-i-1);return r},ParsingHeader_Data:function(t,e){var i=0;var n,s,r,a,o,l;var _;var h,f,C,m,u,T;var S,c,g,E,d,O;var D=new vx.reference;var A=new vx.reference;var G=new vx.reference;var F=new vx.reference;var R=new CUSERNAME;var p=new CUSERNAME;var I=new ObArray;var M=new ObArray;I.SetSize(3);S=this.GetParam(TGiboFile.TAG_GAMEINFOMAIN,D)+",";c=this.GetParam(TGiboFile.TAG_GAMEINFOSUB,A)+",";g=this.GetParam(TGiboFile.TAG_WUSERINFO,G)+",";E=this.GetParam(TGiboFile.TAG_BUSERINFO,F)+",";if(D.m_dwRef&&A.m_dwRef&&G.m_dwRef&&F.m_dwRef){I.SetAt(0,S);I.SetAt(2,",");I.SetAt(1,"GBKIND:");this.m_sCode=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"GTYPE:");t.daekuktype=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"GCDT:");t.daekukrule=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"GTIME:");l=lb_util.CFG_GetToken(I);this.GetTimeInfo_GAMEINFOMAIN(l,M);t.sec=M.GetAt(0);t.seccnt=M.GetAt(1);t.SetTime(M.GetAt(2));I.SetAt(1,"GRLT:");e.response=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"ZIPSU:");e.zipcnt=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"DUM:");t.dum=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"GONGJE:");t.broad=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"TCNT:");e.sucnt=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"LINE:");var v=Number(lb_util.CFG_GetToken(I));if(v>0)this.m_lineCnt=v;this.m_szaudio=0;I.SetAt(0,c);I.SetAt(1,"GNAMEF:");this.m_gnFlag=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"GPLCF:");this.m_gpFlag=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"GNAME:");this.m_gamename=lb_util.CFG_GetToken(I);I.SetAt(1,"GDATE:");o=lb_util.CFG_GetToken(I);if(o==null){S=this.GetParam(TGiboFile.TAG_GAMETAG,D)+",";if(D){var b=new ObArray;b.Add(S);b.Add("C");b.Add(",");o=lb_util.CFG_GetToken(b);t.SetSaveTime(this.GetGameDate_GAMETAG(o));b.RemoveAll();b=null}else{o=this.GetParam(TGiboFile.TAG_GAMEDATE,D)}}else{t.SetSaveTime(this.GetGameDate_GAMEINFOSUB(o))}this.m_gamedate=o;I.SetAt(1,"GPLC:");this.m_gameplace=lb_util.CFG_GetToken(I);I.SetAt(1,"GCMT:");this.m_commentator=lb_util.CFG_GetToken(I);t.dolsel=1;I.SetAt(0,g);I.SetAt(1,"WID:");n=lb_util.CFG_GetToken(I);I.SetAt(1,"WLV:");h=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"WNICK:");s=lb_util.CFG_GetToken(I);I.SetAt(1,"WNCD:");f=Number(lb_util.CFG_GetToken(I));R.Set(n,h,s,f);t.SetBangjang(R);I.SetAt(1,"WAID:");t.s_avatanum=CUtil.NTOHS(Number(lb_util.CFG_GetToken(I)));I.SetAt(1,"WIMG:");d=lb_util.CFG_GetToken(I);t.sendPath=CUserImage.GetImagePathToNum(d);if(t.sendPath!=0)t.sbflag=1;I.SetAt(0,E);I.SetAt(1,"BID:");r=lb_util.CFG_GetToken(I);I.SetAt(1,"BLV:");C=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"BNICK:");a=lb_util.CFG_GetToken(I);I.SetAt(1,"BNCD:");m=Number(lb_util.CFG_GetToken(I));p.Set(r,C,a,m);t.SetPartner(p);I.SetAt(1,"BAID:");t.r_avatanum=CUtil.NTOHS(Number(lb_util.CFG_GetToken(I)));I.SetAt(1,"BIMG:");O=lb_util.CFG_GetToken(I);t.recvPath=CUserImage.GetImagePathToNum(O);if(t.recvPath!=0)t.rbflag=1;this.m_version=TGiboFile.VERSION_TYGEM;i=2}else{S=this.GetParam(TGiboFile.TAG_GAMETAG,D)+",";if(D.m_dwRef){t.dolsel=1;I.SetAt(0,S);I.SetAt(2,",");I.SetAt(1,"S");t.daekuktype=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"R");t.daekukrule=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"D");t.dum=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"G");t.broad=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"W");e.response=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"Z");e.zipcnt=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"T");l=lb_util.CFG_GetToken(I);this.GetTimeInfo_GAMETAG(l,M);t.sec=M.GetAt(0);t.seccnt=M.GetAt(1);t.SetTime(M.GetAt(2));this.m_gnFlag=0;this.m_gpFlag=0;this.m_gamename=this.GetParam(TGiboFile.TAG_GAMENAME,D);this.m_gameplace=this.GetParam(TGiboFile.TAG_GAMEPLACE,D);this.m_commentator=null;I.SetAt(1,"C");o=lb_util.CFG_GetToken(I);if(o!=""){this.m_gamedate=o;t.SetSaveTime(this.GetGameDate_GAMETAG(o));I.SetAt(1,"T");n=lb_util.CFG_GetToken(I);I.SetAt(1,"L");h=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"M");r=lb_util.CFG_GetToken(I);I.SetAt(1,"N");C=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"A");s=lb_util.CFG_GetToken(I);I.SetAt(1,"B");a=lb_util.CFG_GetToken(I);I.SetAt(1,"J");f=Number(lb_util.CFG_GetToken(I));I.SetAt(1,"K");m=Number(lb_util.CFG_GetToken(I));if(s==null)s=n;if(a==null)a=r;i=1;this.m_version=TGiboFile.VERSION_OLDTYGEM}else{this.m_gamedate=o;t.SetSaveTime(0);S="("+this.GetParam(TGiboFile.TAG_GAMEWHITENAME,D);I.SetAt(0,S);I.SetAt(1,"(");I.SetAt(2,"(");n=lb_util.CFG_GetToken(I);h=0;S="("+this.GetParam(TGiboFile.TAG_GAMEBLACKNAME,D);I.SetAt(0,S);r=lb_util.CFG_GetToken(I);C=0;s=n;a=r;f=0;m=0}R.Set(n,h,s,f);t.SetBangjang(R);p.Set(r,C,a,m);t.SetPartner(p);i=1;this.m_version=TGiboFile.VERSION_OLDLIVE}}D.Delete();A.Delete();G.Delete();F.Delete();I.RemoveAll();M.RemoveAll();return i},GetSubstring:function(t,e,i,n){if(n==undefined)n=null;var s,r;if(n)s=n.y;else s=0;s=t.buf.indexOf(e,s);if(s==-1){this.m_error=TGiboFile.NOT_EXIST_HEADER;return null}s+=e.length;r=t.buf.indexOf(i,s);if(r==-1){this.m_error=TGiboFile.NOT_EXIST_HEADER;return null}if(n){n.x=s;n.y=r+i.length}return t.buf.substring(s,r-1)},GetLBKFile:function(){if(!this.m_fpLBK)return null;this.m_fpLBK.SeekToFirst();return this.m_fpLBK},LoadFile:function(t,e){var i=new vx.point(0,0);this.m_error=0;this.m_strHeader=this.GetSubstring(t,"\\HS","\\HE",i);if(this.m_error!=0)return null;this.m_fpLBK=new CStringFile(CUtil.TrimLeft(this.GetSubstring(t,"\\GS","\\GE",i)));if(this.m_error!=0){this.m_error=TGiboFile.NOT_EXIST_BOARDDATA;return false}var n,s;while((n=this.GetSubstring(t,"\\RS","\\RE",i))!=null){if(n.length==0)continue;if(!this.m_pReferList)this.m_pReferList=new ObArray;s=new CTextRefer(n);this.m_pReferList.Add(s)}return true}});TGiboFile.VERSION_OLDLIVE=0;TGiboFile.VERSION_OLDTYGEM=1;TGiboFile.VERSION_TYGEM=2;TGiboFile.TAG_GAMENAME="GAMENAME";TGiboFile.TAG_GAMEDATE="GAMEDATE";TGiboFile.TAG_GAMEPLACE="GAMEPLACE";TGiboFile.TAG_GAMEWHITENAME="GAMEWHITENAME";TGiboFile.TAG_GAMEBLACKNAME="GAMEBLACKNAME";TGiboFile.TAG_GAMEINFOMAIN="GAMEINFOMAIN";TGiboFile.TAG_GAMEINFOSUB="GAMEINFOSUB";TGiboFile.TAG_WUSERINFO="WUSERINFO";TGiboFile.TAG_BUSERINFO="BUSERINFO";TGiboFile.TAG_GAMETAG="GAMETAG";var SGFTAG=SGFTAG||{};SGFTAG.APPLICATION="_AP";SGFTAG.SGF_TYPE="_TP";SGFTAG.LINE_COUNT="_SZ";SGFTAG.MATCH_TYPE="_MT";SGFTAG.RULE="_RU";SGFTAG.DUM="_DUM";SGFTAG.RESULT="_RES";SGFTAG.TIME_LIMIT="_TML";SGFTAG.CHOILGGI_CNT="_CDN";SGFTAG.CHOILGGI_SEC="_CDT";SGFTAG.GAME_DATE="_DT";SGFTAG.ENABLE_MOVEBACK="_ETB";SGFTAG.ENABLE_ANALYSIS="_ESA";SGFTAG.WHITE_ID="_WID";SGFTAG.WHITE_NICK="_WNICK";SGFTAG.WHITE_RANK="_WRK";SGFTAG.WHITE_SITECODE="_WSC";SGFTAG.WHITE_CONTRYCODE="_WCC";SGFTAG.WHITE_PICTURE="_WPIC";SGFTAG.WHITE_AVATA="_WAVA";SGFTAG.BLACK_ID="_BID";SGFTAG.BLACK_NICK="_BNICK";SGFTAG.BLACK_RANK="_BRK";SGFTAG.BLACK_SITECODE="_BSC";SGFTAG.BLACK_CONTRYCODE="_BCC";SGFTAG.BLACK_PICTURE="_BPIC";SGFTAG.BLACK_AVATA="_BAVA";SGFTAG.COMMENTATOR_ID="_CID";SGFTAG.COMMENTATOR_NICK="_CNICK";SGFTAG.COMMENTATOR_RANK="_CRK";SGFTAG.COMMENTATOR_SITECODE="_CSC";SGFTAG.COMMENTATOR_CONTRYCODE="_CCC";SGFTAG.COMMENTATOR_PICTURE="_CPIC";var CGib2Sgf=vx.Class.extend({init:function(t){this.m_gfile=null;this.m_sgf=null;this.m_nColor=0;if(t!=undefined){this.LoadGIB(t,true)}},Delete:function(){if(this.m_sgf){this.m_sgf.Delete();this.m_sgf=null}if(this.m_gfile){this.m_gfile.Delete();this.m_gfile=null}},LoadGIB:function(t,e){if(t==null)return false;if(e==undefined)e=false;var i=new TGiboFile;if(!i.LoadFile(t,null))return false;var n=i.GetLBKFile();var s=new CPKG_GAME_MATCH_IND_EX;var r=new CPKG_GAME_DONE_IND;i.ParsingHeader_Data(s,r);this.m_gfile=i;var a=1;if(s.daekukrule>0)a=2;this.m_nColor=a;var o,l;var _=new CUSERNAME;var h=new CRuleSGF;h.NewBoard(i.m_lineCnt,s.daekukrule,s.dum,0);s.GetWhite(_);h[SGFTAG.WHITE_ID]=_.id;h[SGFTAG.WHITE_NICK]=_.nick;h[SGFTAG.WHITE_RANK]=_.grade;h[SGFTAG.WHITE_SITECODE]=_.sCode;h[SGFTAG.WHITE_CONTRYCODE]=_.nCode;s.GetBlack(_);h[SGFTAG.BLACK_ID]=_.id;h[SGFTAG.BLACK_NICK]=_.nick;h[SGFTAG.BLACK_RANK]=_.grade;h[SGFTAG.BLACK_SITECODE]=_.sCode;h[SGFTAG.BLACK_CONTRYCODE]=_.nCode;var f,C,m;var u,T,S;var c=s.GetWhiteAvata();f=Number(c.GetAt(0));C=CUtil.NTOHL(Number(c.GetAt(1)));m=Number(c.GetAt(2));c.RemoveAll();c=s.GetBlackAvata();u=Number(c.GetAt(0));T=CUtil.NTOHL(Number(c.GetAt(1)));S=Number(c.GetAt(2));c.RemoveAll();if(f!=0)h[SGFTAG.WHITE_PICTURE]=C;else h[SGFTAG.WHITE_AVATA]=m;if(u!=0)h[SGFTAG.BLACK_PICTURE]=T;else h[SGFTAG.BLACK_AVATA]=S;h[SGFTAG.TIME_LIMIT]=s.time.toString();h[SGFTAG.CHOILGGI_CNT]=s.seccnt.toString();h[SGFTAG.CHOILGGI_SEC]=s.sec.toString();if(r.response!=255){l=r.zipcnt/10;switch(r.response){case TDefine.WINCODE_EQUAL:o="DRAW";break;case TDefine.WINCODE_BLACK:o="BWIN "+l.toString();break;case TDefine.WINCODE_WHITE:o="WWIN "+l.toString();break;case TDefine.WINCODE_BLACKDRAW:o="BWIN GVUP";break;case TDefine.WINCODE_WHITEDRAW:o="WWIN GVUP";break;case TDefine.WINCODE_BLACKHALT:o="BWIN DIS";break;case TDefine.WINCODE_WHITEHALT:o="WWIN DIS";break;case TDefine.WINCODE_BLACKTIME:o="BWIN TIME";break;case TDefine.WINCODE_WHITETIME:o="WWIN TIME";break;default:o="CANCEL";break}h[SGFTAG.RESULT]=o}var g,E,d,O,D;var A=new ObArray;while((g=n.ReadString())!=null){A.RemoveAll();CUtil.ParsingToken(g+" "," ",A);D=A.length;if(D==0)continue;E=A[0];if(E=="STO"){if(D<6)return false;a=Number(A[3]);d=Number(A[4]);O=Number(A[5])}else if(E=="SKI"){a=a%2+1;d=O=-1}else if(E=="WIT"){h.SetBack(undefined);continue}else{continue}h.GameStone(d,O,a,false)}this.m_sgf=h;if(e&&i.m_pReferList){var A=i.m_pReferList;var G,F,R=A.length;for(F=0;F<R;F++){G=A.GetAt(F);if(G.explain){h.SetMove(G.susun);h.DocumentAdd(G.explain)}if(G.lbk){this.AppendLBK(new CStringFile(G.lbk))}}}this.m_sgf.SetCurNode(this.m_sgf.FindPutNode());return true},AppendLBK:function(t){var e=this.m_sgf;var i=e;var n,s,r,a,o,l=this.m_nColor;var _=new ObArray;while((n=t.ReadString())!=null){_.RemoveAll();CUtil.ParsingToken(n+" "," ",_);o=_.length;if(o==0)continue;s=_[0];if(s=="STO"){if(o<6)return false;l=Number(_[3]);r=Number(_[4]);a=Number(_[5])}else if(s=="SKI"){l=l%2+1;r=a=-1}else if(s=="WIT"){e.SetBack(undefined);continue}else{continue}if(i){i=i.m_child;if(i&&i.m_ptPos.x==r&&i.m_ptPos.y==a){e.SetCurNode(i);continue}}e.ReferStone(r,a,l,false)}return true}});var CGameTime=vx.Class.extend({init:function(){this.Set(65535,0,0)},Delete:function(){},Set:function(t,e,i){this.m_nSetTimeLeft=t;this.m_nSetChoilggiCnt=e;this.m_nSetChoilggiSec=i;this.m_nTimeLeft=t;this.m_nChoilggiCnt=e;this.m_nChoilggiSec=i},Update:function(t,e,i){this.m_nTimeLeft=t;this.m_nChoilggiCnt=e;this.m_nChoilggiSec=i},Clear:function(){this.Set(65535,0,0)},IsLimit:function(){return this.m_nSetTimeLeft!=65535},RestoreChoilggi:function(){if(this.m_nTimeLeft==0){this.m_nChoilggiSec=this.m_nSetChoilggiSec}},Calculate:function(t){if(!this.IsLimit())return-1;if(this.m_nTimeLeft>0){if(this.m_nTimeLeft<=t){this.m_nTimeLeft=0;return-2}this.m_nTimeLeft-=t;return 0}if(this.m_nChoilggiSec>0){if(this.m_nChoilggiSec<=t){this.m_nChoilggiSec=0;return this.m_nSetChoilggiCnt-this.m_nChoilggiCnt+1}this.m_nChoilggiSec-=t;return-3}return-1}});var CStone=vx.object.extend({init:function(){this._super();this.m_bLast=false;this.m_nColor=0;this.m_nShape=0;this.m_nBase=-1;this.m_nIndex=-1;this.m_nTimeChk=0},Delete:function(){this._super()},OnCreate:function(){if(!this._super())return false;return true},OnDraw:function(t,e){var i,n,s;if(this.m_nColor==GSGF.GT_BLACK)i=1;else if(this.m_nColor==GSGF.GT_WHITE)i=0;else return;var r=this.m_parent;if(r){var a=0;if(r.OrFlagEx(CBoard.BOARDEX_SHOWNUM_MASK)){if(r.IsFlagEx(CBoard.BOARDEX_SHOWNUM))a=1;else if(r.IsFlagEx(CBoard.BOARDEX_SHOWNUM2))a=2}var o=r.GetStoneImage();var l=r.GetStoneImageRect();if(o){if(i==1)l.Offset(l.Width()*i,0);o.DrawEx(t,e.left,e.top,l,0)}else{if(i==1){n=0;s=13816530}else{n=16777215;s=13816530}t.DrawEllipse(e,n,s)}var _=this.m_nShape;if(_>0){if((_==GSGF.GT_WHOUSE||_==GSGF.GT_BHOUSE)&&r.IsReview(true)){}else{if(i==1)n=16777215;else n=0;r.DrawShape(t,e,_,n)}}else if(this.m_nBase>=0||a==1||a==2&&this.m_bLast){var h;if(a==2&&this.m_nBase<0)h=r.GetIndexFont(this.m_nIndex,true);else h=r.GetIndexFont(this.m_nIndex);if(h){var f;if(a&&this.m_nBase==-1)f=this.m_nIndex;else f=this.m_nIndex-this.m_nBase+1;if(f>0){if(i==0)n=0;else n=16777215;t.DrawText(f.toString(),e,CDefine.DT_VCENTER|CDefine.DT_CENTER,h,n)}}a=1}if(this.m_bLast){var C,m,u=new ObArray;if(a||this.m_nShape>0){C=Math.floor(this.m_width/4);u.Add(CUtil.CPoint(e.right,e.bottom));u.Add(CUtil.CPoint(e.right,e.bottom-C));u.Add(CUtil.CPoint(e.right-C,e.bottom));n=16711680}else{C=Math.floor(this.m_width/9);e.Deflate(C,C);m=e.CenterPoint();u.Add(m.Clone());m.x=e.right-1;u.Add(m.Clone());m.x=u[0].x;m.y=e.bottom-1;u.Add(m);if(i==0)n=255;else n=16777215}t.DrawPolygon(u,n,n,1,1);u.RemoveAll()}}},SetStone:function(t,e,i,n){if(t.y==0&&t.x==0){var s=0}var r=0;if(t.nValue==GSGF.GT_EMPTY&&this.IsFlag(CFlags.STATUS_SHOW))r=1;this.ShowObject(t.nValue!=GSGF.GT_EMPTY);if(t.nValue==this.m_nColor&&t.nIndex==this.m_nIndex&&e==this.m_nShape&&i==this.m_bLast&&n==this.m_nBase)return r;this.m_nIndex=t.nIndex;this.m_nColor=t.nValue;this.m_nShape=e;this.m_nBase=n;this.m_bLast=i;this.Invalidate();return r},SetStoneAlpha:function(t){if(t){if(this.m_nAlpha==1)this.SetAlpha(.5)}else{if(this.m_nAlpha!=1)this.SetAlpha(1)}},PutDown:function(t,e){if(t)this.m_nTimeChk=Date.now();if(this.m_parent.IsFlagEx(CBoard.BOARDEX_PUMPANI)&&!this.m_parent.m_mother){var i=15;var n=1.5;var s=-.1;this.SetScale(n,n);if(!t){this.PlayTransform(CDefine.TRANSFORM_XSCALE,n,1,s,i);this.PlayTransform(CDefine.TRANSFORM_YSCALE,n,1,s,i);this.m_nTmDelay=100}this.ModifyFlag(CFlags.STATUS_TOP,0)}else{this.m_parent.PlayStoneSound(e)}},PutDownEnd:function(){var t=Date.now()-this.m_nTimeChk;var e=this.GetSkin();if(e.SetNetState!=undefined)e.SetNetState(t);if(this.m_nScaleX!=1){if(t<100)this.m_nTmDelay=100-t;var i=15;var n=1.5;var s=-.1;this.PlayTransform(CDefine.TRANSFORM_XSCALE,n,1,s,i);this.PlayTransform(CDefine.TRANSFORM_YSCALE,n,1,s,i)}},PutDownPartner:function(t){if(this.m_parent.IsFlagEx(CBoard.BOARDEX_PUMPANI)&&!this.m_parent.m_mother){var e=15;var i=1.5;var n=-.1;this.SetScale(i,i);this.PlayTransform(CDefine.TRANSFORM_XSCALE,i,1,n,e);this.PlayTransform(CDefine.TRANSFORM_YSCALE,i,1,n,e);this.m_nTmDelay=100;this.ModifyFlag(CFlags.STATUS_TOP,0)}else{this.m_parent.PlayStoneSound(t)}},PutDownError:function(){this.SetScale(1,1);this.ModifyFlag(0,CFlags.STATUS_TOP);this.ShowObject(false)},SelfEventSync:function(t,e,i){if(t==CDefine.CMD_TRANSFORM_END){this.ModifyFlag(0,CFlags.STATUS_TOP);var n=this.m_parent.SyncMatrix(true);this.m_parent.PlayStoneSound(n);return false}return true}});var CBoardMenu=vx.object.extend({init:function(t){this._super();this.m_board=null;this.m_bkgnd=null;this.m_rcSrc=null;this.m_crBk=16777215;if(t==undefined)this.m_bHorz=false;else this.m_bHorz=t},Delete:function(){this.m_board=null;this.m_bkgnd=null;this.m_rcSrc=null;this._super()},OnCreate:function(){if(!this._super())return false;var t,e=CUtil.MAKEFRAME(0,0,1,0);var i=CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED;if(this.m_bHorz)t=CDefine.TTD_OBJECTDOWN;else t=CDefine.TTD_OBJECTLEFT;var n=CUtil.CPoint(28,28);var s=CMyGlobal.gIcon;var r,a,o=this.GetClientRect();if(this.m_bHorz){o.left+=2;o.right=o.left+n.x;o.top+=2;o.bottom=o.top+n.y}else{o.right-=6;o.left=o.right-n.x;o.top+=6;o.bottom=o.top+n.y}if(!this.m_bHorz){var l=o.Clone();l.Deflate(0,0,0,6);a=new CFlatButton(4294967295,4294967295,304891,2763306,4);a.CreateP(this.m_stage,l,CDefine.VXID_CLOSE,CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED,0,this);a.SetColor(CColor.INDEX_CONTROLBORDER,a.GetColor(CColor.INDEX_CONTROLFACE));a.SetColor(CColor.INDEX_CONTROLTEXT,16777215);a.CreateToolTip(this.FindText("TT_REVIEW_CLOSE"),t);o.Offset(0,29)}a=new CSelectButton(16777215,11323391,0);a.CreateP(this.m_stage,o,CMyDefine.IDC_BTN_TOOL,CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED,CFlags.VXBUTTON_USECHECK,this);a.CreateToolTip(this.FindText("TT_REVIEW_MENU"),t);for(r=0;r<=8;r++){a.AddSubButton(CMyDefine.IDC_BTN_TOOL+r,CMyGlobal.GetIconTag28(8+r),n);if(r==0||r==7)a.AddSubSeperator(1)}if(this.m_bHorz)a.m_nShowType=1;a.SelectSubButton(CMyDefine.IDC_TOOL_ALTERNATIVE);a.SetImageEx(CMyGlobal.gIcon,CUtil.MAKEFRAME(0,0,1,0),CMyGlobal.GetIconRect(28,0));this.CreateMenuButton(o,CMyDefine.IDC_TOOL_REFRESH,"TT_REVIEW_RE",5,t);this.CreateMenuButton(o,CMyDefine.IDC_TOOL_SAVE,"TT_REVIEW_SAVE",4,t);this.CreateMenuButton(o,CMyDefine.IDC_ARROW_PREV,"TT_PREV",6,t);this.CreateMenuButton(o,CMyDefine.IDC_ARROW_NEXT,"TT_NEXT",7,t);return true},CreateMenuButton:function(t,e,i,n,s){if(s==CDefine.TTD_OBJECTDOWN)t.Offset(29,0);else t.Offset(0,29);var r=new vx.button;r.CreateP(this.m_stage,t,e,CFlags.STATUS_SHOW|CFlags.STATUS_ENABLED,0,this);r.SetImageEx(CMyGlobal.gIcon,CUtil.MAKEFRAME(0,0,1,0),CMyGlobal.GetIconRect(28,0));r.SetButtonTag(CMyGlobal.GetIconTag28(n),0,0);r.CreateToolTip(this.FindText(i),s)},OnDraw:function(t,e){t.DrawRoundRect(e,4,this.m_crBk,0)},EventSync:function(t,e,i,n){this._super(t,e,i,n);if(t==CDefine.CMD_VXBUTTON_CLICK){if(e==CDefine.VXID_CLOSE){if(this.m_board.IsFlagEx(CBoard.BOARDEX_REVIEWMODE))this.m_parent.SendMessage(t,CMyDefine.IDC_BTN_CLOSEREVIEW,i,null);else this.m_parent.SendMessage(t,CMyDefine.IDC_BTN_CLOSEREFER,i,null)}else{this.m_parent.SendMessage(t,e,i,n);if(e==CMyDefine.IDC_TOOL_REFRESH){var s=this.FindObject(CMyDefine.IDC_BTN_TOOL);if(s)s.SelectSubButton(CMyDefine.IDC_TOOL_ALTERNATIVE)}}}},Init:function(t){this.m_board=t;var e,i=t.m_parent;if(this.m_bHorz)e=new vx.point(149,32);else e=new vx.point(41,185);this.m_rcSrc=new vx.rect(0,0,e.x,e.y);this.Create(i.m_stage,this.GetMenuRect(),CDefine.VXID_NONE,CFlags.STATUS_ENABLED|CFlags.STATUS_BOTTOM,0,i);t.SetSubMenu(this)},Reposition:function(){this.MoveObject(this.GetMenuRect())},GetMenuRect:function(){var t;var e=this.m_rcSrc.Width();var i=this.m_rcSrc.Height();if(this.m_bHorz){t=this.m_board.GetObjectRect();t.top=t.bottom;t.bottom=t.top+i;t.right=t.left+e}else{if(this.m_board.IsFlagEx(CBoard.BOARDEX_SHOWCOORD)){t=this.m_board.GetObjectRect();t.left=t.right+2}else{t=this.m_board.m_rcR.Clone();this.m_board.ClientToStage(t);t.left=t.right-5}t.right=t.left+e;t.top=Math.floor((t.top+t.bottom-i)/2)+50;t.bottom=t.top+i}return t},ResetTool:function(){var t=this.FindObject(CMyDefine.IDC_BTN_TOOL);if(t)t.SelectSubButton(CMyDefine.IDC_TOOL_ALTERNATIVE)},ShowMenu:function(t){if(t)this.ShowControl(CMyDefine.IDC_TOOL_SAVE,!this.m_board.IsFlagEx(CBoard.BOARDEX_REVIEWMODE));this.ShowObject(t)}});var CTerriPanel=vx.object.extend({init:function(){this._super();this.m_nLine=0;this.m_mtMark=null},Delete:function(){GSGF.DeleteMatrix(this.m_mtMark);this.m_mtMark=null;this._super()},OnCreate:function(){if(!this._super())return false;this.ModifyFlag(0,CFlags.STATUS_ENABLED);var t=this.m_parent;var e=t.m_nLine;this.m_nLine=e;this.m_mtMark=GSGF.NewMatrix(e,e);return true},OnDraw:function(t,e){var i=this.m_parent;var n=CUtil.CRect(0,0,0,0);var s,r,a,o=this.m_nLine;for(s=0;s<o;s++){for(r=0;r<o;r++){a=this.m_mtMark[s][r];switch(a){case GSGF.GT_BLACKTERI:case GSGF.GT_WHITETERI:i.GetStoneRect2(s,r,n);i.DrawShape(t,n,a,0);break}}}},SetTerritory:function(t){if(t){GSGF.ClearMatrix(this.m_mtMark,0);var e=t.board;var i=e.length;var n,s=0;var r,a,o=this.m_nLine;if(i==o*o){for(a=0;a<o;a++){for(r=0;r<o;r++){switch(Number(e.charAt(s))){case 1:n=GSGF.GT_BLACKTERI;break;case 2:n=GSGF.GT_WHITETERI;break;default:n=0}this.m_mtMark[r][a]=n;s++}}}}this.ShowObject(t!=null)}});var CBoard=vx.object.extend({init:function(t,e){this._super();if(t==undefined)t=null;if(e==undefined)e=null;this.m_ptCurPos=new vx.point(-1,-1);this.m_rcR=CUtil.CRect(0,0,0,0);this.m_imgStone=null;this.m_rcStone=CUtil.CRect(0,0,0,0);this.m_nUS=0;this.m_nBnd=0;this.m_crCoord=0;this.m_nLine=GSGF.DEFAULT_BOARD_WIDTH;this.m_nType=0;this.m_mtStone=null;this.m_rSGF=null;this.m_cSGF=null;this.m_aryChoice=new ObArray;this.m_nSyncLevel=0;this.m_nOrder=CBoard.STONE_NONE;this.m_callback_upload=t;this.m_callback_info=e;this.m_mother=null;this.m_linker=null;this.m_imgB=null;this.m_imgH=null;this.m_imgS=null;this.m_idxB=0;this.m_whiteTime=new CGameTime;this.m_blackTime=new CGameTime;this.m_nTool=0;this.m_nBigPos=CUtil.CPoint(-1,-1);this.m_ptTmp=CUtil.CPoint(-1,-1);this.m_nSaveIndex=-1;this.m_crLevel=0;this.m_menu=null;this.ModifyFlag(CFlags.STATUS_NOCLIP,0);this.m_nAlphaBk=1;this.m_terriPan=null;this.m_tfIndex=null;this.m_tfCoord=null},toString:function(){return"(CBoard)"},Delete:function(){this.m_tfIndex=null;this.m_tfCoord=null;this.m_terriPan=null;this.m_menu=null;this.m_ptTmp=null;this.m_nBigPos=null;this.m_ptCurPos=null;this.m_callback_upload=null;this.m_callback_info=null;this.m_mother=null;if(this.m_linker){this.m_linker.RemoveAll();this.m_linker=null}this.m_imgStone=null;this.m_rcStone=null;this.m_imgS=null;this.m_imgH=null;this.m_imgB=null;this.m_rcR=null;if(this.m_rSGF){this.m_rSGF.Delete();this.m_rSGF=null}if(this.m_cSGF){this.m_cSGF.Delete();this.m_cSGF=null}if(this.m_aryChoice){this.m_aryChoice.RemoveAll();this.m_aryChoice=null}if(this.m_whiteTime){this.m_whiteTime.Delete();this.m_whiteTime=null}if(this.m_blackTime){this.m_blackTime.Delete();this.m_blackTime=null}this.Clear();if(vx.Global.BoardArray!=undefined){vx.Global.BoardArray.RemoveObject(this)}this._super()},Clear:function(){if(this.m_mtStone){var t,e,i,n,s=this.m_mtStone.length;for(t=0;t<s;t++){n=this.m_mtStone[t].length;for(e=0;e<n;e++){i=this.m_mtStone[t][e];if(i&&!(i.m_uFlag2&CFlags.STATUS2_DELETE))i.Destroy()}}GSGF.DeleteMatrix(this.m_mtStone);this.m_mtStone=null}},GetStoneImage:function(){return this.m_imgStone},SetSubMenu:function(t){this.m_menu=t},SetBoardOrder:function(t){this.m_nOrder=t},ResetBoard:function(t){this.m_nSaveIndex=-1;var e=false;if(t!=this.m_nLine){this.Clear();e=true}this.m_nLine=t;if(e)this.ResizeBoard();var i,n,s,r=CUtil.CRect(0,0,0,0);if(!this.m_mtStone){this.m_mtStone=GSGF.NewMatrix(t,t);for(i=0;i<t;i++){for(n=0;n<t;n++){this.GetStoneRect2(i,n,r);s=new CStone;s.CreateP(this.m_stage,r,100*i+n,CFlags.STATUS_NOCLIP|CFlags.STATUS_NOMESSAGE,0,this);this.m_mtStone[i][n]=s}}}else{for(i=0;i<t;i++){for(n=0;n<t;n++){s=this.m_mtStone[i][n];s.ShowObject(false)}}}if(this.m_rSGF)this.m_rSGF.ResetSGFMatrix(t);if(this.m_cSGF)this.m_cSGF.ResetSGFMatrix(t);if(this.m_whiteTime)this.m_whiteTime.Clear();if(this.m_blackTime)this.m_blackTime.Clear();this.KillTimer(CBoard.TIMER_PLAYER_WHITE);this.KillTimer(CBoard.TIMER_PLAYER_BLACK);this.m_nTool=0;this.m_nBigPos=CUtil.CPoint(-1,-1)},GetStoneRect:function(t,e,i){if(i==null||i==undefined)i=CUtil.CRect(0,0,0,0);i.left=this.m_rcR.left+this.m_nBnd+t*this.m_nUS;i.top=this.m_rcR.top+this.m_nBnd+e*this.m_nUS;i.right=i.left+this.m_nUS;i.bottom=i.top+this.m_nUS;return i},GetStoneRect2:function(t,e,i){if(i==null||i==undefined)i=CUtil.CRect(0,0,0,0);i.left=this.m_rcR.left+this.m_nBnd+t*this.m_nUS;i.top=this.m_rcR.top+this.m_nBnd+e*this.m_nUS;i.right=i.left+this.m_nUS;i.bottom=i.top+this.m_nUS;if(this.m_nUS>=23){i.right++;i.bottom++}return i},GetRealRect:function(){var t=this.GetClientRect();return CBoard.GetBoardRect(t)},OnCreate:function(){if(!this._super())return false;this.m_imgB=this.FindImage("board.png");this.m_imgH=this.FindImage("hwa.png");this.m_imgS=this.FindImage("boardshadow.png");this.m_imgStone=this.FindImage("wbsall.png");this.m_tfIndex=new vx.font(this.GetSkin().m_global.g_fontName,12,false);this.m_tfCoord=new vx.font(this.GetSkin().m_global.g_fontName,12,false);this.ResetBoard(this.m_nLine);this.ModifyFlag(CFlags.STATUS_DRAWAFTER,0);if(vx.Global.BoardArray==undefined)vx.Global.BoardArray=new ObArray;vx.Global.BoardArray.Add(this);return true},OnLButtonDown:function(t,e,i){if(this.IsEmpty())return;var n,s,r=this.m_rcR.Clone();r.Deflate(this.m_nBnd,this.m_nBnd);if(r.Contain(t,e)){n=Math.floor((t-r.left)/this.m_nUS);s=Math.floor((e-r.top)/this.m_nUS);var a=true;if(this.m_parent.IsPlayer!=undefined)a=this.m_parent.IsPlayer();if(this.OrFlagEx(CBoard.BOARDEX_EDITABLE)||this.m_cSGF){if(!this.m_cSGF&&this.m_rSGF.IsGega()&&a){if(!this.IsFlagEx(CBoard.BOARDEX_DEADSTONE_CONFIRM)){if(this.CheckDeadStone(n,s)==0)this.ShowGegaMenu(n,s)}}else{if(this.IsPutNodeStatus()||!this.HitNextStone(n,s)){if(this.m_nTool==0)this.AddStone(n,s);else this.AddMark(n,s,this.m_nTool)}}}else{if(!this.HitNextStone(n,s)&&!this.m_cSGF){this.ArrowMove(1)}}}},OnRButtonDown:function(t,e,i){if(!this.OrFlagEx(CBoard.BOARDEX_EDITABLE)&&!this.m_cSGF){this.ArrowMove(-1)}},OnMouseMove:function(t,e,i){if(this.IsEmpty())return;if(this.OrFlagEx(CBoard.BOARDEX_EDITABLE)&&(!this.IsViewer()||this.m_cSGF)){var n,s,r=this.m_rcR.Clone();r.Deflate(this.m_nBnd,this.m_nBnd);if(r.Contain(t,e)){n=Math.floor((t-r.left)/this.m_nUS);s=Math.floor((e-r.top)/this.m_nUS);if(n>=0&&n<this.m_nLine&&s>=0&&s<this.m_nLine){if(n!=this.m_ptCurPos.x||s!=this.m_ptCurPos.y){this.InvalidateRect(this.GetStoneRect2(this.m_ptCurPos.x,this.m_ptCurPos.y));this.m_ptCurPos.x=n;this.m_ptCurPos.y=s;this.InvalidateRect(this.GetStoneRect2(n,s))}return}}}this.ClearCurrentPos()},OnMouseLeave:function(){this.ClearCurrentPos()},OnCancelMode:function(){this.ClearCurrentPos()},EventSync:function(t,e,i,n){this._super(t,e,i,n);if(t==CDefine.CMD_VXMENU_CLICK){if(this.m_nBigPos.x!=-1&&this.m_nBigPos.y!=-1){if(e==menu.ID_MENU_BIGON){this.CheckDeadStone(this.m_nBigPos.x,this.m_nBigPos.y,true)}this.InvalidateRect(this.GetStoneRect(this.m_nBigPos.x,this.m_nBigPos.y));this.m_nBigPos.x=this.m_nBigPos.y=-1}}},ClearCurrentPos:function(){if(this.m_ptCurPos.x!=-1&&this.m_ptCurPos.y!=-1){this.InvalidateRect(this.GetStoneRect2(this.m_ptCurPos.x,this.m_ptCurPos.y));this.m_ptCurPos.x=this.m_ptCurPos.y=-1}},IsMyTurn:function(){return this.m_nOrder==3||this.m_nOrder==this.GetNextColor()},GetNextColor:function(){if(this.m_nTool==0){if(this.m_cSGF)return this.m_cSGF.GetNextColor(this.IsFlagEx(CBoard.BOARDEX_REVIEWMODE));else return this.m_rSGF.GetNextColor(this.IsFlagEx(CBoard.BOARDEX_REFERMODE))}else{switch(this.m_nTool){case CBoard.TOOL_BLACK:return GSGF.GT_BLACK;case CBoard.TOOL_WHITE:return GSGF.GT_WHITE}return GSGF.GT_EMPTY}},GetMarkCount:function(){if(this.m_cSGF){return this.m_cSGF.m_cboard.m_nShapeCount}else if(this.m_rSGF){if(!this.m_rSGF.m_bViewSync)return this.m_rSGF.m_vboard.m_nShapeCount;else if(this.m_rSGF.IsGega())return this.m_rSGF.m_pboard.m_nShapeCount;else return this.m_rSGF.m_cboard.m_nShapeCount}else return 0},GetMark:function(t,e){if(this.m_cSGF)return this.m_cSGF.m_cboard.GetShapeAt(t,e);else if(this.m_rSGF){if(!this.m_rSGF.m_bViewSync)return this.m_rSGF.m_vboard.GetShapeAt(t,e);else if(this.m_rSGF.IsGega())return this.m_rSGF.m_pboard.GetShapeAt(t,e);else return this.m_rSGF.m_cboard.GetShapeAt(t,e)}else return 0},SyncMatrix:function(t){if(t==undefined)t=false;if(this.IsEmpty())return 0;var e,i,n,s=null;if(this.m_cSGF)n=this.m_cSGF;else n=this.m_rSGF;e=0;i=n.GetLastBranchIndex();if(this.GetMarkCount()>0){if(!n.m_bViewSync)s=n.m_vboard;else if(n.IsGega())s=n.m_pboard;else s=n.m_cboard}var r=0;var a=n.GetLast();var o,l,_,h=this.m_nLine;for(l=0;l<h;l++){for(_=0;_<h;_++){bs=n.GetStone(l,_);if(a.x==l&&a.y==_)o=true;else o=false;if(s)e=s.GetShapeAt(l,_);r+=this.m_mtStone[l][_].SetStone(n.GetStone(l,_),e,o,i)}}if(this.m_nType!=CBoard.BOARDTYPE_GAMER){this.UpdateChoiceRect();if(n.m_bViewSync)h=n.m_curNode.GetNextChoice(this.m_aryChoice);else h=n.m_viewNode.GetNextChoice(this.m_aryChoice);if(h>1)this.UpdateChoiceRect()}this.CheckSyncLevel();if(t)return r;else return 0},SyncMatrix_Prev:function(t,e){if(this.IsEmpty()||(t==-1||e==-1))return;var i,n,s,r=null;if(this.m_cSGF)s=this.m_cSGF;else s=this.m_rSGF;i=0;n=s.GetLastBranchIndex();if(this.GetMarkCount()>0){if(!s.m_bViewSync)r=s.m_vboard;else if(s.IsGega())r=s.m_pboard;else r=s.m_cboard}var a,o,l,_=this.m_nLine;for(o=0;o<_;o++){for(l=0;l<_;l++){a=this.m_mtStone[o][l];if(a.m_bLast){a.m_bLast=false;a.Invalidate();break}}}if(r)i=r.GetShapeAt(t,e);this.m_mtStone[t][e].SetStone(s.GetStone(t,e),i,true,n)},GetStoneColor:function(t,e){if(this.IsEmpty())return GSGF.GT_EMPTY;var i,n;if(this.m_cSGF)i=this.m_cSGF;else i=this.m_rSGF;n=i.GetStone(t,e);return n.nValue},GetCoordGapSize:function(){var t,e=Math.min(this.m_width,this.m_height);if(this.GetSkin().m_rScale==1)t=Math.floor(e*.02);else t=Math.floor(e*.02);var i=16*this.GetSkin().m_rScale;if(t>i)t=i;else if(t<6)return 0;return Math.floor(t*2)},GetCoordFont:function(){var t,e=Math.min(this.m_width,this.m_height);if(this.GetSkin().m_rScale==1)t=Math.floor(e*.02);else t=Math.floor(e*.02);var i=16*this.GetSkin().m_rScale;if(t>i)t=i;else if(t<6)return null;this.m_tfCoord.SetSize(t);this.m_tfCoord.SetBold(false);return this.m_tfCoord},GetIndexFont:function(t,e,i){if(e==undefined)e=false;if(i==undefined)i=false;var n,s,r=this.m_nUS;if(i)r=Math.floor(r*1.2);var a=r-6;if(t<10){n=1;s=-2}else if(t>=10&&t<100){n=2;s=2}else{n=3;s=3}var o=a/n+s*a/8;o-=8;if(this.GetSkin().m_rScale==1)o=Math.floor(o*.8);if(o>20)o=20;else if(o<7)o=7;this.m_tfIndex.SetSize(o);this.m_tfIndex.SetBold(e);return this.m_tfIndex},OnDraw:function(t,e){var i=0;var n=4294967295;var s=this.m_rcR.Clone();var r,a=this.m_nLine;var o,l,_=this.m_crCoord;if(_==0){l=16777215;o=.3}else{l=0;o=.5}var h=this.IsFlagEx(CBoard.BOARDEX_SHOWALPHA);if(this.IsFlagEx(CBoard.BOARDEX_SHOWCOORD)){var f=s.Clone();var C=this.GetCoordGapSize();f.Inflate(0,0,C,C);if(this.m_imgS&&!h)this.m_imgS.DrawBox(t,f,0);var m,u="A";var T=this.GetCoordFont();if(T){var S=CDefine.DT_VCENTER|CDefine.DT_CENTER;var c,g=CUtil.CRect(s.right,s.top+this.m_nBnd,f.right,s.top+this.m_nBnd+this.m_nUS);m=!this.IsFlagEx(CBoard.BOARDEX_Y_ALPHABET);c=u.charCodeAt(0);for(r=0;r<a;r++){if(m){c=r+1;t.DrawText(c.toString(),g,S,T,this.m_crCoord)}else{t.DrawText(String.fromCharCode(c),g,S,T,this.m_crCoord);c++}g.Offset(0,this.m_nUS)}g.SetRect(s.left+this.m_nBnd,s.bottom,s.left+this.m_nBnd+this.m_nUS,f.bottom);m=this.IsFlagEx(CBoard.BOARDEX_X_DIGIT);c=u.charCodeAt(0);for(r=0;r<a;r++){if(m){c=r+1;t.DrawText(c.toString(),g,S,T,this.m_crCoord)}else{t.DrawText(String.fromCharCode(c),g,S,T,this.m_crCoord);c++}g.Offset(this.m_nUS,0)}}}if(h)t.Alpha(this.m_nAlphaBk);if(this.m_imgB)this.m_imgB.DrawPattern(t,s,this.m_imgB.GetFrameRect(this.m_idxB),0);else t.FillSolidRect(s,16766588);if(h)t.RestoreAlpha();if(this.m_nSyncLevel>0&&!(this.m_uFlagEx&CBoard.BOARDEX_NODRAW_SYNCLEVEL)){var E=this.m_crLevel;var d=this.m_nBnd;t.Draw3dRect(s,E,E,1,d,0);t.Draw3dRect(s,0,0,1);if(this.m_menu&&this.m_menu.IsFlag(CFlags.STATUS_SHOW)&&!this.IsFlagEx(CBoard.BOARDEX_SHOWCOORD)){var f=this.m_menu.GetObjectRect();this.StageToClient(f);t.DrawLine(s.right-1,f.top+1,s.right-1,f.bottom-2,E)}}else{t.DrawRectangle(s,4294967295,0)}if(s.Width()>=80){var O=this.m_nBnd+Math.floor(this.m_nUS/2);s.Deflate(O,O);for(r=1;r<a-1;r++){t.DrawLine(s.left,s.top+r*this.m_nUS,s.right,s.top+r*this.m_nUS,i)}for(r=1;r<a-1;r++){t.DrawLine(s.left+r*this.m_nUS,s.top,s.left+r*this.m_nUS,s.bottom,i)}t.DrawLine(s.left,s.top,s.right,s.top,i);t.DrawLine(s.right,s.top,s.right,s.bottom,i);t.DrawLine(s.left,s.bottom,s.right,s.bottom,i);t.DrawLine(s.left,s.top,s.left,s.bottom,i)}var D=null;switch(a){case 11:D=GSGF.BOARD11;break;case 13:D=GSGF.BOARD13;break;case 19:D=GSGF.BOARD19;break}if(D&&this.m_nUS>=CBoard.SIZE_MIN_UNIT){var A=CUtil.CRect(0,0,0,0);var G,F,R,p,I,M=this.m_imgH;a=D[0].length;if(this.m_nUS<15)I=0;else if(this.m_nUS<30)I=1;else if(this.m_nUS<45)I=2;else I=3;if(M){var v=M.GetFrameSize();R=v.x}else{R=4+I*2}for(r=0;r<a;r++){this.GetStoneRect(D[0][r],D[1][r],A);G=(A.left+A.right)/2;F=(A.top+A.bottom)/2;p=R/2;if(M){M.DrawFrame(t,G-p,F-p,I,0)}else{A.SetRect(G-p,F-p,G-p+R,F-p+R);t.DrawEllipse(A,i)}}}if(this.GetMarkCount()>0){s=CUtil.CRect(0,0,0,0);var b,N,x,c,y,B=this.m_nLine;for(b=0;b<B;b++){for(N=0;N<B;N++){c=this.GetMark(b,N);y=this.GetStoneColor(b,N);if(c>0&&(y==GSGF.GT_EMPTY||y==GSGF.GT_NOTHOUSE)){if((c==GSGF.GT_WHOUSE||c==GSGF.GT_BHOUSE)&&this.IsReview(true)){continue}this.GetStoneRect2(b,N,s);if(!h&&c>=GSGF.GT_LABEL&&c<=GSGF.GT_CHAR_END&&c!=GSGF.GT_NOTHOUSE){this.DrawMarkBack(t,this.m_rcR,s.Clone(),this.m_imgB,this.m_imgB.GetFrameRect(this.m_idxB))}this.DrawShape(t,s,c,0)}}}}if(this.OrFlagEx(CBoard.BOARDEX_DEADSTONE_MASK)){if(this.m_nBigPos.x!=-1&&this.m_nBigPos.y!=-1){this.GetStoneRect(this.m_nBigPos.x,this.m_nBigPos.y,s);t.Alpha(.5);this.DrawShape(t,s,GSGF.GT_NOTHOUSE,0);t.RestoreAlpha()}}},DrawShape:function(t,e,i,n){if(i>=GSGF.GT_CHAR_START&&i<=GSGF.GT_CHAR_END){var s=String.fromCharCode(i);t.DrawText(s,e,CDefine.DT_VCENTER|CDefine.DT_CENTER,this.GetIndexFont(1,true,true),n)}else{var r=e.Clone();var a=r.Width();var o,l=Math.floor(a/16);if(l<1)l=1;switch(i){case GSGF.GT_NOTHOUSE:o=Math.floor(a/6)+Math.floor(l/2);r.Deflate(o,o);t.DrawEllipse(r,16711680,4294967295,1,l);break;case GSGF.GT_CIRCLE:o=Math.floor(a/4)+Math.floor(l/2);r.Deflate(o,o);t.DrawEllipse(r,4294967295,n,1,l);break;case GSGF.GT_CROSS:o=Math.floor(a/3.3)+Math.floor(l/2);r.Deflate(o,o);t.DrawLine(r.left,r.top,r.right,r.bottom,n,1,l);t.DrawLine(r.right,r.top,r.left,r.bottom,n,1,l);break;case GSGF.GT_RECT:o=Math.floor(a/3);r.Deflate(o,o);t.DrawRectangle(r,n,4294967295,1,l);break;case GSGF.GT_TRIANGLE:{var _=new ObArray;o=Math.floor(a/3.2);r.Deflate(o,o);_.Add(CUtil.CPoint((r.left+r.right)/2,r.top));_.Add(CUtil.CPoint(r.left,r.bottom));_.Add(CUtil.CPoint(r.right,r.bottom));t.DrawPolygon(_,n,4294967295,1,l);_.RemoveAll()}break;case GSGF.GT_BHOUSE:case GSGF.GT_BLACKRECT:o=Math.floor(a/3);r.Deflate(o,o);t.DrawRectangle(r,0,4294967295,1,l);break;case GSGF.GT_WHOUSE:case GSGF.GT_WHITERECT:o=Math.floor(a/3);r.Deflate(o,o);t.DrawRectangle(r,16777215,4294967295,1,l);break;case GSGF.GT_BLACKTERI:o=Math.floor(a/3);r.Deflate(o,o);t.DrawRectangle(r,0,10790052,1,1);break;case GSGF.GT_WHITETERI:o=Math.floor(a/3);r.Deflate(o,o);t.DrawRectangle(r,16777215,10790052,1,1);break}}},OnDrawAfter:function(t,e){var i=false;var n,s=this.m_aryChoice.length;if(s>1){var r=this.GetIndexFont(1,true);if(r){for(n=1;n<s;n++){a=this.m_aryChoice[n].m_ptPos;if(a&&a.x!=-1&&a.y!=-1){o=this.GetStoneRect2(a.x,a.y);o.Offset(e.left,e.top);t.DrawEllipse(o,9421311,4294967295);str="R"+n;t.DrawText(str,o,CDefine.DT_VCENTER|CDefine.DT_CENTER,r,0);if(a.x==this.m_ptCurPos.x&&a.y==this.m_ptCurPos.y)i=true}}}}if(this.m_ptCurPos.x!=-1&&this.m_ptCurPos.y!=-1&&this.IsShowNextStone()){var a=this.m_ptCurPos;var o=this.GetStoneRect2(a.x,a.y);var l=this.m_mtStone[a.x][a.y];if(i&&!this.IsStoneFirst())return;if(this.m_nTool<CBoard.TOOL_LABEL){if(!(l.m_uFlag&CFlags.STATUS_SHOW)&&this.m_imgStone){var _,h=this.m_imgStone;var f=this.GetStoneImageRect();var C=GSGF.GT_EMPTY;if(this.m_parent!=null&&this.m_parent.IsPlayer!=undefined){var m=this.m_parent;if(m&&m.m_roominfo&&m.IsPlayer()&&!this.IsFlagEx(CBoard.BOARDEX_REVIEWMODE)){var u=m.GetMyColor();if(u==MDol.BLACK)C=GSGF.GT_BLACK;else if(u==MDol.WHITE)C=GSGF.GT_WHITE}}var T=this.GetNextColor();if(T==GSGF.GT_BLACK){f.Offset(f.Width(),0);t.Alpha(.4)}else if(T==GSGF.GT_WHITE){t.Alpha(.5)}if(C!=GSGF.GT_EMPTY){if(C==T)h.DrawEx(t,o.left,o.top,f,0);else{t.Alpha(.8);o.Deflate(o.Width()/4,o.Height()/4);if(C==GSGF.GT_BLACK)t.FillSolidRect(o,CColor.RGB(255,255,255));else t.FillSolidRect(o,CColor.RGB(0,0,0));t.RestoreAlpha()}}else{h.DrawEx(t,o.left,o.top,f,0)}t.RestoreAlpha()}}else{var S,c;if(l.m_uFlag&CFlags.STATUS_SHOW&&l.m_nColor==GSGF.GT_BLACK)S=16777215;else S=0;if(this.m_nTool==CBoard.TOOL_ERASER){var g=Math.floor(o.Width()/6);o.Deflate(g,g);t.DrawRectangle(o,4294967295,S)}else if(this.GetMark(a.x,a.y)==0){if(this.m_nTool==CBoard.TOOL_LABEL)c=this.GetNextLabelCharacter();else c=this.m_nTool+10;t.Alpha(.5);this.DrawShape(t,o,c,S);t.RestoreAlpha()}}}},IsShowNextStone:function(){if(this.m_uFlag&CFlags.STATUS_ENABLED){if(this.OrFlagEx(CBoard.BOARDEX_REFERMODE|CBoard.BOARDEX_REVIEWMODE))return true;if(this.m_rSGF.IsGega())return false;if(this.OrFlagEx(CBoard.BOARDEX_EDITABLE)&&this.m_nOrder!=CBoard.STONE_NONE)return true}return false},DrawMarkBack:function(t,e,i,n,s){var r,a,o,l,_,h,f,C,m;var u=s.Clone();r=Math.floor(i.Width()/6);i.Deflate(r,r);a=o=0;h=i.Width();f=i.Height();C=u.Width();m=u.Height();u.top+=(i.top-e.top)%m;for(_=0;_<3;_++){u.left=s.left+(i.left-e.left)%C;r=f-o;if(r<u.Height())u.bottom=u.top+r;for(l=0;l<3;l++){r=h-a;if(r<u.Width())u.right=u.left+r;n.DrawEx(t,i.left+a,i.top+o,u,0);a+=u.Width();u.left=s.left;u.right=s.right;if(a>=h)break}o+=u.Height();if(o>=f)break;a=0;u.top=s.top;u.bottom=s.bottom}},OnSize:function(){this.ResizeBoard()},ResizeBoard:function(){var t,e,i,n,s,r,a,o,l=0;r=this.GetRealRect();n=Math.min(r.Width(),r.Height());if(this.IsFlagEx(CBoard.BOARDEX_SHOWCOORD)){l=this.GetCoordGapSize();n-=l}s=this.m_nLine;var _=Math.floor(n/s);if(_>CBoard.SIZE_MAX_UNIT)_=CBoard.SIZE_MAX_UNIT;a=Math.floor(CBoard.SIZE_MAX_BOARDER*_/CBoard.SIZE_MAX_UNIT);if(a<2)a=2;n-=a*2;o=Math.floor(n/s);n=o*s+a*2;t=Math.floor((r.left+r.right)/2);e=Math.floor((r.top+r.bottom)/2);i=Math.floor((n+l)/2);r.left=t-i;r.top=e-i;r.right=r.left+n;r.bottom=r.top+n;this.m_nUS=o;this.m_nBnd=a;this.m_rcR.Set(r);var h=this.m_nUS;if(h>=23)h++;CBoard.SetStoneImageRect(h,this.m_rcStone);if(this.m_mtStone){var t,e,f;for(t=0;t<s;t++){for(e=0;e<s;e++){f=this.m_mtStone[t][e];this.GetStoneRect2(t,e,r);f.MoveObjectP(r)}}}if(this.m_terriPan)this.m_terriPan.MoveObjectP(this.GetClientRect());this.Invalidate()},GetStoneImageRect:function(){return this.m_rcStone.Clone()},ShowCoord:function(t){if(t==undefined)t=!this.IsFlagEx(CBoard.BOARDEX_SHOWCOORD);if(t)this.ModifyFlagEx(CBoard.BOARDEX_SHOWCOORD,0);else this.ModifyFlagEx(0,CBoard.BOARDEX_SHOWCOORD);this.ResizeBoard()},ShowNumber:function(t){if(t==undefined){if(this.IsFlagEx(CBoard.BOARDEX_SHOWNUM)){this.ModifyFlagEx(CBoard.BOARDEX_SHOWNUM2,CBoard.BOARDEX_SHOWNUM)}else if(!this.OrFlagEx(CBoard.BOARDEX_SHOWNUM_MASK)){this.ModifyFlagEx(CBoard.BOARDEX_SHOWNUM,0)}else{this.ModifyFlagEx(0,CBoard.BOARDEX_SHOWNUM_MASK)}}else{if(t)this.ModifyFlagEx(CBoard.BOARDEX_SHOWNUM,CBoard.BOARDEX_SHOWNUM2);else this.ModifyFlagEx(0,CBoard.BOARDEX_SHOWNUM_MASK)}this.Invalidate()},ShowAlpha:function(t){if(t==undefined)t=!this.IsFlagEx(CBoard.BOARDEX_SHOWALPHA);if(t)this.ModifyFlagEx(CBoard.BOARDEX_SHOWALPHA,0);else this.ModifyFlagEx(0,CBoard.BOARDEX_SHOWALPHA);this.Invalidate()},IsEmpty:function(){return this.m_rSGF==null},ClearGame:function(){this.m_nSaveIndex=-1;if(this.m_rSGF){this.m_rSGF.Delete();this.m_rSGF=null}if(this.m_cSGF){this.m_cSGF.Delete();this.m_cSGF=null}var t=CBoard.BOARDEX_DEADSTONE_MASK|4294901760;this.ModifyFlagEx(0,t);this.m_nType=0;this.m_nSyncLevel=0;this.m_aryChoice.RemoveAll();if(this.m_terriPan){this.m_terriPan.Destroy();this.m_terriPan=null}},NewGame:function(t,e,i,n,s){this.ClearGame();if(e==undefined)e=GSGF.DEFAULT_BOARD_WIDTH;switch(t){case CBoard.BOARDTYPE_GAMER:this.ModifyFlagEx(CBoard.BOARDEX_PLAYMODE,0);break;case CBoard.BOARDTYPE_TEACHER:case CBoard.BOARDTYPE_EXPLAINER:case CBoard.BOARDTYPE_EDITOR:this.m_nOrder=CBoard.STONE_FREE;this.ModifyFlagEx(CBoard.BOARDEX_PLAYMODE,0);break;case CBoard.BOARDTYPE_COMMENTATOR:case CBoard.BOARDTYPE_VIEWER:break}this.m_nType=t;this.m_rSGF=new CRuleSGF;if(t==CBoard.BOARDTYPE_EDITOR)this.m_rSGF.SetSingleBoard();this.ResetBoard(e);this.m_rSGF.NewBoard(e,i,n,s);this.SyncMatrix();if(this.m_linker){var r,a,o=this.m_linker.length;for(a=0;a<o;a++){r=this.m_linker[a];r.NewGame(t,e,i,n)}}this.SetTurnInfo();this.OnCurrentIndex();this.Invalidate()},OpenGame:function(t,e){this.ClearGame();if(e.indexOf("HS")!=-1){var i=new CStringFile(e);var n=new CGib2Sgf(i);if(!n.m_sgf)return;e=n.m_sgf.SaveBoard()}switch(t){case CBoard.BOARDTYPE_GAMER:case CBoard.BOARDTYPE_TEACHER:case CBoard.BOARDTYPE_EXPLAINER:case CBoard.BOARDTYPE_EDITOR:this.ModifyFlagEx(CBoard.BOARDEX_PLAYMODE,0);break;case CBoard.BOARDTYPE_COMMENTATOR:case CBoard.BOARDTYPE_VIEWER:break}this.m_nType=t;this.m_rSGF=new CRuleSGF;this.ResetBoard(this.m_rSGF.m_nLine);this.m_rSGF.OpenBoard(e);if(this.m_rSGF.m_refNode){this.ModifyFlagEx(CBoard.BOARDEX_REFERMODE,0)}this.SyncMatrix();if(this.m_linker){var s,r,a=this.m_linker.length;for(r=0;r<a;r++){s=this.m_linker[r];s.OpenGame(t,e)}}this.SetTurnInfo();this.OnCurrentIndex();this.Invalidate()},SaveGame:function(t){if(t==undefined)t=false;if(!this.m_rSGF)return"";if(t){var e=this.m_rSGF;if(this.m_cSGF)e=this.m_cSGF;return e.SaveBoard()}else{return this.m_rSGF.SaveBoard()}return""},SaveCurrentBoard:function(){if(this.m_cSGF)return this.m_cSGF.SaveCurrentBoard();else if(this.m_rSGF)return this.m_rSGF.SaveCurrentBoard();else return null},UploadSGF:function(t,e){this.EnableObject(true);var i=GSGF.CMD_OPENSGF+"|";if(e==""||e==null){this.NewGame(t,19,0,0,GSGF.TYPE_EMPTY);i+=this.SaveGame()}else{this.OpenGame(t,e);GSGF.bComment=false;e=this.SaveGame();GSGF.bComment=true;this.OpenGame(t,e);i+=e}this.UploadCommand(i)},LinkBoard:function(t){if(this.m_mother)this.m_mother.DeleteLinker(this);this.m_mother=t;if(t)t.AddLinker(this)},AddLinker:function(t){if(this.m_linker){if(this.m_linker.FindObject(t)!=-1)return}else{this.m_linker=new ObArray}this.m_linker.AddTail(t);var e=this.SaveGame();if(e!="")t.OpenGame(CBoard.BOARDTYPE_VIEWER,e)},DeleteLinker:function(t){if(this.m_linker)this.m_linker.RemoveObject(t)},SetCommandCallback:function(t,e){this.m_callback_upload=t;this.m_callback_info=e},UploadCommand:function(t){if(this.m_cSGF||this.IsViewer()||t==""||t==undefined)return false;var e=false;if(this.m_callback_upload){var i=t.charAt(0);if(i==GSGF.CMD_GAMESTONE){this.EnableGameTime(false)}this.m_callback_upload(t.charAt(0),t,t.length);if(i==GSGF.CMD_GAMESTONE||i==GSGF.CMD_REFERSTONE||i==GSGF.CMD_REFERPRESTONE)e=true}if(this.m_linker){var n,s,r=this.m_linker.length;for(s=0;s<r;s++){n=this.m_linker[s];n.DoCommand(t);n.SyncMatrix()}}return e},IsPutNodeStatus:function(){switch(this.m_nType){case CBoard.BOARDTYPE_GAMER:case CBoard.BOARDTYPE_EXPLAINER:case CBoard.BOARDTYPE_TEACHER:if(this.m_rSGF.IsSync()&&!this.IsFlagEx(CBoard.BOARDEX_REFERMODE))return true;break}return false},AddStone:function(t,e){var i,n="";if(this.IsEmpty())return false;var s=false;var r=false;if(this.GetMarkCount()>0)r=true;if(this.m_cSGF){if(this.IsFlagEx(CBoard.BOARDEX_REVIEWMODE)){n=this.m_cSGF.ReferStone(t,e,this.m_cSGF.GetNextColor(true))}}else{if(this.m_nType==CBoard.BOARDTYPE_EDITOR){n=this.m_rSGF.AddStone(t,e,this.m_rSGF.GetNextColor(false))}else if(this.m_nType==CBoard.BOARDTYPE_GAMER||this.m_nType==CBoard.BOARDTYPE_EXPLAINER){if(this.m_rSGF.IsSync()){i=this.m_rSGF.GetNextColor(false);if(this.m_nOrder!=CBoard.STONE_FREE&&i!=this.m_nOrder)return false;n=this.m_rSGF.GameStone(t,e,i)}}else if(this.m_nType==CBoard.BOARDTYPE_TEACHER){if(this.IsFlagEx(CBoard.BOARDEX_REFERMODE)){n=this.m_rSGF.ReferStone(t,e,this.m_rSGF.GetNextColor(true))}else if(this.m_rSGF.IsSync()){i=this.m_rSGF.GetNextColor(false);if(this.m_nOrder!=CBoard.STONE_FREE&&i!=this.m_nOrder)return false;n=this.m_rSGF.GameStone(t,e,i)}}else if(this.m_nType==CBoard.BOARDTYPE_COMMENTATOR){if(this.IsFlagEx(CBoard.BOARDEX_REFERMODE)){n=this.m_rSGF.ReferStone(t,e,this.m_rSGF.GetNextColor(true))}}if(n!=""||this.m_nType!=CBoard.BOARDTYPE_EDITOR){s=this.UploadCommand(n)}}if(n!=""){var a=0;if(!this.m_mother&&this.IsFlagEx(CBoard.BOARDEX_PUMPANI))this.SyncMatrix_Prev(t,e);else a=this.SyncMatrix(true);if(t!=-1&&e!=-1){this.m_mtStone[t][e].PutDown(s,a)}this.OnCurrentIndex(true);if(r||this.GetMarkCount()>0)this.Invalidate();return true}return false},CheckDeadStone:function(t,e,i){if(i==undefined)i=false;var n,s=this.m_rSGF.m_pboard.GetAt(t,e);if(s==GSGF.GT_EMPTY){if(!i)return 0;if(this.m_nOrder==CBoard.STONE_WHITE||this.m_nOrder==CBoard.STONE_FREE)s=GSGF.GT_WHITE;else if(this.m_nOrder==CBoard.STONE_BLACK)s=GSGF.GT_BLACK;else return-1}else{if(this.m_nOrder!=CBoard.STONE_FREE&&this.m_nOrder!=s)return-1}n=this.m_rSGF.RemoveDeadStone(t,e,s);if(n!=""){this.UploadCommand(n);this.SyncMatrix();this.Invalidate();return 1}return-1},AddMark:function(t,e,i){var n,s=null;if(this.m_cSGF)n=this.m_cSGF;else n=this.m_rSGF;var r=false;if(this.GetMarkCount()>0)r=true;switch(i){case CBoard.TOOL_BLACK:if(this.m_nType==CBoard.BOARDTYPE_EDITOR)s=n.AddPreStone(t,e,GSGF.GT_BLACK);else if(this.OrFlagEx(CBoard.BOARDEX_RMASK))s=n.ReferPreStone(t,e,GSGF.GT_BLACK);break;case CBoard.TOOL_WHITE:if(this.m_nType==CBoard.BOARDTYPE_EDITOR)s=n.AddPreStone(t,e,GSGF.GT_WHITE);else if(this.OrFlagEx(CBoard.BOARDEX_RMASK))s=n.ReferPreStone(t,e,GSGF.GT_WHITE);break;case CBoard.TOOL_LABEL:case CBoard.TOOL_CIRCLE:case CBoard.TOOL_CROSS:case CBoard.TOOL_RECT:case CBoard.TOOL_TRIANGLE:if(this.m_nType==CBoard.BOARDTYPE_EDITOR||this.OrFlagEx(CBoard.BOARDEX_RMASK))s=n.AddMark(t,e,i);break;case CBoard.TOOL_ERASER:if(this.m_nType==CBoard.BOARDTYPE_EDITOR||this.OrFlagEx(CBoard.BOARDEX_RMASK))s=n.EraseMark(t,e);break}if(r||s&&this.GetMarkCount()>0)this.Invalidate();if(s!=""){this.UploadCommand(s);this.SyncMatrix();return true}return false},DoCommand:function(t,e,i){var n=this.m_ptTmp;n.x=n.y=-1;if(gMain.IsFlagCfg(MConfigFlag.F_NO_SHOW_PUT_STONE))this.ModifyFlagEx(0,CBoard.BOARDEX_PUMPANI);else this.ModifyFlagEx(CBoard.BOARDEX_PUMPANI,0);this.CheckCurrentIndex();var s=this.m_rSGF.DoCommand(t,n);if(s==null)return 0;if(this.m_cSGF){if(s==GSGF.CMD_GAMESTONE||s==GSGF.CMD_SETBACK){var r=this.m_cSGF.m_curNode;this.m_cSGF.DoCommand(t);this.m_cSGF.m_curNode=r}e=i=null}else{if(s==GSGF.CMD_DEADSTONE||s==GSGF.CMD_DEADSTONE_CANCEL||s==GSGF.CMD_DEADSTONE_CONFIRM||s==GSGF.CMD_DEADSTONE_RETRY){e=i=null}}if(e&&i){this.UpdateGameTime(e.m_nTimeleft,e.m_nChoilggi_cnt,e.m_nChoilggi_sec,i.m_nTimeleft,i.m_nChoilggi_cnt,i.m_nChoilggi_sec)}if(s==GSGF.CMD_REFERMODE_ON){this.ModifyFlagEx(CBoard.BOARDEX_REFERMODE,0)}else if(s==GSGF.CMD_REFERMODE_OFF){this.ModifyFlagEx(0,CBoard.BOARDEX_REFERMODE)}else if(s==GSGF.CMD_GAMESTONE||s==GSGF.CMD_SETBACK){var a=false;var o=new GNode;o.m_str=GSGF.TokenRight(t,"|");o.ParsingNode();if(o.m_ptPos&&o.m_ptPos.x==-1&&o.m_ptPos.y==-1)a=true;o.Delete();if(a)this.EnableGameTime(false);else this.EnableGameTime(true)}var l=0;var _=false;var h=false;if(!this.m_mother&&(s==GSGF.CMD_GAMESTONE||s==GSGF.CMD_REFERSTONE)){if(this.IsFlagEx(CBoard.BOARDEX_PUMPANI))_=true;h=true}if(_)this.SyncMatrix_Prev(n.x,n.y);else l=this.SyncMatrix(h);if(n.x>=0&&n.y>=0){if(s==GSGF.CMD_ADDMARK||s==GSGF.CMD_ERASEMARK){this.InvalidateRect(this.GetStoneRect2(n.x,n.y))}else{this.m_mtStone[n.x][n.y].PutDownPartner(l)}}else if(n.x==-2&&n.y==-2){this.Invalidate()}if(s==GSGF.CMD_OPENSGF){this.SetTurnInfo();this.Invalidate()}this.OnCurrentIndex();if(this.m_linker){var f,C,m=this.m_linker.length;for(C=0;C<m;C++){f=this.m_linker[C];f.DoCommand(t)}}return s},OnMyCommand:function(t,e,i){var n=this.DelayDown(t);if(n==GSGF.CMD_GAMESTONE||n==GSGF.CMD_SETBACK){this.UpdateGameTime(e.m_nTimeleft,e.m_nChoilggi_cnt,e.m_nChoilggi_sec,i.m_nTimeleft,i.m_nChoilggi_cnt,i.m_nChoilggi_sec);this.EnableGameTime(true)}return n},DelayDown:function(t){var e=t.charAt(0);if(e==GSGF.CMD_GAMESTONE||e==GSGF.CMD_REFERSTONE||e==GSGF.CMD_REFERPRESTONE){var i=new GNode;i.m_str=GSGF.TokenRight(t,"|");i.ParsingNode();if(GSGF.IsValidPos(i.m_ptPos,this.m_nLine)){this.m_mtStone[i.m_ptPos.x][i.m_ptPos.y].PutDownEnd()}i.Delete();i=null}return e},IsStoneFirst:function(){if(this.m_rSGF.IsSync()&&this.IsFlagEx(CBoard.BOARDEX_PLAYMODE)&&!this.IsFlagEx(CBoard.BOARDEX_REFERMODE))return true;else return false},HitNextStone:function(t,e){if(this.IsEmpty())return false;var i=this.m_aryChoice.length;if(i>1){var n,s,r;for(n=1;n<i;n++){s=this.m_aryChoice[n].m_ptPos;if(s&&s.x==t&&s.y==e){var a=false;if(this.GetMarkCount()>0)a=true;if(this.m_cSGF){ret=this.m_cSGF.NextStone(s.x,s.y)}else if(!this.IsStoneFirst()){if(this.IsViewer()){this.m_rSGF.SetViewSync(false)}ret=this.m_rSGF.NextStone(s.x,s.y)}else return false;if(ret!="")this.UploadCommand(ret);if(a||this.GetMarkCount()>0)this.Invalidate();this.SyncMatrix();this.OnCurrentIndex(true);return true}}}return false},SetBack:function(t){if(this.IsEmpty())return false;var e=this.m_rSGF.SetBack(t);if(e!=""){this.UploadCommand(e);this.SyncMatrix();this.OnCurrentIndex(true);return true}return false},SetError:function(t,e){if(this.IsEmpty())return false;this.m_mtStone[t][e].PutDownError();this.m_rSGF.SetError();this.SyncMatrix();this.OnCurrentIndex(true)},Pass:function(t){if(this.IsEmpty())return false;var e=this.m_rSGF.Pass(t);if(e!=""){this.UploadCommand(e);this.SyncMatrix();this.OnCurrentIndex(true);return true}return false},Equal:function(){if(this.IsEmpty())return false;return false},Throw:function(){if(this.IsEmpty())return false;return false},Save:function(){if(this.IsEmpty())return"";var t=this.m_rSGF.SaveBoard();return t},ArrowMove:function(t){if(this.IsEmpty())return;this.CheckCurrentIndex();var e=false;if(this.GetMarkCount()>0)e=true;var i;if(this.m_cSGF){i=this.m_cSGF}else{i=this.m_rSGF;if(this.IsViewer())i.SetViewSync(false)}if(t==-999){var n=i.GetLastBranchBackCount();if(n>0)t=n*-1}var s=i.ArrowMove(t);if(i.m_curNode==i.m_viewNode){i.m_bViewSync=true}if(s!=""){if(s.length>1)this.UploadCommand(s);this.SyncMatrix()}if(e||this.GetMarkCount()>0)this.Invalidate();this.OnCurrentIndex()},SetMove:function(t){if(this.IsEmpty())return;this.m_nSaveIndex=-1;var e=false;if(this.GetMarkCount()>0)e=true;var i;if(this.m_cSGF){i=this.m_cSGF}else{i=this.m_rSGF;if(this.IsViewer())i.SetViewSync(false)}var n=i.SetMove(t);if(i.m_curNode==i.m_viewNode){i.m_bViewSync=true}if(n!=""){if(n.length>1)this.UploadCommand(n);this.SyncMatrix()}if(e||this.GetMarkCount()>0)this.Invalidate();this.OnCurrentIndex()},UpdateChoiceRect:function(){var t,e,i=this.m_aryChoice.length;if(i>1){for(t=0;t<i;t++){e=this.m_aryChoice[t].m_ptPos;if(e&&e.x!=-1&&e.y!=-1){this.InvalidateRect(this.GetStoneRect2(e.x,e.y))}}}},SetReferMode:function(t){if(this.IsEmpty())return false;var e=null;this.SetTool(0);if(t){this.ModifyFlagEx(CBoard.BOARDEX_REFERMODE,0);e=this.m_rSGF.SetReferMode(true)}else{this.CheckCurrentIndex();this.ModifyFlagEx(0,CBoard.BOARDEX_REFERMODE);e=this.m_rSGF.SetReferMode(false);this.OnCurrentIndex()}if(e!=""){this.UploadCommand(e);this.SyncMatrix()}this.Invalidate();return true},SetReviewMode:function(t){if(this.IsEmpty())return false;if(this.m_cSGF){this.m_cSGF.Delete();this.m_cSGF=null}this.SetTool(0);if(t){this.m_cSGF=new CRuleSGF;var e=this.m_rSGF.SaveBoard();this.m_cSGF.OpenBoard(e);this.m_cSGF.Travel(GSGF.TRAVEL_RESETTEMP,this.m_cSGF,null);this.m_cSGF.Generate(this.m_cSGF.m_curNode,this.m_cSGF.m_cboard);this.ModifyFlagEx(CBoard.BOARDEX_REVIEWMODE,0)}else{this.ModifyFlagEx(0,CBoard.BOARDEX_REVIEWMODE);this.OnCurrentIndex(true)}this.SyncMatrix();this.Invalidate();return true},CheckSyncLevel:function(){if(this.IsEmpty())return;var t;if(this.m_cSGF){t=3}else{if(!this.m_rSGF.m_bViewSync)t=4;else if(this.IsFlagEx(CBoard.BOARDEX_REFERMODE))t=2;else if(this.m_rSGF.IsSync())t=0;else t=1}if(t!=this.m_nSyncLevel){this.m_nSyncLevel=t;switch(this.m_nSyncLevel){case 2:this.m_crLevel=4816383;break;case 3:this.m_crLevel=16735014;break;case 4:this.m_crLevel=5263440;break;default:this.m_crLevel=9671571;break}if(this.m_menu){this.m_menu.m_crBk=this.m_crLevel;this.m_menu.Invalidate()}this.Invalidate()}},SetTool:function(t){this.m_nTool=t},GetNextLabelCharacter:function(){if(this.m_cSGF)return this.m_cSGF.m_cboard.m_nNextCode;else if(this.m_rSGF)return this.m_rSGF.m_cboard.m_nNextCode;else return GSGF.GT_CHAR_START},GetCurrentIndex:function(){var t,e;if(this.m_cSGF)t=this.m_cSGF;else t=this.m_rSGF;if(t.IsViewSync()){if(t.IsSync())e=t.m_pboard.m_nStoneIndex;else e=t.m_cboard.m_nStoneIndex}else{e=t.m_vboard.m_nStoneIndex}return e},GetSusunNum:function(){if(this.m_rSGF)return this.m_rSGF.m_pboard.m_nStoneIndex;else return-1},SaveRefer:function(){if(this.IsFlagEx(CBoard.BOARDEX_REVIEWMODE)){this.m_cSGF.SaveRefer()}else if(this.IsFlagEx(CBoard.BOARDEX_REFERMODE)){var t=this.m_rSGF.SaveRefer();if(t!="")this.UploadCommand(t)}},DocumentAdd:function(t){var e=this.m_rSGF.DocumentAdd(t);if(e!="")this.UploadCommand(e)},DocumentSet:function(t){var e=this.m_rSGF.DocumentSet(t);if(e!="")this.UploadCommand(e)},DocumentDel:function(){var t=this.m_rSGF.DocumentDel();if(t!="")this.UploadCommand(t)},OnGegaStart:function(){if(this.m_nOrder!=CBoard.STONE_NONE&&this.m_nType>=CBoard.BOARDTYPE_GAMER&&this.m_nType<=CBoard.BOARDTYPE_EXPLAINER){if(this.IsFlagEx(CBoard.BOARDEX_REVIEWMODE))this.SetReviewMode(false);if(this.IsFlagEx(CBoard.BOARDEX_REFERMODE))this.SetReferMode(false);if(!this.m_rSGF.IsSync())this.ArrowMove(999)}this.ModifyFlagEx(CBoard.BOARDEX_DEADSTONE,0)},DeadStoneCancel:function(){if(this.m_nOrder!=CBoard.STONE_NONE&&this.m_nType>=CBoard.BOARDTYPE_GAMER&&this.m_nType<=CBoard.BOARDTYPE_EXPLAINER){var t=this.m_rSGF.DeadStoneCancel(this.m_nOrder);if(t!=""){this.UploadCommand(t);this.SyncMatrix();this.Invalidate()}}},DeadStoneConfirm:function(){if(this.m_nOrder!=CBoard.STONE_NONE&&this.m_nType>=CBoard.BOARDTYPE_GAMER&&this.m_nType<=CBoard.BOARDTYPE_EXPLAINER){this.EnableObject(false);this.ModifyFlagEx(CBoard.BOARDEX_DEADSTONE_CONFIRM,0);var t=this.m_rSGF.DeadStoneConfirm(this.m_nOrder);if(t!="")this.UploadCommand(t)}},DeadStoneRetry:function(){if(this.m_nOrder!=CBoard.STONE_NONE&&this.m_nType>=CBoard.BOARDTYPE_GAMER&&this.m_nType<=CBoard.BOARDTYPE_EXPLAINER){this.EnableObject(true);this.ModifyFlagEx(0,CBoard.BOARDEX_DEADSTONE_CONFIRM);var t=this.m_rSGF.DeadStoneRetry(this.m_nOrder);if(t!="")this.UploadCommand(t)}},SetGameTime:function(t,e,i,n,s,r){this.m_whiteTime.Set(t,e,i);this.m_blackTime.Set(n,s,r);if(this.m_callback_info)this.m_callback_info(CBoard.CMD_TIME_UPDATE,CBoard.STONE_FREE,0,false,0)},UpdateGameTime:function(t,e,i,n,s,r){this.m_whiteTime.Update(t,e,i);this.m_blackTime.Update(n,s,r);if(this.m_callback_info)this.m_callback_info(CBoard.CMD_TIME_UPDATE,CBoard.STONE_FREE,0,false,0)},UpdateGameTimeTarget:function(t,e,i,n){if(t==MDol.WHITE)this.m_whiteTime.Update(e,i,n);else if(t==MDol.BLACK)this.m_blackTime.Update(e,i,n);if(this.m_callback_info)this.m_callback_info(CBoard.CMD_TIME_UPDATE,t,0,false,0)},EnableGameTime:function(t){if(t){var e=this.SetTurnInfo();if(e==GSGF.GT_WHITE&&this.m_whiteTime.IsLimit()){this.SetTimer(CBoard.TIMER_PLAYER_WHITE,CBoard.TIC_SECOND);this.KillTimer(CBoard.TIMER_PLAYER_BLACK)}else if(e==GSGF.GT_BLACK&&this.m_blackTime.IsLimit()){this.SetTimer(CBoard.TIMER_PLAYER_BLACK,CBoard.TIC_SECOND);this.KillTimer(CBoard.TIMER_PLAYER_WHITE)}}else{if(this.m_whiteTime.IsLimit())this.KillTimer(CBoard.TIMER_PLAYER_WHITE);if(this.m_blackTime.IsLimit())this.KillTimer(CBoard.TIMER_PLAYER_BLACK)}},OnTimer:function(t,e,i,n){this._super(t,e,i,n);if(t==CBoard.TIMER_PLAYER_WHITE||t==CBoard.TIMER_PLAYER_BLACK){if(this.m_callback_info==null){this.KillTimer(t);return}var s,r,a,o=Math.floor(i);if(t==CBoard.TIMER_PLAYER_WHITE){r=this.m_whiteTime;s=GSGF.GT_WHITE}else{r=this.m_blackTime;s=GSGF.GT_BLACK}a=r.Calculate(o);if(a==-1){this.KillTimer(t);return}else if(a==-2){this.KillTimer(t);if(r.m_nSetChoilggiSec!=10)this.m_stage.PlaySoundEx("counting",this.m_parent)}else if(a==-3||a>=1&&a<=5){if(r.m_nChoilggiSec<10&&r.m_nChoilggiCnt>=0){this.m_stage.PlaySoundEx("count"+(10-r.m_nChoilggiSec),this.m_parent)}}if(a>=1&&a<=5){if(r.m_nSetChoilggiSec!=10){var l=r.m_nSetChoilggiCnt-a;this.m_stage.PlaySoundEx("remain"+l,this.m_parent)}this.KillTimer(t)}this.UpdateGameTimeTarget(s,r.m_nTimeLeft,r.m_nChoilggiCnt,r.m_nChoilggiSec);if(a>0){ret=this.m_rSGF.SetTimeStatus(s,a);if(ret!=""&&s==this.m_nOrder)this.UploadCommand(ret)}}},IsBothConfirm:function(){return this.m_rSGF.IsBothConfirm()},GetHouse:function(t){return this.m_rSGF.GetHouse(t)},OnGegaEnd:function(t){if(this.m_nOrder!=CBoard.STONE_NONE&&this.m_nType>=CBoard.BOARDTYPE_GAMER&&this.m_nType<=CBoard.BOARDTYPE_EXPLAINER){this.EnableObject(true)}this.ModifyFlagEx(0,CBoard.BOARDEX_DEADSTONE_MASK)},ShowGegaMenu:function(t,e){if(this.m_nBigPos.x==-1&&this.m_nBigPos.y==-1){this.m_nBigPos.x=t;this.m_nBigPos.y=e;var i=this.GetStoneRect(t,e);var n=i.CenterPoint();this.ClientToStage(n);var s=new vx.menu(0,CFlags.VXBOX_BORDERFLAT|CFlags.VXMENU_USESAHDOW|CFlags.VXMENU_WANTCLOSEEVENT,"icon.png","shadow.png");s.SetMenuProperty(CMyDefine.MENULINE_HEIGHT,0,15,0);s.SetBackColor(16777215,CColor.RGB(108,108,108),0,0);s.SetTextColor(0,16777215,16777215,4294967295,4294967295);s.SetEdgeColor(16777215,0,16777215,0);s.CreatePopupMenu(menu.IDR_MENU1,0,-1,n.x,n.y,this);this.InvalidateRect(this.GetStoneRect2(t,e))}},IsViewer:function(){return this.m_nType==CBoard.BOARDTYPE_VIEWER},ResetReviewRefer:function(){var t=0;if(this.m_cSGF)t=this.m_cSGF.GetLastBranchBackCount(true);else t=this.m_rSGF.GetLastBranchBackCount();if(t>0)this.ArrowMove(t*-1)},CheckCurrentIndex:function(){this.m_nSaveIndex=this.GetCurrentIndex()},OnCurrentIndex:function(t){if(t==undefined)t=false;var e=this.GetCurrentIndex();if(t||this.m_nSaveIndex!=e){this.m_nSaveIndex=e;var i=this.m_rSGF.m_viewNode["_C"];if(!GSGF.IsValid(i))i="";this.NotifyParent(CMyDefine.CMD_BOARD_VIEWEXPLAIN,i,e)}},SetTurnInfo:function(){if(!this.m_rSGF)return 0;var t=this.m_rSGF.m_pboard.m_nNextColor;if(this.m_callback_info){var e=this.m_rSGF.m_pboard.m_szDead;var i=this.m_rSGF.m_pboard.m_nStoneIndex;this.m_callback_info(CBoard.CMD_SET_TURN,t,i,e.x,e.y)}return t},IsViewSync:function(t){if(t==undefined)t=false;if(this.m_rSGF){var e=this.m_rSGF.IsViewSync();if(t)return e&&this.m_rSGF.m_bViewSync;else return e}return false},SyncExpView:function(){if(this.m_rSGF){this.m_rSGF.SetViewSync(true);this.SyncMatrix();this.Invalidate();this.OnCurrentIndex()}},ReplaceHeader:function(t){if(this.m_rSGF){this.m_rSGF.Clear();this.m_rSGF.m_str=t;this.m_rSGF.ParsingNode()}},PlayStoneSound:function(t){if(this.m_mother||t==undefined)return;var e;if(t>10)e="stone3";else if(t>3)e="stone2";else if(t>0)e="stone1";else e="stone0";this.m_stage.PlaySoundEx(e,this.m_parent)},GetStoneString:function(t){if(this.IsEmpty())return"";var e,i="";if(this.m_cSGF)e=this.m_cSGF;else e=this.m_rSGF;var n,s,r=this.m_nLine;var a,o;for(n=0;n<r;n++){for(s=0;s<r;s++){if(t)a=e.GetStone(s,n);else a=e.GetStone(n,s);o=a.nValue;switch(o){case GSGF.GT_BLACK:i+="1";break;case GSGF.GT_WHITE:i+="2";break;default:i+="0";break}}}return i},SetBkIdx:function(t){this.m_idxB=t;this.Invalidate()},IsReview:function(t){var e=CBoard.BOARDEX_REVIEWMODE;if(t==undefined)t=false;if(t)e|=CBoard.BOARDEX_REFERMODE;return this.OrFlagEx(e)},ShowTerritory:function(t,e){if(e==undefined)e=false;var i=this.m_terriPan;if(t==null){if(i)i.SetTerritory(null);return""}else{if(i==null){i=new CTerriPanel;i.CreateP(this.m_stage,this.GetClientRect(),CDefine.VXID_NONE,CFlags.STATUS_NOMESSAGE,0,this);this.m_terriPan=i}var n,s=CMyGlobal.GetTerritoryText(t.calc,t.bzip,t.wzip);if(e)n=s;else n="";i.SetTerritory(t,n);return s}}});CBoard.SIZE_COORD=10;CBoard.SIZE_MIN_UNIT=10;CBoard.SIZE_MAX_UNIT=59;CBoard.SIZE_MAX_BOARDER=8;CBoard.BOARDEX_SHOWCOORD=1;CBoard.BOARDEX_SHOWNUM=2;CBoard.BOARDEX_SHOWNUM2=4;CBoard.BOARDEX_SHOWNUM_MASK=6;CBoard.BOARDEX_NODRAW_SYNCLEVEL=8;CBoard.BOARDEX_SHOWALPHA=16;CBoard.BOARDEX_PUMPANI=32;CBoard.BOARDEX_X_DIGIT=64;CBoard.BOARDEX_Y_ALPHABET=128;CBoard.BOARDTYPE_VIEWER=0;CBoard.BOARDTYPE_COMMENTATOR=1;CBoard.BOARDTYPE_GAMER=2;CBoard.BOARDTYPE_TEACHER=3;CBoard.BOARDTYPE_EXPLAINER=4;CBoard.BOARDTYPE_EDITOR=5;CBoard.BOARDEX_DEADSTONE=256;CBoard.BOARDEX_DEADSTONE_CONFIRM=512;CBoard.BOARDEX_DEADSTONE_MASK=768;CBoard.BOARDEX_PLAYMODE=65536;CBoard.BOARDEX_REFERMODE=131072;CBoard.BOARDEX_REVIEWMODE=262144;CBoard.BOARDEX_RMASK=393216;CBoard.BOARDEX_EDITMODE=524288;CBoard.BOARDEX_EDITABLE=983040;CBoard.STONE_NONE=0;CBoard.STONE_BLACK=1;CBoard.STONE_WHITE=2;CBoard.STONE_FREE=3;CBoard.TOOL_ALTERNATIVE=0;CBoard.TOOL_BLACK=1;CBoard.TOOL_WHITE=2;CBoard.TOOL_LABEL=3;CBoard.TOOL_CIRCLE=4;CBoard.TOOL_CROSS=5;CBoard.TOOL_RECT=6;CBoard.TOOL_TRIANGLE=7;CBoard.TOOL_ERASER=8;CBoard.TIMER_PLAYER_BLACK=5001;CBoard.TIMER_PLAYER_WHITE=5002;CBoard.TIC_SECOND=1e3;CBoard.CMD_SET_TURN=1;CBoard.CMD_TIME_UPDATE=2;CBoard.GetBoardRect=function(t){var e=t.Clone();var i=e.Width();var n=e.Height();if(i>n)len=n;else len=i;e.left+=Math.floor((i-len)/2);e.right=e.left+len;e.top+=Math.floor((n-len)/2);e.bottom=e.top+len;return e};CBoard.GetPos=function(t){var e,i,n=GSGF.TokenLeft(t,"|");if(n=="")return null;var s=new GNode;s.m_str=GSGF.TokenRight(t,"|");s.ParsingNode();if(s.m_ptPos==null){return null}var e=s.m_ptPos;s.m_ptPos=null;s.Delete();s=null;return e};CBoard.SetStoneImageRect=function(t,e){if(e==undefined)e=CUtil.CRect(0,0,0,0);var i,n,s,r,a=0;if(t<10)t=10;else if(t>90)t=90;if(t<47){r=0;s=10}else if(t<65){r=92;s=47}else if(t<79){r=220;s=65}else{r=376;s=79;n=t-79}n=t-s;for(i=0;i<n;i++){a+=s+i}e.SetRect(r,a,r+t,a+t);return e};